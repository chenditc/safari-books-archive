<!--[if IE]><![endif]--><!DOCTYPE html><!--[if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/streaming-systems/9781491983867/ch09.html"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="3905629"
  data-user-uuid="f04af719-1c84-4fc3-9be3-1f1b4622ab99"
  data-username="safaribooksonline122"
  data-account-type="Trial"
  
  data-activated-trial-date="12/09/2018"


  data-archive="9781491983867"
  data-publishers="O&#39;Reilly Media, Inc."



  data-htmlfile-name="ch09.html"
  data-epub-title="Streaming Systems" data-debug=0 data-testing=0><![endif]--><!--[if gt IE 8]><!--><html class="js flexbox flexboxlegacy no-touch websqldatabase indexeddb history csscolumns csstransforms localstorage sessionstorage applicationcache svg inlinesvg zoom gr__safaribooksonline_com" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#" itemscope="" itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/" data-offline-url="/" data-url="/library/view/streaming-systems/9781491983867/ch09.html" data-csrf-cookie="csrfsafari" data-highlight-privacy="" data-user-id="3905629" data-user-uuid="f04af719-1c84-4fc3-9be3-1f1b4622ab99" data-username="safaribooksonline122" data-account-type="Trial" data-activated-trial-date="12/09/2018" data-archive="9781491983867" data-publishers="O'Reilly Media, Inc." data-htmlfile-name="ch09.html" data-epub-title="Streaming Systems" data-debug="0" data-testing="0" style=""><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="Safari Books Online"><meta name="format-detection" content="telephone=no"><meta http-equiv="cleartype" content="on"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="apple-itunes-app" content="app-id=881697395, app-argument=safaridetail://9781491983867"><meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0"><meta property="twitter:account_id" content="4503599627559754"><link rel="apple-touch-icon" href="https://www.safaribooksonline.com/static/images/apple-touch-icon.0c29511d2d72.png"><link rel="shortcut icon" href="https://www.safaribooksonline.com/favicon.ico" type="image/x-icon"><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700,900,200italic,300italic,400italic,600italic,700italic,900italic" rel="stylesheet" type="text/css"><title>9. Streaming Joins - Streaming Systems</title><link rel="stylesheet" href="https://www.safaribooksonline.com/static/CACHE/css/5e586a47a3b7.css" type="text/css"><link rel="stylesheet" type="text/css" href="https://www.safaribooksonline.com/static/css/annotator.e3b0c44298fc.css"><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css"><style type="text/css" title="ibis-book">
    @charset "utf-8";#sbo-rt-content html,#sbo-rt-content div,#sbo-rt-content div,#sbo-rt-content span,#sbo-rt-content applet,#sbo-rt-content object,#sbo-rt-content iframe,#sbo-rt-content h1,#sbo-rt-content h2,#sbo-rt-content h3,#sbo-rt-content h4,#sbo-rt-content h5,#sbo-rt-content h6,#sbo-rt-content p,#sbo-rt-content blockquote,#sbo-rt-content pre,#sbo-rt-content a,#sbo-rt-content abbr,#sbo-rt-content acronym,#sbo-rt-content address,#sbo-rt-content big,#sbo-rt-content cite,#sbo-rt-content code,#sbo-rt-content del,#sbo-rt-content dfn,#sbo-rt-content em,#sbo-rt-content img,#sbo-rt-content ins,#sbo-rt-content kbd,#sbo-rt-content q,#sbo-rt-content s,#sbo-rt-content samp,#sbo-rt-content small,#sbo-rt-content strike,#sbo-rt-content strong,#sbo-rt-content sub,#sbo-rt-content sup,#sbo-rt-content tt,#sbo-rt-content var,#sbo-rt-content b,#sbo-rt-content u,#sbo-rt-content i,#sbo-rt-content center,#sbo-rt-content dl,#sbo-rt-content dt,#sbo-rt-content dd,#sbo-rt-content ol,#sbo-rt-content ul,#sbo-rt-content li,#sbo-rt-content fieldset,#sbo-rt-content form,#sbo-rt-content label,#sbo-rt-content legend,#sbo-rt-content table,#sbo-rt-content caption,#sbo-rt-content tdiv,#sbo-rt-content tfoot,#sbo-rt-content thead,#sbo-rt-content tr,#sbo-rt-content th,#sbo-rt-content td,#sbo-rt-content article,#sbo-rt-content aside,#sbo-rt-content canvas,#sbo-rt-content details,#sbo-rt-content embed,#sbo-rt-content figure,#sbo-rt-content figcaption,#sbo-rt-content footer,#sbo-rt-content header,#sbo-rt-content hgroup,#sbo-rt-content menu,#sbo-rt-content nav,#sbo-rt-content output,#sbo-rt-content ruby,#sbo-rt-content section,#sbo-rt-content summary,#sbo-rt-content time,#sbo-rt-content mark,#sbo-rt-content audio,#sbo-rt-content video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}#sbo-rt-content article,#sbo-rt-content aside,#sbo-rt-content details,#sbo-rt-content figcaption,#sbo-rt-content figure,#sbo-rt-content footer,#sbo-rt-content header,#sbo-rt-content hgroup,#sbo-rt-content menu,#sbo-rt-content nav,#sbo-rt-content section{display:block}#sbo-rt-content div{line-height:1}#sbo-rt-content ol,#sbo-rt-content ul{list-style:none}#sbo-rt-content blockquote,#sbo-rt-content q{quotes:none}#sbo-rt-content blockquote:before,#sbo-rt-content blockquote:after,#sbo-rt-content q:before,#sbo-rt-content q:after{content:none}#sbo-rt-content table{border-collapse:collapse;border-spacing:0}@page{margin:5px !important}#sbo-rt-content p{margin:10px 0 0;line-height:125%;text-align:left}#sbo-rt-content p.byline{text-align:left;margin:-33px auto 35px;font-style:italic;font-weight:bold}#sbo-rt-content div.preface p+p.byline{margin:1em 0 0 !important}#sbo-rt-content div.preface p.byline+p.byline{margin:0 !important}#sbo-rt-content div.sect1>p.byline{margin:-.25em 0 1em}#sbo-rt-content div.sect1>p.byline+p.byline{margin-top:-1em}#sbo-rt-content em{font-style:italic;font-family:inherit}#sbo-rt-content em strong,#sbo-rt-content strong em{font-weight:bold;font-style:italic;font-family:inherit}#sbo-rt-content strong,#sbo-rt-content span.bold{font-weight:bold}#sbo-rt-content em.replaceable{font-style:italic}#sbo-rt-content strong.userinput{font-weight:bold;font-style:normal}#sbo-rt-content span.bolditalic{font-weight:bold;font-style:italic}#sbo-rt-content a.ulink,#sbo-rt-content a.xref,#sbo-rt-content a.email,#sbo-rt-content a.link,#sbo-rt-content a{text-decoration:none;color:#8e0012}#sbo-rt-content span.lineannotation{font-style:italic;color:#a62a2a;font-family:serif}#sbo-rt-content span.underline{text-decoration:underline}#sbo-rt-content span.strikethrough{text-decoration:line-through}#sbo-rt-content span.smallcaps{font-variant:small-caps}#sbo-rt-content span.cursor{background:#000;color:#fff}#sbo-rt-content span.smaller{font-size:75%}#sbo-rt-content .boxedtext,#sbo-rt-content .keycap{border-style:solid;border-width:1px;border-color:#000;padding:1px}#sbo-rt-content span.gray50{color:#7F7F7F;}#sbo-rt-content h1,#sbo-rt-content div.toc-title,#sbo-rt-content h2,#sbo-rt-content h3,#sbo-rt-content h4,#sbo-rt-content h5{-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;font-weight:bold;text-align:left;page-break-after:avoid !important;font-family:sans-serif,"DejaVuSans"}#sbo-rt-content div.toc-title{font-size:1.5em;margin-top:20px !important;margin-bottom:30px !important}#sbo-rt-content section[data-type="sect1"] h1{font-size:1.3em;color:#8e0012;margin:40px 0 8px 0}#sbo-rt-content section[data-type="sect2"] h2{font-size:1.1em;margin:30px 0 8px 0 !important}#sbo-rt-content section[data-type="sect3"] h3{font-size:1em;color:#555;margin:20px 0 8px 0 !important}#sbo-rt-content section[data-type="sect4"] h4{font-size:1em;font-weight:normal;font-style:italic;margin:15px 0 6px 0 !important}#sbo-rt-content section[data-type="chapter"]>div>h1,#sbo-rt-content section[data-type="preface"]>div>h1,#sbo-rt-content section[data-type="appendix"]>div>h1,#sbo-rt-content section[data-type="glossary"]>div>h1,#sbo-rt-content section[data-type="bibliography"]>div>h1,#sbo-rt-content section[data-type="index"]>div>h1{font-size:2em;line-height:1;margin-bottom:50px;color:#000;padding-bottom:10px;border-bottom:1px solid #000}#sbo-rt-content span.label,#sbo-rt-content span.keep-together{font-size:inherit;font-weight:inherit}#sbo-rt-content div[data-type="part"] h1{font-size:2em;text-align:center;margin-top:0 !important;margin-bottom:50px;padding:50px 0 10px 0;border-bottom:1px solid #000}#sbo-rt-content img.width-ninety{width:90%}#sbo-rt-content img{max-width:95%;margin:0 auto;padding:0}#sbo-rt-content div.figure{background-color:transparent;text-align:center !important;margin:15px 0 15px 0 !important;page-break-inside:avoid}#sbo-rt-content figure{margin:15px 0 15px 0 !important;page-break-inside:avoid}#sbo-rt-content div.figure h6,#sbo-rt-content figure h6,#sbo-rt-content figure figcaption{font-size:.9rem !important;text-align:center;font-weight:normal !important;font-style:italic;font-family:serif !important;text-transform:none !important;letter-spacing:normal !important;color:#000 !important;padding-top:10px !important;page-break-before:avoid}#sbo-rt-content div.informalfigure{text-align:center !important;padding:5px 0 !important}#sbo-rt-content div.sidebar{margin:15px 0 10px 0 !important;border:1px solid #DCDCDC;background-color:#F7F7F7;padding:15px !important;page-break-inside:avoid}#sbo-rt-content aside[data-type="sidebar"]{margin:15px 0 10px 0 !important;page-break-inside:avoid}#sbo-rt-content div.sidebar-title,#sbo-rt-content aside[data-type="sidebar"] h5{font-weight:bold;font-size:1em;font-family:sans-serif;text-transform:uppercase;letter-spacing:1px;text-align:center;margin:4px 0 6px 0 !important;page-break-inside:avoid}#sbo-rt-content div.sidebar ol,#sbo-rt-content div.sidebar ul,#sbo-rt-content aside[data-type="sidebar"] ol,#sbo-rt-content aside[data-type="sidebar"] ul{margin-left:1.25em !important}#sbo-rt-content div.sidebar div.figure p.title,#sbo-rt-content aside[data-type="sidebar"] figcaption,#sbo-rt-content div.sidebar div.informalfigure div.caption{font-size:90%;text-align:center;font-weight:normal;font-style:italic;font-family:serif !important;color:#000;padding:5px !important;page-break-before:avoid;page-break-after:avoid}#sbo-rt-content div.sidebar div.tip,#sbo-rt-content div.sidebar div[data-type="tip"],#sbo-rt-content div.sidebar div.note,#sbo-rt-content div.sidebar div[data-type="note"],#sbo-rt-content div.sidebar div.warning,#sbo-rt-content div.sidebar div[data-type="warning"],#sbo-rt-content div.sidebar div[data-type="caution"],#sbo-rt-content div.sidebar div[data-type="important"]{margin:20px auto 20px auto !important;font-size:90%;width:85%}#sbo-rt-content aside[data-type="sidebar"] p.byline{font-size:90%;font-weight:bold;font-style:italic;text-align:center;text-indent:0;margin:5px auto 6px;page-break-after:avoid}#sbo-rt-content pre{white-space:pre-wrap;font-family:"Ubuntu Mono",monospace;margin:25px 0 25px 20px;font-size:85%;display:block;-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;overflow-wrap:break-word}#sbo-rt-content div.note pre.programlisting,#sbo-rt-content div.tip pre.programlisting,#sbo-rt-content div.warning pre.programlisting,#sbo-rt-content div.caution pre.programlisting,#sbo-rt-content div.important pre.programlisting{margin-bottom:0}#sbo-rt-content code{font-family:"Ubuntu Mono",monospace;-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;overflow-wrap:break-word}#sbo-rt-content code strong em,#sbo-rt-content code em strong,#sbo-rt-content pre em strong,#sbo-rt-content pre strong em,#sbo-rt-content strong code em code,#sbo-rt-content em code strong code,#sbo-rt-content span.bolditalic code{font-weight:bold;font-style:italic;font-family:"Ubuntu Mono BoldItal",monospace}#sbo-rt-content code em,#sbo-rt-content em code,#sbo-rt-content pre em,#sbo-rt-content em.replaceable{font-family:"Ubuntu Mono Ital",monospace;font-style:italic}#sbo-rt-content code strong,#sbo-rt-content strong code,#sbo-rt-content pre strong,#sbo-rt-content strong.userinput{font-family:"Ubuntu Mono Bold",monospace;font-weight:bold}#sbo-rt-content div[data-type="example"]{margin:10px 0 15px 0 !important}#sbo-rt-content div[data-type="example"] h1,#sbo-rt-content div[data-type="example"] h2,#sbo-rt-content div[data-type="example"] h3,#sbo-rt-content div[data-type="example"] h4,#sbo-rt-content div[data-type="example"] h5,#sbo-rt-content div[data-type="example"] h6{font-style:italic;font-weight:normal;text-align:left !important;text-transform:none !important;font-family:serif !important;margin:10px 0 5px 0 !important;border-bottom:1px solid #000}#sbo-rt-content li pre.example{padding:10px 0 !important}#sbo-rt-content div[data-type="example"] pre[data-type="programlisting"],#sbo-rt-content div[data-type="example"] pre[data-type="screen"]{margin:0}#sbo-rt-content section[data-type="titlepage"]>div>h1{font-size:2em;margin:50px 0 10px 0 !important;line-height:1;text-align:center}#sbo-rt-content section[data-type="titlepage"] h2,#sbo-rt-content section[data-type="titlepage"] p.subtitle,#sbo-rt-content section[data-type="titlepage"] p[data-type="subtitle"]{font-size:1.3em;font-weight:normal;text-align:center;margin-top:.5em;color:#555}#sbo-rt-content section[data-type="titlepage"]>div>h2[data-type="author"],#sbo-rt-content section[data-type="titlepage"] p.author{font-size:1.3em;font-family:serif !important;font-weight:bold;margin:50px 0 !important;text-align:center}#sbo-rt-content section[data-type="titlepage"] p.edition{text-align:center;text-transform:uppercase;margin-top:2em}#sbo-rt-content section[data-type="titlepage"]{text-align:center}#sbo-rt-content section[data-type="titlepage"]:after{content:url(css_assets/titlepage_footer_ebook.png);margin:0 auto;max-width:80%}#sbo-rt-content div.book div.titlepage div.publishername{margin-top:60%;margin-bottom:20px;text-align:center;font-size:1.25em}#sbo-rt-content div.book div.titlepage div.locations p{margin:0;text-align:center}#sbo-rt-content div.book div.titlepage div.locations p.cities{font-size:80%;text-align:center;margin-top:5px}#sbo-rt-content section.preface[title="Dedication"]>div.titlepage h2.title{text-align:center;text-transform:uppercase;font-size:1.5em;margin-top:50px;margin-bottom:50px}#sbo-rt-content ul.stafflist{margin:15px 0 15px 20px !important}#sbo-rt-content ul.stafflist li{list-style-type:none;padding:5px 0}#sbo-rt-content ul.printings li{list-style-type:none}#sbo-rt-content section.preface[title="Dedication"] p{font-style:italic;text-align:center}#sbo-rt-content div.colophon h1.title{font-size:1.3em;margin:0 !important;font-family:serif !important;font-weight:normal}#sbo-rt-content div.colophon h2.subtitle{margin:0 !important;color:#000;font-family:serif !important;font-size:1em;font-weight:normal}#sbo-rt-content div.colophon div.author h3.author{font-size:1.1em;font-family:serif !important;margin:10px 0 0 !important;font-weight:normal}#sbo-rt-content div.colophon div.editor h4,#sbo-rt-content div.colophon div.editor h3.editor{color:#000;font-size:.8em;margin:15px 0 0 !important;font-family:serif !important;font-weight:normal}#sbo-rt-content div.colophon div.editor h3.editor{font-size:.8em;margin:0 !important;font-family:serif !important;font-weight:normal}#sbo-rt-content div.colophon div.publisher{margin-top:10px}#sbo-rt-content div.colophon div.publisher p,#sbo-rt-content div.colophon div.publisher span.publishername{margin:0;font-size:.8em}#sbo-rt-content div.legalnotice p,#sbo-rt-content div.timestamp p{font-size:.8em}#sbo-rt-content div.timestamp p{margin-top:10px}#sbo-rt-content div.colophon[title="About the Author"] h1.title,#sbo-rt-content div.colophon[title="Colophon"] h1.title{font-size:1.5em;margin:0 !important;font-family:sans-serif !important}#sbo-rt-content section.chapter div.titlepage div.author{margin:10px 0 10px 0}#sbo-rt-content section.chapter div.titlepage div.author div.affiliation{font-style:italic}#sbo-rt-content div.attribution{margin:5px 0 0 50px !important}#sbo-rt-content h3.author span.orgname{display:none}#sbo-rt-content div.epigraph{margin:10px 0 10px 20px !important;page-break-inside:avoid;font-size:90%}#sbo-rt-content div.epigraph p{font-style:italic}#sbo-rt-content blockquote,#sbo-rt-content div.blockquote{margin:10px !important;page-break-inside:avoid;font-size:95%}#sbo-rt-content blockquote p,#sbo-rt-content div.blockquote p{font-style:italic;margin:.75em 0 0 !important}#sbo-rt-content blockquote div.attribution,#sbo-rt-content blockquote p[data-type="attribution"]{margin:5px 0 10px 30px !important;text-align:right;width:80%}#sbo-rt-content blockquote div.attribution p,#sbo-rt-content blockquote p[data-type="attribution"]{font-style:normal;margin-top:5px}#sbo-rt-content blockquote div.attribution p:before,#sbo-rt-content blockquote p[data-type="attribution"]:before{font-style:normal;content:"—";-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none}#sbo-rt-content p.right{text-align:right;margin:0}#sbo-rt-content div[data-type="footnotes"]{border-top:1px solid black;margin-top:1.5em}#sbo-rt-content sub,#sbo-rt-content sup{font-size:75%;line-height:0;position:relative}#sbo-rt-content sup{top:-.5em}#sbo-rt-content sub{bottom:-.25em}#sbo-rt-content div.refentry p.refname{font-size:1em;font-family:sans-serif,"DejaVuSans";font-weight:bold;margin-bottom:5px;overflow:auto;width:100%}#sbo-rt-content div.refentry{width:100%;display:block;margin-top:2em}#sbo-rt-content div.refsynopsisdiv{display:block;clear:both}#sbo-rt-content div.refentry header{page-break-inside:avoid !important;display:block;break-inside:avoid !important;padding-top:0;border-bottom:1px solid #000}#sbo-rt-content div.refsect1 h6{font-size:.9em;font-family:sans-serif,"DejaVuSans";font-weight:bold}#sbo-rt-content div.refsect1{margin-top:3em}#sbo-rt-content dt{padding-top:10px !important;padding-bottom:0 !important}#sbo-rt-content dd{margin-left:1.5em !important;margin-bottom:.25em}#sbo-rt-content dd ol,#sbo-rt-content dd ul{padding-left:1em}#sbo-rt-content dd li{margin-top:0;margin-bottom:0}#sbo-rt-content dd,#sbo-rt-content li{text-align:left}#sbo-rt-content ul,#sbo-rt-content ul>li,#sbo-rt-content ol ul,#sbo-rt-content ol ul>li,#sbo-rt-content ul ol ul,#sbo-rt-content ul ol ul>li{list-style-type:disc}#sbo-rt-content ul ul,#sbo-rt-content ul ul>li{list-style-type:square}#sbo-rt-content ul ul ul,#sbo-rt-content ul ul ul>li{list-style-type:circle}#sbo-rt-content ol,#sbo-rt-content ol>li,#sbo-rt-content ol ul ol,#sbo-rt-content ol ul ol>li,#sbo-rt-content ul ol,#sbo-rt-content ul ol>li{list-style-type:decimal}#sbo-rt-content ol ol,#sbo-rt-content ol ol>li{list-style-type:lower-alpha}#sbo-rt-content ol ol ol,#sbo-rt-content ol ol ol>li{list-style-type:lower-roman}#sbo-rt-content ol,#sbo-rt-content ul{list-style-position:outside;margin:15px 0 15px 1.25em;padding-left:2.25em}#sbo-rt-content ol li,#sbo-rt-content ul li{margin:.5em 0 .65em;line-height:125%}#sbo-rt-content div.orderedlistalpha{list-style-type:upper-alpha}#sbo-rt-content table.simplelist,#sbo-rt-content ul.simplelist{margin:15px 0 15px 20px !important}#sbo-rt-content ul.simplelist li{list-style-type:none;padding:5px 0}#sbo-rt-content table.simplelist td{border:none}#sbo-rt-content table.simplelist tr{border-bottom:none}#sbo-rt-content table.simplelist tr:nth-of-type(even){background-color:transparent}#sbo-rt-content dl.calloutlist p:first-child{margin-top:-25px !important}#sbo-rt-content dl.calloutlist dd{padding-left:0;margin-top:-25px}#sbo-rt-content dl.calloutlist img,#sbo-rt-content a.co img{padding:0}#sbo-rt-content div.toc ol{margin-top:8px !important;margin-bottom:8px !important;margin-left:0 !important;padding-left:0 !important}#sbo-rt-content div.toc ol ol{margin-left:30px !important;padding-left:0 !important}#sbo-rt-content div.toc ol li{list-style-type:none}#sbo-rt-content div.toc a{color:#8e0012}#sbo-rt-content div.toc ol a{font-size:1em;font-weight:bold}#sbo-rt-content div.toc ol>li>ol a{font-weight:bold;font-size:1em}#sbo-rt-content div.toc ol>li>ol>li>ol a{text-decoration:none;font-weight:normal;font-size:1em}#sbo-rt-content div.tip,#sbo-rt-content div[data-type="tip"],#sbo-rt-content div.note,#sbo-rt-content div[data-type="note"],#sbo-rt-content div.warning,#sbo-rt-content div[data-type="warning"],#sbo-rt-content div[data-type="caution"],#sbo-rt-content div[data-type="important"]{margin:30px !important;font-size:90%;padding:10px 8px 20px 8px !important;page-break-inside:avoid}#sbo-rt-content div.tip ol,#sbo-rt-content div.tip ul,#sbo-rt-content div[data-type="tip"] ol,#sbo-rt-content div[data-type="tip"] ul,#sbo-rt-content div.note ol,#sbo-rt-content div.note ul,#sbo-rt-content div[data-type="note"] ol,#sbo-rt-content div[data-type="note"] ul,#sbo-rt-content div.warning ol,#sbo-rt-content div.warning ul,#sbo-rt-content div[data-type="warning"] ol,#sbo-rt-content div[data-type="warning"] ul,#sbo-rt-content div[data-type="caution"] ol,#sbo-rt-content div[data-type="caution"] ul,#sbo-rt-content div[data-type="important"] ol,#sbo-rt-content div[data-type="important"] ul{margin-left:1.5em !important}#sbo-rt-content div.tip,#sbo-rt-content div[data-type="tip"],#sbo-rt-content div.note,#sbo-rt-content div[data-type="note"]{border:1px solid #BEBEBE;background-color:transparent}#sbo-rt-content div.warning,#sbo-rt-content div[data-type="warning"],#sbo-rt-content div[data-type="caution"],#sbo-rt-content div[data-type="important"]{border:1px solid #BC8F8F}#sbo-rt-content div.tip h3,#sbo-rt-content div[data-type="tip"] h6,#sbo-rt-content div[data-type="tip"] h1,#sbo-rt-content div.note h3,#sbo-rt-content div[data-type="note"] h6,#sbo-rt-content div[data-type="note"] h1,#sbo-rt-content div.warning h3,#sbo-rt-content div[data-type="warning"] h6,#sbo-rt-content div[data-type="warning"] h1,#sbo-rt-content div[data-type="caution"] h6,#sbo-rt-content div[data-type="caution"] h1,#sbo-rt-content div[data-type="important"] h1,#sbo-rt-content div[data-type="important"] h6{font-weight:bold;font-size:110%;font-family:sans-serif !important;text-transform:uppercase;letter-spacing:1px;text-align:center;margin:4px 0 6px !important}#sbo-rt-content div[data-type="tip"] figure h6,#sbo-rt-content div[data-type="note"] figure h6,#sbo-rt-content div[data-type="warning"] figure h6,#sbo-rt-content div[data-type="caution"] figure h6,#sbo-rt-content div[data-type="important"] figure h6{font-family:serif !important}#sbo-rt-content div.tip h3,#sbo-rt-content div[data-type="tip"] h6,#sbo-rt-content div.note h3,#sbo-rt-content div[data-type="note"] h6,#sbo-rt-content div[data-type="tip"] h1,#sbo-rt-content div[data-type="note"] h1{color:#737373}#sbo-rt-content div.warning h3,#sbo-rt-content div[data-type="warning"] h6,#sbo-rt-content div[data-type="caution"] h6,#sbo-rt-content div[data-type="important"] h6,#sbo-rt-content div[data-type="warning"] h1,#sbo-rt-content div[data-type="caution"] h1,#sbo-rt-content div[data-type="important"] h1{color:#C67171}#sbo-rt-content div.sect1[title="Safari® Books Online"] div.note,#sbo-rt-content div.safarienabled{background-color:transparent;margin:8px 0 0 !important;border:0 solid #BEBEBE;font-size:100%;padding:0 !important;page-break-inside:avoid}#sbo-rt-content div.sect1[title="Safari® Books Online"] div.note h3,#sbo-rt-content div.safarienabled h6{display:none}#sbo-rt-content div.table,#sbo-rt-content table{margin:15px 0 30px 0 !important;max-width:95%;border:none !important;background:none;display:table !important}#sbo-rt-content div.table,#sbo-rt-content div.informaltable,#sbo-rt-content table{page-break-inside:avoid}#sbo-rt-content tr,#sbo-rt-content tr td{border-bottom:1px solid #c3c3c3}#sbo-rt-content thead td,#sbo-rt-content thead th{border-bottom:#9d9d9d 1px solid !important;border-top:#9d9d9d 1px solid !important}#sbo-rt-content tr:nth-of-type(even){background-color:#f1f6fc}#sbo-rt-content thead{font-family:sans-serif;font-weight:bold}#sbo-rt-content td,#sbo-rt-content th{display:table-cell;padding:.3em;text-align:left;vertical-align:middle;font-size:80%}#sbo-rt-content div.informaltable table{margin:10px auto !important}#sbo-rt-content div.informaltable table tr{border-bottom:none}#sbo-rt-content div.informaltable table tr:nth-of-type(even){background-color:transparent}#sbo-rt-content div.informaltable td,#sbo-rt-content div.informaltable th{border:#9d9d9d 1px solid}#sbo-rt-content div.table-title,#sbo-rt-content table caption{font-weight:normal;font-style:italic;font-family:serif;font-size:1em;margin:10px 0 10px 0 !important;padding:0;page-break-after:avoid;text-align:left !important}#sbo-rt-content table code{font-size:smaller}#sbo-rt-content div.equation,#sbo-rt-content div[data-type="equation"]{margin:10px 0 15px 0 !important}#sbo-rt-content div.equation-title,#sbo-rt-content div[data-type="equation"] h5{font-style:italic;font-weight:normal;font-family:serif !important;font-size:90%;margin:20px 0 10px 0 !important;page-break-after:avoid}#sbo-rt-content div.equation-contents{margin-left:20px}#sbo-rt-content div[data-type="equation"] math{font-size:calc(.35em + 1vw)}#sbo-rt-content span.inlinemediaobject{height:.85em;display:inline-block;margin-bottom:.2em}#sbo-rt-content span.inlinemediaobject img{margin:0;height:.85em}#sbo-rt-content div.informalequation{margin:20px 0 20px 20px;width:75%}#sbo-rt-content div.informalequation img{width:75%}#sbo-rt-content div.index{text-indent:0}#sbo-rt-content div.index h3{padding:.25em;margin-top:1em !important;background-color:#F0F0F0}#sbo-rt-content div.index li{line-height:130%;list-style-type:none}#sbo-rt-content div.index a.indexterm{color:#8e0012 !important}#sbo-rt-content div.index ul{margin-left:0 !important;padding-left:0 !important}#sbo-rt-content div.index ul ul{margin-left:1em !important;margin-top:0 !important}#sbo-rt-content code.boolean,#sbo-rt-content .navy{color:rgb(0,0,128);}#sbo-rt-content code.character,#sbo-rt-content .olive{color:rgb(128,128,0);}#sbo-rt-content code.comment,#sbo-rt-content .blue{color:rgb(0,0,255);}#sbo-rt-content code.conditional,#sbo-rt-content .limegreen{color:rgb(50,205,50);}#sbo-rt-content code.constant,#sbo-rt-content .darkorange{color:rgb(255,140,0);}#sbo-rt-content code.debug,#sbo-rt-content .darkred{color:rgb(139,0,0);}#sbo-rt-content code.define,#sbo-rt-content .darkgoldenrod,#sbo-rt-content .gold{color:rgb(184,134,11);}#sbo-rt-content code.delimiter,#sbo-rt-content .dimgray{color:rgb(105,105,105);}#sbo-rt-content code.error,#sbo-rt-content .red{color:rgb(255,0,0);}#sbo-rt-content code.exception,#sbo-rt-content .salmon{color:rgb(250,128,11);}#sbo-rt-content code.float,#sbo-rt-content .steelblue{color:rgb(70,130,180);}#sbo-rt-content pre code.function,#sbo-rt-content .green{color:rgb(0,128,0);}#sbo-rt-content code.identifier,#sbo-rt-content .royalblue{color:rgb(65,105,225);}#sbo-rt-content code.ignore,#sbo-rt-content .gray{color:rgb(128,128,128);}#sbo-rt-content code.include,#sbo-rt-content .purple{color:rgb(128,0,128);}#sbo-rt-content code.keyword,#sbo-rt-content .sienna{color:rgb(160,82,45);}#sbo-rt-content code.label,#sbo-rt-content .deeppink{color:rgb(255,20,147);}#sbo-rt-content code.macro,#sbo-rt-content .orangered{color:rgb(255,69,0);}#sbo-rt-content code.number,#sbo-rt-content .brown{color:rgb(165,42,42);}#sbo-rt-content code.operator,#sbo-rt-content .black{color:#000;}#sbo-rt-content code.preCondit,#sbo-rt-content .teal{color:rgb(0,128,128);}#sbo-rt-content code.preProc,#sbo-rt-content .fuschia{color:rgb(255,0,255);}#sbo-rt-content code.repeat,#sbo-rt-content .indigo{color:rgb(75,0,130);}#sbo-rt-content code.special,#sbo-rt-content .saddlebrown{color:rgb(139,69,19);}#sbo-rt-content code.specialchar,#sbo-rt-content .magenta{color:rgb(255,0,255);}#sbo-rt-content code.specialcomment,#sbo-rt-content .seagreen{color:rgb(46,139,87);}#sbo-rt-content code.statement,#sbo-rt-content .forestgreen{color:rgb(34,139,34);}#sbo-rt-content code.storageclass,#sbo-rt-content .plum{color:rgb(221,160,221);}#sbo-rt-content code.string,#sbo-rt-content .darkred{color:rgb(139,0,0);}#sbo-rt-content code.structure,#sbo-rt-content .chocolate{color:rgb(210,106,30);}#sbo-rt-content code.tag,#sbo-rt-content .darkcyan{color:rgb(0,139,139);}#sbo-rt-content code.todo,#sbo-rt-content .black{color:#000;}#sbo-rt-content code.type,#sbo-rt-content .mediumslateblue{color:rgb(123,104,238);}#sbo-rt-content code.typedef,#sbo-rt-content .darkgreen{color:rgb(0,100,0);}#sbo-rt-content code.underlined{text-decoration:underline;}#sbo-rt-content pre code.hll{background-color:#ffc}#sbo-rt-content pre code.c{color:#09F;font-style:italic}#sbo-rt-content pre code.err{color:#A00}#sbo-rt-content pre code.k{color:#069;font-weight:bold}#sbo-rt-content pre code.o{color:#555}#sbo-rt-content pre code.cm{color:#35586C;font-style:italic}#sbo-rt-content pre code.cp{color:#099}#sbo-rt-content pre code.c1{color:#35586C;font-style:italic}#sbo-rt-content pre code.cs{color:#35586C;font-weight:bold;font-style:italic}#sbo-rt-content pre code.gd{background-color:#FCC}#sbo-rt-content pre code.ge{font-style:italic}#sbo-rt-content pre code.gr{color:#F00}#sbo-rt-content pre code.gh{color:#030;font-weight:bold}#sbo-rt-content pre code.gi{background-color:#CFC}#sbo-rt-content pre code.go{color:#000}#sbo-rt-content pre code.gp{color:#009;font-weight:bold}#sbo-rt-content pre code.gs{font-weight:bold}#sbo-rt-content pre code.gu{color:#030;font-weight:bold}#sbo-rt-content pre code.gt{color:#9C6}#sbo-rt-content pre code.kc{color:#069;font-weight:bold}#sbo-rt-content pre code.kd{color:#069;font-weight:bold}#sbo-rt-content pre code.kn{color:#069;font-weight:bold}#sbo-rt-content pre code.kp{color:#069}#sbo-rt-content pre code.kr{color:#069;font-weight:bold}#sbo-rt-content pre code.kt{color:#078;font-weight:bold}#sbo-rt-content pre code.m{color:#F60}#sbo-rt-content pre code.s{color:#C30}#sbo-rt-content pre code.na{color:#309}#sbo-rt-content pre code.nb{color:#366}#sbo-rt-content pre code.nc{color:#0A8;font-weight:bold}#sbo-rt-content pre code.no{color:#360}#sbo-rt-content pre code.nd{color:#99F}#sbo-rt-content pre code.ni{color:#999;font-weight:bold}#sbo-rt-content pre code.ne{color:#C00;font-weight:bold}#sbo-rt-content pre code.nf{color:#C0F}#sbo-rt-content pre code.nl{color:#99F}#sbo-rt-content pre code.nn{color:#0CF;font-weight:bold}#sbo-rt-content pre code.nt{color:#309;font-weight:bold}#sbo-rt-content pre code.nv{color:#033}#sbo-rt-content pre code.ow{color:#000;font-weight:bold}#sbo-rt-content pre code.w{color:#bbb}#sbo-rt-content pre code.mf{color:#F60}#sbo-rt-content pre code.mh{color:#F60}#sbo-rt-content pre code.mi{color:#F60}#sbo-rt-content pre code.mo{color:#F60}#sbo-rt-content pre code.sb{color:#C30}#sbo-rt-content pre code.sc{color:#C30}#sbo-rt-content pre code.sd{color:#C30;font-style:italic}#sbo-rt-content pre code.s2{color:#C30}#sbo-rt-content pre code.se{color:#C30;font-weight:bold}#sbo-rt-content pre code.sh{color:#C30}#sbo-rt-content pre code.si{color:#A00}#sbo-rt-content pre code.sx{color:#C30}#sbo-rt-content pre code.sr{color:#3AA}#sbo-rt-content pre code.s1{color:#C30}#sbo-rt-content pre code.ss{color:#A60}#sbo-rt-content pre code.bp{color:#366}#sbo-rt-content pre code.vc{color:#033}#sbo-rt-content pre code.vg{color:#033}#sbo-rt-content pre code.vi{color:#033}#sbo-rt-content pre code.il{color:#F60}#sbo-rt-content pre code.g{color:#050}#sbo-rt-content pre code.l{color:#C60}#sbo-rt-content pre code.l{color:#F90}#sbo-rt-content pre code.n{color:#008}#sbo-rt-content pre code.nx{color:#008}#sbo-rt-content pre code.py{color:#96F}#sbo-rt-content pre code.p{color:#000}#sbo-rt-content pre code.x{color:#F06}#sbo-rt-content div.blockquote_sampler_toc{width:95%;margin:5px 5px 5px 10px !important}#sbo-rt-content div{font-family:serif;text-align:left}#sbo-rt-content .gray-background,#sbo-rt-content .reverse-video{background:#2E2E2E;color:#FFF}#sbo-rt-content .light-gray-background{background:#A0A0A0}#sbo-rt-content .preserve-whitespace{white-space:pre-wrap}#sbo-rt-content span.gray{color:#4C4C4C}#sbo-rt-content .what_lt{color:#c90;}#sbo-rt-content .where_lt{color:#26c}#sbo-rt-content .when_lt{color:#6a5;}#sbo-rt-content .how_lt{color:#c00}#sbo-rt-content .what_dk{color:#ffd040}#sbo-rt-content .where_dk{color:#6af}#sbo-rt-content .when_dk{color:#8ac86f}#sbo-rt-content .how_dk{color:#d77}#sbo-rt-content .grey_bg{background-color:#ff0}#sbo-rt-content .yellow_bg{background-color:#ff0}#sbo-rt-content .green_bg{background-color:#00FF7F}#sbo-rt-content .red_bg{background-color:#FFA07A}#sbo-rt-content .blue_bg{background-color:#87CEEB}#sbo-rt-content .code_blue{color:#00f}#sbo-rt-content .code_grey{color:#777}#sbo-rt-content .code_orange{color:#d83}#sbo-rt-content .code_purple{color:#87c}#sbo-rt-content .code_lightgrey{color:#C0C0C0}#sbo-rt-content .strikethrough{text-decoration:line-through}#sbo-rt-content .table_white{color:white}#sbo-rt-content .table_black{color:black}#sbo-rt-content .table_red{color:#d77}#sbo-rt-content .table_green{color:#8ac86f}#sbo-rt-content .table_blue{color:#00f}#sbo-rt-content .table_mediumgrey{background-color:#404040}#sbo-rt-content .table_lightgrey{background-color:#606060}#sbo-rt-content .table_darkgrey{background-color:#202020}
    </style><link rel="canonical" href="/site/library/view/streaming-systems/9781491983867/ch09.html"><meta name="description" content=" Chapter 9. Streaming Joins When I first began learning about joins, it was an intimidating topic; LEFT, OUTER, SEMI, INNER, CROSS: the language of joins is expressive and expansive. Add ... "><meta property="og:title" content="9. Streaming Joins"><meta itemprop="isPartOf" content="/library/view/streaming-systems/9781491983867/"><meta itemprop="name" content="9. Streaming Joins"><meta property="og:url" itemprop="url" content="https://www.safaribooksonline.com/library/view/streaming-systems/9781491983867/ch09.html"><meta property="og:site_name" content="Safari"><meta property="og:image" itemprop="thumbnailUrl" content="https://www.safaribooksonline.com/library/cover/9781491983867/"><meta property="og:description" itemprop="description" content=" Chapter 9. Streaming Joins When I first began learning about joins, it was an intimidating topic; LEFT, OUTER, SEMI, INNER, CROSS: the language of joins is expressive and expansive. Add ... "><meta itemprop="inLanguage" content="en"><meta itemprop="publisher" content="O'Reilly Media, Inc."><meta property="og:type" content="book"><meta property="og:book:isbn" itemprop="isbn" content="9781491983874"><meta property="og:book:author" itemprop="author" content="Reuven Lax"><meta property="og:book:author" itemprop="author" content="Slava Chernyak"><meta property="og:book:author" itemprop="author" content="Tyler Akidau"><meta property="og:book:tag" itemprop="about" content="Databases"><meta property="og:book:tag" itemprop="about" content="Engineering"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@safari"><style type="text/css" id="font-styles" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-size: <%= font_size %> !important; }"></style><style type="text/css" id="font-family" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-family: <%= font_family %> !important; }"></style><style type="text/css" id="column-width" data-template="#sbo-rt-content { max-width: <%= column_width %>% !important; margin: 0 auto !important; }"></style><style id="annotator-dynamic-style">.annotator-adder, .annotator-outer, .annotator-notice {
  z-index: 100019;
}
.annotator-filter {
  z-index: 100009;
}</style></head>


<body class="reading sidenav nav-collapsed  scalefonts subscribe-panel library" data-gr-c-s-loaded="true">

    
  
  
  



    
      <div class="hide working" role="status">
        <div class="working-image"></div>
      </div>
      <div class="sbo-site-nav">
        





<a href="/site/library/view/streaming-systems/9781491983867/ch09.html#container" class="skip">Skip to content</a><header class="topbar t-topbar" style="display:None"><nav role="navigation" class="js-site-nav"><ul class="topnav"><li class="t-logo"><a href="https://www.safaribooksonline.com/home/" class="l0 None safari-home nav-icn js-keyboard-nav-home"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>Safari Home Icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M4 9.9L4 9.9 4 18 16 18 16 9.9 10 4 4 9.9ZM2.6 8.1L2.6 8.1 8.7 1.9 10 0.5 11.3 1.9 17.4 8.1 18 8.7 18 9.5 18 18.1 18 20 16.1 20 3.9 20 2 20 2 18.1 2 9.5 2 8.7 2.6 8.1Z"></path><rect x="10" y="12" width="3" height="7"></rect><rect transform="translate(18.121320, 10.121320) rotate(-315.000000) translate(-18.121320, -10.121320) " x="16.1" y="9.1" width="4" height="2"></rect><rect transform="translate(2.121320, 10.121320) scale(-1, 1) rotate(-315.000000) translate(-2.121320, -10.121320) " x="0.1" y="9.1" width="4" height="2"></rect></g></svg><span>Safari Home</span></a></li><li><a href="https://www.safaribooksonline.com/r/" class="t-recommendations-nav l0 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>recommendations icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M50 25C50 18.2 44.9 12.5 38.3 11.7 37.5 5.1 31.8 0 25 0 18.2 0 12.5 5.1 11.7 11.7 5.1 12.5 0 18.2 0 25 0 31.8 5.1 37.5 11.7 38.3 12.5 44.9 18.2 50 25 50 31.8 50 37.5 44.9 38.3 38.3 44.9 37.5 50 31.8 50 25ZM25 3.1C29.7 3.1 33.6 6.9 34.4 11.8 30.4 12.4 26.9 15.1 25 18.8 23.1 15.1 19.6 12.4 15.6 11.8 16.4 6.9 20.3 3.1 25 3.1ZM34.4 15.6C33.6 19.3 30.7 22.2 27.1 22.9 27.8 19.2 30.7 16.3 34.4 15.6ZM22.9 22.9C19.2 22.2 16.3 19.3 15.6 15.6 19.3 16.3 22.2 19.2 22.9 22.9ZM3.1 25C3.1 20.3 6.9 16.4 11.8 15.6 12.4 19.6 15.1 23.1 18.8 25 15.1 26.9 12.4 30.4 11.8 34.4 6.9 33.6 3.1 29.7 3.1 25ZM22.9 27.1C22.2 30.7 19.3 33.6 15.6 34.4 16.3 30.7 19.2 27.8 22.9 27.1ZM25 46.9C20.3 46.9 16.4 43.1 15.6 38.2 19.6 37.6 23.1 34.9 25 31.3 26.9 34.9 30.4 37.6 34.4 38.2 33.6 43.1 29.7 46.9 25 46.9ZM27.1 27.1C30.7 27.8 33.6 30.7 34.4 34.4 30.7 33.6 27.8 30.7 27.1 27.1ZM38.2 34.4C37.6 30.4 34.9 26.9 31.3 25 34.9 23.1 37.6 19.6 38.2 15.6 43.1 16.4 46.9 20.3 46.9 25 46.9 29.7 43.1 33.6 38.2 34.4Z"></path></g></svg><span>Recommended</span></a></li><li><a href="https://www.safaribooksonline.com/playlists/" class="t-queue-nav l0 nav-icn None"><!--?xml version="1.0" encoding="UTF-8"?--><svg width="21px" height="17px" viewBox="0 0 21 17" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><!-- Generator: Sketch 46.2 (44496) - http://www.bohemiancoding.com/sketch --><title>icon_Playlist_sml</title><desc>Created with Sketch.</desc><defs></defs><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="icon_Playlist_sml" fill-rule="nonzero" fill="#000000"><g id="playlist-icon"><g id="Group-6"><rect id="Rectangle-path" x="5" y="0" width="16" height="3" rx="0.5"></rect><circle id="Oval" cx="1.5" cy="1.5" r="1.5"></circle></g><g id="Group-5" transform="translate(0.000000, 7.000000)"><circle id="Oval" cx="1.5" cy="1.5" r="1.5"></circle><rect id="Rectangle-path" x="5" y="0" width="16" height="3" rx="0.5"></rect></g><g id="Group-5-Copy" transform="translate(0.000000, 14.000000)"><circle id="Oval" cx="1.5" cy="1.5" r="1.5"></circle><rect id="Rectangle-path" x="5" y="0" width="16" height="3" rx="0.5"></rect></g></g></g></g></svg><span>
               Playlists
            </span></a></li><li class="search"><a href="/site/library/view/streaming-systems/9781491983867/ch09.html#" class="t-search-nav trigger nav-icn l0" data-dropdown-selector=".searchbox"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>search icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M31.3 0C20.9 0 12.5 8.4 12.5 18.8 12.5 22.5 13.6 25.9 15.4 28.8L1.2 42.9C-0.4 44.5-0.4 47.2 1.2 48.8 2 49.6 3.1 50 4.2 50 5.2 50 6.3 49.6 7.1 48.8L21.2 34.6C24.1 36.5 27.5 37.5 31.3 37.5 41.6 37.5 50 29.1 50 18.8 50 8.4 41.6 0 31.3 0ZM31.3 31.3C24.4 31.3 18.8 25.6 18.8 18.8 18.8 11.9 24.4 6.3 31.3 6.3 38.1 6.3 43.8 11.9 43.8 18.8 43.8 25.6 38.1 31.3 31.3 31.3Z"></path></g></svg><span>Search</span></a></li><li class="usermenu dropdown"><a href="/site/library/view/streaming-systems/9781491983867/ch09.html#" class="trigger l0 nav-icn nav-dropdown"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>navigation arrow</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M0.1 12.5L9.7 3.1C9.8 3 9.9 3 10 3 10.1 3 10.2 3 10.3 3.1L19.9 12.5C20 12.5 20 12.6 20 12.8 20 12.9 20 13 19.9 13L17 15.9C16.9 16 16.8 16 16.7 16 16.5 16 16.4 16 16.4 15.9L10 9.7 3.6 15.9C3.6 16 3.5 16 3.3 16 3.2 16 3.1 16 3 15.9L0.1 13C0 12.9 0 12.8 0 12.7 0 12.7 0 12.6 0.1 12.5Z"></path></g></svg><span>Expand Nav</span></a><div class="drop-content"><ul><li><a href="https://www.safaribooksonline.com/history/" class="t-recent-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>recent items icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 0C11.2 0 0 11.2 0 25 0 38.8 11.2 50 25 50 38.8 50 50 38.8 50 25 50 11.2 38.8 0 25 0ZM6.3 25C6.3 14.6 14.6 6.3 25 6.3 35.4 6.3 43.8 14.6 43.8 25 43.8 35.4 35.4 43.8 25 43.8 14.6 43.8 6.3 35.4 6.3 25ZM31.8 31.5C32.5 30.5 32.4 29.2 31.6 28.3L27.1 23.8 27.1 12.8C27.1 11.5 26.2 10.4 25 10.4 23.9 10.4 22.9 11.5 22.9 12.8L22.9 25.7 28.8 31.7C29.2 32.1 29.7 32.3 30.2 32.3 30.8 32.3 31.3 32 31.8 31.5Z"></path></g></svg><span>History</span></a></li><li><a href="https://www.safaribooksonline.com/topics" class="t-topics-link l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 55" width="20" height="20" version="1.1" fill="#4A3C31"><desc>topics icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 55L50 41.262 50 13.762 25 0 0 13.762 0 41.262 25 55ZM8.333 37.032L8.333 17.968 25 8.462 41.667 17.968 41.667 37.032 25 46.538 8.333 37.032Z"></path></g></svg><span>Topics</span></a></li><li><a href="https://www.safaribooksonline.com/tutorials/" class="l1 nav-icn t-tutorials-nav js-toggle-menu-item None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>tutorials icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M15.8 18.2C15.8 18.2 15.9 18.2 16 18.2 16.1 18.2 16.2 18.2 16.4 18.2 16.5 18.2 16.7 18.1 16.9 18 17 17.9 17.1 17.8 17.2 17.7 17.3 17.6 17.4 17.5 17.4 17.4 17.5 17.2 17.6 16.9 17.6 16.7 17.6 16.6 17.6 16.5 17.6 16.4 17.5 16.2 17.5 16.1 17.4 15.9 17.3 15.8 17.2 15.6 17 15.5 16.8 15.3 16.6 15.3 16.4 15.2 16.2 15.2 16 15.2 15.8 15.2 15.7 15.2 15.5 15.3 15.3 15.4 15.2 15.4 15.1 15.5 15 15.7 14.9 15.8 14.8 15.9 14.7 16 14.7 16.1 14.6 16.3 14.6 16.4 14.6 16.5 14.6 16.6 14.6 16.6 14.6 16.7 14.6 16.9 14.6 17 14.6 17.1 14.7 17.3 14.7 17.4 14.8 17.6 15 17.7 15.1 17.9 15.2 18 15.3 18 15.5 18.1 15.5 18.1 15.6 18.2 15.7 18.2 15.7 18.2 15.7 18.2 15.8 18.2L15.8 18.2ZM9.4 11.5C9.5 11.5 9.5 11.5 9.6 11.5 9.7 11.5 9.9 11.5 10 11.5 10.2 11.5 10.3 11.4 10.5 11.3 10.6 11.2 10.8 11.1 10.9 11 10.9 10.9 11 10.8 11.1 10.7 11.2 10.5 11.2 10.2 11.2 10 11.2 9.9 11.2 9.8 11.2 9.7 11.2 9.5 11.1 9.4 11 9.2 10.9 9.1 10.8 8.9 10.6 8.8 10.5 8.7 10.3 8.6 10 8.5 9.9 8.5 9.7 8.5 9.5 8.5 9.3 8.5 9.1 8.6 9 8.7 8.8 8.7 8.7 8.8 8.6 9 8.5 9.1 8.4 9.2 8.4 9.3 8.2 9.5 8.2 9.8 8.2 10 8.2 10.1 8.2 10.2 8.2 10.3 8.2 10.5 8.3 10.6 8.4 10.7 8.5 10.9 8.6 11.1 8.7 11.2 8.9 11.3 9 11.4 9.1 11.4 9.2 11.4 9.3 11.5 9.3 11.5 9.3 11.5 9.4 11.5 9.4 11.5L9.4 11.5ZM3 4.8C3.1 4.8 3.1 4.8 3.2 4.8 3.4 4.8 3.5 4.8 3.7 4.8 3.8 4.8 4 4.7 4.1 4.6 4.3 4.5 4.4 4.4 4.5 4.3 4.6 4.2 4.6 4.1 4.7 4 4.8 3.8 4.8 3.5 4.8 3.3 4.8 3.1 4.8 3 4.8 2.9 4.7 2.8 4.7 2.6 4.6 2.5 4.5 2.3 4.4 2.2 4.2 2.1 4 1.9 3.8 1.9 3.6 1.8 3.5 1.8 3.3 1.8 3.1 1.8 2.9 1.8 2.7 1.9 2.6 2 2.4 2.1 2.3 2.2 2.2 2.3 2.1 2.4 2 2.5 2 2.6 1.8 2.8 1.8 3 1.8 3.3 1.8 3.4 1.8 3.5 1.8 3.6 1.8 3.8 1.9 3.9 2 4 2.1 4.2 2.2 4.4 2.4 4.5 2.5 4.6 2.6 4.7 2.7 4.7 2.8 4.7 2.9 4.8 2.9 4.8 3 4.8 3 4.8 3 4.8L3 4.8ZM13.1 15.2C13.2 15.1 13.2 15.1 13.2 15.1 13.3 14.9 13.4 14.7 13.6 14.5 13.8 14.2 14.1 14 14.4 13.8 14.7 13.6 15.1 13.5 15.5 13.4 15.9 13.4 16.3 13.4 16.7 13.5 17.2 13.5 17.6 13.7 17.9 13.9 18.2 14.1 18.5 14.4 18.7 14.7 18.9 15 19.1 15.3 19.2 15.6 19.3 15.9 19.4 16.1 19.4 16.4 19.4 17 19.3 17.5 19.1 18.1 19 18.3 18.9 18.5 18.7 18.7 18.5 19 18.3 19.2 18 19.4 17.7 19.6 17.3 19.8 16.9 19.9 16.6 20 16.3 20 16 20 15.8 20 15.6 20 15.4 19.9 15.4 19.9 15.4 19.9 15.4 19.9 15.2 19.9 15 19.8 14.9 19.8 14.8 19.7 14.7 19.7 14.6 19.7 14.4 19.6 14.3 19.5 14.1 19.3 13.7 19.1 13.4 18.7 13.2 18.4 13.1 18.1 12.9 17.8 12.9 17.5 12.8 17.3 12.8 17.1 12.8 16.9L3.5 14.9C3.3 14.9 3.1 14.8 3 14.8 2.7 14.7 2.4 14.5 2.1 14.3 1.7 14 1.4 13.7 1.2 13.3 1 13 0.9 12.6 0.8 12.3 0.7 12 0.7 11.7 0.7 11.4 0.7 11 0.8 10.5 1 10.1 1.1 9.8 1.3 9.5 1.6 9.2 1.8 8.9 2.1 8.7 2.4 8.5 2.8 8.3 3.2 8.1 3.6 8.1 3.9 8 4.2 8 4.5 8 4.6 8 4.8 8 4.9 8.1L6.8 8.5C6.8 8.4 6.8 8.4 6.8 8.4 6.9 8.2 7.1 8 7.2 7.8 7.5 7.5 7.7 7.3 8 7.1 8.4 6.9 8.7 6.8 9.1 6.7 9.5 6.7 10 6.7 10.4 6.8 10.8 6.8 11.2 7 11.5 7.2 11.8 7.5 12.1 7.7 12.4 8 12.6 8.3 12.7 8.6 12.8 8.9 12.9 9.2 13 9.4 13 9.7 13 9.7 13 9.8 13 9.8 13.6 9.9 14.2 10.1 14.9 10.2 15 10.2 15 10.2 15.1 10.2 15.3 10.2 15.4 10.2 15.6 10.2 15.8 10.1 16 10 16.2 9.9 16.4 9.8 16.5 9.6 16.6 9.5 16.8 9.2 16.9 8.8 16.9 8.5 16.9 8.3 16.9 8.2 16.8 8 16.8 7.8 16.7 7.7 16.6 7.5 16.5 7.3 16.3 7.2 16.2 7.1 16 7 15.9 6.9 15.8 6.9 15.7 6.9 15.6 6.8 15.5 6.8L6.2 4.8C6.2 5 6 5.2 5.9 5.3 5.7 5.6 5.5 5.8 5.3 6 4.9 6.2 4.5 6.4 4.1 6.5 3.8 6.6 3.5 6.6 3.2 6.6 3 6.6 2.8 6.6 2.7 6.6 2.6 6.6 2.6 6.5 2.6 6.5 2.5 6.5 2.3 6.5 2.1 6.4 1.8 6.3 1.6 6.1 1.3 6 1 5.7 0.7 5.4 0.5 5 0.3 4.7 0.2 4.4 0.1 4.1 0 3.8 0 3.6 0 3.3 0 2.8 0.1 2.2 0.4 1.7 0.5 1.5 0.7 1.3 0.8 1.1 1.1 0.8 1.3 0.6 1.6 0.5 2 0.3 2.3 0.1 2.7 0.1 3.1 0 3.6 0 4 0.1 4.4 0.2 4.8 0.3 5.1 0.5 5.5 0.8 5.7 1 6 1.3 6.2 1.6 6.3 1.9 6.4 2.3 6.5 2.5 6.6 2.7 6.6 3 6.6 3 6.6 3.1 6.6 3.1 9.7 3.8 12.8 4.4 15.9 5.1 16.1 5.1 16.2 5.2 16.4 5.2 16.7 5.3 16.9 5.5 17.2 5.6 17.5 5.9 17.8 6.2 18.1 6.5 18.3 6.8 18.4 7.2 18.6 7.5 18.6 7.9 18.7 8.2 18.7 8.6 18.7 9 18.6 9.4 18.4 9.8 18.3 10.1 18.2 10.3 18 10.6 17.8 10.9 17.5 11.1 17.3 11.3 16.9 11.6 16.5 11.8 16 11.9 15.7 12 15.3 12 15 12 14.8 12 14.7 12 14.5 11.9 13.9 11.8 13.3 11.7 12.6 11.5 12.5 11.7 12.4 11.9 12.3 12 12.1 12.3 11.9 12.5 11.7 12.7 11.3 12.9 10.9 13.1 10.5 13.2 10.2 13.3 9.9 13.3 9.6 13.3 9.4 13.3 9.2 13.3 9 13.2 9 13.2 9 13.2 9 13.2 8.8 13.2 8.7 13.2 8.5 13.1 8.2 13 8 12.8 7.7 12.6 7.4 12.4 7.1 12 6.8 11.7 6.7 11.4 6.6 11.1 6.5 10.8 6.4 10.6 6.4 10.4 6.4 10.2 5.8 10.1 5.2 9.9 4.5 9.8 4.4 9.8 4.4 9.8 4.3 9.8 4.1 9.8 4 9.8 3.8 9.8 3.6 9.9 3.4 10 3.2 10.1 3 10.2 2.9 10.4 2.8 10.5 2.6 10.8 2.5 11.1 2.5 11.5 2.5 11.6 2.5 11.8 2.6 12 2.6 12.1 2.7 12.3 2.8 12.5 2.9 12.6 3.1 12.8 3.2 12.9 3.3 13 3.5 13.1 3.6 13.1 3.7 13.1 3.8 13.2 3.9 13.2L13.1 15.2 13.1 15.2Z"></path></g></svg><span>Tutorials</span></a></li><li class="nav-offers flyout-parent"><a href="/site/library/view/streaming-systems/9781491983867/ch09.html#" class="l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>offers icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M35.9 20.6L27 15.5C26.1 15 24.7 15 23.7 15.5L14.9 20.6C13.9 21.1 13.2 22.4 13.2 23.4L13.2 41.4C13.2 42.4 13.9 43.7 14.9 44.2L23.3 49C24.2 49.5 25.6 49.5 26.6 49L35.9 43.6C36.8 43.1 37.6 41.8 37.6 40.8L37.6 23.4C37.6 22.4 36.8 21.1 35.9 20.6L35.9 20.6ZM40 8.2C39.1 7.6 37.6 7.6 36.7 8.2L30.2 11.9C29.3 12.4 29.3 13.2 30.2 13.8L39.1 18.8C40 19.4 40.7 20.6 40.7 21.7L40.7 39C40.7 40.1 41.4 40.5 42.4 40L48.2 36.6C49.1 36.1 49.8 34.9 49.8 33.8L49.8 15.6C49.8 14.6 49.1 13.3 48.2 12.8L40 8.2 40 8.2ZM27 10.1L33.6 6.4C34.5 5.9 34.5 5 33.6 4.5L26.6 0.5C25.6 0 24.2 0 23.3 0.5L16.7 4.2C15.8 4.7 15.8 5.6 16.7 6.1L23.7 10.1C24.7 10.6 26.1 10.6 27 10.1ZM10.1 21.7C10.1 20.6 10.8 19.4 11.7 18.8L20.6 13.8C21.5 13.2 21.5 12.4 20.6 11.9L13.6 7.9C12.7 7.4 11.2 7.4 10.3 7.9L1.6 12.8C0.7 13.3 0 14.6 0 15.6L0 33.8C0 34.9 0.7 36.1 1.6 36.6L8.4 40.5C9.3 41 10.1 40.6 10.1 39.6L10.1 21.7 10.1 21.7Z"></path></g></svg><span>Offers &amp; Deals</span></a><ul class="flyout"><li><a href="https://get.oreilly.com/email-signup.html" target="_blank" class="l2 nav-icn"><span>Newsletters</span></a></li></ul></li><li class="nav-highlights"><a href="https://www.safaribooksonline.com/u/f04af719-1c84-4fc3-9be3-1f1b4622ab99/" class="t-highlights-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 35" width="20" height="20" version="1.1" fill="#4A3C31"><desc>highlights icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M13.325 18.071L8.036 18.071C8.036 11.335 12.36 7.146 22.5 5.594L22.5 0C6.37 1.113 0 10.632 0 22.113 0 29.406 3.477 35 10.403 35 15.545 35 19.578 31.485 19.578 26.184 19.578 21.556 17.211 18.891 13.325 18.071L13.325 18.071ZM40.825 18.071L35.565 18.071C35.565 11.335 39.86 7.146 50 5.594L50 0C33.899 1.113 27.5 10.632 27.5 22.113 27.5 29.406 30.977 35 37.932 35 43.045 35 47.078 31.485 47.078 26.184 47.078 21.556 44.74 18.891 40.825 18.071L40.825 18.071Z"></path></g></svg><span>Highlights</span></a></li><li><a href="https://www.safaribooksonline.com/u/preferences/" class="t-settings-nav l1 js-settings nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"></path></g></svg><span>Settings</span></a></li><li><a href="https://www.oreilly.com/online-learning/support/" class="l1 no-icon">Support</a></li><li><a href="https://www.safaribooksonline.com/accounts/logout/" class="l1 no-icon">Sign Out</a></li></ul><ul class="profile"><li><a href="https://www.safaribooksonline.com/u/preferences/" class="l2 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"></path></g></svg><span>Settings</span></a><span class="l2 t-nag-notification" id="nav-nag"><strong class="trial-green">10</strong> days left in your trial.
  
  

  
    
      

<a class="" href="https://www.safaribooksonline.com/subscribe/">Subscribe</a>.


    
  

  

</span></li><li><a href="https://www.oreilly.com/online-learning/support/" class="l2">Support</a></li><li><a href="https://www.safaribooksonline.com/accounts/logout/" class="l2">Sign Out</a></li></ul></div></li></ul></nav></header>


      </div>
      <div id="container" class="application" style="height: auto;">
        
          <div class="nav-container clearfix">
            


            
            
          </div>

          

  <div class="js-toc">
    
      <div class="sbo-reading-menu sbo-menu-top"><section class="sbo-toc-container toc-menu"><a href="/site/library/view/streaming-systems/9781491983867/ch09.html#" class="sbo-toc-thumb"><span class="sbo-title ss-list"><h1><div class="visuallyhidden">Table of Contents for </div>
      
      Streaming Systems
      
    </h1></span></a><div class="toc-contents"></div></section></div>

    

    <div class="interface-controls interface-controls-top">
      <ul class="interface-control-btns js-bitlist js-reader">
        <li class="js-search-in-archive search-in-archive t-search-in-archive"><a href="/site/library/view/streaming-systems/9781491983867/ch09.html#" title="Search in archive" class="js-search-controls search-controls"><span class="icon">Search in book...</span></a><form class="search-archive-bar js-search-form"><input type="search" name="query" placeholder="Search inside this book..." autocomplete="off"></form><div class="search-archive-results"><div class="js-sitb-results-region"></div></div></li><li class="queue-control"><div class="js-content-uri" data-content-uri="/api/v1/book/9781491983867/chapter/ch09.html"><div class="js-collections-dropdown collections-dropdown menu-bit-cards"></div></div></li><li class="js-font-control-panel font-control-activator"><a href="/site/library/view/streaming-systems/9781491983867/ch09.html#" data-push-state="false" id="font-controls" title="Change font size" aria-label="Change font size"><span class="icon">Toggle Font Controls</span></a></li><li class="dropdown sharing-controls"><a href="/site/library/view/streaming-systems/9781491983867/ch09.html#" class="trigger" data-push-state="false" title="Share" aria-label="Share"><i class="fa fa-share"></i></a><ul class="social-sharing dropdown-menu"><li><a class="twitter share-button t-twitter" target="_blank" aria-label="Share this section on Twitter" title="Share this section on Twitter" href="https://twitter.com/share?url=https://www.safaribooksonline.com/library/view/streaming-systems/9781491983867/ch09.html&amp;text=Streaming%20Systems&amp;via=safari"><span>Twitter</span></a></li><li><a class="facebook share-button t-facebook" target="_blank" aria-label="Share this section on Facebook" title="Share this section on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://www.safaribooksonline.com/library/view/streaming-systems/9781491983867/ch09.html"><span>Facebook</span></a></li><li><a class="googleplus share-button t-googleplus" target="_blank" aria-label="Share this secton on Google Plus" title="Share this secton on Google Plus" href="https://plus.google.com/share?url=https://www.safaribooksonline.com/library/view/streaming-systems/9781491983867/ch09.html"><span>Google Plus</span></a></li><li><a class="email share-button t-email" aria-label="Share this section via email" title="Share this section via email" href="mailto:?subject=Safari:%209.%20Streaming%20Joins&amp;body=https://www.safaribooksonline.com/library/view/streaming-systems/9781491983867/ch09.html%0D%0Afrom%20Streaming%20Systems%0D%0A"><span>Email</span></a></li></ul></li>
      </ul>
    </div>

    <section role="document">
        
        



 <!--[if lt IE 9]>
  
<![endif]-->



  


        
	  <div class="t-sbo-prev sbo-prev sbo-nav-top">
  
    
      
        <a href="/site/library/view/streaming-systems/9781491983867/ch08.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">8. Streaming SQL</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-top">
  
    
      
        <a href="/site/library/view/streaming-systems/9781491983867/ch10.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">10. The Evolution of Large-Scale Data Processing</div>
        </a>
    
  
  </div>



<div id="sbo-rt-content" style="transform: none;"><div class="annotator-wrapper"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 9. Streaming Joins"><div class="chapter" id="streaming_joins">
<h1><span class="label">Chapter 9. </span>Streaming Joins</h1>

<p>When I first began learning about joins, it was an<a contenteditable="false" data-primary="streaming joins" data-type="indexterm" id="ix_strmjoin"></a> intimidating topic; <code>LEFT</code>, <code>OUTER</code>, <code>SEMI</code>, <code>INNER</code>, <code>CROSS</code>: the language of joins is expressive and expansive. Add on top of that the dimension of time that streaming brings to the table, and you’re left with what appears to be a challengingly complex topic.<a contenteditable="false" data-primary="joins" data-seealso="streaming joins" data-type="indexterm" id="idm140176509145344"></a> The good news is that joins really aren’t the frightening beast with nasty, pointy teeth that they might initially appear to be. As is the case with so many other complex topics, after you understand the central ideas and themes of joins, the broader landscape that’s built on top of these basics suddenly becomes so much more accessible. So please join me now as we explore the fascinating topic of...well, joins.</p>

<section data-type="sect1" data-pdf-bookmark="All Your Joins Are Belong to Streaming"><div class="sect1" id="idm140176509143408">
<h1>All Your Joins Are Belong to Streaming</h1>

<p>What does it mean to join two datasets? We understand intuitively that joins are just a specific type of grouping operation: by joining together<a contenteditable="false" data-primary="grouping operations" data-secondary="joins as" data-type="indexterm" id="idm140176509141776"></a> data that share some property (i.e., key), we collect together some number of previously unrelated individual data elements into a <em>group</em> of related elements. And as we learned in <a data-type="xref" href="/site/library/view/streaming-systems/9781491983867/ch06.html#streams_and_tables">Chapter&nbsp;6</a>, grouping operations always consume a stream and yield a table. Knowing these two things, it’s only a small leap to then arrive at the conclusion that forms the basis for this entire chapter: <em>at their hearts, all joins are streaming joins</em>.<a contenteditable="false" data-primary="joins" data-secondary="all joins as streaming joins" data-type="indexterm" id="idm140176509138000"></a></p>

<p>What’s great about this fact is that it actually makes the topic of streaming joins that much more tractable. All of the tools we’ve learned for reasoning about time within the context of streaming grouping operations (windowing, watermarks, triggers, etc.) continue to apply in the case of streaming joins. What’s perhaps intimidating is that adding streaming to the mix seems like it could only serve to complicate things. But as you’ll see in the examples that follow, there’s a certain elegant simplicity and consistency to modeling all joins as streaming joins. Instead of feeling like there are a confounding multitude of different join approaches, it becomes clear that nearly all types of joins really boil down to minor variations on the same pattern. In the end, that clarity of insight helps makes joins (streaming or otherwise) much less intimidating.</p>

<p>To give us something concrete to reason about, let’s consider a number of different types of joins as they’re applied the following datasets, conveniently named <code>Left</code> and <code>Right</code> to match the common nomenclature:</p>

<pre data-type="programlisting"><strong><em><span class="code_blue">12:10&gt;</span> SELECT <span class="code_orange">TABLE</span> * FROM Left;        <span class="code_blue">12:10&gt;</span> SELECT <span class="code_orange">TABLE</span> * FROM Right;</em></strong>
--------------------                    --------------------
| Num | Id | Time  |                    | Num | Id | Time  |
--------------------                    --------------------
| 1   | L1 | 12:02 |                    | 2   | R2 | 12:01 |
| 2   | L2 | 12:06 |                    | 3   | R3 | 12:04 |
| 3   | L3 | 12:03 |                    | 4   | R4 | 12:05 |
--------------------                    --------------------
</pre>

<p>Each contains three columns:</p>

<dl>
	<dt><code>Num</code></dt>
	<dd>
	<p>A single number.</p>
	</dd>
	<dt><code>Id</code></dt>
	<dd>
	<p>A portmanteau of the first letter in the name of the corresponding table (“<code>L</code>” or “<code>R</code>”) and the <code>Num</code>, thus providing a way to uniquely identify the source of a given cell in join results.</p>
	</dd>
	<dt><code>Time</code></dt>
	<dd>
	<p>The arrival time of the given record in the system, which becomes important when considering streaming joins.</p>
	</dd>
</dl>

<p>To keep things simple, note that our initial datasets will have strictly unique join keys. When we get to <code>SEMI</code> joins, we’ll introduce some more complicated datasets to highlight join behavior in the presence of duplicate keys.</p>

<p>We first look at <em>unwindowed joins</em> in a great deal of depth because windowing often affects join semantics in only a minor way.<a contenteditable="false" data-primary="windowing" data-seealso="unwindowed joins" data-type="indexterm" id="idm140176509120640"></a> After we exhaust our appetite for unwindowed joins, we then touch upon some of the more interesting points of joins in a windowed context.</p>
</div></section>

<section data-type="sect1" data-pdf-bookmark="Unwindowed Joins"><div class="sect1" id="idm140176509118848">
<h1>Unwindowed Joins</h1>

<p>It’s a popular myth that streaming joins over unbounded data always require windowing.<a contenteditable="false" data-primary="streaming joins" data-secondary="unwindowed joins" data-type="indexterm" id="ix_strmjoinunw"></a> But by applying<a contenteditable="false" data-primary="unwindowed joins" data-type="indexterm" id="ix_unwjoin"></a> the concepts we learned in <a data-type="xref" href="/site/library/view/streaming-systems/9781491983867/ch06.html#streams_and_tables">Chapter&nbsp;6</a>, we can see that’s simply not true. Joins (both windowed and unwindowed) are simply another type of grouping operation, and grouping operations yield tables. Thus, if we want to consume the table created by an unwindowed join (or, equivalently,<a contenteditable="false" data-primary="triggers" data-secondary="in unwindowed joins" data-type="indexterm" id="idm140176509112320"></a> joins within a single global window covering all of time) as a stream, we need only apply an ungrouping (or <span class="keep-together">trigger</span>) operation that isn’t of the “wait until we’ve seen all the input” variety. Windowing the join into a nonglobal window and using a watermark trigger (i.e., a “wait until we’ve seen all the input in a finite temporal chunk of the stream” trigger) is indeed one option, but so is triggering on every record (i.e., materialized view semantics) or <a contenteditable="false" data-primary="materialized views" data-type="indexterm" id="idm140176509109632"></a>periodically as processing time advances, regardless of whether the join is windowed or not. Because it makes the examples easy to follow, we assume the use of an implicit default per-record trigger in all of the following unwindowed join examples that observe the join results as a stream.</p>

<p>Now, onto joins themselves. ANSI SQL defines <a contenteditable="false" data-primary="SQL" data-secondary="types of joins defined in ANSI SQL" data-type="indexterm" id="idm140176509107552"></a>five types of joins: <code>FULL OUTER</code>, <code>LEFT OUTER</code>, <code>RIGHT OUTER</code>, <code>INNER</code>, and <code>CROSS</code>. We look at the first four in depth, and discuss the last only briefly in the next paragraph. We also touch on two other interesting, but less-often encountered (and less well supported, at least using standard syntax) variations: <code>ANTI</code> and <code>SEMI</code> joins.</p>

<p>On the surface, it sounds like a lot of variations. But as you’ll see, there’s really only one type of join at the core: the <code>FULL OUTER</code> join. A <code>CROSS</code> join is just a <code>FULL OUTER</code> join with a vacuously true join predicate; that is, it returns every possible pairing of a row from the left table with a row from the right table. All of the other join variations simply reduce down to some logical subset of the <code>FULL OUTER</code> join.<sup><a data-type="noteref" id="idm140176509100064-marker" href="/site/library/view/streaming-systems/9781491983867/ch09.html#idm140176509100064" class="totri-footnote">1</a></sup> As a result, after you understand the commonality between all the different join types, it becomes a lot easier to keep them all in your head. It also makes reasoning about them in the context of streaming all that much simpler.</p>

<p>One last note here before we get started: we’ll be primarily considering equi joins with at most 1:1 cardinality, by which<a contenteditable="false" data-primary="cardinality" data-secondary="in unwindowed joins" data-type="indexterm" id="idm140176509097920"></a> I mean joins in which the join predicate is an equality statement and there is at most one matching row on each side of the join. This keeps the examples simple and concise. When we get to <code>SEMI</code> joins, we’ll expand our example to consider joins with arbitrary N:M cardinality, which will let us observe the behavior of more arbitrary predicate joins.</p>

<section data-type="sect2" data-pdf-bookmark="FULL OUTER"><div class="sect2" id="idm140176509095456">
<h2>FULL OUTER</h2>

<p>Because they form the conceptual foundation for each of the other variations, we first look at <code>FULL OUTER</code> joins.<a contenteditable="false" data-primary="streaming joins" data-secondary="unwindowed joins" data-tertiary="FULL OUTER" data-type="indexterm" id="idm140176509093040"></a><a contenteditable="false" data-primary="unwindowed joins" data-secondary="FULL OUTER" data-type="indexterm" id="idm140176509091360"></a><a contenteditable="false" data-primary="FULL OUTER joins" data-type="indexterm" id="idm140176509089984"></a> Outer joins embody a rather liberal and optimistic interpretation of the word “join”: the result of <code>FULL OUTER</code>–joining two datasets is essentially the full list of rows in both datasets,<sup><a data-type="noteref" id="idm140176509088208-marker" href="/site/library/view/streaming-systems/9781491983867/ch09.html#idm140176509088208" class="totri-footnote">2</a></sup> with rows in the two datasets that share the same join key combined together, but unmatched rows for either side included unjoined.</p>

<p>For example, if we <code>FULL OUTER</code>–join our two example datasets into a new relation containing only the joined IDs, the result would look something like this:</p>

<pre data-type="programlisting"><strong><em><span class="code_blue">12:10&gt;</span> SELECT <span class="code_orange">TABLE</span> </em></strong>
<strong><em>         Left.Id as L, </em></strong>
<strong><em>         Right.Id as R,</em></strong>
<strong><em>       FROM Left <span class="yellow_bg">FULL OUTER</span> JOIN Right</em></strong>
<strong><em>       ON L.Num = R.Num;</em></strong>
---------------
| L    | R    |
---------------
| L1   | null | 
| L2   | R2   |
| L3   | R3   |
| null | R4   |
---------------
</pre>

<p>We can see that the <code>FULL OUTER</code> join includes both rows that satisfied the join predicate (e.g., “<code>L2, R2</code>” and “<code>L3, R3</code>”), but it also includes partial rows that failed the predicate (e.g., “<code>L1, null</code>” and “<code>null, R4</code>”, where the null is signaling the unjoined portion of the data).</p>

<p>Of course, that’s just a point-in-time snapshot of this <code>FULL OUTER</code>–join relation, taken after all of the data have arrived in the system. We’re here to learn about streaming joins, and streaming joins by definition involve the added dimension of time. As we know from <a data-type="xref" href="/site/library/view/streaming-systems/9781491983867/ch08.html#streaming_sql">Chapter&nbsp;8</a>, if we want to understand how a given dataset/relation changes over time, we want to speak in terms of time-varying relations (TVRs). <a contenteditable="false" data-primary="time-varying relations" data-secondary="for FULL OUTER joins" data-type="indexterm" id="idm140176509074992"></a>So to best understand how the join evolves over time, let’s look now at the full TVR for this join (with changes between each snapshot relation highlighted in yellow):</p>

<pre data-type="programlisting"><strong><em><span class="code_blue">12:10&gt;</span> SELECT <span class="code_grey">TVR</span></em></strong>
<strong><em>         Left.Id as L,</em></strong>
<strong><em>         Right.Id as R,</em></strong>
<strong><em>       FROM Left <span class="yellow_bg">FULL OUTER</span> JOIN Right</em></strong>
<strong><em>       ON L.Num = R.Num;</em></strong>
-------------------------------------------------------------------------
|  [-inf, 12:01)  |  [12:01, 12:02) |  [12:02, 12:03) |  [12:03, 12:04) |
| --------------- | --------------- | --------------- | --------------- |
| | L    | R    | | | L    | R    | | | L    | R    | | | L    | R    | |
| --------------- | --------------- | --------------- | --------------- |
| --------------- | <span class="yellow_bg">| null | R2   |</span> | <span class="yellow_bg">| L1   | null |</span> | | L1   | null | | 
|                 | --------------- | | null | R2   | | | null | R2   | |
|                 |                 | --------------- | <span class="yellow_bg">| L3   | null |</span> |
|                 |                 |                 | --------------- |
-------------------------------------------------------------------------
|  [12:04, 12:05) |  [12:05, 12:06) |  [12:06, 12:07) |
| --------------- | --------------- | --------------- |
| | L    | R    | | | L    | R    | | | L    | R    | |
| --------------- | --------------- | --------------- |
| | L1   | null | | | L1   | null | | | L1   | null | |
| | null | L2   | | | null | L2   | | |<span class="yellow_bg"> L2   </span>| L2   | |
| | L3   |<span class="yellow_bg"> L3   </span>| | | L3   | L3   | | | L3   | L3   | |
| --------------- | <span class="yellow_bg">| null | L4   |</span> | | null | L4   | |
|                 | --------------- | --------------- |
-------------------------------------------------------
</pre>

<p>And, as you might then expect, the stream rendering of this TVR would capture the specific deltas between each of those snapshots:</p>

<pre data-type="programlisting"><strong><em><span class="code_blue">12:00&gt;</span> SELECT <span class="code_purple">STREAM</span> </em></strong>
<strong><em>         Left.Id as L,</em></strong>
<strong><em>         Right.Id as R, </em></strong>
<strong><em>         CURRENT_TIMESTAMP as Time,</em></strong>
<strong><em>         Sys.Undo as Undo</em></strong>
<strong><em>       FROM Left <span class="yellow_bg">FULL OUTER</span> JOIN Right</em></strong>
<strong><em>       ON L.Num = R.Num;</em></strong>
------------------------------
| L    | R    | Time  | Undo |
------------------------------
| null | R2   | 12:01 |      |
| L1   | null | 12:02 |      |
| L3   | null | 12:03 |      |
| L3   | null | 12:04 | undo |
| L3   | R3   | 12:04 |      |
| null | R4   | 12:05 |      |
| null | R2   | 12:06 | undo |
| L2   | R2   | 12:06 |      |
....... [12:00, 12:10] .......
</pre>

<p>Note the inclusion of the <code>Time</code> and <code>Undo</code> columns, to highlight the times when given rows materialize in the stream, and also call out instances when an update to a given row first results in a retraction of the previous version of that row. The undo/retraction rows are critical if this stream is to capture a full-fidelity view of the TVR over time.</p>

<p>So, although each of these three renderings of the join (table, TVR, stream) are distinct from one another, it’s also pretty clear how they’re all just different views on the same data: the table snapshot shows us the overall dataset as it exists after all the data have arrived, and the TVR and stream versions capture (in their own ways) the evolution of the entire relation over the course of its existence.</p>

<p>With that basic familiarity of <code>FULL OUTER</code> joins in place, we now understand all of the core concepts of joins in a streaming context. No windowing needed, no custom triggers, nothing particularly painful or unintuitive. Just a per-record evolution of the join over time, as you would expect. Even better, all of the other types of joins are just variations on this theme (conceptually, at least), essentially just an additional filtering operation performed on the per-record stream of the <code>FULL OUTER</code> join. Let’s now look at each of them in more detail.</p>
</div></section>

<section data-type="sect2" data-pdf-bookmark="LEFT OUTER"><div class="sect2" id="idm140176509094832">
<h2>LEFT OUTER</h2>

<p><code>LEFT OUTER</code> joins are a just a <code>FULL OUTER</code> join <a contenteditable="false" data-primary="LEFT OUTER joins" data-type="indexterm" id="idm140176509048096"></a>with any unjoined rows from the right dataset removed. <a contenteditable="false" data-primary="streaming joins" data-secondary="unwindowed joins" data-tertiary="LEFT OUTER" data-type="indexterm" id="idm140176509046768"></a><a contenteditable="false" data-primary="unwindowed joins" data-secondary="LEFT OUTER" data-type="indexterm" id="idm140176509045120"></a>This is most clearly seen by taking the original <code>FULL OUTER</code> join and graying out the rows that would be filtered. For a <code>LEFT OUTER</code> join, that would look like the following, where every row with an unjoined left side is filtered out of the original <code>FULL OUTER</code> join:</p>

<pre data-type="programlisting"><strong><em>                                         <span class="code_blue">12:00&gt;</span> SELECT <span class="code_purple">STREAM</span> Left.Id as L, </em></strong>
<strong><em><span class="code_blue">12:10&gt;</span> SELECT <span class="code_orange">TABLE</span>                               Right.Id as R,</em></strong>
<strong><em>         Left.Id as L,                            Sys.EmitTime as Time, </em></strong>
<strong><em>         Right.Id as R                            Sys.Undo as Undo </em></strong>
<strong><em>       FROM Left <span class="yellow_bg">LEFT OUTER</span> JOIN Right          FROM Left <span class="yellow_bg">LEFT OUTER</span> JOIN Right</em></strong>
<strong><em>       ON L.Num = R.Num;                        ON L.Num = R.Num;</em></strong>
---------------                          ------------------------------
| L    | R    |                          | L    | R    | Time  | Undo |
---------------                          ------------------------------
| L1   | null |                          <span class="code_lightgrey">| null | R2   | 12:01 |      |</span>
| L2   | R2   |                          | L1   | null | 12:02 |      |
| L3   | R3   |                          | L3   | null | 12:03 |      |
<span class="code_lightgrey">| null | R4   |</span>                          | L3   | null | 12:04 | undo |
---------------                          | L3   | R3   | 12:04 |      |
                                         <span class="code_lightgrey">| null | R4   | 12:05 |      |</span>
                                         <span class="code_lightgrey">| null | R2   | 12:06 | undo |</span>
                                         | L2   | R2   | 12:06 |      |
                                         ....... [12:00, 12:10] .......
</pre>

<p>To see what the table and stream would actually look like in practice, let’s look at the same queries again, but this time with the grayed-out rows omitted entirely:</p>

<pre data-type="programlisting"><strong><em>                                         <span class="code_blue">12:00&gt;</span> SELECT <span class="code_purple">STREAM</span> Left.Id as L, </em></strong>
<strong><em><span class="code_blue">12:10&gt;</span> SELECT <span class="code_orange">TABLE</span>                               Right.Id as R,</em></strong>
<strong><em>         Left.Id as L,                            Sys.EmitTime as Time, </em></strong>
<strong><em>         Right.Id as R                            Sys.Undo as Undo </em></strong>
<strong><em>       FROM Left <span class="yellow_bg">LEFT OUTER</span> JOIN Right          FROM Left <span class="yellow_bg">LEFT OUTER</span> JOIN Right</em></strong>
<strong><em>       ON L.Num = R.Num;                        ON L.Num = R.Num;</em></strong>
---------------                          ------------------------------
| L    | R    |                          | L    | R    | Time  | Undo |
---------------                          ------------------------------
| L1   | null |                          | L1   | null | 12:02 |      |
| L2   | R2   |                          | L3   | null | 12:03 |      |
| L3   | R3   |                          | L3   | null | 12:04 | undo |
---------------                          | L3   | R3   | 12:04 |      |
                                         | L2   | R2   | 12:06 |      |
                                         ....... [12:00, 12:10] .......
</pre>
</div></section>

<section data-type="sect2" data-pdf-bookmark="RIGHT OUTER"><div class="sect2" id="idm140176509020320">
<h2>RIGHT OUTER</h2>

<p><code>RIGHT OUTER</code> joins are the<a contenteditable="false" data-primary="unwindowed joins" data-secondary="RIGHT OUTER" data-type="indexterm" id="idm140176509018512"></a> converse <a contenteditable="false" data-primary="RIGHT OUTER joins" data-type="indexterm" id="idm140176509016976"></a>of a left join: all unjoined rows<a contenteditable="false" data-primary="streaming joins" data-secondary="unwindowed joins" data-tertiary="RIGHT OUTER" data-type="indexterm" id="idm140176509015712"></a> from the left dataset in the full outer join are right out, *cough*, removed:</p>

<pre data-type="programlisting"><strong><em>                                         <span class="code_blue">12:00&gt;</span> SELECT <span class="code_purple">STREAM</span> Left.Id as L, </em></strong>
<strong><em><span class="code_blue">12:10&gt;</span> SELECT <span class="code_orange">TABLE</span>                               Right.Id as R,</em></strong>
<strong><em>         Left.Id as L,                            Sys.EmitTime as Time, </em></strong>
<strong><em>         Right.Id as R                            Sys.Undo as Undo </em></strong>
<strong><em>       FROM Left <span class="yellow_bg">RIGHT OUTER</span> JOIN Right         FROM Left <span class="yellow_bg">RIGHT OUTER</span> JOIN Right</em></strong>
<strong><em>       ON L.Num = R.Num;                        ON L.Num = R.Num;</em></strong>
---------------                          ------------------------------
| L    | R    |                          | L    | R    | Time  | Undo |
---------------                          ------------------------------
<span class="code_lightgrey">| L1   | null |</span>                          | null | R2   | 12:01 |      |
| L2   | R2   |                          <span class="code_lightgrey">| L1   | null | 12:02 |      |</span>
| L3   | R3   |                          <span class="code_lightgrey">| L3   | null | 12:03 |      |</span>
| null | R4   |                          <span class="code_lightgrey">| L3   | null | 12:04 | undo |</span>
---------------                          | L3   | R3   | 12:04 |      |
                                         | null | R4   | 12:05 |      |
                                         | null | R2   | 12:06 | undo |
                                         | L2   | R2   | 12:06 |      |
                                         ....... [12:00, 12:10] .......
</pre>

<p>And here we see how the queries rendered as the actual <code>RIGHT OUTER</code> join would appear:</p>

<pre data-type="programlisting"><strong><em>                                         <span class="code_blue">12:00&gt;</span> SELECT <span class="code_purple">STREAM</span> Left.Id as L, </em></strong>
<strong><em><span class="code_blue">12:10&gt;</span> SELECT <span class="code_orange">TABLE</span>                               Right.Id as R,</em></strong>
<strong><em>         Left.Id as L,                            Sys.EmitTime as Time, </em></strong>
<strong><em>         Right.Id as R                            Sys.Undo as Undo </em></strong>
<strong><em>       FROM Left <span class="yellow_bg">RIGHT OUTER</span> JOIN Right         FROM Left <span class="yellow_bg">RIGHT OUTER</span> JOIN Right</em></strong>
<strong><em>       ON L.Num = R.Num;                        ON L.Num = R.Num;</em></strong>
---------------                          ------------------------------
| L    | R    |                          | L    | R    | Time  | Undo |
---------------                          ------------------------------
| L2   | R2   |                          | null | R2   | 12:01 |      |
| L3   | R3   |                          | L3   | R3   | 12:04 |      |
| null | R4   |                          | null | R4   | 12:05 |      |
---------------                          | null | R2   | 12:06 | undo |
                                         | L2   | R2   | 12:06 |      |
                                         ....... [12:00, 12:10] .......
</pre>
</div></section>

<section data-type="sect2" data-pdf-bookmark="INNER"><div class="sect2" id="idm140176508991456">
<h2>INNER</h2>

<p><code>INNER</code> joins are essentially the intersection of the <code>LEFT OUTER</code> and <code>RIGHT OUTER</code> joins.<a contenteditable="false" data-primary="streaming joins" data-secondary="unwindowed joins" data-tertiary="INNER" data-type="indexterm" id="idm140176508988496"></a><a contenteditable="false" data-primary="INNER joins" data-type="indexterm" id="idm140176508986816"></a><a contenteditable="false" data-primary="unwindowed joins" data-secondary="INNER" data-type="indexterm" id="idm140176508985712"></a> Or, to think of it subtractively, the rows removed from the original <code>FULL OUTER</code> join to create an <code>INNER</code> join are the union of the rows removed from the <code>LEFT OUTER</code> and <code>RIGHT OUTER</code> joins. As a result, all rows that remain unjoined on either side are absent from the <code>INNER</code> join:</p>

<pre data-type="programlisting"><strong><em>                                         <span class="code_blue">12:00&gt;</span> SELECT <span class="code_purple">STREAM</span> Left.Id as L, </em></strong>
<strong><em><span class="code_blue">12:10&gt;</span> SELECT <span class="code_orange">TABLE</span>                               Right.Id as R,</em></strong>
<strong><em>         Left.Id as L,                            Sys.EmitTime as Time, </em></strong>
<strong><em>         Right.Id as R                            Sys.Undo as Undo </em></strong>
<strong><em>       FROM Left <span class="yellow_bg">INNER</span> JOIN Right               FROM Left <span class="yellow_bg">INNER</span> JOIN Right</em></strong>
<strong><em>       ON L.Num = R.Num;                        ON L.Num = R.Num;</em></strong>
---------------                          ------------------------------
| L    | R    |                          | L    | R    | Time  | Undo |
---------------                          ------------------------------
<span class="code_lightgrey">| L1   | null |</span>                          <span class="code_lightgrey">| null | R2   | 12:01 |      |</span>
| L2   | R2   |                          <span class="code_lightgrey">| L1   | null | 12:02 |      |</span>
| L3   | R3   |                          <span class="code_lightgrey">| L3   | null | 12:03 |      |</span>
<span class="code_lightgrey">| null | R4   |</span>                          <span class="code_lightgrey">| L3   | null | 12:04 | undo |</span>
---------------                          | L3   | R3   | 12:04 |      |
                                         <span class="code_lightgrey">| null | R4   | 12:05 |      |</span>
                                         <span class="code_lightgrey">| null | R2   | 12:06 | undo |</span>
                                         | L2   | R2   | 12:06 |      |
                                         ....... [12:00, 12:10] .......
</pre>

<p>And again, more succinctly rendered as the <code>INNER</code> join would look in reality:</p>

<pre data-type="programlisting"><strong><em>                                         <span class="code_blue">12:00&gt;</span> SELECT <span class="code_purple">STREAM</span> Left.Id as L, </em></strong>
<strong><em><span class="code_blue">12:10&gt;</span> SELECT <span class="code_orange">TABLE</span>                               Right.Id as R,</em></strong>
<strong><em>         Left.Id as L,                            Sys.EmitTime as Time, </em></strong>
<strong><em>         Right.Id as R                            Sys.Undo as Undo </em></strong>
<strong><em>       FROM Left <span class="yellow_bg">INNER</span> JOIN Right               FROM Left <span class="yellow_bg">INNER</span> JOIN Right</em></strong>
<strong><em>       ON L.Num = R.Num;                        ON L.Num = R.Num;</em></strong>
---------------                          ------------------------------
| L    | R    |                          | L    | R    | Time  | Undo |
---------------                          ------------------------------
| L2   | R2   |                          | L3   | R3   | 12:04 |      |
| L3   | R3   |                          | L2   | R2   | 12:06 |      |
---------------                          ....... [12:00, 12:10] .......
</pre>

<p>Given this example, you might be inclined to think retractions never play a part in <code>INNER</code> join streams because they were all filtered out in this example. But imagine if the value in the <code>Left</code> table for the row with a <code>Num</code> of <code>3</code> were updated from “<code>L3</code>” to “<code>L3v2</code>” at 12:07. In addition to resulting in a different value on the left side for our final <code><span class="code_orange">TABLE</span></code> query (again performed at 12:10, which is after the update to row <code>3</code> on the <code>Left</code> arrived), it would also result in a <code><span class="code_purple">STREAM</span></code> that captures both the removal of the old value via a retraction and the addition of the new value:</p>

<pre data-type="programlisting"><strong><em>                                         <span class="code_blue">12:00&gt;</span> SELECT <span class="code_purple">STREAM</span> Left.Id as L, </em></strong>
<strong><em><span class="code_blue">12:10&gt;</span> SELECT <span class="code_orange">TABLE</span>                               Right.Id as R,</em></strong>
<strong><em>         Left.Id as L,                            Sys.EmitTime as Time, </em></strong>
<strong><em>         Right.Id as R                            Sys.Undo as Undo </em></strong>
<strong><em>       FROM LeftV2 <span class="yellow_bg">INNER</span> JOIN Right             FROM LeftV2 <span class="yellow_bg">INNER</span> JOIN Right</em></strong>
<strong><em>       ON L.Num = R.Num;                        ON L.Num = R.Num;</em></strong>
---------------                           ------------------------------
| L    | R    |                           | L    | R    | Time  | Undo |
---------------                           ------------------------------
| L2   | R2   |                           | L3   | R3   | 12:04 |      |
| L3v2 | R3   |                           | L2   | R2   | 12:06 |      |
---------------                           | L3   | R3   | 12:07 | undo | 
                                          | L3v2 | R3   | 12:07 |      |
                                          ....... [12:00, 12:10] .......
</pre>
</div></section>

<section data-type="sect2" data-pdf-bookmark="ANTI"><div class="sect2" id="idm140176508941744">
<h2>ANTI</h2>

<p><code>ANTI</code> joins are the obverse of the <code>INNER</code> join: they <a contenteditable="false" data-primary="ANTI joins" data-type="indexterm" id="idm140176508939296"></a>contain <a contenteditable="false" data-primary="unwindowed joins" data-secondary="ANTI" data-type="indexterm" id="idm140176508938032"></a>all of <a contenteditable="false" data-primary="streaming SQL" data-secondary="unwindowed joins" data-tertiary="ANTI" data-type="indexterm" id="idm140176508936496"></a>the <em>unjoined</em> rows. Not all SQL systems support a clean <code>ANTI</code> join syntax, but I’ll use the most straightforward one here for clarity:</p>

<pre data-type="programlisting"><strong><em>                                         <span class="code_blue">12:00&gt;</span> SELECT <span class="code_purple">STREAM</span> Left.Id as L, </em></strong>
<strong><em><span class="code_blue">12:10&gt;</span> SELECT <span class="code_orange">TABLE</span>                               Right.Id as R,</em></strong>
<strong><em>         Left.Id as L,                            Sys.EmitTime as Time, </em></strong>
<strong><em>         Right.Id as R                            Sys.Undo as Undo </em></strong>
<strong><em>       FROM Left <span class="yellow_bg">ANTI</span> JOIN Right                FROM Left <span class="yellow_bg">ANTI</span> JOIN Right</em></strong>
<strong><em>       ON L.Num = R.Num;                        ON L.Num = R.Num;</em></strong>
---------------                          -------------------------------
| L    | R    |                          | L    |    R | Time  | Undo |
---------------                          ------------------------------
| L1   | null |                          | null | R2   | 12:01 |      |
<span class="code_lightgrey">| L2   | R2   |</span>                          | L1   | null | 12:02 |      |
<span class="code_lightgrey">| L3   | R3   |</span>                          | L3   | null | 12:03 |      |
| null | R4   |                          | L3   | null | 12:04 | undo |
---------------                          <span class="code_lightgrey">| L3   | R3   | 12:04 |      |</span>
                                         | null | R4   | 12:05 |      |
                                         | null | R2   | 12:06 | undo |
                                         <span class="code_lightgrey">| L2   | R2   | 12:06 |      |</span>
                                         ....... [12:00, 12:10] .......
</pre>

<p>What’s slightly interesting about the stream rendering of the <code>ANTI</code> join is that it ends up containing a bunch of false-starts and retractions for rows which eventually do end up joining; in fact, the <code>ANTI</code> join is as heavy on retractions as the <code>INNER</code> join is light. The more concise versions would look like this:</p>

<pre data-type="programlisting"><strong><em>                                         <span class="code_blue">12:00&gt;</span> SELECT <span class="code_purple">STREAM</span> Left.Id as L, </em></strong>
<strong><em><span class="code_blue">12:10&gt;</span> SELECT <span class="code_orange">TABLE</span>                               Right.Id as R,</em></strong>
<strong><em>         Left.Id as L,                            Sys.EmitTime as Time, </em></strong>
<strong><em>         Right.Id as R                            Sys.Undo as Undo </em></strong>
<strong><em>       FROM Left <span class="yellow_bg">ANTI</span> JOIN Right               FROM Left <span class="yellow_bg">ANTI</span> JOIN Right</em></strong>
<strong><em>       ON L.Num = R.Num;                        ON L.Num = R.Num;</em></strong>
---------------                          ------------------------------
| L    | R    |                          | L    | R    | Time  | Undo |
---------------                          ------------------------------
| L1   | null |                          | null | R2   | 12:01 |      |
| null | R4   |                          | L1   | null | 12:02 |      |
---------------                          | L3   | null | 12:03 |      | 
                                         | L3   | null | 12:04 | undo |
                                         | null | R4   | 12:05 |      |
                                         | null | R2   | 12:06 | undo |
                                         ....... [12:00, 12:10] .......
</pre>
</div></section>

<section data-type="sect2" data-pdf-bookmark="SEMI"><div class="sect2" id="idm140176508910256">
<h2>SEMI</h2>

<p>We now come to <code>SEMI</code> joins, and <code>SEMI</code> joins are kind of weird.<a contenteditable="false" data-primary="streaming joins" data-secondary="unwindowed joins" data-tertiary="SEMI" data-type="indexterm" id="ix_strmjoinunwSEMI"></a><a contenteditable="false" data-primary="SEMI joins" data-type="indexterm" id="ix_SEMIj"></a><a contenteditable="false" data-primary="unwindowed joins" data-secondary="SEMI" data-type="indexterm" id="ix_unwjoinSEMI"></a> At first glance, they basically look like inner joins with one side of the joined values being dropped. And, indeed, in cases for which the cardinality relationship of <code>&lt;side-being-kept&gt;:&lt;side-being-dropped&gt;</code> is N:M with M ≤ 1, this works (note that we’ll be using kept=<code>Left</code>, dropped=<code>Right</code> for all the examples that follow). For example, on the <code>Left</code> and <code>Right</code> datasets we’ve used so far (which had cardinalities of 0:1, 1:0, and 1:1 for the joined data), the <code>INNER</code> and <code>SEMI</code> join variations look identical:</p>

<pre data-type="programlisting"><strong><em><span class="code_blue">12:10&gt;</span> SELECT <span class="code_orange">TABLE</span>            <span class="code_blue">12:10&gt;</span> SELECT <span class="code_orange">TABLE</span></em></strong>
<strong><em>  Left.Id as L                   Left.Id as L</em></strong>
<strong><em>FROM Left <span class="yellow_bg">INNER</span> JOIN           FROM Left <span class="yellow_bg">SEMI</span> JOIN</em></strong>
<strong><em>Right ON L.Num = R.Num;        Right ON L.Num = R.Num;</em></strong>
--------<span class="code_lightgrey">-------</span>                --------<span class="code_lightgrey">-------</span>
| L    |<span class="code_lightgrey"> R    |</span>                | L    |<span class="code_lightgrey"> R    |</span>
--------<span class="code_lightgrey">-------</span>                --------<span class="code_lightgrey">-------</span>
<span class="code_lightgrey">| L1   | null |</span>                <span class="code_lightgrey">| L1   | null |</span>
| L2   |<span class="code_lightgrey"> R2   |</span>                | L2   |<span class="code_lightgrey"> R2   |</span>
| L3   |<span class="code_lightgrey"> R3   |</span>                | L3   |<span class="code_lightgrey"> R3   |</span>
<span class="code_lightgrey">| null | R4   |</span>                <span class="code_lightgrey">| null | R4   |</span>
--------<span class="code_lightgrey">-------</span>                --------<span class="code_lightgrey">-------</span>
</pre>

<p>However, there’s an additional subtlety to <code>SEMI</code> joins in<a contenteditable="false" data-primary="cardinality" data-secondary="in unwindowed joins" data-tertiary="SEMI join" data-type="indexterm" id="idm140176508879312"></a> the case of N:M cardinality with M &gt; 1: because the <em>values</em> on the M side are not being returned, the <code>SEMI</code> join simply predicates the join condition on there being <em>any</em> matching row on the right, rather than repeatedly yielding a new result for <em>every</em> matching row.</p>

<p>To see this clearly, let’s switch to a slightly more complicated pair of input relations that highlight the N:M join cardinality of the rows contained therein. In these relations, the <code>N_M</code> column states what the cardinality relationship of rows is between the left and right sides, and the <code>Id</code> column (as before) provides an identifier that is unique for each row in each of the input relations:</p>

<pre data-type="programlisting"><strong><em><span class="code_blue">12:15&gt;</span> SELECT <span class="code_orange">TABLE</span> * FROM LeftNM;    <span class="code_blue">12:15&gt;</span> SELECT <span class="code_orange">TABLE</span> * FROM RightNM;</em></strong>
---------------------                 ---------------------
| N_M | Id  |  Time |                 | N_M | Id  |  Time |
---------------------                 ---------------------
| 1:0 | L2  | 12:07 |                 | 0:1 | R1  | 12:02 |
| 1:1 | L3  | 12:01 |                 | 1:1 | R3  | 12:14 |
| 1:2 | L4  | 12:05 |                 | 1:2 | R4A | 12:03 |
| 2:1 | L5A | 12:09 |                 | 1:2 | R4B | 12:04 |
| 2:1 | L5B | 12:08 |                 | 2:1 | R5  | 12:06 |
| 2:2 | L6A | 12:12 |                 | 2:2 | R6A | 12:11 |
| 2:2 | L6B | 12:10 |                 | 2:2 | R6B | 12:13 |
---------------------                 ---------------------
</pre>

<p class="pagebreak-before">With these inputs, the <code>FULL OUTER</code> join expands to look like these:</p>

<pre data-type="programlisting"><strong><em>                                       <span class="code_blue">12:00&gt;</span> SELECT <span class="code_purple">STREAM</span></em></strong>
<strong><em>                                                COALESCE(LeftNM.N_M, </em></strong>
<strong><em><span class="code_blue">12:15&gt;</span> SELECT <span class="code_orange">TABLE</span>                                      RightNM.N_M) as N_M, </em></strong>
<strong><em>         COALESCE(LeftNM.N_M,                     LeftNM.Id as L,</em></strong>
<strong><em>                  RightNM.N_M) as N_M,            RightNM.Id as R, </em></strong>
<strong><em>         LeftNM.Id as L,                        Sys.EmitTime as Time, </em></strong>
<strong><em>         RightNM.Id as R,                         Sys.Undo as Undo</em></strong>
<strong><em>       FROM LeftNM                            FROM LeftNM </em></strong>
<strong><em>         <span class="yellow_bg">FULL OUTER</span> JOIN RightNM                <span class="yellow_bg">FULL OUTER</span> JOIN RightNM</em></strong>
<strong><em>         ON LeftNM.N_M = RightNM.N_M;           ON LeftNM.N_M = RightNM.N_M;</em></strong>
---------------------                  ------------------------------------
| N_M | L    | R    |                  | N_M | L    | R    | Time  | Undo |
---------------------                  ------------------------------------
| 0:1 | null | R1   |                  | 1:1 | L3   | null | 12:01 |      |
| 1:0 | L2   | null |                  | 0:1 | null | R1   | 12:02 |      |
| 1:1 | L3   | R3   |                  | 1:2 | null | R4A  | 12:03 |      |
| 1:2 | L4   | R4A  |                  | 1:2 | null | R4B  | 12:04 |      |
| 1:2 | L4   | R4B  |                  | 1:2 | null | R4A  | 12:05 | undo |
| 2:1 | L5A  | R5   |                  | 1:2 | null | R4B  | 12:05 | undo |
| 2:1 | L5B  | R5   |                  | 1:2 | L4   | R4A  | 12:05 |      |
| 2:2 | L6A  | R6A  |                  | 1:2 | L4   | R4B  | 12:05 |      |
| 2:2 | L6A  | R6B  |                  | 2:1 | null | R5   | 12:06 |      |
| 2:2 | L6B  | R6A  |                  | 1:0 | L2   | null | 12:07 |      |
| 2:2 | L6B  | R6B  |                  | 2:1 | null | R5   | 12:08 | undo |
---------------------                  | 2:1 | L5B  | R5   | 12:08 |      |
                                       | 2:1 | L5A  | R5   | 12:09 |      |
                                       | 2:2 | L6B  | null | 12:10 |      |
                                       | 2:2 | L6B  | null | 12:11 | undo |
                                       | 2:2 | L6B  | R6A  | 12:11 |      |
                                       | 2:2 | L6A  | R6A  | 12:12 |      |
                                       | 2:2 | L6A  | R6B  | 12:13 |      |
                                       | 2:2 | L6B  | R6B  | 12:13 |      |
                                       | 1:1 | L3   | null | 12:14 | undo |
                                       | 1:1 | L3   | R3   | 12:14 |      |
                                       .......... [12:00, 12:15] ..........
</pre>

<p>As a side note, one additional benefit of these more complicated datasets is that the multiplicative nature of joins when there are multiple rows on each side matching the same predicate begins to become more clear (e.g., the “2:2” rows, which expand from two rows in each the inputs to four rows in the output; if the dataset had a set of “3:3” rows, they’d expand from three rows in each of the inputs to nine rows in the output, and so on).</p>

<p>But back to the subtleties of <code>SEMI</code> joins. With these datasets, it becomes much clearer what the difference between the filtered <code>INNER</code> join and the <code>SEMI</code> join is: the <code>INNER</code> join yields duplicate values for any of the rows where the N:M cardinality has M &gt; 1, whereas the <code>SEMI</code> join doesn’t (note that I’ve highlighted the duplicate rows in the <code>INNER</code> join version in red, and included in gray the portions of the full outer join that are omitted in the respective <code>INNER</code> and <code>SEMI</code> versions):</p>

<pre data-type="programlisting"><strong><em><span class="code_blue">12:15&gt;</span> SELECT <span class="code_orange">TABLE</span>                       <span class="code_blue">12:15&gt;</span> SELECT <span class="code_orange">TABLE</span></em></strong>
<strong><em>         COALESCE(LeftNM.N_M,                      COALESCE(LeftNM.N_M,</em></strong>
<strong><em>                  RightNM.N_M) as N_M,                      RightNM.N_M) as N_M,</em></strong>
<strong><em>         LeftNM.Id as L                            LeftNM.Id as L</em></strong>
<strong><em>       FROM LeftNM <span class="yellow_bg">INNER</span> JOIN RightNM            FROM LeftNM <span class="yellow_bg">SEMI</span> JOIN RightNM</em></strong>
<strong><em>       ON LeftNM.N_M = RightNM.N_M;              ON LeftNM.N_M = RightNM.N_M;</em></strong>
--------------<span class="code_lightgrey">-------</span>                     --------------<span class="code_lightgrey">-------</span>
| N_M | L    |<span class="code_lightgrey"> R    |</span>                     | N_M | L    |<span class="code_lightgrey"> R    |</span>
--------------<span class="code_lightgrey">-------</span>                     --------------<span class="code_lightgrey">-------</span>
<span class="code_lightgrey">| 0:1 | null | R1   |</span>                     <span class="code_lightgrey">| 0:1 | null | R1   |</span>
<span class="code_lightgrey">| 1:0 | L2   | null |</span>                     <span class="code_lightgrey">| 1:0 | L2   | null |</span>
| 1:1 | L3   |<span class="code_lightgrey"> R3   |</span>                     | 1:1 | L3   |<span class="code_lightgrey"> R3   |</span>
| 1:2 | L4   |<span class="code_lightgrey"> R5A  |</span>                     | 1:2 | L4   |<span class="code_lightgrey"> R5A  |</span>
|<span class="red_bg"> 1:2 </span>|<span class="red_bg"> L4   </span>|<span class="code_lightgrey"> R5B  |</span>                     <span class="code_lightgrey">| 1:2 | L4   | R5B  |</span>
| 2:1 | L5A  |<span class="code_lightgrey"> R5   |</span>                     | 2:1 | L5A  |<span class="code_lightgrey"> R5   |</span>
| 2:1 | L5B  |<span class="code_lightgrey"> R5   |</span>                     | 2:1 | L5B  |<span class="code_lightgrey"> R5   |</span>
| 2:2 | L6A  |<span class="code_lightgrey"> R6A  |</span>                     | 2:2 | L6A  |<span class="code_lightgrey"> R6A  |</span>
|<span class="red_bg"> 2:2 </span>|<span class="red_bg"> L6A  </span>|<span class="code_lightgrey"> R6B  |</span>                     <span class="code_lightgrey">| 2:2 | L6A  | R6B  |</span>
| 2:2 | L6B  |<span class="code_lightgrey"> R6A  |</span>                     | 2:2 | L6B  |<span class="code_lightgrey"> R6A  |</span>
|<span class="red_bg"> 2:2 </span>|<span class="red_bg"> L6B  </span>|<span class="code_lightgrey"> R6B  |</span>                     <span class="code_lightgrey">| 2:2 | L6B  | R6B  |</span>
--------------<span class="code_lightgrey">-------</span>                     --------------<span class="code_lightgrey">-------</span>
</pre>

<p>Or, rendered more succinctly:</p>

<pre data-type="programlisting"><strong><em><span class="code_blue">12:15&gt;</span> SELECT <span class="code_orange">TABLE</span>                       <span class="code_blue">12:15&gt;</span> SELECT <span class="code_orange">TABLE</span></em></strong>
<strong><em>         COALESCE(LeftNM.N_M,                      COALESCE(LeftNM.N_M,</em></strong>
<strong><em>                  RightNM.N_M) as N_M,                      RightNM.N_M) as N_M,</em></strong>
<strong><em>         LeftNM.Id as L                            LeftNM.Id as L</em></strong>
<strong><em>       FROM LeftNM <span class="yellow_bg">INNER</span> JOIN RightNM            FROM LeftNM <span class="yellow_bg">SEMI</span> JOIN RightNM</em></strong>
<strong><em>       ON LeftNM.N_M = RightNM.N_M;              ON LeftNM.N_M = RightNM.N_M;</em></strong>
-------------                             -------------
| N_M | L   |                             | N_M | L   |
-------------                             -------------
| 1:1 | L3  |                             | 1:1 | L3  |
| 1:2 | L4  |                             | 1:2 | L4  |
|<span class="red_bg"> 1:2 </span>|<span class="red_bg"> L4  </span>|                             | 2:1 | L5A |
| 2:1 | L5A |                             | 2:1 | L5B |
| 2:1 | L5B |                             | 2:2 | L6A |
| 2:2 | L6A |                             | 2:2 | L6B |
|<span class="red_bg"> 2:2 </span>|<span class="red_bg"> L6A </span>|                             -------------
| 2:2 | L6B |
|<span class="red_bg"> 2:2 </span>|<span class="red_bg"> L6B </span>|
-------------
</pre>

<p>The <code><span class="code_purple">STREAM</span></code> renderings then provide a bit of context as to which rows are filtered out—they are simply the later-arriving duplicate rows (from the perspective of the columns being projected):</p>

<pre class="pagebreak-before" data-type="programlisting"><strong><em><span class="code_blue">12:00&gt;</span> SELECT <span class="code_purple">STREAM</span>                        <span class="code_blue">12:00&gt;</span> SELECT <span class="code_purple">STREAM</span></em></strong>
<strong><em>         COALESCE(LeftNM.N_M,                        COALESCE(LeftNM.N_M,</em></strong>
<strong><em>                  RightNM.N_M) as N_M,                        RightNM.N_M) as N_M,</em></strong>
<strong><em>         LeftNM.Id as L                              LeftNM.Id as L</em></strong>
<strong><em>         Sys.EmitTime as Time,                       Sys.EmitTime as Time,</em></strong>
<strong><em>         Sys.Undo as Undo,                           Sys.Undo as Undo,</em></strong>
<strong><em>       FROM LeftNM <span class="yellow_bg">INNER</span> JOIN RightNM              FROM LeftNM <span class="yellow_bg">SEMI</span> JOIN RightNM</em></strong>
<strong><em>       ON LeftNM.N_M = RightNM.N_M;                ON LeftNM.N_M = RightNM.N_M;</em></strong>
--------------<span class="code_lightgrey">-------</span>---------------        --------------<span class="code_lightgrey">-------</span>---------------
| N_M | L    |<span class="code_lightgrey"> R    |</span> Time  | Undo |        | N_M | L    |<span class="code_lightgrey"> R    |</span> Time  | Undo |
--------------<span class="code_lightgrey">-------</span>---------------        --------------<span class="code_lightgrey">-------</span>---------------
<span class="code_lightgrey">| 1:1 | L3   | null | 12:01 |      |</span>        <span class="code_lightgrey">| 1:1 | L3   | null | 12:01 |      |</span>
<span class="code_lightgrey">| 0:1 | null | R1   | 12:02 |      |</span>        <span class="code_lightgrey">| 0:1 | null | R1   | 12:02 |      |</span>
<span class="code_lightgrey">| 1:2 | null | R4A  | 12:03 |      |</span>        <span class="code_lightgrey">| 1:2 | null | R4A  | 12:03 |      |</span>
<span class="code_lightgrey">| 1:2 | null | R4B  | 12:04 |      |</span>        <span class="code_lightgrey">| 1:2 | null | R4B  | 12:04 |      |</span>
<span class="code_lightgrey">| 1:2 | null | R4A  | 12:05 | undo |</span>        <span class="code_lightgrey">| 1:2 | null | R4A  | 12:05 | undo |</span>
<span class="code_lightgrey">| 1:2 | null | R4B  | 12:05 | undo |</span>        <span class="code_lightgrey">| 1:2 | null | R4B  | 12:05 | undo |</span>
| 1:2 | L4   |<span class="code_lightgrey"> R4A  |</span> 12:05 |      |        | 1:2 | L4   |<span class="code_lightgrey"> R4A  |</span> 12:05 |      |
|<span class="red_bg"> 1:2 </span>|<span class="red_bg"> L4   </span>|<span class="code_lightgrey"> R4B  |</span><span class="red_bg"> 12:05 </span>|<span class="red_bg">      </span>|        <span class="code_lightgrey">| 1:2 | L4   | R4B  | 12:05 |      |</span>
<span class="code_lightgrey">| 2:1 | null | R5   | 12:06 |      |</span>        <span class="code_lightgrey">| 2:1 | null | R5   | 12:06 |      |</span>
<span class="code_lightgrey">| 1:0 | L2   | null | 12:07 |      |</span>        <span class="code_lightgrey">| 1:0 | L2   | null | 12:07 |      |</span>
<span class="code_lightgrey">| 2:1 | null | R5   | 12:08 | undo |</span>        <span class="code_lightgrey">| 2:1 | null | R5   | 12:08 | undo |</span>
| 2:1 | L5B  |<span class="code_lightgrey"> R5   |</span> 12:08 |      |        | 2:1 | L5B  |<span class="code_lightgrey"> R5   |</span> 12:08 |      |
| 2:1 | L5A  |<span class="code_lightgrey"> R5   |</span> 12:09 |      |        | 2:1 | L5A  |<span class="code_lightgrey"> R5   |</span> 12:09 |      |
<span class="code_lightgrey">| 2:2 | L6B  | null | 12:10 |      |</span>        <span class="code_lightgrey">| 2:2 | L6B  | null | 12:10 |      |</span>
<span class="code_lightgrey">| 2:2 | L6B  | null | 12:10 | undo |</span>        <span class="code_lightgrey">| 2:2 | L6B  | null | 12:10 | undo |</span>
| 2:2 | L6B  |<span class="code_lightgrey"> R6A  |</span> 12:11 |      |        | 2:2 | L6B  |<span class="code_lightgrey"> R6A  |</span> 12:11 |      |
| 2:2 | L6A  |<span class="code_lightgrey"> R6A  |</span> 12:12 |      |        | 2:2 | L6A  |<span class="code_lightgrey"> R6A  |</span> 12:12 |      |
|<span class="red_bg"> 2:2 </span>|<span class="red_bg"> L6A  </span>|<span class="code_lightgrey"> R6B  |</span><span class="red_bg"> 12:13 </span>|<span class="red_bg">      </span>|        <span class="code_lightgrey">| 2:2 | L6A  | R6B  | 12:13 |      |</span>
|<span class="red_bg"> 2:2 </span>|<span class="red_bg"> L6B  </span>|<span class="code_lightgrey"> R6B  |</span><span class="red_bg"> 12:13 </span>|<span class="red_bg">      </span>|        <span class="code_lightgrey">| 2:2 | L6B  | R6B  | 12:13 |      |</span>
<span class="code_lightgrey">| 1:1 | L3   | null | 12:14 | undo |</span>        <span class="code_lightgrey">| 1:1 | L3   | null | 12:14 | undo |</span>
| 1:1 | L3   |<span class="code_lightgrey"> R3   |</span> 12:14 |      |        | 1:1 | L3   |<span class="code_lightgrey"> R3   |</span> 12:14 |      |
.......... [12:00, 12:15] ..........    &nbsp;   .......... [12:00, 12:15] ..........
</pre>

<p>And again, rendered succinctly:</p>

<pre data-type="programlisting"><strong><em><span class="code_blue">12:00&gt;</span> SELECT <span class="code_purple">STREAM</span>                        <span class="code_blue">12:00&gt;</span> SELECT <span class="code_purple">STREAM</span></em></strong>
<strong><em>         COALESCE(LeftNM.N_M,                        COALESCE(LeftNM.N_M,</em></strong>
<strong><em>                  RightNM.N_M) as N_M,                        RightNM.N_M) as N_M,</em></strong>
<strong><em>         LeftNM.Id as L                              LeftNM.Id as L</em></strong>
<strong><em>         Sys.EmitTime as Time,                       Sys.EmitTime as Time,</em></strong>
<strong><em>         Sys.Undo as Undo,                           Sys.Undo as Undo,</em></strong>
<strong><em>       FROM LeftNM <span class="yellow_bg">INNER</span> JOIN RightNM              FROM LeftNM <span class="yellow_bg">SEMI</span> JOIN RightNM</em></strong>
<strong><em>       ON LeftNM.N_M = RightNM.N_M;                ON LeftNM.N_M = RightNM.N_M;</em></strong>
----------------------------                ----------------------------
| N_M | L   | Time  | Undo |                | N_M | L   | Time  | Undo |
----------------------------                ----------------------------
| 1:2 | L4  | 12:05 |      |                | 1:2 | L4  | 12:05 |      |
|<span class="red_bg"> 1:2 </span>|<span class="red_bg"> L4  </span>|<span class="red_bg"> 12:05 </span>|<span class="red_bg">      </span>|                | 2:1 | L5B | 12:08 |      |
| 2:1 | L5B | 12:08 |      |                | 2:1 | L5A | 12:09 |      |
| 2:1 | L5A | 12:09 |      |                | 2:2 | L6B | 12:11 |      |
| 2:2 | L6B | 12:11 |      |                | 2:2 | L6A | 12:12 |      |
| 2:2 | L6A | 12:12 |      |                | 1:1 | L3  | 12:14 |      |
|<span class="red_bg"> 2:2 </span>|<span class="red_bg"> L6A </span>|<span class="red_bg"> 12:13 </span>|<span class="red_bg">      </span>|                ...... [12:00, 12:15] ......
|<span class="red_bg"> 2:2 </span>|<span class="red_bg"> L6B </span>|<span class="red_bg"> 12:13 </span>|<span class="red_bg">      </span>|
| 1:1 | L3  | 12:14 |      |
...... [12:00, 12:15] ......      
</pre>
</div></section>

<p>As we’ve seen over the course of a number of examples, there’s really nothing special about streaming joins. They function exactly as we might expect given our knowledge of streams and tables, with join streams capturing the history of the join over time as it evolves. This is in contrast to join tables, which simply capture a snapshot of the entire join as it exists at a specific point in time, as we’re perhaps more accustomed.</p>

<p>But, even more important, viewing joins through the lens of stream-table theory has lent some additional clarity. The core underlying join primitive<a contenteditable="false" data-primary="FULL OUTER joins" data-type="indexterm" id="idm140176508725920"></a> is the <code>FULL OUTER</code> join, which is a stream → table grouping operation that collects together all the joined and unjoined rows in a relation. All of the other variants we looked at in detail (<code>LEFT OUTER</code>, <code>RIGHT OUTER</code>, <code>INNER</code>, <code>ANTI</code>, and <code>SEMI</code>) simply add an additional layer of filtering on<a contenteditable="false" data-primary="unwindowed joins" data-secondary="SEMI" data-startref="ix_unwjoinSEMI" data-type="indexterm" id="idm140176508721808"></a> the <a contenteditable="false" data-primary="SEMI joins" data-startref="ix_SEMIj" data-type="indexterm" id="idm140176508720032"></a>joined <a contenteditable="false" data-primary="streaming joins" data-secondary="unwindowed joins" data-startref="ix_strmjoinunwSEMI" data-tertiary="SEMI" data-type="indexterm" id="idm140176508718496"></a>stream <a contenteditable="false" data-primary="unwindowed joins" data-startref="ix_unwjoin" data-type="indexterm" id="idm140176508716416"></a>following <a contenteditable="false" data-primary="streaming joins" data-secondary="unwindowed joins" data-startref="ix_strmjoinunw" data-type="indexterm" id="idm140176508714880"></a>the <code>FULL OUTER</code> join.<sup><a data-type="noteref" id="idm140176508712624-marker" href="/site/library/view/streaming-systems/9781491983867/ch09.html#idm140176508712624" class="totri-footnote">3</a></sup></p>
</div></section>

<section data-type="sect1" data-pdf-bookmark="Windowed Joins"><div class="sect1" id="idm140176509118384">
<h1>Windowed Joins</h1>

<p>Having looked at a variety of unwindowed joins, let’s next explore what windowing adds to the mix.<a contenteditable="false" data-primary="windowing" data-secondary="windowed joins" data-type="indexterm" id="ix_windjoin"></a><a contenteditable="false" data-primary="streaming joins" data-secondary="windowed joins" data-type="indexterm" id="ix_strmjoinwin"></a> I would argue that there are two motivations for windowing your joins:</p>

<dl>
	<dt>To partition time in some meaningful way</dt>
	<dd>
	<p>An obvious case is fixed windows; for example,<a contenteditable="false" data-primary="time" data-secondary="partitioning in windowed joins" data-type="indexterm" id="idm140176508704864"></a> daily windows, for which events that occurred in the same day should be joined together for some business reason (e.g., daily billing tallies). Another might be limiting the range of time within a join for performance reasons. However, it turns out there are even more sophisticated (and useful) ways of partitioning time in joins, including one particularly interesting use case that no streaming system I’m aware of today supports natively: <em>temporal validity joins</em>. More on this in just a bit.</p>
	</dd>
	<dt>To provide a meaningful reference point for timing out a join</dt>
	<dd>
	<p>This is useful for a number of unbounded join situations,<a contenteditable="false" data-primary="timing out a join, providing reference point for" data-type="indexterm" id="idm140176508701056"></a> but it is perhaps most obviously beneficial for use cases like outer joins, for which it is unknown a priori if one side of the join will ever show up. For classic batch processing (including standard interactive SQL queries), outer joins are timed out only when the bounded input dataset has been fully processed. But when processing unbounded data, we can’t wait for all data to be processed. As we discussed in Chapters <a data-type="xref" data-xrefstyle="select:labelnumber" href="/site/library/view/streaming-systems/9781491983867/ch02.html#the_what_where_when_and_how" class="totri-footnote">2</a> and <a data-type="xref" data-xrefstyle="select:labelnumber" href="/site/library/view/streaming-systems/9781491983867/ch03.html#watermarks_chapter" class="totri-footnote">3</a>, watermarks provide a progress metric for gauging the completeness of an input source in event time. But to make use of that metric for timing out a join, we need some reference point to compare against. Windowing a join provides that reference by bounding the extent of the join to the end of the window. After the watermark passes the end of the window, the system may consider the input for the window complete. At that point, just as in the bounded join case, it’s safe to time out any unjoined rows and materialize their partial results.</p>
	</dd>
</dl>

<p>That said, as we saw earlier, windowing is absolutely not a requirement for streaming joins. It makes a lot of sense in a many cases, but by no means is it a necessity.</p>

<p>In practice, most of the use cases for windowed joins (e.g., daily windows) are relatively straightforward and easy to extrapolate from the concepts we’ve learned up until now. To see why, we look briefly at what it means to apply fixed windows to some of the join examples we already encountered. After that, we spend the rest of this chapter investigating the much more interesting (and mind-bending) topic of <em>temporal validity joins</em>, looking first in detail at what I mean by temporal validity windows, and then moving on to looking at what joins mean within the context of such windows.</p>

<section data-type="sect2" data-pdf-bookmark="Fixed Windows"><div class="sect2" id="idm140176508693728">
<h2>Fixed Windows</h2>

<p>Windowing a join adds the <a contenteditable="false" data-primary="fixed windows" data-secondary="windowed joins in" data-type="indexterm" id="ix_fixwinjoin"></a>dimension of <a contenteditable="false" data-primary="windowing" data-secondary="windowed joins" data-tertiary="fixed windows" data-type="indexterm" id="ix_windjoinfix"></a>time into the join criteria themselves. In doing so,<a contenteditable="false" data-primary="streaming joins" data-secondary="windowed joins" data-tertiary="fixed windows" data-type="indexterm" id="ix_strmjoinwinfix"></a> the window serves to scope the set of rows being joined to only those contained within the window’s time interval. This is perhaps more clearly seen with an example, so let’s take our original <code>Left</code> and <code>Right</code> tables and window them into five-minute fixed windows:</p>

<pre data-type="programlisting"><strong><em><span class="code_blue">12:10&gt;</span> SELECT <span class="code_orange">TABLE</span> *,                     <span class="code_blue">12:10&gt;</span> SELECT <span class="code_orange">TABLE</span> *,</em></strong>
<strong><em>       TUMBLE(Time, INTERVAL '5' MINUTE)          TUMBLE(Time, INTERVAL '5' MINUTE)</em></strong>
<strong><em>       as Window FROM Left;                       as Window FROM Right</em></strong>
-------------------------------------      -------------------------------------
| Num | Id | Time  | Window         |      | Num | Id | Time  | Window         |
-------------------------------------      -------------------------------------
| 1   | L1 | 12:02 | [12:00, 12:05) |      | 2   | R2 | 12:01 |<span class="yellow_bg"> [12:00, 12:05) </span>|
| 2   | L2 | 12:06 |<span class="yellow_bg"> [12:05, 12:10) </span>|      | 3   | R3 | 12:04 | [12:00, 12:05) |
| 3   | L3 | 12:03 | [12:00, 12:05) |      | 4   | R4 | 12:05 | [12:05, 12:06) |
-------------------------------------      -------------------------------------
</pre>

<p>In our previous <code>Left</code> and <code>Right</code> examples, the join criterion was simply <code>Left.Num = Right.Num</code>. To turn this into a windowed join, we would expand the join criteria to include window equality, as well: <code>Left.Num = Right.Num AND Left.Window = Right.Window</code>. Knowing that, we can already infer from the preceding windowed tables how our join is going to change (highlighted for clarity): because the <code>L2</code> and <code>R2</code> rows do not fall within the same five-minute fixed window, they will not be joined together in the windowed variant of our join.</p>

<p>And indeed, if we compare the unwindowed and windowed variants side-by-side as tables, we can see this clearly (with the corresponding <code>L2</code> and <code>R2</code> rows highlighted on each side of the join):</p>

<pre data-type="programlisting"><strong><em>                                 <span class="code_blue">12:10&gt;</span> SELECT <span class="code_orange">TABLE</span> </em></strong>
<strong><em>                                          Left.Id as L,</em></strong>
<strong><em>                                          Right.Id as R,</em></strong>
<strong><em>                                          COALESCE(</em></strong>
<strong><em>                                            TUMBLE(Left.Time, INTERVAL '5' MINUTE),</em></strong>
<strong><em>                                            TUMBLE(Right.Time, INTERVAL '5' MINUTE)</em></strong>
<strong><em><span class="code_blue">12:10&gt;</span> SELECT <span class="code_orange">TABLE</span>                       ) AS Window</em></strong>
<strong><em>         Left.Id as L,                  FROM Left</em></strong>
<strong><em>         Right.Id as R,                   <span class="yellow_bg">FULL OUTER</span> JOIN Right </em></strong>
<strong><em>       FROM Left                          ON L.Num = R.Num AND </em></strong>
<strong><em>         <span class="yellow_bg">FULL OUTER</span> JOIN Right              TUMBLE(Left.Time, INTERVAL '5' MINUTE) =</em></strong>
<strong><em>         ON L.Num = R.Num;                  TUMBLE(Right.Time, INTERVAL '5' MINUTE);</em></strong>
---------------                  --------------------------------
| L    | R    |                  | L    | R    | Window         |
---------------                  --------------------------------
| L1   | null |                  | L1   | null | [12:00, 12:05) |
|<span class="yellow_bg"> L2   | R2   </span>|                  |<span class="yellow_bg"> null | R2   | [12:00, 12:05) </span>|
| L3   | R3   |                  | L3   | R3   | [12:00, 12:05) |
| null | R4   |                  |<span class="yellow_bg"> L2   | null | [12:05, 12:10) </span>|
---------------                  | null | R4   | [12:05, 12:10) |
                                 --------------------------------
</pre>

<p>The difference is also readily apparent when comparing the unwindowed and windowed joins as streams. As I’ve highlighted in the example that follows, they differ primarily in their final rows. The unwindowed side completes the join for <code>Num = 2</code>, yielding a retraction for the unjoined <code>R2</code> row in addition to a new row for the completed <code>L2, R2</code> join. The windowed side, on the other hand, simply yields an unjoined <code>L2</code> row because <code>L2</code> and <code>R2</code> fall within different five-minute windows:</p>

<pre data-type="programlisting"><strong><em>                                 <span class="code_blue">12:10&gt;</span> SELECT <span class="code_purple">STREAM</span> </em></strong>
<strong><em>                                          Left.Id as L,</em></strong>
<strong><em>                                          Right.Id as R,</em></strong>
<strong><em>                                          Sys.EmitTime as Time,</em></strong>
<strong><em>                                          COALESCE(</em></strong>
<strong><em>                                            TUMBLE(Left.Time, INTERVAL '5' MINUTE),</em></strong>
<strong><em><span class="code_blue">12:10&gt;</span> SELECT <span class="code_purple">STREAM</span>                        TUMBLE(Right.Time, INTERVAL '5' MINUTE)</em></strong>
<strong><em>         Left.Id as L,                    ) AS Window,</em></strong>
<strong><em>         Right.Id as R,                 Sys.Undo as Undo</em></strong>
<strong><em>         Sys.EmitTime as Time,          FROM Left</em></strong>
<strong><em>         Sys.Undo as Undo                 <span class="yellow_bg">FULL OUTER</span> JOIN Right</em></strong>
<strong><em>       FROM Left                          ON L.Num = R.Num AND</em></strong>
<strong><em>         <span class="yellow_bg">FULL OUTER</span> JOIN Right              TUMBLE(Left.Time, INTERVAL '5' MINUTE) =</em></strong>
<strong><em>         ON L.Num = R.Num;                  TUMBLE(Right.Time, INTERVAL '5' MINUTE);</em></strong>
------------------------------   -----------------------------------------------
| L    | R    | Time  | Undo |   | L    | R    | Time  | Window         | Undo |
------------------------------   -----------------------------------------------
| null | R2   | 12:01 |      |   | null | R2   | 12:01 | [12:00, 12:05) |      |
| L1   | null | 12:02 |      |   | L1   | null | 12:02 | [12:00, 12:05) |      |
| L3   | null | 12:03 |      |   | L3   | null | 12:03 | [12:00, 12:05) |      |
| L3   | null | 12:04 | undo |   | L3   | null | 12:04 | [12:00, 12:05) | undo |
| L3   | R3   | 12:04 |      |   | L3   | R3   | 12:04 | [12:00, 12:05) |      |
| null | R4   | 12:05 |      |   | null | R4   | 12:05 | [12:05, 12:10) |      |
|<span class="yellow_bg"> null | R2   | 12:06 | undo </span>|   |<span class="yellow_bg"> L2   | null | 12:06 | [12:05, 12:10) |      </span>|
|<span class="yellow_bg"> L2   | R2   | 12:06 |      </span>|   ............... [12:00, 12:10] ................
....... [12:00, 12:10] .......
</pre>

<p>And with that, we now understand the effects of windowing on a <code>FULL OUTER</code> join. By applying the rules we learned in the first half of the chapter, it’s then easy to derive the windowed variants of <code>LEFT OUTER</code>, <code>RIGHT OUTER</code>, <code>INNER</code>, <code>ANTI</code>, and <code>SEMI</code> joins, as well. I will leave most of these derivations as an exercise for you to complete, but to give a single example, <code>LEFT OUTER</code> join, as we learned, is just the <code>FULL OUTER</code> join with null columns on the left side of the join removed (again, with <code>L2</code> and <code>R2</code> rows highlighted to compare the differences):</p>

<pre data-type="programlisting"><strong><em>                                 <span class="code_blue">12:10&gt;</span> SELECT <span class="code_orange">TABLE</span> </em></strong>
<strong><em>                                          Left.Id as L,</em></strong>
<strong><em>                                          Right.Id as R,</em></strong>
<strong><em>                                          COALESCE(</em></strong>
<strong><em>                                            TUMBLE(Left.Time, INTERVAL '5' MINUTE),</em></strong>
<strong><em>                                            TUMBLE(Right.Time, INTERVAL '5' MINUTE)</em></strong>
<strong><em><span class="code_blue">12:10&gt;</span> SELECT <span class="code_orange">TABLE</span>                       ) AS Window</em></strong>
<strong><em>         Left.Id as L,                  FROM Left</em></strong>
<strong><em>         Right.Id as R,                   <span class="yellow_bg">LEFT OUTER</span> JOIN Right </em></strong>
<strong><em>       FROM Left                          ON L.Num = R.Num AND </em></strong>
<strong><em>         <span class="yellow_bg">LEFT OUTER</span> JOIN Right              TUMBLE(Left.Time, INTERVAL '5' MINUTE) =</em></strong>
<strong><em>         ON L.Num = R.Num;                  TUMBLE(Right.Time, INTERVAL '5' MINUTE);</em></strong>
---------------                  --------------------------------
| L    | R    |                  | L    | R    | Window         |
---------------                  --------------------------------
| L1   | null |                  | L1   | null | [12:00, 12:05) |
|<span class="yellow_bg"> L2   | R2   </span>|                  |<span class="yellow_bg"> L2   | null | [12:05, 12:10) </span>|
| L3   | R3   |                  | L3   | R3   | [12:00, 12:05) |
---------------                  --------------------------------
</pre>

<p>By scoping the region of time for the join into fixed five-minute intervals, we chopped our datasets into two distinct windows of time: <code>[12:00, 12:05)</code> and <code>[12:05, 12:10)</code>. The exact same join logic we observed earlier was then applied within those regions, yielding a slightly different outcome for the case in which the <code>L2</code> and <code>R2</code> rows fell into separate regions. And at a basic level, that’s really all there is to windowed joins.<a contenteditable="false" data-primary="streaming joins" data-secondary="windowed joins" data-startref="ix_strmjoinwinfix" data-tertiary="fixed windows" data-type="indexterm" id="idm140176508615664"></a><a contenteditable="false" data-primary="windowing" data-secondary="windowed joins" data-startref="ix_windjoinfix" data-tertiary="fixed windows" data-type="indexterm" id="idm140176508613744"></a><a contenteditable="false" data-primary="fixed windows" data-secondary="windowed joins in" data-startref="ix_fixwinjoin" data-type="indexterm" id="idm140176508611824"></a></p>
</div></section>

<section data-type="sect2" data-pdf-bookmark="Temporal Validity"><div class="sect2" id="idm140176508693104">
<h2>Temporal Validity</h2>
Having looked at the basics of windowed joins, <a contenteditable="false" data-primary="streaming joins" data-secondary="windowed joins" data-tertiary="temporal validity" data-type="indexterm" id="ix_strmjoinwintmpval"></a>we now spend <a contenteditable="false" data-primary="temporal validity" data-type="indexterm" id="ix_tmpval"></a>the rest of the chapter looking at a somewhat more <a contenteditable="false" data-primary="windowing" data-secondary="windowed joins" data-tertiary="temporal validity" data-type="indexterm" id="ix_windjointmpval"></a>advanced approach: temporal validity windowing.

<section data-type="sect3" data-pdf-bookmark="Temporal validity windows"><div class="sect3" id="idm140176508603360">
<h3>Temporal validity windows</h3>

<p>Temporal validity windows apply in situations in which the rows in a relation effectively slice time into regions wherein a given <a contenteditable="false" data-primary="temporal validity" data-secondary="temporal validity windows" data-type="indexterm" id="ix_tmpvalwin"></a>value is valid. More concretely, imagine a financial system for performing currency conversions.<sup><a data-type="noteref" id="idm140176508599408-marker" href="/site/library/view/streaming-systems/9781491983867/ch09.html#idm140176508599408" class="totri-footnote">4</a></sup> Such a system might contain a time-varying relation that captured the current conversion rates for various types of currency. For example, there might be a relation for converting from different currencies to Yen, like this:</p>

<pre data-type="programlisting"><strong><em><span class="code_blue">12:10&gt;</span> SELECT <span class="code_orange">TABLE</span> * FROM YenRates;</em></strong>
--------------------------------------
| Curr | Rate | EventTime | ProcTime |
--------------------------------------
| USD  | 102  | 12:00:00  | 12:04:13 |
| Euro | 114  | 12:00:30  | 12:06:23 |
| Yen  | 1    | 12:01:00  | 12:05:18 |
| Euro | 116  | 12:03:00  | 12:09:07 |
| Euro | 119  | 12:06:00  | 12:07:33 |
--------------------------------------
</pre>

<p>To highlight what I mean by saying that temporal validity windows “effectively slice time into regions wherein a given value is valid,” consider only the Euro-to-Yen conversion rates in that relation:</p>

<pre data-type="programlisting"><strong><em><span class="code_blue">12:10&gt;</span> SELECT <span class="code_orange">TABLE</span> * FROM YenRates WHERE Curr = "Euro";</em></strong>
--------------------------------------
| Curr | Rate | EventTime | ProcTime |
--------------------------------------
| Euro | 114  | 12:00:30  | 12:06:23 |
| Euro | 116  | 12:03:00  | 12:09:07 |
| Euro | 119  | 12:06:00  | 12:07:33 |
--------------------------------------
</pre>

<p>From a database engineering perspective, we understand that these values don’t mean that the rate for converting Euros to Yen is 114 ¥/€ at precisely 12:00, 116 ¥/€ at 12:03, 119 ¥/€ at 12:06, and undefined at all other times. Instead, we know that the intent of this table is to capture the fact that the conversion rate for Euros to Yen is undefined until 12:00, 114 ¥/€ from 12:00 to 12:03, 116 ¥/€ from 12:03 to 12:06, and 119 ¥/€ from then on. Or drawn out in a timeline:</p>

<pre class="font_small" data-type="programlisting">        Undefined              114 ¥/€                116 ¥/€              119 ¥/€
|----[-inf, 12:00)----|----[12:00, 12:03)----|----[12:03, 12:06)----|----[12:06, now)----→
</pre>

<p>Now, if we knew all of the rates ahead of time, we could capture these regions explicitly in the row data themselves. But if we instead need to build up these regions incrementally, based only upon the start times at which a given rate becomes valid, we have a problem: the region for a given row will change over time depending on the rows that come after it. <a contenteditable="false" data-primary="out-of-order data" data-secondary="in temporal validity windows" data-type="indexterm" id="idm140176508588176"></a>This is a problem even if the data arrive in order (because every time a new rate arrives, the previous rate changes from being valid forever to being valid until the arrival time of the new rate), but is further compounded if they can arrive <em>out of order</em>. For example, using the processing-time ordering in the preceding <code>YenRates</code> table, the sequence of timelines our table would effectively represent over time would be as follows:</p>

<pre class="font_xsmall" data-type="programlisting">Range of processing time | Event-time validity timeline during that range of processing-time
=========================|==============================================================================
                         |
                         |      Undefined
        [-inf, 12:06:23) | |--[-inf, +inf)---------------------------------------------------------→
                         |
                         |      Undefined          114 ¥/€
    [12:06:23, 12:07:33) | |--[-inf, 12:00)--|--[12:00, +inf)--------------------------------------→
                         |
                         |      Undefined          114 ¥/€                              119 ¥/€
    [12:07:33, 12:09:07) | |--[-inf, 12:00)--|--[12:00, 12:06)---------------------|--[12:06, +inf)→
                         |
                         |      Undefined          114 ¥/€            116 ¥/€           119 ¥/€
         [12:09:07, now) | |--[-inf, 12:00)--|--[12:00, 12:03)--|--[12:03, 12:06)--|--[12:06, +inf)→
</pre>

<p>Or, if we wanted to render this as a time-varying relation (with changes between each snapshot<a contenteditable="false" data-primary="time-varying relations" data-secondary="in temporal validity windows" data-type="indexterm" id="idm140176508582832"></a> relation highlighted in yellow):</p>

<pre class="font_small" data-type="programlisting"><strong><em><span class="code_blue">12:10&gt;</span> SELECT <span class="code_grey">TVR</span> * FROM YenRatesWithRegion ORDER BY EventTime;</em></strong>
---------------------------------------------------------------------------------------------
|              [-inf, 12:06:23)               |            [12:06:23, 12:07:33)             |
| ------------------------------------------- | ------------------------------------------- |
| | Curr | Rate |  Region        | ProcTime | | | Curr | Rate |  Region        | ProcTime | |
| ------------------------------------------- | ------------------------------------------- |
| ------------------------------------------- | |<span class="yellow_bg"> Euro </span>|<span class="yellow_bg"> 114  </span>|<span class="yellow_bg"> [12:00, +inf)  </span>|<span class="yellow_bg"> 12:06:23 </span>| |
|                                             | ------------------------------------------- |
---------------------------------------------------------------------------------------------
|            [12:07:33, 12:09:07)             |              [12:09:07, +inf)               |
| ------------------------------------------- | ------------------------------------------- |
| | Curr | Rate |  Region        | ProcTime | | | Curr | Rate |  Region        | ProcTime | |
| ------------------------------------------- | ------------------------------------------- |
| | Euro | 114  | [12:00, <span class="yellow_bg">12:06</span>) | 12:06:23 | | | Euro | 114  | [12:00, <span class="yellow_bg">12:03</span>) | 12:06:23 | |
| |<span class="yellow_bg"> Euro </span>|<span class="yellow_bg"> 119  </span>|<span class="yellow_bg"> [12:06, +inf)  </span>|<span class="yellow_bg"> 12:07:33 </span>| | |<span class="yellow_bg"> Euro </span>|<span class="yellow_bg"> 116  </span>|<span class="yellow_bg"> [12:03, 12:06) </span>|<span class="yellow_bg"> 12:09:07 </span>| |
| ------------------------------------------- | | Euro | 119  | [12:06, +inf)  | 12:07:33 | |
|                                             | ------------------------------------------- |
---------------------------------------------------------------------------------------------
</pre>

<p>What’s important to note here is that half of the changes involve updates to multiple rows. That maybe doesn’t sound so bad, until you recall that the difference between each of these snapshots is the arrival of exactly one new row. In other words, the arrival of a single new input row results in transactional modifications to multiple output rows. That sounds less good. On the other hand, it also sounds a lot like the multirow transactions involved in building up session windows. And indeed, this is yet another example of windowing providing benefits beyond simple partitioning of time: it also affords the ability to do so in ways that involve complex, multirow transactions.</p>

<p>To see this in action, let’s look at an animation. If this were a Beam pipeline, it would probably look something like the following:</p>

<pre data-type="programlisting">PCollection&lt;Currency, Decimal&gt; yenRates = ...;
PCollection&lt;Decimal&gt; validYenRates = yenRates
    .apply(<span class="where_lt">Window.into(new ValidityWindows()</span>)
    .apply(<span class="what_lt">GroupByKey.&lt;Currency, Decimal&gt;create()</span>);
</pre>

<p>Rendered in a streams/tables animation, that pipeline would look like that shown in <a data-type="xref" href="/site/library/view/streaming-systems/9781491983867/ch09.html#temporal_validity_windowing_over_time_chap_nine">Figure&nbsp;9-1</a>.</p>

<figure><div id="temporal_validity_windowing_over_time_chap_nine" class="figure">
<video style="margin: 0 auto; max-width: 100%;" controls="controls" poster="https://www.safaribooksonline.com/library/view/streaming-systems/9781491983867/assets/stsy_0901.png" autoplay="autoplay" loop="loop">
<source src="https://www.safaribooksonline.com/library/view/streaming-systems/9781491983867/assets/stsy_0901.mp4" type="video/mp4"><img src="https://www.safaribooksonline.com/library/view/streaming-systems/9781491983867/assets/stsy_0901.png" alt="Temporal validity windowing over time" width="600" height="402" data-mfp-src="/library/view/streaming-systems/9781491983867/assets/stsy_0901.png">
</video>
<h6><span class="label">Figure 9-1. </span>Temporal validity windowing over time</h6>
</div></figure>

<p>This animation highlights a critical aspect of temporal validity: shrinking windows. Validity windows must be able to shrink over time, thereby diminishing the reach of their validity and splitting any data contained therein across the two new windows. See the <a href="http://bit.ly/2N7Nn3A">code snippets on GitHub</a> for an example partial implementation.<sup><a data-type="noteref" id="idm140176508555520-marker" href="/site/library/view/streaming-systems/9781491983867/ch09.html#idm140176508555520" class="totri-footnote">5</a></sup><a contenteditable="false" data-primary="streaming SQL" data-secondary="temporal validity window in" data-type="indexterm" id="idm140176508553520"></a></p>

<p>In SQL terms, the creation of these validity windows would look something like the following (making using of a hypothetical <code>VALIDITY_WINDOW</code> construct), viewed as a table:</p>

<pre data-type="programlisting"><strong><em><span class="code_blue">12:10&gt;</span> SELECT <span class="code_orange">TABLE</span> </em></strong>
<strong><em>         Curr,</em></strong>
<strong><em>         MAX(Rate) as Rate,</em></strong>
<strong><em>         VALIDITY_WINDOW(EventTime) as Window</em></strong>
<strong><em>       FROM YenRates </em></strong>
<strong><em>       GROUP BY</em></strong>
<strong><em>         Curr,</em></strong>
<strong><em>         VALIDITY_WINDOW(EventTime)</em></strong>
<strong><em>       HAVING Curr = "Euro";</em></strong>
--------------------------------
| Curr | Rate | Window         |
--------------------------------
| Euro | 114  | [12:00, 12:03) |
| Euro | 116  | [12:03, 12:06) |
| Euro | 119  | [12:06, +inf)  |
--------------------------------
</pre>

<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="idm140176508543440">
<h5>Validity Windows in Standard SQL</h5>

<p>Note that it’s possible to describe validity windows in standard SQL using a three-way self-join:</p>

<pre data-type="programlisting">SELECT
  r1.Curr,
  MAX(r1.Rate) AS Rate,
  r1.EventTime AS WindowStart,
  r2.EventTime AS WIndowEnd
FROM YenRates r1
LEFT JOIN YenRates r2
  ON r1.Curr = r2.Curr
     AND r1.EventTime &lt; r2.EventTime
LEFT JOIN YenRates r3
  ON r1.Curr = r3.Curr
     AND r1.EventTime &lt; r3.EventTime 
     AND r3.EventTime &lt; r2.EventTime
WHERE r3.EventTime IS NULL
GROUP BY r1.Curr, WindowStart, WindowEnd
HAVING r1.Curr = 'Euro';
</pre>

<p>Thanks to Martin Kleppmann for pointing this out.</p>
</div></aside>

<p class="pagebreak-before">Or, perhaps more interestingly, viewed as a stream:</p>

<pre data-type="programlisting"><strong><em><span class="code_blue">12:00&gt;</span> SELECT <span class="code_purple">STREAM</span></em></strong>
<strong><em>         Curr,</em></strong>
<strong><em>         MAX(Rate) as Rate,</em></strong>
<strong><em>         VALIDITY_WINDOW(EventTime) as Window,</em></strong>
<strong><em>         Sys.EmitTime as Time,</em></strong>
<strong><em>         Sys.Undo as Undo,</em></strong>
<strong><em>       FROM YenRates</em></strong>
<strong><em>       GROUP BY</em></strong>
<strong><em>         Curr,</em></strong>
<strong><em>         VALIDITY_WINDOW(EventTime) </em></strong>
<strong><em>       HAVING Curr = "Euro";</em></strong>
--------------------------------------------------
| Curr | Rate | Window         | Time     | Undo |
--------------------------------------------------
| Euro | 114  | [12:00, +inf)  | 12:06:23 |      |
| Euro | 114  | [12:00, +inf)  | 12:07:33 | undo |
| Euro | 114  | [12:00, 12:06) | 12:07:33 |      | 
| Euro | 119  | [12:06, +inf)  | 12:07:33 |      |
| Euro | 114  | [12:00, 12:06) | 12:09:07 | undo | 
| Euro | 114  | [12:00, 12:03) | 12:09:07 |      |
| Euro | 116  | [12:03, 12:06) | 12:09:07 |      |
................. [12:00, 12:10] .................
</pre>

<p>Great, we have an understanding of how to use point-in-time values to effectively slice up time into ranges within which those values are valid. But the real power of these temporal validity windows is when they are applied in the context of joining them with other data. That’s where temporal validity joins come in.<a contenteditable="false" data-primary="temporal validity" data-secondary="temporal validity windows" data-startref="ix_tmpvalwin" data-type="indexterm" id="idm140176508529920"></a></p>
</div></section>

<section data-type="sect3" data-pdf-bookmark="Temporal validity joins"><div class="sect3" id="idm140176508602416">
<h3>Temporal validity joins</h3>

<p>To explore the semantics of<a contenteditable="false" data-primary="temporal validity" data-secondary="temporal validity joins" data-type="indexterm" id="ix_tmpvaljoin"></a> temporal validity joins, suppose that our financial application contains another time-varying relation, one that tracks currency-conversion orders from various currencies to Yen:</p>

<pre data-type="programlisting"><strong><em><span class="code_blue">12:10&gt;</span> SELECT <span class="code_orange">TABLE</span> * FROM YenOrders;</em></strong>
----------------------------------------
| Curr | Amount | EventTime | ProcTime |
----------------------------------------
| Euro | 2      | 12:02:00  | 12:05:07 |
| USD  | 1      | 12:03:00  | 12:03:44 |
| Euro | 5      | 12:05:00  | 12:08:00 |
| Yen  | 50     | 12:07:00  | 12:10:11 |
| Euro | 3      | 12:08:00  | 12:09:33 |
| USD  | 5      | 12:10:00  | 12:10:59 |
----------------------------------------
</pre>

<p class="pagebreak-before">And for simplicity, as before, let’s focus on the Euro conversions:</p>

<pre data-type="programlisting"><strong><em><span class="code_blue">12:10&gt;</span> SELECT <span class="code_orange">TABLE</span> * FROM YenOrders WHERE Curr = "Euro";</em></strong>
----------------------------------------
| Curr | Amount | EventTime | ProcTime |
----------------------------------------
| Euro | 2      | 12:02:00  | 12:05:07 |
| Euro | 5      | 12:05:00  | 12:08:00 |
| Euro | 3      | 12:08:00  | 12:09:33 |
----------------------------------------
</pre>

<p>We’d like to robustly join these orders to the <code>YenRates</code> relation, treating the rows in <code>YenRates</code> as defining validity windows. As such, we’ll actually want to join to the validity-windowed version of the <code>YenRates</code> relation we constructed at the end of the last section:</p>

<pre data-type="programlisting"><strong><em><span class="code_blue">12:10&gt;</span> SELECT <span class="code_orange">TABLE</span></em></strong>
<strong><em>         Curr,</em></strong>
<strong><em>         MAX(Rate) as Rate,</em></strong>
<strong><em>         VALIDITY_WINDOW(EventTime) as Window</em></strong>
<strong><em>       FROM YenRates</em></strong>
<strong><em>       GROUP BY</em></strong>
<strong><em>         Curr,</em></strong>
<strong><em>         VALIDITY_WINDOW(EventTime)</em></strong>
<strong><em>       HAVING Curr = "Euro";</em></strong>
--------------------------------
| Curr | Rate | Window         |
--------------------------------
| Euro | 114  | [12:00, 12:03) |
| Euro | 116  | [12:03, 12:06) |
| Euro | 119  | [12:06, +inf)  |
--------------------------------
</pre>

<p>Fortunately, after we have our conversion rates placed into validity windows, a windowed join between those rates and the <code>YenOrders</code> relation gives us exactly what we want:</p>

<pre data-type="programlisting"><strong><em><span class="code_blue">12:10&gt;</span> WITH ValidRates AS</em></strong>
<strong><em>         (SELECT</em></strong>
<strong><em>            Curr,</em></strong>
<strong><em>            MAX(Rate) as Rate,</em></strong>
<strong><em>            VALIDITY_WINDOW(EventTime) as Window</em></strong>
<strong><em>          FROM YenRates</em></strong>
<strong><em>          GROUP BY</em></strong>
<strong><em>            Curr,</em></strong>
<strong><em>            VALIDITY_WINDOW(EventTime))</em></strong>
<strong><em>       SELECT <span class="code_orange">TABLE</span></em></strong>
<strong><em>         YenOrders.Amount as "E",</em></strong>
<strong><em>         ValidRates.Rate as "Y/E", </em></strong>
<strong><em>         YenOrders.Amount * ValidRates.Rate as "Y",</em></strong>
<strong><em>         YenOrders.EventTime as Order, </em></strong>
<strong><em>         ValidRates.Window as "Rate Window"</em></strong>
<strong><em>       FROM YenOrders FULL OUTER JOIN ValidRates </em></strong>
<strong><em>         ON YenOrders.Curr = ValidRates.Curr</em></strong>
<strong><em>           AND WINDOW_START(ValidRates.Window) &lt;= YenOrders.EventTime</em></strong>
<strong><em>           AND YenOrders.EventTime &lt; WINDOW_END(ValidRates.Window)</em></strong>
<strong><em>       HAVING Curr = "Euro";</em></strong>
-------------------------------------------
| E | Y/E | Y   | Order  | Rate Window    |
-------------------------------------------
| 2 | 114 | 228 | 12:02  | [12:00, 12:03) |
| 5 | 116 | 580 | 12:05  | [12:03, 12:06) |
| 3 | 119 | 357 | 12:08  | [12:06, +inf)  |
-------------------------------------------
</pre>

<p>Thinking back to our original <code>YenRates</code> and <code>YenOrders</code> relations, this joined relation indeed looks correct: each of the three conversions ended up with the (eventually) appropriate rate for the given window of event time within which their corresponding order fell. So we have a decent sense that this join is doing what we want in terms of providing us the eventual correctness we want.</p>

<p>That said, this simple snapshot view of the relation, taken after all the values have arrived and the dust has settled, belies the complexity of this join. To really understand what’s going on here, we need to look at the full TVR. <a contenteditable="false" data-primary="time-varying relations" data-secondary="in temporal validity joins" data-type="indexterm" id="idm140176508491344"></a>First, recall that the validity-windowed conversion rate relation was actually much more complex than the previous simple table snapshot view might lead you to believe. For reference, here’s the <code><span class="code_purple">STREAM</span></code> version of the validity windows relation, which better highlights the evolution of those conversion rates over time:</p>

<pre data-type="programlisting"><strong><em><span class="code_blue">12:00&gt;</span> SELECT <span class="code_purple">STREAM</span></em></strong>
<strong><em>         Curr,</em></strong>
<strong><em>         MAX(Rate) as Rate,</em></strong>
<strong><em>         VALIDITY(EventTime) as Window,</em></strong>
<strong><em>         Sys.EmitTime as Time,</em></strong>
<strong><em>         Sys.Undo as Undo,</em></strong>
<strong><em>       FROM YenRates</em></strong>
<strong><em>       GROUP BY</em></strong>
<strong><em>         Curr,</em></strong>
<strong><em>         VALIDITY(EventTime)</em></strong>
<strong><em>       HAVING Curr = "Euro";</em></strong>
--------------------------------------------------
| Curr | Rate | Window         | Time     | Undo |
--------------------------------------------------
| Euro | 114  | [12:00, +inf)  | 12:06:23 |      |
| Euro | 114  | [12:00, +inf)  | 12:07:33 | undo |
| Euro | 114  | [12:00, 12:06) | 12:07:33 |      | 
| Euro | 119  | [12:06, +inf)  | 12:07:33 |      |
| Euro | 114  | [12:00, 12:06) | 12:09:07 | undo | 
| Euro | 114  | [12:00, 12:03) | 12:09:07 |      |
| Euro | 116  | [12:03, 12:06) | 12:09:07 |      |
................. [12:00, 12:10] .................
</pre>

<p>As a result, if we look at the full TVR for our validity-windowed join, you can see that the corresponding evolution of this join over time is much more complicated, due to the out-of-order arrival of values on both sides of the join:</p>

<pre class="font_small" data-type="programlisting"><strong><em><span class="code_blue">12:10&gt;</span> WITH ValidRates AS</em></strong>
<strong><em>         (SELECT</em></strong>
<strong><em>            Curr,</em></strong>
<strong><em>            MAX(Rate) as Rate,</em></strong>
<strong><em>            VALIDITY_WINDOW(EventTime) as Window</em></strong>
<strong><em>          FROM YenRates</em></strong>
<strong><em>          GROUP BY</em></strong>
<strong><em>            Curr,</em></strong>
<strong><em>            VALIDITY_WINDOW(EventTime))</em></strong>
<strong><em>       SELECT <span class="code_grey">TVR</span></em></strong>
<strong><em>         YenOrders.Amount as "E",</em></strong>
<strong><em>         ValidRates.Rate as "Y/E", </em></strong>
<strong><em>         YenOrders.Amount * ValidRates.Rate as "Y",</em></strong>
<strong><em>         YenOrders.EventTime as Order,</em></strong>
<strong><em>         ValidRates.Window as "Rate Window"</em></strong>
<strong><em>       FROM YenOrders FULL OUTER JOIN ValidRates </em></strong>
<strong><em>         ON YenOrders.Curr = ValidRates.Curr</em></strong>
<strong><em>           AND WINDOW_START(ValidRates.Window) &lt;= YenOrders.EventTime</em></strong>
<strong><em>           AND YenOrders.EventTime &lt; WINDOW_END(ValidRates.Window)</em></strong>
<strong><em>       HAVING Curr = "Euro";</em></strong>
-------------------------------------------------------------------------------------------
|              [-inf, 12:05:07)              |            [12:05:07, 12:06:23)            |
| ------------------------------------------ | ------------------------------------------ |
| | E | Y/E | Y   | Order | Rate Window    | | | E | Y/E | Y   | Order | Rate Window    | |
| ------------------------------------------ | ------------------------------------------ |
| ------------------------------------------ | |<span class="yellow_bg"> 2 </span>|<span class="yellow_bg">     </span>|<span class="yellow_bg">     </span>|<span class="yellow_bg"> 12:02 </span>|<span class="yellow_bg">                </span>| |
|                                            | ------------------------------------------ |
-------------------------------------------------------------------------------------------
|            [12:06:23, 12:07:33)            |            [12:07:33, 12:08:00)            |
| ------------------------------------------ | ------------------------------------------ |
| | E | Y/E | Y   | Order | Rate Window    | | | E | Y/E | Y   | Order | Rate Window    | |
| ------------------------------------------ | ------------------------------------------ |
| | 2 |<span class="yellow_bg"> 114 </span>|<span class="yellow_bg"> 228 </span>| 12:02 |<span class="yellow_bg"> [12:00, +inf)  </span>| | | 2 | 114 | 228 | 12:02 |<span class="yellow_bg"> [12:00, 12:06) </span>| |
| ------------------------------------------ | |<span class="yellow_bg">   </span>|<span class="yellow_bg"> 119 </span>|<span class="yellow_bg">     </span>|<span class="yellow_bg">       </span>|<span class="yellow_bg"> [12:06, +inf)  </span>| |
|                                            | ------------------------------------------ |
-------------------------------------------------------------------------------------------
|            [12:08:00, 12:09:07)            |            [12:09:07, 12:09:33)            |
| ------------------------------------------ | ------------------------------------------ |
| | E | Y/E | Y   | Order | Rate Window    | | | E | Y/E | Y   | Order | Rate Window    | |
| ------------------------------------------ | ------------------------------------------ |
| | 2 | 114 | 228 | 12:02 | [12:00, 12:06) | | | 2 | 114 | 228 | 12:02 |<span class="yellow_bg"> [12:00, 12:03) </span>| |
| |<span class="yellow_bg"> 5 </span>|<span class="yellow_bg"> 114 </span>|<span class="yellow_bg"> 570 </span>|<span class="yellow_bg"> 12:05 </span>|<span class="yellow_bg"> [12:03, 12:06) </span>| | | 5 |<span class="yellow_bg"> 116 </span>|<span class="yellow_bg"> 580 </span>| 12:05 |<span class="yellow_bg"> [12:03, 12:06) </span>| |
| |   | 119 |     |       | [12:06, +inf)  | | |   | 119 |     | 12:08 | [12:06, +inf)  | |
| ------------------------------------------ | ------------------------------------------ |
-------------------------------------------------------------------------------------------
|               [12:09:33, now)              |
| ------------------------------------------ |
| | E | Y/E | Y   | Order | Rate Window    | |
| ------------------------------------------ |
| | 2 | 114 | 228 | 12:02 | [12:00, 12:03) | |
| | 5 | 116 | 580 | 12:05 | [12:03, 12:06) | |
| |<span class="yellow_bg"> 3 </span>| 119 |<span class="yellow_bg"> 357 </span>|<span class="yellow_bg"> 12:08 </span>| [12:06, +inf)  | |
| ------------------------------------------ |
----------------------------------------------
</pre>

<p>In particular, the result for the 5 € order is originally quoted at 570 ¥ because that order (which happened at 12:05) originally falls into the validity window for the 114 ¥/€ rate. But when the 116 ¥/€ rate for event time 12:03 arrives out of order, the result for the 5 € order must be updated from 570 ¥ to 580 ¥. This is also evident if you observe the results of the join as a stream (here I’ve highlighted the incorrect 570 ¥ in red, and the retraction for 570 ¥ and subsequent corrected value of 580 ¥ in blue):</p>

<pre data-type="programlisting"><strong><em><span class="code_blue">12:00&gt;</span> WITH ValidRates AS</em></strong>
<strong><em>         (SELECT</em></strong>
<strong><em>            Curr,</em></strong>
<strong><em>            MAX(Rate) as Rate,</em></strong>
<strong><em>            VALIDITY_WINDOW(EventTime) as Window</em></strong>
<strong><em>          FROM YenRates</em></strong>
<strong><em>          GROUP BY</em></strong>
<strong><em>            Curr,</em></strong>
<strong><em>            VALIDITY_WINDOW(EventTime))</em></strong>
<strong><em>       SELECT <span class="code_purple">STREAM</span></em></strong>
<strong><em>         YenOrders.Amount as "E",</em></strong>
<strong><em>         ValidRates.Rate as "Y/E", </em></strong>
<strong><em>         YenOrders.Amount * ValidRates.Rate as "Y",</em></strong>
<strong><em>         YenOrders.EventTime as Order,</em></strong>
<strong><em>         ValidRates.Window as "Rate Window",</em></strong>
<strong><em>         Sys.EmitTime as Time,</em></strong>
<strong><em>         Sys.Undo as Undo</em></strong>
<strong><em>       FROM YenOrders FULL OUTER JOIN ValidRates </em></strong>
<strong><em>         ON YenOrders.Curr = ValidRates.Curr</em></strong>
<strong><em>           AND WINDOW_START(ValidRates.Window) &lt;= YenOrders.EventTime</em></strong>
<strong><em>           AND YenOrders.EventTime &lt; WINDOW_END(ValidRates.Window)</em></strong>
<strong><em>       HAVING Curr = “Euro”;</em></strong>
------------------------------------------------------------
| E | Y/E | Y   | Order | Rate Window    | Time     | Undo | 
------------------------------------------------------------
| 2 |     |     | 12:02 |                | 12:05:07 |      |
| 2 |     |     | 12:02 |                | 12:06:23 | undo |
| 2 | 114 | 228 | 12:02 | [12:00, +inf)  | 12:06:23 |      |
| 2 | 114 | 228 | 12:02 | [12:00, +inf)  | 12:07:33 | undo |
| 2 | 114 | 228 | 12:02 | [12:00, 12:06) | 12:07:33 |      |
|   | 119 |     |       | [12:06, +inf)  | 12:07:33 |      |
|<span class="red_bg"> 5 </span>|<span class="red_bg"> 114 </span>|<span class="red_bg"> 570 </span>|<span class="red_bg"> 12:05 </span>|<span class="red_bg"> [12:00, 12:06) </span>|<span class="red_bg"> 12:08:00 </span>|<span class="red_bg">      </span>|
| 2 | 114 | 228 | 12:02 | [12:00, 12:06) | 12:09:07 | undo |
|<span class="blue_bg"> 5 </span>|<span class="blue_bg"> 114 </span>|<span class="blue_bg"> 570 </span>|<span class="blue_bg"> 12:05 </span>|<span class="blue_bg"> [12:00, 12:06) </span>|<span class="blue_bg"> 12:09:07 </span>|<span class="blue_bg"> undo </span>|
| 2 | 114 | 228 | 12:02 | [12:00, 12:03) | 12:09:07 |      |
|<span class="blue_bg"> 5 </span>|<span class="blue_bg"> 116 </span>|<span class="blue_bg"> 580 </span>|<span class="blue_bg"> 12:05 </span>|<span class="blue_bg"> [12:03, 12:06) </span>|<span class="blue_bg"> 12:09:07 </span>|<span class="blue_bg">      </span>|
|   | 119 |     |       | [12:06, +inf)  | 12:09:33 | undo |
| 3 | 119 | 357 | 12:08 | [12:06, +inf)  | 12:09:33 |      |
...................... [12:00, 12:10] ......................
</pre>

<p>It’s worth calling out that this is a fairly messy stream due to the use of a <code>FULL OUTER</code> join.<a contenteditable="false" data-primary="FULL OUTER joins" data-type="indexterm" id="idm140176508440800"></a> In reality, when consuming conversion orders as a stream, you probably don’t care about unjoined rows; switching <a contenteditable="false" data-primary="INNER joins" data-type="indexterm" id="idm140176508410176"></a>to an <code>INNER</code> join helps eliminate those rows. You probably also don’t care about cases for which the rate window changes, but the actual conversion value isn’t affected. By removing the rate window from the stream, we can further decrease its chattiness:</p>

<pre class="pre" data-type="programlisting"><strong><em><span class="code_blue">12:00&gt;</span> WITH ValidRates AS</em></strong>
<strong><em>         (SELECT</em></strong>
<strong><em>            Curr,</em></strong>
<strong><em>            MAX(Rate) as Rate,</em></strong>
<strong><em>            VALIDITY_WINDOW(EventTime) as Window</em></strong>
<strong><em>          FROM YenRates</em></strong>
<strong><em>          GROUP BY</em></strong>
<strong><em>            Curr,</em></strong>
<strong><em>            VALIDITY_WINDOW(EventTime))</em></strong>
<strong><em>       SELECT <span class="code_purple">STREAM</span></em></strong>
<strong><em>         YenOrders.Amount as "E",</em></strong>
<strong><em>         ValidRates.Rate as "Y/E", </em></strong>
<strong><em>         YenOrders.Amount * ValidRates.Rate as "Y",</em></strong>
<strong><em>         YenOrders.EventTime as Order,</em></strong>
<strong><em>         <span class="yellow_bg"><s>ValidRates.Window as "Rate Window",</s></span></em></strong>
<strong><em>         Sys.EmitTime as Time,</em></strong>
<strong><em>         Sys.Undo as Undo</em></strong>
<strong><em>       FROM YenOrders <span class="yellow_bg">INNER</span> JOIN ValidRates </em></strong>
<strong><em>         ON YenOrders.Curr = ValidRates.Curr</em></strong>
<strong><em>           AND WINDOW_START(ValidRates.Window) &lt;= YenOrders.EventTime</em></strong>
<strong><em>           AND YenOrders.EventTime &lt; WINDOW_END(ValidRates.Window)</em></strong>
<strong><em>       HAVING Curr = "Euro";</em></strong>
-------------------------------------------
| E | Y/E | Y   | Order | Time     | Undo |
-------------------------------------------
| 2 | 114 | 228 | 12:02 | 12:06:23 |      |
|<span class="red_bg"> 5 </span>|<span class="red_bg"> 114 </span>|<span class="red_bg"> 570 </span>|<span class="red_bg"> 12:05 </span>|<span class="red_bg"> 12:08:00 </span>|<span class="red_bg">      </span>|
|<span class="blue_bg"> 5 </span>|<span class="blue_bg"> 114 </span>|<span class="blue_bg"> 570 </span>|<span class="blue_bg"> 12:05 </span>|<span class="blue_bg"> 12:09:07 </span>|<span class="blue_bg"> undo </span>|
|<span class="blue_bg"> 5 </span>|<span class="blue_bg"> 116 </span>|<span class="blue_bg"> 580 </span>|<span class="blue_bg"> 12:05 </span>|<span class="blue_bg"> 12:09:07 </span>|<span class="blue_bg">      </span>|
| 3 | 119 | 357 | 12:08 | 12:09:33 |      |
............. [12:00, 12:10] ..............
</pre>

<p>Much nicer. We can now see that this query very succinctly does what we originally set out to do: join two TVRs for currency conversion rates and orders in a robust way that is tolerant of data arriving out of order. <a data-type="xref" href="/site/library/view/streaming-systems/9781491983867/ch09.html#temporal_validity_join_converting_euros_to_yen_with_per_record_triggering">Figure&nbsp;9-2</a> visualizes this query as an animated diagram. In it, you can also very clearly see the way the overall structure of things change as they evolve over time.</p>

<figure><div id="temporal_validity_join_converting_euros_to_yen_with_per_record_triggering" class="figure">
<video style="margin: 0 auto; max-width: 100%;" controls="controls" poster="https://www.safaribooksonline.com/library/view/streaming-systems/9781491983867/assets/stsy_0902.png" autoplay="autoplay" loop="loop">
<source src="https://www.safaribooksonline.com/library/view/streaming-systems/9781491983867/assets/stsy_0902.mp4" type="video/mp4"><img src="https://www.safaribooksonline.com/library/view/streaming-systems/9781491983867/assets/stsy_0902.png" alt="Temporal validity join, converting Euros to Yen with per-record triggering" width="600" height="360" data-mfp-src="/library/view/streaming-systems/9781491983867/assets/stsy_0902.png">
</video>
<h6><span class="label">Figure 9-2. </span>Temporal validity join, converting Euros to Yen with per-record triggering</h6>
</div></figure>

<section data-type="sect4" data-pdf-bookmark="Watermarks and temporal validity joins"><div class="sect4" id="idm140176508371824">
<h4>Watermarks and temporal validity joins</h4>

<p>With this example, we’ve highlighted the first benefit of windowed joins called out at the<a contenteditable="false" data-primary="watermarks" data-secondary="and temporal validity joins" data-type="indexterm" id="idm140176508370240"></a> beginning of<a contenteditable="false" data-primary="temporal validity" data-secondary="temporal validity joins" data-tertiary="watermarks and" data-type="indexterm" id="idm140176508368576"></a> this section: windowing a join allows you to partition that join within time for some practical business need. In this case, the business need was slicing time into regions of validity for our currency conversion rates.</p>

<p>Before we call it a day, however, it turns out that this example also provides an opportunity to highlight the second point I called out: the fact that windowing a join can provide a meaningful reference point for watermarks. To see how that’s useful, imagine changing the previous query to replace the implicit default per-record trigger with an explicit watermark trigger that would fire only once when the watermark passed the end of the validity window in the join (assuming that we have a watermark available for both of our input TVRs that accurately tracks the completeness of those relations in event time as well as an execution engine that knows how to take those watermarks into consideration). Now, instead of our stream containing multiple outputs and retractions for rates arriving out of order, we could instead end up with a stream containing a single, correct converted result per order, which is clearly even more ideal than before:</p>

<pre data-type="programlisting"><strong><em><span class="code_blue">12:00&gt;</span> WITH ValidRates AS</em></strong>
<strong><em>         (SELECT</em></strong>
<strong><em>            Curr,</em></strong>
<strong><em>            MAX(Rate) as Rate,</em></strong>
<strong><em>            VALIDITY_WINDOW(EventTime) as Window</em></strong>
<strong><em>          FROM YenRates</em></strong>
<strong><em>          GROUP BY</em></strong>
<strong><em>            Curr,</em></strong>
<strong><em>            VALIDITY_WINDOW(EventTime))</em></strong>
<strong><em>       SELECT <span class="code_purple">STREAM</span></em></strong>
<strong><em>         YenOrders.Amount as "E",</em></strong>
<strong><em>         ValidRates.Rate as "Y/E", </em></strong>
<strong><em>         YenOrders.Amount * ValidRates.Rate as "Y",</em></strong>
<strong><em>         YenOrders.EventTime as Order,</em></strong>
<strong><em>         Sys.EmitTime as Time,</em></strong>
<strong><em>         Sys.Undo as Undo</em></strong>
<strong><em>       FROM YenOrders INNER JOIN ValidRates </em></strong>
<strong><em>         ON YenOrders.Curr = ValidRates.Curr</em></strong>
<strong><em>           AND WINDOW_START(ValidRates.Window) &lt;= YenOrders.EventTime</em></strong>
<strong><em>           AND YenOrders.EventTime &lt; WINDOW_END(ValidRates.Window)</em></strong>
<strong><em>       HAVING Curr = "Euro"</em></strong>
<strong><em>       <span class="yellow_bg">EMIT WHEN WATERMARK PAST WINDOW_END(ValidRates.Window)</span>;</em></strong>
-------------------------------------------
| E | Y/E | Y   | Order | Time     | Undo |
-------------------------------------------
| 2 | 114 | 228 | 12:02 | 12:08:52 |      |
| 5 | 116 | 580 | 12:05 | 12:10:04 |      |
| 3 | 119 | 357 | 12:08 | 12:10:13 |      |
............. [12:00, 12:11] ..............
</pre>

<p>Or, rendered as an animation, which clearly shows how joined results are not emitted into the output stream until the watermark moves beyond them, as demonstrated in <a data-type="xref" href="/site/library/view/streaming-systems/9781491983867/ch09.html#temporal_validity_join_converting_euros_to_yen_with_watermark_triggering">Figure&nbsp;9-3</a>.</p>

<figure><div id="temporal_validity_join_converting_euros_to_yen_with_watermark_triggering" class="figure">
<video style="margin: 0 auto; max-width: 100%;" controls="controls" poster="https://www.safaribooksonline.com/library/view/streaming-systems/9781491983867/assets/stsy_0903.png" autoplay="autoplay" loop="loop">
<source src="https://www.safaribooksonline.com/library/view/streaming-systems/9781491983867/assets/stsy_0903.mp4" type="video/mp4"><img src="https://www.safaribooksonline.com/library/view/streaming-systems/9781491983867/assets/stsy_0903.png" alt="Temporal validity join, converting Euros to Yen with watermark triggering" width="600" height="361" data-mfp-src="/library/view/streaming-systems/9781491983867/assets/stsy_0903.png">
</video>
<h6><span class="label">Figure 9-3. </span>Temporal validity join, converting Euros to Yen with watermark triggering</h6>
</div></figure>

<p>Either way, it’s impressive<a contenteditable="false" data-primary="temporal validity" data-secondary="temporal validity joins" data-startref="ix_tmpvaljoin" data-type="indexterm" id="idm140176508342512"></a> to see how this query encapsulates such a complex set of interactions into a clean and concise rendering of the desired results.<a contenteditable="false" data-primary="streaming joins" data-secondary="windowed joins" data-startref="ix_strmjoinwintmpval" data-tertiary="temporal validity" data-type="indexterm" id="idm140176508340496"></a><a contenteditable="false" data-primary="temporal validity" data-startref="ix_tmpval" data-type="indexterm" id="idm140176508338576"></a><a contenteditable="false" data-primary="windowing" data-secondary="windowed joins" data-startref="ix_windjointmpval" data-tertiary="temporal validity" data-type="indexterm" id="idm140176508337200"></a><a contenteditable="false" data-primary="windowing" data-secondary="windowed joins" data-startref="ix_windjoin" data-type="indexterm" id="idm140176508335280"></a><a contenteditable="false" data-primary="streaming joins" data-secondary="windowed joins" data-startref="ix_strmjoinwin" data-type="indexterm" id="idm140176508333632"></a></p>
</div></section>
</div></section>
</div></section>
</div></section>

<section data-type="sect1" data-pdf-bookmark="Summary"><div class="sect1" id="idm140176508527392">
<h1>Summary</h1>

<p>In this chapter, we analyzed the world of joins (using the join vocabulary of SQL) within the context of stream processing. We began with unwindowed joins and saw how, conceptually, all joins are streaming joins as the core. We saw how the foundation for essentially all of the other join variations is the <code>FULL OUTER</code> join, and discussed the specific alterations that occur as part of <code>LEFT OUTER</code>, <code>RIGHT OUTER</code>, <code>INNER</code>, <code>ANTI</code>, <code>SEMI</code>, and even <code>CROSS</code> joins. In addition, we saw how all of those different join patterns interact in a world of TVRs and streams.</p>

<p>We next moved on to windowed joins, and learned that windowing a join is typically motivated by one or both of the following benefits:</p>

<ul>
	<li>
	<p>The ability to <em>partition the join within time</em> for some business need</p>
	</li>
	<li>
	<p>The ability to <em>tie results</em> from the join <em>to the progress of a watermark</em></p>
	</li>
</ul>

<p>And, finally, we explored in depth one of the more interesting and useful types of windows with respect to joining: temporal validity windows. We saw how temporal validity windows very naturally carve time into regions of validity for given values, based only on the specific points in time where those values change. We learned that joins within validity windows require a windowing framework that supports windows that can split over time, which is something no existing streaming system today supports natively. And we saw how concisely validity windows allowed us to solve the problem of joining TVRs for currency conversion rates and orders together in a robust, natural way.</p>

<p>Joins are often one of the more intimidating aspects of data processing, streaming or otherwise. However, by understanding the theoretical foundation of joins and how straightforwardly we can derive all the different types of joins from that basic foundation, joins become a much less frightening beast, even with the additional dimension of time that streaming adds to the mix.<a contenteditable="false" data-primary="streaming joins" data-startref="ix_strmjoin" data-type="indexterm" id="idm140176508321152"></a></p>
</div></section>
<div data-type="footnotes"><p data-type="footnote" id="idm140176509100064"><sup><a href="/site/library/view/streaming-systems/9781491983867/ch09.html#idm140176509100064-marker" class="totri-footnote">1</a></sup> From a conceptual perspective, at least. There are many different ways to implement each of these types of joins, some of which are likely much more efficient than performing an actual <code>FULL OUTER</code> join and then filtering down its results, especially when the rest of the query and the distribution of the data are taken into consideration.</p><p data-type="footnote" id="idm140176509088208"><sup><a href="/site/library/view/streaming-systems/9781491983867/ch09.html#idm140176509088208-marker" class="totri-footnote">2</a></sup> Again, ignoring what happens when there are duplicate join keys; more on this when we get to <code>SEMI</code> joins.</p><p data-type="footnote" id="idm140176508712624"><sup><a href="/site/library/view/streaming-systems/9781491983867/ch09.html#idm140176508712624-marker" class="totri-footnote">3</a></sup> From a conceptual perspective, at least. There are, of course, many different ways to implement each of these types of joins, some of which might be much more efficient than performing an actual <code>FULL OUTER</code> join and then filtering down its results, depending on the rest of the query and the distribution of the data.</p><p data-type="footnote" id="idm140176508599408"><sup><a href="/site/library/view/streaming-systems/9781491983867/ch09.html#idm140176508599408-marker" class="totri-footnote">4</a></sup> Note that the example data and the temporal join use case motivating it are lifted almost wholesale from Julian Hyde’s excellent <a href="http://bit.ly/2MoNqaS">“Streams, joins, and temporal tables”</a> document.</p><p data-type="footnote" id="idm140176508555520"><sup><a href="/site/library/view/streaming-systems/9781491983867/ch09.html#idm140176508555520-marker" class="totri-footnote">5</a></sup> It’s a partial implementation because it only works if the windows exist in isolation, as in <a data-type="xref" href="/site/library/view/streaming-systems/9781491983867/ch09.html#temporal_validity_windowing_over_time_chap_nine">Figure&nbsp;9-1</a>. As soon as you mix the windows with other data, such as the joining examples below, you would need some mechanism for splitting the data from the shrunken window into two separate windows, which Beam does not currently provide.</p></div></div></section><div class="annotator-outer annotator-viewer viewer annotator-hide">
  <ul class="annotator-widget annotator-listing"></ul>
</div><div class="annotator-modal-wrapper annotator-editor-modal annotator-editor annotator-hide">
	<div class="annotator-outer editor">
		<h2 class="title">Highlight</h2>
		<form class="annotator-widget">
			<ul class="annotator-listing">
			<li class="annotator-item"><textarea id="annotator-field-0" placeholder="Add a note using markdown (optional)" class="js-editor" maxlength="750"></textarea></li></ul>
			<div class="annotator-controls">
				<a class="link-to-markdown" href="https://daringfireball.net/projects/markdown/basics" target="_blank">?</a>
				<ul>
					<li class="delete annotator-hide"><a href="/site/library/view/streaming-systems/9781491983867/ch09.html#delete" class="annotator-delete-note button positive">Delete Note</a></li>
					<li class="save"><a href="/site/library/view/streaming-systems/9781491983867/ch09.html#save" class="annotator-save annotator-focus button positive">Save Note</a></li>
					<li class="cancel"><a href="/site/library/view/streaming-systems/9781491983867/ch09.html#cancel" class="annotator-cancel button">Cancel</a></li>
				</ul>
			</div>
		</form>
	</div>
</div><div class="annotator-modal-wrapper annotator-delete-confirm-modal" style="display: none;">
  <div class="annotator-outer">
    <h2 class="title">Highlight</h2>
      <a class="js-close-delete-confirm annotator-cancel close" href="/site/library/view/streaming-systems/9781491983867/ch09.html#close">Close</a>
      <div class="annotator-widget">
         <div class="delete-confirm">
            Are you sure you want to permanently delete this note?
         </div>
         <div class="annotator-controls">
            <a href="/site/library/view/streaming-systems/9781491983867/ch09.html#cancel" class="annotator-cancel button js-cancel-delete-confirm">No, I changed my mind</a>
            <a href="/site/library/view/streaming-systems/9781491983867/ch09.html#delete" class="annotator-delete button positive js-delete-confirm">Yes, delete it</a>
         </div>
       </div>
   </div>
</div><div class="annotator-adder" style="display: none;">
	<ul class="adders ">
		
		<li class="copy"><a href="/site/library/view/streaming-systems/9781491983867/ch09.html#">Copy</a></li>
		
		<li class="add-highlight"><a href="/site/library/view/streaming-systems/9781491983867/ch09.html#">Add Highlight</a></li>
		<li class="add-note"><a href="/site/library/view/streaming-systems/9781491983867/ch09.html#">
			
				Add Note
			
		</a></li>
		
	</ul>
</div></div></div>



  <div class="t-sbo-prev sbo-prev sbo-nav-bottom">
  
    
      
        <a href="/site/library/view/streaming-systems/9781491983867/ch08.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">8. Streaming SQL</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-bottom">
  
    
      
        <a href="/site/library/view/streaming-systems/9781491983867/ch10.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">10. The Evolution of Large-Scale Data Processing</div>
        </a>
    
  
  </div>


        
    </section>
  </div>
<section class="sbo-saved-archives"></section>



          
          
  




    
    
      <div id="js-subscribe-nag" class="subscribe-nag clearfix trial-panel t-subscribe-nag collapsed">
        
        
          
          
            <p class="usage-data">Find answers on the fly, or master something new. Subscribe today. <a href="https://www.safaribooksonline.com/subscribe/" class="ga-active-trial-subscribe-nag">See pricing options.</a></p>
          

          
        
        

      </div>

    
    



        
      </div>
      




  <footer class="pagefoot t-pagefoot" style="padding-bottom: 69px;">
    <a href="/site/library/view/streaming-systems/9781491983867/ch09.html#" class="icon-up"><div class="visuallyhidden">Back to top</div></a>
    <ul class="js-footer-nav">
      
        <li><a class="t-recommendations-footer" href="https://www.safaribooksonline.com/r/">Recommended</a></li>
      
      <li>
      <a class="t-queue-footer" href="https://www.safaribooksonline.com/playlists/">Playlists</a>
      </li>
      
        <li><a class="t-recent-footer" href="https://www.safaribooksonline.com/history/">History</a></li>
        <li><a class="t-topics-footer" href="https://www.safaribooksonline.com/topics?q=*&amp;limit=21">Topics</a></li>
      
      
        <li><a class="t-tutorials-footer" href="https://www.safaribooksonline.com/tutorials/">Tutorials</a></li>
      
      <li><a class="t-settings-footer js-settings" href="https://www.safaribooksonline.com/u/preferences/">Settings</a></li>
      <li class="full-support"><a href="https://www.oreilly.com/online-learning/support/">Support</a></li>
      <li><a href="https://www.safaribooksonline.com/apps/">Get the App</a></li>
      <li><a href="https://www.safaribooksonline.com/accounts/logout/">Sign Out</a></li>
    </ul>
    <span class="copyright">© 2018 <a href="https://www.safaribooksonline.com/" target="_blank">Safari</a>.</span>
    <a href="https://www.safaribooksonline.com/terms/">Terms of Service</a> /
    <a href="https://www.safaribooksonline.com/privacy/">Privacy Policy</a>
  </footer>




    
    
      <img src="https://www.oreilly.com/library/view/oreilly_set_cookie/" alt="" style="display:none;">
    
    
<div style="width:0px; height:0px; display:none; visibility:hidden;" id="batBeacon0.552474838481049"><img style="width:0px; height:0px; display:none; visibility:hidden;" id="batBeacon0.6737157599256252" width="0" height="0" alt="" src="https://bat.bing.com/action/0?ti=5794699&amp;Ver=2&amp;mid=5ef77012-709d-ac6f-cdd5-24642020750e&amp;pi=1200101525&amp;lg=en-US&amp;sw=1440&amp;sh=900&amp;sc=24&amp;tl=9.%20Streaming%20Joins%20-%20Streaming%20Systems&amp;p=https%3A%2F%2Fwww.safaribooksonline.com%2Flibrary%2Fview%2Fstreaming-systems%2F9781491983867%2Fch09.html&amp;r=&amp;evt=pageLoad&amp;msclkid=N&amp;rn=195549"></div>
    
  

<div class="annotator-notice"></div><div class="font-flyout"><div class="font-controls-panel">
	<div class="nightmodes">
		<ul>
			<li class="day"><a href="/site/library/view/streaming-systems/9781491983867/ch09.html#" id="day-mode" title="Day Mode">
				<i class="fa fa-sun-o"></i>
				<span>Day Mode</span></a></li>
			<li class="cloudy"><a href="/site/library/view/streaming-systems/9781491983867/ch09.html#" id="cloudy-mode" title="Cloudy Mode">
				<i class="fa fa-cloud"></i>
				<span>Cloud Mode</span>
			</a></li>
			<li class="night"><a href="/site/library/view/streaming-systems/9781491983867/ch09.html#" id="night-mode" title="Night Mode">
				<i class="fa fa-moon-o"></i>
				<span>Night Mode</span>
			</a></li>
		</ul>
	</div>

	<div class="font-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-font left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-font-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-font right"></i>
		</div>
	</div>

	<div class="column-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-compress left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-column-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-expand right"></i>
		</div>
	</div>

	<a id="reset" class="button" href="/site/library/view/streaming-systems/9781491983867/ch09.html#">Reset</a>
</div>
</div></body></html>