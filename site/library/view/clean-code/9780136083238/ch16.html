<!--[if IE]><![endif]--><!DOCTYPE html><!--[if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage"" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/clean-code/9780136083238/ch16.html"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="859452"
  data-user-uuid="4d373bec-fada-4717-9823-769db3ed3a36"
  data-username="dchen267"
  data-account-type="B2B"
  
  data-activated-trial-date="04/25/2016"


  data-archive="9780136083238"
  data-publishers="Prentice Hall"



  data-htmlfile-name="ch16.html"
  data-epub-title="Clean Code" data-debug=0 data-testing=0><![endif]--><!--[if gt IE 8]><!--><html class=" js flexbox flexboxlegacy no-touch websqldatabase indexeddb history csscolumns csstransforms localstorage sessionstorage applicationcache svg inlinesvg zoom gr__safaribooksonline_com" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#" itemscope="" itemtype="http://schema.org/Book http://schema.org/ItemPage" "="" data-login-url="/accounts/login/" data-offline-url="/" data-url="/library/view/clean-code/9780136083238/ch16.html" data-csrf-cookie="csrfsafari" data-highlight-privacy="" data-user-id="859452" data-user-uuid="4d373bec-fada-4717-9823-769db3ed3a36" data-username="dchen267" data-account-type="B2B" data-activated-trial-date="04/25/2016" data-archive="9780136083238" data-publishers="Prentice Hall" data-htmlfile-name="ch16.html" data-epub-title="Clean Code" data-debug="0" data-testing="0"><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="Safari Books Online"><meta name="format-detection" content="telephone=no"><meta http-equiv="cleartype" content="on"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="apple-itunes-app" content="app-id=881697395, app-argument=safaridetail://9780136083238"><meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0"><meta property="twitter:account_id" content="4503599627559754"><link rel="apple-touch-icon" href="https://www.safaribooksonline.com/static/images/apple-touch-icon.8cc2fd27400e.png"><link rel="shortcut icon" href="https://www.safaribooksonline.com/favicon.ico" type="image/x-icon"><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700,900,200italic,300italic,400italic,600italic,700italic,900italic" rel="stylesheet" type="text/css"><title>16. Refactoring SerialDate - Clean Code</title><link rel="stylesheet" href="https://www.safaribooksonline.com/static/CACHE/css/e4b0fef39b55.css" type="text/css"><link rel="stylesheet" type="text/css" href="https://www.safaribooksonline.com/static/css/annotator.min.fd58f69f4908.css"><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css"><style type="text/css" title="ibis-book"></style><link rel="canonical" href="/library/view/clean-code/9780136083238/ch16.html"><meta name="description" content="Chapter&nbsp;16.&nbsp;Refactoring SerialDate If you go to http://www.jfree.org/jcommon/index.php, you will find the JCommon library. Deep within that library there is a package named ... "><meta property="og:title" content="16. Refactoring SerialDate"><meta itemprop="isPartOf" content="/library/view/clean-code/9780136083238/"><meta itemprop="name" content="16. Refactoring SerialDate"><meta property="og:url" itemprop="url" content="https://www.safaribooksonline.com/library/view/clean-code/9780136083238/ch16.html"><meta property="og:site_name" content="Safari"><meta property="og:image" itemprop="thumbnailUrl" content="https://www.safaribooksonline.com/library/cover/9780136083238/"><meta property="og:description" itemprop="description" content="Chapter&nbsp;16.&nbsp;Refactoring SerialDate If you go to http://www.jfree.org/jcommon/index.php, you will find the JCommon library. Deep within that library there is a package named ... "><meta itemprop="inLanguage" content="en"><meta itemprop="publisher" content="Prentice Hall"><meta property="og:type" content="book"><meta property="og:book:isbn" itemprop="isbn" content="9780136083238"><meta property="og:book:author" itemprop="author" content="Robert C. Martin"><meta property="og:book:tag" itemprop="about" content="Agile"><meta property="og:book:tag" itemprop="about" content="Core Programming"><meta property="og:book:tag" itemprop="about" content="Lean"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@safari"><style type="text/css" id="font-styles" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-size: <%= font_size %> !important; }"></style><style type="text/css" id="font-family" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-family: <%= font_family %> !important; }"></style><style type="text/css" id="column-width" data-template="#sbo-rt-content { max-width: <%= column_width %>% !important; margin: 0 auto !important; }"></style><!--[if lt IE 9]><script src="/static/js/src/respond.min.cf5c9b7980e5.js"></script><![endif]--><style id="annotator-dynamic-style">.annotator-adder, .annotator-outer, .annotator-notice {
  z-index: 100019;
}
.annotator-filter {
  z-index: 100009;
}</style></head>


<body class="reading sidenav nav-collapsed  scalefonts library" data-gr-c-s-loaded="true">

    
      <div class="hide working" role="status">
        <div class="working-image"></div>
      </div>
      <div class="sbo-site-nav">
        




<a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#container" class="skip">Skip to content</a><header class="topbar t-topbar"><nav role="navigation" class="js-site-nav"><ul class="topnav"><li class="t-logo"><a href="https://www.safaribooksonline.com/home/" class="l0 None safari-home nav-icn js-keyboard-nav-home"><svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" version="1.1" fill="#4A3C31"><desc>Safari Home Icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M4 9.9L4 9.9 4 18 16 18 16 9.9 10 4 4 9.9ZM2.6 8.1L2.6 8.1 8.7 1.9 10 0.5 11.3 1.9 17.4 8.1 18 8.7 18 9.5 18 18.1 18 20 16.1 20 3.9 20 2 20 2 18.1 2 9.5 2 8.7 2.6 8.1Z"></path><rect x="10" y="12" width="3" height="7"></rect><rect transform="translate(18.121320, 10.121320) rotate(-315.000000) translate(-18.121320, -10.121320) " x="16.1" y="9.1" width="4" height="2"></rect><rect transform="translate(2.121320, 10.121320) scale(-1, 1) rotate(-315.000000) translate(-2.121320, -10.121320) " x="0.1" y="9.1" width="4" height="2"></rect></g></svg><span>Safari Home</span></a></li><li><a href="https://www.safaribooksonline.com/r/" class="t-recommendations-nav l0 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" version="1.1" fill="#4A3C31"><desc>recommendations icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M50 25C50 18.2 44.9 12.5 38.3 11.7 37.5 5.1 31.8 0 25 0 18.2 0 12.5 5.1 11.7 11.7 5.1 12.5 0 18.2 0 25 0 31.8 5.1 37.5 11.7 38.3 12.5 44.9 18.2 50 25 50 31.8 50 37.5 44.9 38.3 38.3 44.9 37.5 50 31.8 50 25ZM25 3.1C29.7 3.1 33.6 6.9 34.4 11.8 30.4 12.4 26.9 15.1 25 18.8 23.1 15.1 19.6 12.4 15.6 11.8 16.4 6.9 20.3 3.1 25 3.1ZM34.4 15.6C33.6 19.3 30.7 22.2 27.1 22.9 27.8 19.2 30.7 16.3 34.4 15.6ZM22.9 22.9C19.2 22.2 16.3 19.3 15.6 15.6 19.3 16.3 22.2 19.2 22.9 22.9ZM3.1 25C3.1 20.3 6.9 16.4 11.8 15.6 12.4 19.6 15.1 23.1 18.8 25 15.1 26.9 12.4 30.4 11.8 34.4 6.9 33.6 3.1 29.7 3.1 25ZM22.9 27.1C22.2 30.7 19.3 33.6 15.6 34.4 16.3 30.7 19.2 27.8 22.9 27.1ZM25 46.9C20.3 46.9 16.4 43.1 15.6 38.2 19.6 37.6 23.1 34.9 25 31.3 26.9 34.9 30.4 37.6 34.4 38.2 33.6 43.1 29.7 46.9 25 46.9ZM27.1 27.1C30.7 27.8 33.6 30.7 34.4 34.4 30.7 33.6 27.8 30.7 27.1 27.1ZM38.2 34.4C37.6 30.4 34.9 26.9 31.3 25 34.9 23.1 37.6 19.6 38.2 15.6 43.1 16.4 46.9 20.3 46.9 25 46.9 29.7 43.1 33.6 38.2 34.4Z" fill="currentColor"></path></g></svg><span>Recommended</span></a></li><li><a href="https://www.safaribooksonline.com/s/" class="t-queue-nav l0 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" version="1.1" fill="#4A3C31"><desc>queue icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 29.2C25.4 29.2 25.8 29.1 26.1 28.9L48.7 16.8C49.5 16.4 50 15.5 50 14.6 50 13.7 49.5 12.8 48.7 12.4L26.1 0.3C25.4-0.1 24.6-0.1 23.9 0.3L1.3 12.4C0.5 12.8 0 13.7 0 14.6 0 15.5 0.5 16.4 1.3 16.8L23.9 28.9C24.2 29.1 24.6 29.2 25 29.2ZM7.3 14.6L25 5.2 42.7 14.6 25 24 7.3 14.6ZM48.7 22.4L47.7 21.9 25 34.2 2.3 21.9 1.3 22.4C0.5 22.9 0 23.7 0 24.7 0 25.6 0.5 26.5 1.3 26.9L23.9 39.3C24.2 39.5 24.6 39.6 25 39.6 25.4 39.6 25.8 39.5 26.1 39.3L48.7 26.9C49.5 26.5 50 25.6 50 24.7 50 23.7 49.5 22.9 48.7 22.4ZM48.7 32.8L47.7 32.3 25 44.6 2.3 32.3 1.3 32.8C0.5 33.3 0 34.1 0 35.1 0 36 0.5 36.9 1.3 37.3L23.9 49.7C24.2 49.9 24.6 50 25 50 25.4 50 25.8 49.9 26.1 49.7L48.7 37.3C49.5 36.9 50 36 50 35.1 50 34.1 49.5 33.3 48.7 32.8Z" fill="currentColor"></path></g></svg><span>Queue</span></a></li><li class="search"><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#" class="t-search-nav trigger nav-icn l0" data-dropdown-selector=".searchbox"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" version="1.1" fill="#4A3C31"><desc>search icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M31.3 0C20.9 0 12.5 8.4 12.5 18.8 12.5 22.5 13.6 25.9 15.4 28.8L1.2 42.9C-0.4 44.5-0.4 47.2 1.2 48.8 2 49.6 3.1 50 4.2 50 5.2 50 6.3 49.6 7.1 48.8L21.2 34.6C24.1 36.5 27.5 37.5 31.3 37.5 41.6 37.5 50 29.1 50 18.8 50 8.4 41.6 0 31.3 0ZM31.3 31.3C24.4 31.3 18.8 25.6 18.8 18.8 18.8 11.9 24.4 6.3 31.3 6.3 38.1 6.3 43.8 11.9 43.8 18.8 43.8 25.6 38.1 31.3 31.3 31.3Z" fill="currentColor"></path></g></svg><span>Search</span></a></li><li class="usermenu dropdown"><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#" class="trigger l0 nav-icn nav-dropdown"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" version="1.1" fill="#4A3C31"><desc>navigation arrow</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M0.1 12.5L9.7 3.1C9.8 3 9.9 3 10 3 10.1 3 10.2 3 10.3 3.1L19.9 12.5C20 12.5 20 12.6 20 12.8 20 12.9 20 13 19.9 13L17 15.9C16.9 16 16.8 16 16.7 16 16.5 16 16.4 16 16.4 15.9L10 9.7 3.6 15.9C3.6 16 3.5 16 3.3 16 3.2 16 3.1 16 3 15.9L0.1 13C0 12.9 0 12.8 0 12.7 0 12.7 0 12.6 0.1 12.5Z"></path></g></svg><span>Expand Nav</span></a><div class="drop-content"><ul><li><a href="https://www.safaribooksonline.com/history/" class="t-recent-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" version="1.1" fill="#4A3C31"><desc>recent items icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 0C11.2 0 0 11.2 0 25 0 38.8 11.2 50 25 50 38.8 50 50 38.8 50 25 50 11.2 38.8 0 25 0ZM6.3 25C6.3 14.6 14.6 6.3 25 6.3 35.4 6.3 43.8 14.6 43.8 25 43.8 35.4 35.4 43.8 25 43.8 14.6 43.8 6.3 35.4 6.3 25ZM31.8 31.5C32.5 30.5 32.4 29.2 31.6 28.3L27.1 23.8 27.1 12.8C27.1 11.5 26.2 10.4 25 10.4 23.9 10.4 22.9 11.5 22.9 12.8L22.9 25.7 28.8 31.7C29.2 32.1 29.7 32.3 30.2 32.3 30.8 32.3 31.3 32 31.8 31.5Z" fill="currentColor"></path></g></svg><span>History</span></a></li><li><a href="https://www.safaribooksonline.com/topics" class="t-topics-link l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 55" version="1.1" fill="#4A3C31"><desc>topics icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 55L50 41.262 50 13.762 25 0 0 13.762 0 41.262 25 55ZM8.333 37.032L8.333 17.968 25 8.462 41.667 17.968 41.667 37.032 25 46.538 8.333 37.032Z" fill="currentColor"></path></g></svg><span>Topics</span></a></li><li><a href="https://www.safaribooksonline.com/tutorials/" class="l1 nav-icn t-tutorials-nav js-toggle-menu-item None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" version="1.1" fill="#4A3C31"><desc>tutorials icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M15.8 18.2C15.8 18.2 15.9 18.2 16 18.2 16.1 18.2 16.2 18.2 16.4 18.2 16.5 18.2 16.7 18.1 16.9 18 17 17.9 17.1 17.8 17.2 17.7 17.3 17.6 17.4 17.5 17.4 17.4 17.5 17.2 17.6 16.9 17.6 16.7 17.6 16.6 17.6 16.5 17.6 16.4 17.5 16.2 17.5 16.1 17.4 15.9 17.3 15.8 17.2 15.6 17 15.5 16.8 15.3 16.6 15.3 16.4 15.2 16.2 15.2 16 15.2 15.8 15.2 15.7 15.2 15.5 15.3 15.3 15.4 15.2 15.4 15.1 15.5 15 15.7 14.9 15.8 14.8 15.9 14.7 16 14.7 16.1 14.6 16.3 14.6 16.4 14.6 16.5 14.6 16.6 14.6 16.6 14.6 16.7 14.6 16.9 14.6 17 14.6 17.1 14.7 17.3 14.7 17.4 14.8 17.6 15 17.7 15.1 17.9 15.2 18 15.3 18 15.5 18.1 15.5 18.1 15.6 18.2 15.7 18.2 15.7 18.2 15.7 18.2 15.8 18.2L15.8 18.2ZM9.4 11.5C9.5 11.5 9.5 11.5 9.6 11.5 9.7 11.5 9.9 11.5 10 11.5 10.2 11.5 10.3 11.4 10.5 11.3 10.6 11.2 10.8 11.1 10.9 11 10.9 10.9 11 10.8 11.1 10.7 11.2 10.5 11.2 10.2 11.2 10 11.2 9.9 11.2 9.8 11.2 9.7 11.2 9.5 11.1 9.4 11 9.2 10.9 9.1 10.8 8.9 10.6 8.8 10.5 8.7 10.3 8.6 10 8.5 9.9 8.5 9.7 8.5 9.5 8.5 9.3 8.5 9.1 8.6 9 8.7 8.8 8.7 8.7 8.8 8.6 9 8.5 9.1 8.4 9.2 8.4 9.3 8.2 9.5 8.2 9.8 8.2 10 8.2 10.1 8.2 10.2 8.2 10.3 8.2 10.5 8.3 10.6 8.4 10.7 8.5 10.9 8.6 11.1 8.7 11.2 8.9 11.3 9 11.4 9.1 11.4 9.2 11.4 9.3 11.5 9.3 11.5 9.3 11.5 9.4 11.5 9.4 11.5L9.4 11.5ZM3 4.8C3.1 4.8 3.1 4.8 3.2 4.8 3.4 4.8 3.5 4.8 3.7 4.8 3.8 4.8 4 4.7 4.1 4.6 4.3 4.5 4.4 4.4 4.5 4.3 4.6 4.2 4.6 4.1 4.7 4 4.8 3.8 4.8 3.5 4.8 3.3 4.8 3.1 4.8 3 4.8 2.9 4.7 2.8 4.7 2.6 4.6 2.5 4.5 2.3 4.4 2.2 4.2 2.1 4 1.9 3.8 1.9 3.6 1.8 3.5 1.8 3.3 1.8 3.1 1.8 2.9 1.8 2.7 1.9 2.6 2 2.4 2.1 2.3 2.2 2.2 2.3 2.1 2.4 2 2.5 2 2.6 1.8 2.8 1.8 3 1.8 3.3 1.8 3.4 1.8 3.5 1.8 3.6 1.8 3.8 1.9 3.9 2 4 2.1 4.2 2.2 4.4 2.4 4.5 2.5 4.6 2.6 4.7 2.7 4.7 2.8 4.7 2.9 4.8 2.9 4.8 3 4.8 3 4.8 3 4.8L3 4.8ZM13.1 15.2C13.2 15.1 13.2 15.1 13.2 15.1 13.3 14.9 13.4 14.7 13.6 14.5 13.8 14.2 14.1 14 14.4 13.8 14.7 13.6 15.1 13.5 15.5 13.4 15.9 13.4 16.3 13.4 16.7 13.5 17.2 13.5 17.6 13.7 17.9 13.9 18.2 14.1 18.5 14.4 18.7 14.7 18.9 15 19.1 15.3 19.2 15.6 19.3 15.9 19.4 16.1 19.4 16.4 19.4 17 19.3 17.5 19.1 18.1 19 18.3 18.9 18.5 18.7 18.7 18.5 19 18.3 19.2 18 19.4 17.7 19.6 17.3 19.8 16.9 19.9 16.6 20 16.3 20 16 20 15.8 20 15.6 20 15.4 19.9 15.4 19.9 15.4 19.9 15.4 19.9 15.2 19.9 15 19.8 14.9 19.8 14.8 19.7 14.7 19.7 14.6 19.7 14.4 19.6 14.3 19.5 14.1 19.3 13.7 19.1 13.4 18.7 13.2 18.4 13.1 18.1 12.9 17.8 12.9 17.5 12.8 17.3 12.8 17.1 12.8 16.9L3.5 14.9C3.3 14.9 3.1 14.8 3 14.8 2.7 14.7 2.4 14.5 2.1 14.3 1.7 14 1.4 13.7 1.2 13.3 1 13 0.9 12.6 0.8 12.3 0.7 12 0.7 11.7 0.7 11.4 0.7 11 0.8 10.5 1 10.1 1.1 9.8 1.3 9.5 1.6 9.2 1.8 8.9 2.1 8.7 2.4 8.5 2.8 8.3 3.2 8.1 3.6 8.1 3.9 8 4.2 8 4.5 8 4.6 8 4.8 8 4.9 8.1L6.8 8.5C6.8 8.4 6.8 8.4 6.8 8.4 6.9 8.2 7.1 8 7.2 7.8 7.5 7.5 7.7 7.3 8 7.1 8.4 6.9 8.7 6.8 9.1 6.7 9.5 6.7 10 6.7 10.4 6.8 10.8 6.8 11.2 7 11.5 7.2 11.8 7.5 12.1 7.7 12.4 8 12.6 8.3 12.7 8.6 12.8 8.9 12.9 9.2 13 9.4 13 9.7 13 9.7 13 9.8 13 9.8 13.6 9.9 14.2 10.1 14.9 10.2 15 10.2 15 10.2 15.1 10.2 15.3 10.2 15.4 10.2 15.6 10.2 15.8 10.1 16 10 16.2 9.9 16.4 9.8 16.5 9.6 16.6 9.5 16.8 9.2 16.9 8.8 16.9 8.5 16.9 8.3 16.9 8.2 16.8 8 16.8 7.8 16.7 7.7 16.6 7.5 16.5 7.3 16.3 7.2 16.2 7.1 16 7 15.9 6.9 15.8 6.9 15.7 6.9 15.6 6.8 15.5 6.8L6.2 4.8C6.2 5 6 5.2 5.9 5.3 5.7 5.6 5.5 5.8 5.3 6 4.9 6.2 4.5 6.4 4.1 6.5 3.8 6.6 3.5 6.6 3.2 6.6 3 6.6 2.8 6.6 2.7 6.6 2.6 6.6 2.6 6.5 2.6 6.5 2.5 6.5 2.3 6.5 2.1 6.4 1.8 6.3 1.6 6.1 1.3 6 1 5.7 0.7 5.4 0.5 5 0.3 4.7 0.2 4.4 0.1 4.1 0 3.8 0 3.6 0 3.3 0 2.8 0.1 2.2 0.4 1.7 0.5 1.5 0.7 1.3 0.8 1.1 1.1 0.8 1.3 0.6 1.6 0.5 2 0.3 2.3 0.1 2.7 0.1 3.1 0 3.6 0 4 0.1 4.4 0.2 4.8 0.3 5.1 0.5 5.5 0.8 5.7 1 6 1.3 6.2 1.6 6.3 1.9 6.4 2.3 6.5 2.5 6.6 2.7 6.6 3 6.6 3 6.6 3.1 6.6 3.1 9.7 3.8 12.8 4.4 15.9 5.1 16.1 5.1 16.2 5.2 16.4 5.2 16.7 5.3 16.9 5.5 17.2 5.6 17.5 5.9 17.8 6.2 18.1 6.5 18.3 6.8 18.4 7.2 18.6 7.5 18.6 7.9 18.7 8.2 18.7 8.6 18.7 9 18.6 9.4 18.4 9.8 18.3 10.1 18.2 10.3 18 10.6 17.8 10.9 17.5 11.1 17.3 11.3 16.9 11.6 16.5 11.8 16 11.9 15.7 12 15.3 12 15 12 14.8 12 14.7 12 14.5 11.9 13.9 11.8 13.3 11.7 12.6 11.5 12.5 11.7 12.4 11.9 12.3 12 12.1 12.3 11.9 12.5 11.7 12.7 11.3 12.9 10.9 13.1 10.5 13.2 10.2 13.3 9.9 13.3 9.6 13.3 9.4 13.3 9.2 13.3 9 13.2 9 13.2 9 13.2 9 13.2 8.8 13.2 8.7 13.2 8.5 13.1 8.2 13 8 12.8 7.7 12.6 7.4 12.4 7.1 12 6.8 11.7 6.7 11.4 6.6 11.1 6.5 10.8 6.4 10.6 6.4 10.4 6.4 10.2 5.8 10.1 5.2 9.9 4.5 9.8 4.4 9.8 4.4 9.8 4.3 9.8 4.1 9.8 4 9.8 3.8 9.8 3.6 9.9 3.4 10 3.2 10.1 3 10.2 2.9 10.4 2.8 10.5 2.6 10.8 2.5 11.1 2.5 11.5 2.5 11.6 2.5 11.8 2.6 12 2.6 12.1 2.7 12.3 2.8 12.5 2.9 12.6 3.1 12.8 3.2 12.9 3.3 13 3.5 13.1 3.6 13.1 3.7 13.1 3.8 13.2 3.9 13.2L13.1 15.2 13.1 15.2Z" fill="currentColor"></path></g></svg><span>Tutorials</span></a></li><li class="nav-offers flyout-parent"><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#" class="l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 50 50" version="1.1" fill="#4A3C31"><desc>offers icon</desc><path d="M10.8 43.7L0 39 0 10.2 13.6 4.6 23.3 8.7 11.5 13.5C11 13.6 10.8 13.9 10.8 14.3L10.8 43.7 10.8 43.7Z"></path><polygon points="12.3 44.4 25 50 38 44.3 38 14.7 25.2 9.4 12.3 14.7 12.3 44.4"></polygon><path d="M36.6 4.7L50 10.2 50 39 39.5 43.6 39.5 14.3C39.5 13.8 39.2 13.6 38.8 13.5L27 8.7 36.6 4.7 36.6 4.7Z"></path><polygon points="34.8 4 25 0 15.4 3.9 25.2 7.9 34.8 4"></polygon></svg><span>Offers</span></a><ul class="flyout"><li><a href="https://www.safaribooksonline.com/oreilly-conferences/" class="l2 nav-icn"><span>Conferences</span></a></li><li><a href="https://www.safaribooksonline.com/oreilly-newsletters/" class="l2 nav-icn"><span>Newsletter</span></a></li></ul></li><li class="nav-highlights"><a href="https://www.safaribooksonline.com/u/003o000000t5q9fAAA/" class="t-highlights-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 35" version="1.1" fill="#4A3C31"><desc>highlights icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M13.325 18.071L8.036 18.071C8.036 11.335 12.36 7.146 22.5 5.594L22.5 0C6.37 1.113 0 10.632 0 22.113 0 29.406 3.477 35 10.403 35 15.545 35 19.578 31.485 19.578 26.184 19.578 21.556 17.211 18.891 13.325 18.071L13.325 18.071ZM40.825 18.071L35.565 18.071C35.565 11.335 39.86 7.146 50 5.594L50 0C33.899 1.113 27.5 10.632 27.5 22.113 27.5 29.406 30.977 35 37.932 35 43.045 35 47.078 31.485 47.078 26.184 47.078 21.556 44.74 18.891 40.825 18.071L40.825 18.071Z" fill="currentColor"></path></g></svg><span>Highlights</span></a></li><li><a href="https://www.safaribooksonline.com/u/" class="t-settings-nav l1 js-settings nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z" fill="currentColor"></path></g></svg><span>Settings</span></a></li><li><a href="https://community.safaribooksonline.com/" class="l1 no-icon">Feedback</a></li><li><a href="https://www.safaribooksonline.com/accounts/logout/" class="l1 no-icon">Sign Out</a></li></ul><ul class="profile"><li><a href="https://www.safaribooksonline.com/u/" class="l2 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z" fill="currentColor"></path></g></svg><span>Settings</span></a></li><li><a href="https://community.safaribooksonline.com/" class="l2">Feedback</a></li><li><a href="https://www.safaribooksonline.com/accounts/logout/" class="l2">Sign Out</a></li></ul></div></li></ul></nav></header>


      </div>
      <div id="container" class="application">
        
          <div class="nav-container clearfix">
            


            
            
          </div>

          

  <div class="js-toc">
    
      <div class="sbo-reading-menu sbo-menu-top"><section class="sbo-toc-container toc-menu"><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#" class="sbo-toc-thumb"><span class="sbo-title ss-list"><h1><div class="visuallyhidden">Table of Contents for </div>
      
      Clean Code
      
    </h1></span></a><div class="toc-contents"></div></section></div>

    

    <div class="interface-controls interface-controls-top">
      <ul class="interface-control-btns js-bitlist js-reader">
        <li class="js-search-in-archive search-in-archive t-search-in-archive"><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#" title="Search in archive" class="js-search-controls search-controls"><span class="icon">Search in book...</span></a><form class="search-archive-bar js-search-form"><input type="search" name="query" placeholder="Search inside this book..." autocomplete="off"></form><div class="search-archive-results"><div class="js-sitb-results-region"></div></div></li><li class="queue-control"><button type="button" class="rec-fav ss-queue js-queue js-current-chapter-queue" data-queue-endpoint="/api/v1/book/9780136083238/chapter/ch16.html" data-for-analytics="9780136083238:ch16.html"><span>Add to Queue</span></button></li><li class="js-font-control-panel font-control-activator"><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#" data-push-state="false" id="font-controls" title="Change font size" aria-label="Change font size"><span class="icon">Toggle Font Controls</span></a></li><li class="dropdown sharing-controls"><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#" class="trigger" data-push-state="false" title="Share" aria-label="Share"><i class="fa fa-share"></i></a><ul class="social-sharing dropdown-menu"><li><a class="twitter share-button t-twitter" target="_blank" aria-label="Share this section on Twitter" title="Share this section on Twitter" href="https://twitter.com/share?url=https://www.safaribooksonline.com/library/view/clean-code/9780136083238/ch16.html&amp;text=Clean%20Code&amp;via=safari"><span>Twitter</span></a></li><li><a class="facebook share-button t-facebook" target="_blank" aria-label="Share this section on Facebook" title="Share this section on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://www.safaribooksonline.com/library/view/clean-code/9780136083238/ch16.html"><span>Facebook</span></a></li><li><a class="googleplus share-button t-googleplus" target="_blank" aria-label="Share this secton on Google Plus" title="Share this secton on Google Plus" href="https://plus.google.com/share?url=https://www.safaribooksonline.com/library/view/clean-code/9780136083238/ch16.html"><span>Google Plus</span></a></li><li><a class="email share-button t-email" aria-label="Share this section via email" title="Share this section via email" href="mailto:?subject=Safari:%2016.%20Refactoring%20SerialDate&amp;body=https://www.safaribooksonline.com/library/view/clean-code/9780136083238/ch16.html%0D%0Afrom%20Clean%20Code%0D%0A"><span>Email</span></a></li></ul></li>
      </ul>
    </div>

    <section role="document">
      
	  <div class="t-sbo-prev sbo-prev sbo-nav-top">
  
    
      
        <a href="/library/view/clean-code/9780136083238/ch15.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">15. JUnit Internals</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-top">
  
    
      
        <a href="/library/view/clean-code/9780136083238/ch17.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">17. Smells and Heuristics</div>
        </a>
    
  
  </div>



<div id="sbo-rt-content"><div class="annotator-wrapper"><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="ch16"></a>Chapter&nbsp;16.&nbsp;Refactoring <code class="literal">SerialDate</code></h1></div></div></div><div class="mediaobject"><a id="f267fig01"></a><img src="https://www.safaribooksonline.com/library/view/clean-code/9780136083238/graphics/16_1fig_martin.jpg" height="229" alt="Refactoring SerialDate" width="350" data-mfp-src="/library/view/clean-code/9780136083238/graphics/16_1fig_martin.jpg"></div><p><a id="iddle1623" class="indexterm"></a><a id="iddle1746" class="indexterm"></a><a id="iddle2114" class="indexterm"></a>If you go to <a class="ulink" href="http://www.jfree.org/jcommon/index.php">http://www.jfree.org/jcommon/index.php</a>, you will find the JCommon library. Deep within that library there is a package named <code class="literal">org.jfree.date</code>. Within that package there is a class named <code class="literal">SerialDate</code>. We are going to explore that class.</p><p>The author of <code class="literal">SerialDate</code> is David Gilbert. David is clearly an experienced and competent programmer. As we shall see, he shows a significant degree of professionalism and discipline within his code. For all intents and purposes, this is “good code.” And I am going to rip it to pieces.</p><p><a id="iddle1204" class="indexterm"></a><a id="iddle1624" class="indexterm"></a><a id="iddle2022" class="indexterm"></a><a id="iddle2115" class="indexterm"></a><a id="iddle2280" class="indexterm"></a><a id="iddle2291" class="indexterm"></a><a id="iddle2384" class="indexterm"></a>This is not an activity of malice. Nor do I think that I am so much better than David that I somehow have a right to pass judgment on his code. Indeed, if you were to find some of my code, I’m sure you could find plenty of things to complain about.</p><p>No, this is not an activity of nastiness or arrogance. What I am about to do is nothing more and nothing less than a professional review. It is something that we should all be comfortable doing. And it is something we should welcome when it is done for us. It is only through critiques like these that we will learn. Doctors do it. Pilots do it. Lawyers do it. And we programmers need to learn how to do it too.</p><p>One more thing about David Gilbert: David is more than just a good programmer. David had the courage and good will to offer his code to the community at large for free. He placed it out in the open for all to see and invited public usage and public scrutiny. This was well done!</p><p><code class="literal">SerialDate</code> (<a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/apb.html#app02ex01">Listing B-1</a>, page <a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/apb.html#app02ex01">349</a>) is a class that represents a date in Java. Why have a class that represents a date, when Java already has <code class="literal">java.util.Date</code> and <code class="literal">java.util.Calendar</code>, and others? The author wrote this class in response to a pain that I have often felt myself. The comment in his opening Javadoc (line 67) explains it well. We could quibble about his intention, but I have certainly had to deal with this issue, and I welcome a class that is about dates instead of times.</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="ch16lev1sec1"></a>First, Make It Work</h1></div></div></div><p>There are some unit tests in a class named <code class="literal">SerialDateTests</code> (<a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/apb.html#app02ex02">Listing B-2</a>, page <a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/apb.html#app02ex02">366</a>). The tests all pass. Unfortunately a quick inspection of the tests shows that they don’t test everything [T1]. For example, doing a “Find Usages” search on the method <code class="literal">MonthCodeToQuarter</code> (line 334) indicates that it is not used [F4]. Therefore, the unit tests don’t test it.</p><p>So I fired up Clover to see what the unit tests covered and what they didn’t. Clover reported that the unit tests executed only 91 of the 185 executable statements in <code class="literal">SerialDate</code> (~50 percent) [T2]. The coverage map looks like a patchwork quilt, with big gobs of unexecuted code littered all through the class.</p><p>It was my goal to completely understand and also refactor this class. I couldn’t do that without much greater test coverage. So I wrote my own suite of completely independent unit tests (<a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/apb.html#app02ex04">Listing B-4</a>, page <a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/apb.html#app02ex04">374</a>).</p><p>As you look through these tests, you will note that many of them are commented out. These tests didn’t pass. They represent behavior that I think <code class="literal">SerialDate</code> should have. So as I refactor <code class="literal">SerialDate</code>, I’ll be working to make these tests pass too.</p><p>Even with some of the tests commented out, Clover reports that the new unit tests are executing 170 (92 percent) out of the 185 executable statements. This is pretty good, and I think we’ll be able to get this number higher.</p><p>The first few commented-out tests (lines 23-63) were a bit of conceit on my part. The program was not designed to pass these tests, but the behavior seemed obvious [G2] to me. <a id="iddle1032" class="indexterm"></a><a id="iddle1127" class="indexterm"></a><a id="iddle1205" class="indexterm"></a><a id="iddle1512" class="indexterm"></a><a id="iddle1836" class="indexterm"></a><a id="iddle2267" class="indexterm"></a>I’m not sure why the <code class="literal">testWeekdayCodeToString</code> method was written in the first place, but because it is there, it seems obvious that it should not be case sensitive. Writing these tests was trivial [T3]. Making them pass was even easier; I just changed lines 259 and 263 to use <code class="literal">equalsIgnoreCase</code>.</p><p>I left the tests at line 32 and line 45 commented out because it’s not clear to me that the “tues” and “thurs” abbreviations ought to be supported.</p><p>The tests on line 153 and line 154 don’t pass. Clearly, they should [G2]. We can easily fix this, and the tests on line 163 through line 213, by making the following changes to the <code class="literal">stringToMonthCode</code> function.</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col width="550" style="text-align: left" class="c1"></colgroup><tbody><tr><td style="text-align: left" valign="top"><div class="informalexample"><pre class="programlisting">457         if ((result &lt; 1) || (result &gt; 12)) {
                result = -1;
458             for (int i = 0; i &lt; monthNames.length; i++) {
459                 if (s.equalsIgnoreCase(shortMonthNames[i])) {
460                     result = i + 1;
461                     break;
462                 }
463                 if (s.equalsIgnoreCase(monthNames[i])) {
464                     result = i + 1;
465                     break;
466                 }
467             }
468         }</pre></div></td></tr></tbody></table></div><p>The commented test on line 318 exposes a bug in the <code class="literal">getFollowingDayOfWeek</code> method (line 672). December 25th, 2004, was a Saturday. The following Saturday was January 1st, 2005. However, when we run the test, we see that <code class="literal">getFollowingDayOfWeek</code> returns December 25th as the Saturday that follows December 25th. Clearly, this is wrong [G3],[T1]. We see the problem in line 685. It is a typical boundary condition error [T5]. It should read as follows:</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col width="550" style="text-align: left" class="c1"></colgroup><tbody><tr><td style="text-align: left" valign="top"><div class="informalexample"><pre class="programlisting">685         if (baseDOW &gt;= targetWeekday) {</pre></div></td></tr></tbody></table></div><p>It is interesting to note that this function was the target of an earlier repair. The change history (line 43) shows that “bugs” were fixed in <code class="literal">getPreviousDayOfWeek</code>, <code class="literal">getFollowingDayOfWeek</code>, and <code class="literal">getNearestDayOfWeek</code> [T6].</p><p>The <code class="literal">testGetNearestDayOfWeek</code> unit test (line 329), which tests the <code class="literal">getNearestDayOfWeek</code> method (line 705), did not start out as long and exhaustive as it currently is. I added a lot of test cases to it because my initial test cases did not all pass [T6]. You can see the pattern of failure by looking at which test cases are commented out. That pattern is revealing [T7]. It shows that the algorithm fails if the nearest day is in the future. Clearly there is some kind of boundary condition error [T5].</p><p>The pattern of test coverage reported by Clover is also interesting [T8]. Line 719 never gets executed! This means that the <code class="literal">if</code> statement in line 718 is always false. Sure enough, a look at the code shows that this must be true. The <code class="literal">adjust</code> variable is always negative and so cannot be greater or equal to 4. So this algorithm is just wrong.</p><p><a id="iddle1158" class="indexterm"></a><a id="iddle1672" class="indexterm"></a><a id="iddle1741" class="indexterm"></a><a id="iddle1747" class="indexterm"></a><a id="iddle1767" class="indexterm"></a><a id="iddle1863" class="indexterm"></a><a id="iddle2112" class="indexterm"></a><a id="iddle2113" class="indexterm"></a>The right algorithm is shown below:</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col width="550" style="text-align: left" class="c1"></colgroup><tbody><tr><td style="text-align: left" valign="top"><div class="informalexample"><pre class="programlisting">int delta = targetDOW - base.getDayOfWeek();
int positiveDelta = delta + 7;
int adjust = positiveDelta % 7;
if (adjust &gt; 3)
  adjust -= 7;

return SerialDate.addDays(adjust, base);</pre></div></td></tr></tbody></table></div><p>Finally, the tests at line 417 and line 429 can be made to pass simply by throwing an <code class="literal">IllegalArgumentException</code> instead of returning an error string from <code class="literal">weekInMonthToString</code> and <code class="literal">relativeToString</code>.</p><p>With these changes all the unit tests pass, and I believe <code class="literal">SerialDate</code> now works. So now it’s time to make it “right.”</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="ch16lev1sec2"></a>Then Make It Right</h1></div></div></div><p>We are going to walk from the top to the bottom of <code class="literal">SerialDate</code>, improving it as we go along. Although you won’t see this in the discussion, I will be running all of the <code class="literal">JCommon</code> unit tests, including my improved unit test for <code class="literal">SerialDate</code>, after every change I make. So rest assured that every change you see here works for all of <code class="literal">JCommon</code>.</p><p>Starting at line 1, we see a ream of comments with license information, copyrights, authors, and change history. I acknowledge that there are certain legalities that need to be addressed, and so the copyrights and licenses must stay. On the other hand, the change history is a leftover from the 1960s. We have source code control tools that do this for us now. This history should be deleted [C1].</p><p>The import list starting at line 61 could be shortened by using <code class="literal">java.text.*</code> and <code class="literal">java.util.*</code>. [J1]</p><p>I wince at the HTML formatting in the Javadoc (line 67). Having a source file with more than one language in it troubles me. This comment has <span class="emphasis"><em>four</em></span> languages in it: Java, English, Javadoc, and html [G1]. With that many languages in use, it’s hard to keep things straight. For example, the nice positioning of line 71 and line 72 are lost when the Javadoc is generated, and yet who wants to see <code class="literal">&lt;ul&gt;</code> and <code class="literal">&lt;li&gt;</code> in the source code? A better strategy might be to just surround the whole comment with <code class="literal">&lt;pre&gt;</code> so that the formatting that is apparent in the source code is preserved within the Javadoc.<a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#ftn.ch16fn01" class="footnote" id="ch16fn01"><sup class="footnote">[1]</sup></a></p><p>Line 86 is the class declaration. Why is this class named <code class="literal">SerialDate</code>? What is the significance of the world “serial”? Is it because the class is derived from <code class="literal">Serializable</code>? That doesn’t seem likely.</p><p><a id="iddle1006" class="indexterm"></a><a id="iddle1333" class="indexterm"></a><a id="iddle1394" class="indexterm"></a><a id="iddle1847" class="indexterm"></a><a id="iddle1881" class="indexterm"></a><a id="iddle2111" class="indexterm"></a>I won’t keep you guessing. I know why (or at least I think I know why) the word “serial” was used. The clue is in the constants SERIAL_LOWER_BOUND and SERIAL_UPPER_BOUND on line 98 and line 101. An even better clue is in the comment that begins on line 830. This class is named <code class="literal">SerialDate</code> because it is implemented using a “serial number,” which happens to be the number of days since December 30th, 1899.</p><p>I have two problems with this. First, the term “serial number” is not really correct. This may be a quibble, but the representation is more of a relative offset than a serial number. The term “serial number” has more to do with product identification markers than dates. So I don’t find this name particularly descriptive [N1]. A more descriptive term might be “ordinal.”</p><p>The second problem is more significant. The name <code class="literal">SerialDate</code> implies an implementation. This class is an abstract class. There is no need to imply anything at all about the implementation. Indeed, there is good reason to hide the implementation! So I find this name to be at the wrong level of abstraction [N2]. In my opinion, the name of this class should simply be <code class="literal">Date</code>.</p><p>Unfortunately, there are already too many classes in the Java library named <code class="literal">Date</code>, so this is probably not the best name to choose. Because this class is all about days, instead of time, I considered naming it <code class="literal">Day</code>, but this name is also heavily used in other places. In the end, I chose <code class="literal">DayDate</code> as the best compromise.</p><p>From now on in this discussion I will use the term <code class="literal">DayDate</code>. I leave it to you to remember that the listings you are looking at still use <code class="literal">SerialDate</code>.</p><p>I understand why <code class="literal">DayDate</code> inherits from <code class="literal">Comparable</code> and <code class="literal">Serializable</code>. But why does it inherit from <code class="literal">MonthConstants</code>? The class <code class="literal">MonthConstants</code> (<a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/apb.html#app02ex03">Listing B-3</a>, page <a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/apb.html#app02ex03">372</a>) is just a bunch of static final constants that define the months. Inheriting from classes with constants is an old trick that Java programmers used so that they could avoid using expressions like <code class="literal">MonthConstants.January</code>, but it’s a bad idea [J2]. <code class="literal">MonthConstants</code> should really be an enum.</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col width="550" style="text-align: left" class="c1"></colgroup><tbody><tr><td style="text-align: left" valign="top"><div class="informalexample"><pre class="programlisting">public abstract class DayDate implements Comparable,
                                         Serializable {
  public static enum Month {
    JANUARY(1),
    FEBRUARY(2),
    MARCH(3),
    APRIL(4),
    MAY(5),
    JUNE(6),
    JULY(7),
    AUGUST(8),
    SEPTEMBER(9),
    OCTOBER(10),
    NOVEMBER(11),
    DECEMBER(12);

    Month(int index) {
      this.index = index;
    }
    public static Month make(int monthIndex) {
      for (Month m : Month.values()) {
        if (m.index == monthIndex)
          return m;
      }
      throw new IllegalArgumentException("Invalid month index " + monthIndex);
    }
    public final int index;
  }</pre></div></td></tr></tbody></table></div><p><a id="iddle1269" class="indexterm"></a><a id="iddle1490" class="indexterm"></a><a id="iddle1813" class="indexterm"></a><a id="iddle2055" class="indexterm"></a><a id="iddle2116" class="indexterm"></a><a id="iddle2408" class="indexterm"></a>Changing <code class="literal">MonthConstants</code> to this <code class="literal">enum</code> forces quite a few changes to the <code class="literal">DayDate</code> class and all it’s users. It took me an hour to make all the changes. However, any function that used to take an <code class="literal">int</code> for a month, now takes a <code class="literal">Month</code> enumerator. This means we can get rid of the <code class="literal">isValidMonthCode</code> method (line 326), and all the month code error checking such as that in <code class="literal">monthCodeToQuarter</code> (line 356) [G5].</p><p>Next, we have line 91, <code class="literal">serialVersionUID</code>. This variable is used to control the serializer. If we change it, then any <code class="literal">DayDate</code> written with an older version of the software won’t be readable anymore and will result in an <code class="literal">InvalidClassException</code>. If you don’t declare the <code class="literal">serialVersionUID</code> variable, then the compiler automatically generates one for you, and it will be different every time you make a change to the module. I know that all the documents recommend manual control of this variable, but it seems to me that automatic control of serialization is a lot safer [G4]. After all, I’d much rather debug an <code class="literal">InvalidClassException</code> than the odd behavior that would ensue if I forgot to change the <code class="literal">serialVersionUID</code>. So I’m going to delete the variable—at least for the time being.<a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#ftn.ch16fn02" class="footnote" id="ch16fn02"><sup class="footnote">[2]</sup></a></p><p>I find the comment on line 93 redundant. Redundant comments are just places to collect lies and misinformation [C2]. So I’m going to get rid of it and its ilk.</p><p>The comments at line 97 and line 100 talk about serial numbers, which I discussed earlier [C1]. The variables they describe are the earliest and latest possible dates that <code class="literal">DayDate</code> can describe. This can be made a bit clearer [N1].</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col width="550" style="text-align: left" class="c1"></colgroup><tbody><tr><td style="text-align: left" valign="top"><div class="informalexample"><pre class="programlisting">public static final int EARLIEST_DATE_ORDINAL = 2;     // 1/1/1900
public static final int LATEST_DATE_ORDINAL = 2958465; // 12/31/9999</pre></div></td></tr></tbody></table></div><p>It’s not clear to me why <code class="literal">EARLIEST_DATE_ORDINAL</code> is 2 instead of 0. There is a hint in the comment on line 829 that suggests that this has something to do with the way dates are represented in Microsoft Excel. There is a much deeper insight provided in a derivative of <code class="literal">DayDate</code> called <code class="literal">SpreadsheetDate</code> (<a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/apb.html#app02ex05">Listing B-5</a>, page <a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/apb.html#app02ex05">382</a>). The comment on line 71 describes the issue nicely.</p><p>The problem I have with this is that the issue seems to be related to the implementation of <code class="literal">SpreadsheetDate</code> and has nothing to do with <code class="literal">DayDate</code>. I conclude from this that <a id="iddle1010" class="indexterm"></a><a id="iddle1395" class="indexterm"></a><a id="iddle1427" class="indexterm"></a><a id="iddle1544" class="indexterm"></a><a id="iddle2401" class="indexterm"></a><code class="literal">EARLIEST_DATE_ORDINAL</code> and <code class="literal">LATEST_DATE_ORDINAL</code> do not really belong in <code class="literal">DayDate</code> and should be moved to <code class="literal">SpreadsheetDate</code> [G6].</p><p>Indeed, a search of the code shows that these variables are used only within <code class="literal">SpreadsheetDate</code>. Nothing in <code class="literal">DayDate</code>, nor in any other class in the <code class="literal">JCommon</code> framework, uses them. Therefore, I’ll move them down into <code class="literal">SpreadsheetDate</code>.</p><p>The next variables, <code class="literal">MINIMUM_YEAR_SUPPORTED</code>, and <code class="literal">MAXIMUM_YEAR_SUPPORTED</code> (line 104 and line 107), provide something of a dilemma. It seems clear that if <code class="literal">DayDate</code> is an abstract class that provides no foreshadowing of implementation, then it should not inform us about a minimum or maximum year. Again, I am tempted to move these variables down into <code class="literal">SpreadsheetDate</code> [G6]. However, a quick search of the users of these variables shows that one other class uses them: <code class="literal">RelativeDayOfWeekRule</code> (<a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/apb.html#app02ex06">Listing B-6</a>, page <a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/apb.html#app02ex06">390</a>). We see that usage at line 177 and line 178 in the <code class="literal">getDate</code> function, where they are used to check that the argument to <code class="literal">getDate</code> is a valid year. The dilemma is that a user of an abstract class needs information about its implementation.</p><p>What we need to do is provide this information without polluting <code class="literal">DayDate</code> itself. Usually, we would get implementation information from an instance of a derivative. However, the <code class="literal">getDate</code> function is not passed an instance of a <code class="literal">DayDate</code>. It does, however, return such an instance, which means that somewhere it must be creating it. Line 187 through line 205 provide the hint. The <code class="literal">DayDate</code> instance is being created by one of the three functions, <code class="literal">getPreviousDayOfWeek</code>, <code class="literal">getNearestDayOfWeek</code>, or <code class="literal">getFollowingDayOfWeek</code>. Looking back at the <code class="literal">DayDate</code> listing, we see that these functions (lines 638–724) all return a date created by <code class="literal">addDays</code> (line 571), which calls <code class="literal">createInstance</code> (line 808), which creates a <code class="literal">SpreadsheetDate</code>! [G7].</p><p>It’s generally a bad idea for base classes to know about their derivatives. To fix this, we should use the A<span class="smaller">BSTRACT</span> F<span class="smaller">ACTORY</span><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#ftn.ch16fn03" class="footnote" id="ch16fn03"><sup class="footnote">[3]</sup></a> pattern and create a <code class="literal">DayDateFactory</code>. This factory will create the instances of <code class="literal">DayDate</code> that we need and can also answer questions about the implementation, such as the maximum and minimum dates.</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col width="550" style="text-align: left" class="c1"></colgroup><tbody><tr><td style="text-align: left" valign="top"><div class="informalexample"><pre class="programlisting">public abstract class DayDateFactory {
  private static DayDateFactory factory = new SpreadsheetDateFactory();
  public static void setInstance(DayDateFactory factory) {
    DayDateFactory.factory = factory;
  }

  protected abstract DayDate _makeDate(int ordinal);
  protected abstract DayDate _makeDate(int day, DayDate.Month month, int year);
  protected abstract DayDate _makeDate(int day, int month, int year);
  protected abstract DayDate _makeDate(java.util.Date date);
  protected abstract int _getMinimumYear();
  protected abstract int _getMaximumYear();

  public static DayDate makeDate(int ordinal) {
    return factory._makeDate(ordinal);
  }
  public static DayDate makeDate(int day, DayDate.Month month, int year) {
    return factory._makeDate(day, month, year);
  }

  public static DayDate makeDate(int day, int month, int year) {
    return factory._makeDate(day, month, year);
  }

  public static DayDate makeDate(java.util.Date date) {
    return factory._makeDate(date);
  }

  public static int getMinimumYear() {
    return factory._getMinimumYear();
  }

  public static int getMaximumYear() {
    return factory._getMaximumYear();
  }
}</pre></div></td></tr></tbody></table></div><p><a id="iddle1011" class="indexterm"></a><a id="iddle1407" class="indexterm"></a><a id="iddle2165" class="indexterm"></a><a id="iddle2185" class="indexterm"></a>This factory class replaces the <code class="literal">createInstance</code> methods with <code class="literal">makeDate</code> methods, which improves the names quite a bit [N1]. It defaults to a <code class="literal">SpreadsheetDateFactory</code> but can be changed at any time to use a different factory. The static methods that delegate to abstract methods use a combination of the S<span class="smaller">INGLETON</span>,<a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#ftn.ch16fn04" class="footnote" id="ch16fn04"><sup class="footnote">[4]</sup></a> D<span class="smaller">ECORATOR</span>,<a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#ftn.ch16fn05" class="footnote" id="ch16fn05"><sup class="footnote">[5]</sup></a> and A<span class="smaller">BSTRACT</span> F<span class="smaller">ACTORY</span> patterns that I have found to be useful.</p><p>The <code class="literal">SpreadsheetDateFactory</code> looks like this.</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col width="550" style="text-align: left" class="c1"></colgroup><tbody><tr><td style="text-align: left" valign="top"><div class="informalexample"><pre class="programlisting">public class SpreadsheetDateFactory extends DayDateFactory {
  public DayDate _makeDate(int ordinal) {
    return new SpreadsheetDate(ordinal);
  }

  public DayDate _makeDate(int day, DayDate.Month month, int year) {
    return new SpreadsheetDate(day, month, year);
  }

  public DayDate _makeDate(int day, int month, int year) {
    return new SpreadsheetDate(day, month, year);
  }

  public DayDate _makeDate(Date date) {
    final GregorianCalendar calendar = new GregorianCalendar();
    calendar.setTime(date);
    return new SpreadsheetDate(
      calendar.get(Calendar.DATE),
      DayDate.Month.make(calendar.get(Calendar.MONTH) + 1),
      calendar.get(Calendar.YEAR));
  }
  protected int _getMinimumYear() {
    return SpreadsheetDate.MINIMUM_YEAR_SUPPORTED;
  }

  protected int _getMaximumYear() {
    return SpreadsheetDate.MAXIMUM_YEAR_SUPPORTED;
  }
}</pre></div></td></tr></tbody></table></div><p><a id="iddle1270" class="indexterm"></a><a id="iddle1339" class="indexterm"></a><a id="iddle2056" class="indexterm"></a><a id="iddle2245" class="indexterm"></a>As you can see, I have already moved the <code class="literal">MINIMUM_YEAR_SUPPORTED</code> and <code class="literal">MAXIMUM_YEAR_SUPPORTED</code> variables into <code class="literal">SpreadsheetDate</code>, where they belong [G6].</p><p>The next issue in <code class="literal">DayDate</code> are the day constants beginning at line 109. These should really be another enum [J3]. We’ve seen this pattern before, so I won’t repeat it here. You’ll see it in the final listings.</p><p>Next, we see a series of tables starting with <code class="literal">LAST_DAY_OF_MONTH</code> at line 140. My first issue with these tables is that the comments that describe them are redundant [C3]. Their names are sufficient. So I’m going to delete the comments.</p><p>There seems to be no good reason that this table isn’t private [G8], because there is a static function <code class="literal">lastDayOfMonth</code> that provides the same data.</p><p>The next table, <code class="literal">AGGREGATE_DAYS_TO_END_OF_MONTH</code>, is a bit more mysterious because it is not used anywhere in the <code class="literal">JCommon</code> framework [G9]. So I deleted it.</p><p>The same goes for <code class="literal">LEAP_YEAR_AGGREGATE_DAYS_TO_END_OF_MONTH.</code></p><p>The next table, <code class="literal">AGGREGATE_DAYS_TO_END_OF_PRECEDING_MONTH</code>, is used only in <code class="literal">SpreadsheetDate</code> (line 434 and line 473). This begs the question of whether it should be moved to <code class="literal">SpreadsheetDate</code>. The argument for not moving it is that the table is not specific to any particular implementation [G6]. On the other hand, no implementation other than <code class="literal">SpreadsheetDate</code> actually exists, and so the table should be moved close to where it is used [G10].</p><p>What settles the argument for me is that to be consistent [G11], we should make the table private and expose it through a function like <code class="literal">julianDateOfLastDayOfMonth</code>. Nobody seems to need a function like that. Moreover, the table can be moved back to <code class="literal">DayDate</code> easily if any new implementation of <code class="literal">DayDate</code> needs it. So I moved it.</p><p>The same goes for the table, <code class="literal">LEAP_YEAR_AGGREGATE_DAYS_TO_END_OF_MONTH.</code></p><p>Next, we see three sets of constants that can be turned into enums (lines 162–205). The first of the three selects a week within a month. I changed it into an enum named <code class="literal">WeekInMonth</code>.</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col width="550" style="text-align: left" class="c1"></colgroup><tbody><tr><td style="text-align: left" valign="top"><div class="informalexample"><pre class="programlisting">public enum WeekInMonth {
    FIRST(1), SECOND(2), THIRD(3), FOURTH(4), LAST(0);
    public final int index;

    WeekInMonth(int index) {
      this.index = index;
    }
  }</pre></div></td></tr></tbody></table></div><p><a id="iddle1206" class="indexterm"></a><a id="iddle1338" class="indexterm"></a><a id="iddle1411" class="indexterm"></a><a id="iddle1461" class="indexterm"></a><a id="iddle1556" class="indexterm"></a><a id="iddle1658" class="indexterm"></a><a id="iddle1739" class="indexterm"></a><a id="iddle2038" class="indexterm"></a><a id="iddle2142" class="indexterm"></a>The second set of constants (lines 177–187) is a bit more obscure. The <code class="literal">INCLUDE_NONE</code>, <code class="literal">INCLUDE_FIRST</code>, <code class="literal">INCLUDE_SECOND</code>, and <code class="literal">INCLUDE_BOTH</code> constants are used to describe whether the defining end-point dates of a range should be included in that range. Mathematically, this is described using the terms “open interval,” “half-open interval,” and “closed interval.” I think it is clearer using the mathematical nomenclature [N3], so I changed it to an enum named <code class="literal">DateInterval</code> with <code class="literal">CLOSED</code>, <code class="literal">CLOSED_LEFT</code>, <code class="literal">CLOSED_RIGHT</code>, and <code class="literal">OPEN</code> enumerators.</p><p>The third set of constants (lines 18–205) describe whether a search for a particular day of the week should result in the last, next, or nearest instance. Deciding what to call this is difficult at best. In the end, I settled for <code class="literal">WeekdayRange</code> with <code class="literal">LAST</code>, <code class="literal">NEXT</code>, and <code class="literal">NEAREST</code> enumerators.</p><p>You might not agree with the names I’ve chosen. They make sense to me, but they may not make sense to you. The point is that they are now in a form that makes them easy to change [J3]. They aren’t passed as integers anymore; they are passed as symbols. I can use the “change name” function of my IDE to change the names, or the types, without worrying that I missed some <code class="literal">-1</code> or <code class="literal">2</code> somewhere in the code or that some <code class="literal">int</code> argument declaration is left poorly described.</p><p>The description field at line 208 does not seem to be used by anyone. I deleted it along with its accessor and mutator [G9].</p><p>I also deleted the degenerate default constructor at line 213 [G12]. The compiler will generate it for us.</p><p>We can skip over the <code class="literal">isValidWeekdayCode</code> method (lines 216–238) because we deleted it when we created the <code class="literal">Day</code> enumeration.</p><p>This brings us to the <code class="literal">stringToWeekdayCode</code> method (lines 242–270). Javadocs that don’t add much to the method signature are just clutter [C3],[G12]. The only value this Javadoc adds is the description of the <code class="literal">-1</code> return value. However, because we changed to the <code class="literal">Day</code> enumeration, the comment is actually wrong [C2]. The method now throws an <code class="literal">IllegalArgumentException</code>. So I deleted the Javadoc.</p><p>I also deleted all the <code class="literal">final</code> keywords in arguments and variable declarations. As far as I could tell, they added no real value but did add to the clutter [G12]. Eliminating <code class="literal">final</code> flies in the face of some conventional wisdom. For example, Robert Simmons<a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#ftn.ch16fn06" class="footnote" id="ch16fn06"><sup class="footnote">[6]</sup></a> strongly recommends us to “. . . spread <code class="literal">final</code> all over your code.” Clearly I disagree. I think that there are a few good uses for <code class="literal">final</code>, such as the occasional <code class="literal">final</code> constant, but otherwise the keyword adds little value and creates a lot of clutter. Perhaps I feel this way because the kinds of errors that <code class="literal">final</code> might catch are already caught by the unit tests I write.</p><p>I didn’t care for the duplicate <code class="literal">if</code> statements [G5] inside the <code class="literal">for</code> loop (line 259 and line 263), so I connected them into a single <code class="literal">if</code> statement using the <code class="literal">||</code> operator. I also used the <code class="literal">Day</code> enumeration to direct the <code class="literal">for</code> loop and made a few other cosmetic changes.</p><p>It occurred to me that this method does not really belong in <code class="literal">DayDate</code>. It’s really the parse function of <code class="literal">Day</code>. So I moved it into the <code class="literal">Day</code> enumeration. However, that made the <code class="literal">Day</code> <a id="iddle1393" class="indexterm"></a><a id="iddle1492" class="indexterm"></a>enumeration pretty large. Because the concept of <code class="literal">Day</code> does not depend on <code class="literal">DayDate</code>, I moved the <code class="literal">Day</code> enumeration outside of the <code class="literal">DayDate</code> class into its own source file [G13].</p><p>I also moved the next function, <code class="literal">weekdayCodeToString</code> (lines 272–286) into the <code class="literal">Day</code> enumeration and called it <code class="literal">toString</code>.</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col width="550" style="text-align: left" class="c1"></colgroup><tbody><tr><td style="text-align: left" valign="top"><div class="informalexample"><pre class="programlisting">public enum Day {
  MONDAY(Calendar.MONDAY),
  TUESDAY(Calendar.TUESDAY),
  WEDNESDAY(Calendar.WEDNESDAY),s
  THURSDAY(Calendar.THURSDAY),
  FRIDAY(Calendar.FRIDAY),
  SATURDAY(Calendar.SATURDAY),
  SUNDAY(Calendar.SUNDAY);

  public final int index;
  private static DateFormatSymbols dateSymbols = new DateFormatSymbols();

  Day(int day) {
    index = day;
  }

  public static Day make(int index) throws IllegalArgumentException {
    for (Day d : Day.values())
      if (d.index == index)
        return d;
    throw new IllegalArgumentException(
      String.format("Illegal day index: %d.", index));
  }

  public static Day parse(String s) throws IllegalArgumentException {
    String[] shortWeekdayNames =
      dateSymbols.getShortWeekdays();
    String[] weekDayNames =
      dateSymbols.getWeekdays();

    s = s.trim();
    for (Day day : Day.values()) {
      if (s.equalsIgnoreCase(shortWeekdayNames[day.index]) ||
          s.equalsIgnoreCase(weekDayNames[day.index])) {
         return day;
      }
    }
    throw new IllegalArgumentException(
      String.format("%s is not a valid weekday string", s));
  }

  public String toString() {
    return dateSymbols.getWeekdays()[index];
  }
}</pre></div></td></tr></tbody></table></div><p>There are two <code class="literal">getMonths</code> functions (lines 288–316). The first calls the second. The second is never called by anyone but the first. Therefore, I collapsed the two into one and vastly simplified them [G9],[G12],[F4]. Finally, I changed the name to be a bit more self-descriptive [N1].</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col width="550" style="text-align: left" class="c1"></colgroup><tbody><tr><td style="text-align: left" valign="top"><div class="informalexample"><pre class="programlisting">public static String[] getMonthNames() {
  return dateFormatSymbols.getMonths();
}</pre></div></td></tr></tbody></table></div><p><a id="iddle1328" class="indexterm"></a><a id="iddle1554" class="indexterm"></a><a id="iddle1829" class="indexterm"></a><a id="iddle1846" class="indexterm"></a>The <code class="literal">isValidMonthCode</code> function (lines 326–346) was made irrelevant by the <code class="literal">Month</code> enum, so I deleted it [G9].</p><p>The <code class="literal">monthCodeToQuarter</code> function (lines 356–375) smells of F<span class="smaller">EATURE</span> E<span class="smaller">NVY</span><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#ftn.ch16fn07" class="footnote" id="ch16fn07"><sup class="footnote">[7]</sup></a> [G14] and probably belongs in the <code class="literal">Month</code> enum as a method named <code class="literal">quarter</code>. So I replaced it.</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col width="550" style="text-align: left" class="c1"></colgroup><tbody><tr><td style="text-align: left" valign="top"><div class="informalexample"><pre class="programlisting">public int quarter() {
  return 1 + (index-1)/3;
}</pre></div></td></tr></tbody></table></div><p>This made the <code class="literal">Month</code> enum big enough to be in its own class. So I moved it out of <code class="literal">DayDate</code> to be consistent with the <code class="literal">Day</code> enum [G11],[G13].</p><p>The next two methods are named <code class="literal">monthCodeToString</code> (lines 377–426). Again, we see the pattern of one method calling its twin with a flag. It is usually a bad idea to pass a flag as an argument to a function, especially when that flag simply selects the format of the output [G15]. I renamed, simplified, and restructured these functions and moved them into the <code class="literal">Month</code> enum [N1],[N3],[C3],[G14].</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col width="550" style="text-align: left" class="c1"></colgroup><tbody><tr><td style="text-align: left" valign="top"><div class="informalexample"><pre class="programlisting">public String toString() {
  return dateFormatSymbols.getMonths()[index - 1];
}

public String toShortString() {
  return dateFormatSymbols.getShortMonths()[index - 1];
}</pre></div></td></tr></tbody></table></div><p>The next method is <code class="literal">stringToMonthCode</code> (lines 428–472). I renamed it, moved it into the <code class="literal">Month</code> enum, and simplified it [N1],[N3],[C3],[G14],[G12].</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col width="550" style="text-align: left" class="c1"></colgroup><tbody><tr><td style="text-align: left" valign="top"><div class="informalexample"><pre class="programlisting">public static Month parse(String s) {
  s = s.trim();
  for (Month m : Month.values())
    if (m.matches(s))
      return m;

  try {
    return make(Integer.parseInt(s));
  }
  catch (NumberFormatException e) {}
  throw new IllegalArgumentException("Invalid month " + s);
}
private boolean matches(String s) {
  return s.equalsIgnoreCase(toString()) ||
         s.equalsIgnoreCase(toShortString());
}</pre></div></td></tr></tbody></table></div><p><a id="iddle1073" class="indexterm"></a><a id="iddle1598" class="indexterm"></a><a id="iddle2202" class="indexterm"></a><a id="iddle2264" class="indexterm"></a><a id="iddle2396" class="indexterm"></a>The <code class="literal">isLeapYear</code> method (lines 495–517) can be made a bit more expressive [G16].</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col width="550" style="text-align: left" class="c1"></colgroup><tbody><tr><td style="text-align: left" valign="top"><div class="informalexample"><pre class="programlisting">public static boolean isLeapYear(int year) {
  boolean fourth = year % 4 == 0;
  boolean hundredth = year % 100 == 0;
  boolean fourHundredth = year % 400 == 0;
  return fourth &amp;&amp; (!hundredth || fourHundredth);
}</pre></div></td></tr></tbody></table></div><p>The next function, <code class="literal">leapYearCount</code> (lines 519–536) doesn’t really belong in <code class="literal">DayDate</code>. Nobody calls it except for two methods in <code class="literal">SpreadsheetDate</code>. So I pushed it down [G6].</p><p>The <code class="literal">lastDayOfMonth</code> function (lines 538–560) makes use of the <code class="literal">LAST_DAY_OF_MONTH</code> array. This array really belongs in the <code class="literal">Month</code> enum [G17], so I moved it there. I also simplified the function and made it a bit more expressive [G16].</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col width="550" style="text-align: left" class="c1"></colgroup><tbody><tr><td style="text-align: left" valign="top"><div class="informalexample"><pre class="programlisting">public static int lastDayOfMonth(Month month, int year) {
  if (month == Month.FEBRUARY &amp;&amp; isLeapYear(year))
    return month.lastDay() + 1;
   else
    return month.lastDay();
}</pre></div></td></tr></tbody></table></div><p>Now things start to get a bit more interesting. The next function is <code class="literal">addDays</code> (lines 562–576). First of all, because this function operates on the variables of <code class="literal">DayDate</code>, it should not be static [G18]. So I changed it to an instance method. Second, it calls the function <code class="literal">toSerial</code>. This function should be renamed <code class="literal">toOrdinal</code> [N1]. Finally, the method can be simplified.</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col width="550" style="text-align: left" class="c1"></colgroup><tbody><tr><td style="text-align: left" valign="top"><div class="informalexample"><pre class="programlisting">public DayDate addDays(int days) {
  return DayDateFactory.makeDate(toOrdinal() + days);
}</pre></div></td></tr></tbody></table></div><p>The same goes for <code class="literal">addMonths</code> (lines 578–602). It should be an instance method [G18]. The algorithm is a bit complicated, so I used E<span class="smaller">XPLAINING</span> T<span class="smaller">EMPORARY</span> V<span class="smaller">ARIABLES</span><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#ftn.ch16fn08" class="footnote" id="ch16fn08"><sup class="footnote">[8]</sup></a> [G19] to make it more transparent. I also renamed the method <code class="literal">getYYY</code> to <code class="literal">getYear</code> [N1].</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col width="550" style="text-align: left" class="c1"></colgroup><tbody><tr><td style="text-align: left" valign="top"><div class="informalexample"><pre class="programlisting">public DayDate addMonths(int months) {
  int thisMonthAsOrdinal = 12 * getYear() + getMonth().index - 1;
  int resultMonthAsOrdinal = thisMonthAsOrdinal + months;
  int resultYear = resultMonthAsOrdinal / 12;
  Month resultMonth = Month.make(resultMonthAsOrdinal % 12 + 1);
  int lastDayOfResultMonth = lastDayOfMonth(resultMonth, resultYear);
  int resultDay = Math.min(getDayOfMonth(), lastDayOfResultMonth);
  return DayDateFactory.makeDate(resultDay, resultMonth, resultYear);
}</pre></div></td></tr></tbody></table></div><p><a id="iddle1830" class="indexterm"></a>The <code class="literal">addYears</code> function (lines 604–626) provides no surprises over the others.</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col width="550" style="text-align: left" class="c1"></colgroup><tbody><tr><td style="text-align: left" valign="top"><div class="informalexample"><pre class="programlisting">public DayDate plusYears(int years) {
  int resultYear = getYear() + years;
  int lastDayOfMonthInResultYear = lastDayOfMonth(getMonth(), resultYear);
  int resultDay = Math.min(getDayOfMonth(), lastDayOfMonthInResultYear);
  return DayDateFactory.makeDate(resultDay, getMonth(), resultYear);
}</pre></div></td></tr></tbody></table></div><p>There is a little itch at the back of my mind that is bothering me about changing these methods from static to instance. Does the expression <code class="literal">date.addDays(5)</code> make it clear that the <code class="literal">date</code> object does not change and that a new instance of <code class="literal">DayDate</code> is returned? Or does it erroneously imply that we are adding five days to the <code class="literal">date</code> object? You might not think that is a big problem, but a bit of code that looks like the following can be very deceiving [G20].</p><div class="informalexample"><pre class="programlisting">DayDate date = DateFactory.makeDate(5, Month.DECEMBER, 1952);
date.addDays(7); // bump date by one week.</pre></div><p>Someone reading this code would very likely just accept that <code class="literal">addDays</code> is changing the <code class="literal">date</code> object. So we need a name that breaks this ambiguity [N4]. So I changed the names to <code class="literal">plusDays</code> and <code class="literal">plusMonths</code>. It seems to me that the intent of the method is captured nicely by</p><div class="informalexample"><pre class="programlisting">DayDate date = oldDate.plusDays(5);</pre></div><p class="continued">whereas the following doesn’t read fluidly enough for a reader to simply accept that the <code class="literal">date</code> object is changed:</p><div class="informalexample"><pre class="programlisting">date.plusDays(5);</pre></div><p>The algorithms continue to get more interesting. <code class="literal">getPreviousDayOfWeek</code> (lines 628–660) works but is a bit complicated. After some thought about what was really going on [G21], I was able to simplify it and use E<span class="smaller">XPLAINING</span> T<span class="smaller">EMPORARY</span> V<span class="smaller">ARIABLES</span> [G19] to make it clearer. I also changed it from a static method to an instance method [G18], and got rid of the duplicate instance method [G5] (lines 997–1008).</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col width="550" style="text-align: left" class="c1"></colgroup><tbody><tr><td style="text-align: left" valign="top"><div class="informalexample"><pre class="programlisting">public DayDate getPreviousDayOfWeek(Day targetDayOfWeek) {
  int offsetToTarget = targetDayOfWeek.index - getDayOfWeek().index;
  if (offsetToTarget &gt;= 0)
    offsetToTarget -= 7;
  return plusDays(offsetToTarget);
}</pre></div></td></tr></tbody></table></div><p>The exact same analysis and result occurred for <code class="literal">getFollowingDayOfWeek</code> (lines 662–693).</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col width="550" style="text-align: left" class="c1"></colgroup><tbody><tr><td style="text-align: left" valign="top"><div class="informalexample"><pre class="programlisting">public DayDate getFollowingDayOfWeek(Day targetDayOfWeek) {
    int offsetToTarget = targetDayOfWeek.index - getDayOfWeek().index;
    if (offsetToTarget &lt;= 0)
      offsetToTarget += 7;
    return plusDays(offsetToTarget);
  }</pre></div></td></tr></tbody></table></div><p>The next function is <code class="literal">getNearestDayOfWeek</code> (lines 695–726), which we corrected back on page 270. But the changes I made back then aren’t consistent with the current pattern in the last two functions [G11]. So I made it consistent and used some E<span class="smaller">XPLAINING</span> T<span class="smaller">EMPORARY</span> V<span class="smaller">ARIABLES</span> [G19] to clarify the algorithm.</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col width="550" style="text-align: left" class="c1"></colgroup><tbody><tr><td style="text-align: left" valign="top"><div class="informalexample"><pre class="programlisting">public DayDate getNearestDayOfWeek(final Day targetDay) {
    int offsetToThisWeeksTarget = targetDay.index - getDayOfWeek().index;
    int offsetToFutureTarget = (offsetToThisWeeksTarget + 7) % 7;
    int offsetToPreviousTarget = offsetToFutureTarget - 7;

    if (offsetToFutureTarget &gt; 3)
      return plusDays(offsetToPreviousTarget);
    else
      return plusDays(offsetToFutureTarget);
  }</pre></div></td></tr></tbody></table></div><p>The <code class="literal">getEndOfCurrentMonth</code> method (lines 728–740) is a little strange because it is an instance method that envies [G14] its own class by taking a <code class="literal">DayDate</code> argument. I made it a true instance method and clarified a few names.</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col width="550" style="text-align: left" class="c1"></colgroup><tbody><tr><td style="text-align: left" valign="top"><div class="informalexample"><pre class="programlisting">public DayDate getEndOfMonth() {
    Month month = getMonth();
    int year = getYear();
    int lastDay = lastDayOfMonth(month, year);
    return DayDateFactory.makeDate(lastDay, month, year);
  }</pre></div></td></tr></tbody></table></div><p>Refactoring <code class="literal">weekInMonthToString</code> (lines 742–761) turned out to be very interesting indeed. Using the refactoring tools of my IDE, I first moved the method to the <code class="literal">WeekInMonth</code> enum that I created back on page 275. Then I renamed the method to <code class="literal">toString</code>. Next, I changed it from a static method to an instance method. All the tests still passed. (Can you guess where I am going?)</p><p>Next, I deleted the method entirely! Five asserts failed (lines 411–415, <a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/apb.html#app02ex04">Listing B-4</a>, page <a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/apb.html#app02ex04">374</a>). I changed these lines to use the names of the enumerators (<code class="literal">FIRST, SECOND,</code> . . .). All the tests passed. Can you see why? Can you also see why each of these steps was necessary? The refactoring tool made sure that all previous callers of <code class="literal">weekInMonthToString</code> now called <code class="literal">toString</code> on the <code class="literal">weekInMonth</code> enumerator because all enumerators implement <code class="literal">toString</code> to simply return their names. . . .</p><p>Unfortunately, I was a bit too clever. As elegant as that wonderful chain of refactorings was, I finally realized that the only users of this function were the tests I had just modified, so I deleted the tests.</p><p>Fool me once, shame on you. Fool me twice, shame on me! So after determining that nobody other than the tests called <code class="literal">relativeToString</code> (lines 765–781), I simply deleted the function and its tests.</p><p><a id="iddle1014" class="indexterm"></a><a id="iddle1250" class="indexterm"></a><a id="iddle1392" class="indexterm"></a><a id="iddle1417" class="indexterm"></a><a id="iddle1801" class="indexterm"></a>We have finally made it to the abstract methods of this abstract class. And the first one is as appropriate as they come: <code class="literal">toSerial</code> (lines 838–844). Back on page 279 I had changed the name to <code class="literal">toOrdinal</code>. Having looked at it in this context, I decided the name should be changed to <code class="literal">getOrdinalDay</code>.</p><p>The next abstract method is <code class="literal">toDate</code> (lines 838–844). It converts a <code class="literal">DayDate</code> to a <code class="literal">java.util.Date</code>. Why is this method abstract? If we look at its implementation in <code class="literal">SpreadsheetDate</code> (lines 198–207, <a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/apb.html#app02ex05">Listing B-5</a>, page <a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/apb.html#app02ex05">382</a>), we see that it doesn’t depend on anything in the implementation of that class [G6]. So I pushed it up.</p><p>The <code class="literal">getYYYY</code>, <code class="literal">getMonth</code>, and <code class="literal">getDayOfMonth</code> methods are nicely abstract. However, the <code class="literal">getDayOfWeek</code> method is another one that should be pulled up from <code class="literal">SpreadSheetDate</code> because it doesn’t depend on anything that can’t be found in <code class="literal">DayDate</code> [G6]. Or does it?</p><p>If you look carefully (line 247, <a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/apb.html#app02ex05">Listing B-5</a>, page <a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/apb.html#app02ex05">382</a>), you’ll see that the algorithm implicitly depends on the origin of the ordinal day (in other words, the day of the week of day 0). So even though this function has no physical dependencies that couldn’t be moved to <code class="literal">DayDate</code>, it does have a logical dependency.</p><p>Logical dependencies like this bother me [G22]. If something logical depends on the implementation, then something physical should too. Also, it seems to me that the algorithm itself could be generic with a much smaller portion of it dependent on the implementation [G6].</p><p>So I created an abstract method in <code class="literal">DayDate</code> named <code class="literal">getDayOfWeekForOrdinalZero</code> and implemented it in <code class="literal">SpreadsheetDate</code> to return <code class="literal">Day.SATURDAY</code>. Then I moved the <code class="literal">getDayOfWeek</code> method up to <code class="literal">DayDate</code> and changed it to call <code class="literal">getOrdinalDay</code> and <code class="literal">getDayOfWeekForOrdinalZero</code>.</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col width="550" style="text-align: left" class="c1"></colgroup><tbody><tr><td style="text-align: left" valign="top"><div class="informalexample"><pre class="programlisting">public Day getDayOfWeek() {
    Day startingDay = getDayOfWeekForOrdinalZero();
    int startingOffset = startingDay.index - Day.SUNDAY.index;
    return Day.make((getOrdinalDay() + startingOffset) % 7 + 1);
  }</pre></div></td></tr></tbody></table></div><p>As a side note, look carefully at the comment on line 895 through line 899. Was this repetition really necessary? As usual, I deleted this comment along with all the others.</p><p>The next method is <code class="literal">compare</code> (lines 902–913). Again, this method is inappropriately abstract [G6], so I pulled the implementation up into <code class="literal">DayDate</code>. Also, the name does not communicate enough [N1]. This method actually returns the difference in days since the argument. So I changed the name to <code class="literal">daysSince</code>. Also, I noted that there weren’t any tests for this method, so I wrote them.</p><p>The next six functions (lines 915–980) are all abstract methods that should be implemented in <code class="literal">DayDate</code>. So I pulled them all up from <code class="literal">SpreadsheetDate</code>.</p><p>The last function, <code class="literal">isInRange</code> (lines 982–995) also needs to be pulled up and refactored. The <code class="literal">switch</code> statement is a bit ugly [G23] and can be replaced by moving the cases into the <code class="literal">DateInterval</code> enum.</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col width="550" style="text-align: left" class="c1"></colgroup><tbody><tr><td style="text-align: left" valign="top"><div class="informalexample"><pre class="programlisting">public enum DateInterval {
    OPEN {
      public boolean isIn(int d, int left, int right) {
        return d &gt; left &amp;&amp; d &lt; right;
      }
    },
    CLOSED_LEFT {
      public boolean isIn(int d, int left, int right) {
        return d &gt;= left &amp;&amp; d &lt; right;
      }
    },
    CLOSED_RIGHT {
      public boolean isIn(int d, int left, int right) {
        return d &gt; left &amp;&amp; d &lt;= right;
      }
    },
    CLOSED {
      public boolean isIn(int d, int left, int right) {
        return d &gt;= left &amp;&amp; d &lt;= right;
      }
   };

   public abstract boolean isIn(int d, int left, int right);
 }</pre></div></td></tr></tbody></table></div><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col width="550" style="text-align: left" class="c1"></colgroup><tbody><tr><td style="text-align: left" valign="top"><div class="informalexample"><pre class="programlisting">public boolean isInRange(DayDate d1, DayDate d2, DateInterval interval) {
    int left = Math.min(d1.getOrdinalDay(), d2.getOrdinalDay());
    int right = Math.max(d1.getOrdinalDay(), d2.getOrdinalDay());
    return interval.isIn(getOrdinalDay(), left, right);
  }</pre></div></td></tr></tbody></table></div><p>That brings us to the end of <code class="literal">DayDate</code>. So now we’ll make one more pass over the whole class to see how well it flows.</p><p>First, the opening comment is long out of date, so I shortened and improved it [C2].</p><p>Next, I moved all the remaining enums out into their own files [G12].</p><p>Next, I moved the static variable (<code class="literal">dateFormatSymbols</code>) and three static methods (<code class="literal">getMonthNames</code>, <code class="literal">isLeapYear</code>, <code class="literal">lastDayOfMonth</code>) into a new class named <code class="literal">DateUtil</code> [G6].</p><p>I moved the abstract methods up to the top where they belong [G24].</p><p>I changed <code class="literal">Month.make</code> to <code class="literal">Month.fromInt</code> [N1] and did the same for all the other enums. I also created a <code class="literal">toInt()</code> accessor for all the enums and made the <code class="literal">index</code> field private.</p><p>There was some interesting duplication [G5] in <code class="literal">plusYears</code> and <code class="literal">plusMonths</code> that I was able to eliminate by extracting a new method named <code class="literal">correctLastDayOfMonth</code>, making the all three methods much clearer.</p><p>I got rid of the magic number 1 [G25], replacing it with <code class="literal">Month.JANUARY.toInt()</code> or <code class="literal">Day.SUNDAY.toInt()</code>, as appropriate. I spent a little time with <code class="literal">SpreadsheetDate</code>, cleaning up the algorithms a bit. The end result is contained in <a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/apb.html#app02ex07">Listing B-7</a>, page <a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/apb.html#app02ex07">394</a>, through <a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/apb.html#app02ex16">Listing B-16</a>, page <a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/apb.html#app02ex16">405</a>.</p><p><a id="iddle1134" class="indexterm"></a>Interestingly the code coverage in <code class="literal">DayDate</code> has <span class="emphasis"><em>decreased</em></span> to 84.9 percent! This is not because less functionality is being tested; rather it is because the class has shrunk so much that the few uncovered lines have a greater weight. <code class="literal">DayDate</code> now has 45 out of 53 executable statements covered by tests. The uncovered lines are so trivial that they weren’t worth testing.</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="ch16lev1sec3"></a>Conclusion</h1></div></div></div><p>So once again we’ve followed the Boy Scout Rule. We’ve checked the code in a bit cleaner than when we checked it out. It took a little time, but it was worth it. Test coverage was increased, some bugs were fixed, the code was clarified and shrunk. The next person to look at this code will hopefully find it easier to deal with than we did. That person will also probably be able to clean it up a bit more than we did.</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="ch16lev1sec4"></a>Bibliography</h1></div></div></div></div><div class="footnotes"><br><hr><div id="ftn.ch16fn01" class="footnote"><p><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#ch16fn01" class="para"><sup class="para">[1] </sup></a>An even better solution would have been for Javadoc to present all comments as preformatted, so that comments appear the same in both code and document.</p></div><div id="ftn.ch16fn02" class="footnote"><p><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#ch16fn02" class="para"><sup class="para">[2] </sup></a>Several of the reviewers of this text have taken exception to this decision. They contend that in an open source framework it is better to assert manual control over the serial ID so that minor changes to the software don’t cause old serialized dates to be invalid. This is a fair point. However, at least the failure, inconvenient though it might be, has a clear-cut cause. On the other hand, if the author of the class forgets to update the ID, then the failure mode is undefined and might very well be silent. I think the real moral of this story is that you should not expect to deserialize across versions.</p></div><div id="ftn.ch16fn03" class="footnote"><p><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#ch16fn03" class="para"><sup class="para">[3] </sup></a><a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/bi07.html#bib16_01">[GOF]</a>.</p></div><div id="ftn.ch16fn04" class="footnote"><p><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#ch16fn04" class="para"><sup class="para">[4] </sup></a>Ibid.</p></div><div id="ftn.ch16fn05" class="footnote"><p><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#ch16fn05" class="para"><sup class="para">[5] </sup></a>Ibid.</p></div><div id="ftn.ch16fn06" class="footnote"><p><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#ch16fn06" class="para"><sup class="para">[6] </sup></a><a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/bi07.html#bib16_02">[Simmons04]</a>, p. 73.</p></div><div id="ftn.ch16fn07" class="footnote"><p><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#ch16fn07" class="para"><sup class="para">[7] </sup></a><a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/bi07.html#bib16_03">[Refactoring]</a>.</p></div><div id="ftn.ch16fn08" class="footnote"><p><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#ch16fn08" class="para"><sup class="para">[8] </sup></a><a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/bi07.html#bib16_04">[Beck97]</a>.</p></div></div></div><div class="annotator-outer annotator-viewer viewer annotator-hide">
  <ul class="annotator-widget annotator-listing"></ul>
</div><div class="annotator-modal-wrapper annotator-editor-modal annotator-editor annotator-hide">
	<div class="annotator-outer editor">
		<h2 class="title">Highlight</h2>
		<form class="annotator-widget">
			<ul class="annotator-listing">
			<li class="annotator-item"><textarea id="annotator-field-0" placeholder="Add a note using markdown (optional)" class="js-editor" maxlength="750"></textarea></li></ul>
			<div class="annotator-controls">
				<a class="link-to-markdown" href="https://daringfireball.net/projects/markdown/basics" target="_blank">?</a>
				<ul>
					<li class="delete annotator-hide"><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#delete" class="annotator-delete-note button positive">Delete Note</a></li>
					<li class="save"><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#save" class="annotator-save annotator-focus button positive">Save Note</a></li>
					<li class="cancel"><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#cancel" class="annotator-cancel button">Cancel</a></li>
				</ul>
			</div>
		</form>
	</div>
</div><div class="annotator-modal-wrapper annotator-delete-confirm-modal" style="display: none;">
  <div class="annotator-outer">
    <h2 class="title">Highlight</h2>
      <a class="js-close-delete-confirm annotator-cancel close" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#close">Close</a>
      <div class="annotator-widget">
         <div class="delete-confirm">
            Are you sure you want to permanently delete this note?
         </div>
         <div class="annotator-controls">
            <a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#cancel" class="annotator-cancel button js-cancel-delete-confirm">No, I changed my mind</a>
            <a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#delete" class="annotator-delete button positive js-delete-confirm">Yes, delete it</a>
         </div>
       </div>
   </div>
</div><div class="annotator-adder" style="display: none;">
	<ul class="adders ">
		
		<li class="copy"><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#">Copy</a></li>
		
		<li class="add-highlight"><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#">Add Highlight</a></li>
		<li class="add-note"><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#">
			
				Add Note
			
		</a></li>
	</ul>
</div></div></div>



  <div class="t-sbo-prev sbo-prev sbo-nav-bottom">
  
    
      
        <a href="/library/view/clean-code/9780136083238/ch15.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">15. JUnit Internals</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-bottom">
  
    
      
        <a href="/library/view/clean-code/9780136083238/ch17.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">17. Smells and Heuristics</div>
        </a>
    
  
  </div>


      
    </section>
    <div class="reading-controls-bottom">
      <ul class="interface-controls js-bitlist">
        <li class="queue-control">
            <button type="button" class="rec-fav ss-queue js-queue js-current-chapter-queue" data-queue-endpoint="/api/v1/book/9780136083238/chapter/ch16.html" data-for-analytics="9780136083238:ch16.html">
      <span>Add to Queue</span>
  </button>
        </li>
      </ul>
    </div>
  </div>
<section class="sbo-saved-archives"></section>



          
          
  





    
    



        
      </div>
      



  <footer class="pagefoot t-pagefoot">
    <a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#" class="icon-up"><div class="visuallyhidden">Back to top</div></a>
    <ul class="js-footer-nav">
      
        <li><a class="t-recommendations-footer" href="https://www.safaribooksonline.com/r/">Recommended</a></li>
      
      <li><a class="t-queue-footer" href="https://www.safaribooksonline.com/s/">Queue</a></li>
      
        <li><a class="t-recent-footer" href="https://www.safaribooksonline.com/history/">History</a></li>
        <li><a class="t-topics-footer" href="https://www.safaribooksonline.com/topics?q=*&amp;limit=21">Topics</a></li>
      
      
        <li><a class="t-tutorials-footer" href="https://www.safaribooksonline.com/tutorials/">Tutorials</a></li>
      
      <li><a class="t-settings-footer js-settings" href="https://www.safaribooksonline.com/u/">Settings</a></li>
      <li><a href="https://www.safaribooksonline.com/blog/">Blog</a></li>
      <li class="full-support"><a href="https://www.safaribooksonline.com/public/support">Support</a></li>
      <li><a href="https://community.safaribooksonline.com/">Feedback</a></li>
      <li><a href="https://www.safaribooksonline.com/apps/">Get the App</a></li>
      <li><a href="https://www.safaribooksonline.com/accounts/logout/">Sign Out</a></li>
    </ul>
    <span class="copyright">© 2016 <a href="https://www.safaribooksonline.com/" target="_blank">Safari</a>.</span>
    <a href="https://www.safaribooksonline.com/terms/">Terms of Service</a> /
    <a href="https://www.safaribooksonline.com/privacy/">Privacy Policy</a>
  </footer>




    

    
    
  

<div class="annotator-notice"></div><div class="font-flyout"><div class="font-controls-panel">
	<div class="nightmodes">
		<ul>
			<li class="day"><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#" id="day-mode" title="Day Mode">
				<i class="fa fa-sun-o"></i>
				<span>Day Mode</span></a></li>
			<li class="cloudy"><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#" id="cloudy-mode" title="Cloudy Mode">
				<i class="fa fa-cloud"></i>
				<span>Cloud Mode</span>
			</a></li>
			<li class="night"><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#" id="night-mode" title="Night Mode">
				<i class="fa fa-moon-o"></i>
				<span>Night Mode</span>
			</a></li>
		</ul>
	</div>

	<div class="font-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-font left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-font-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-font right"></i>
		</div>
	</div>

	<div class="column-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-compress left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-column-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-expand right"></i>
		</div>
	</div>

	<a id="reset" class="button" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch16.html#">Reset</a>
</div>
</div></body><span class="gr__tooltip"><span class="gr__tooltip-content"></span><i class="gr__tooltip-logo"></i><span class="gr__triangle"></span></span></html>