<!--[if IE]><![endif]--><!DOCTYPE html><!--[if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage"" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/clean-code/9780136083238/ch13.html"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="859452"
  data-user-uuid="4d373bec-fada-4717-9823-769db3ed3a36"
  data-username="dchen267"
  data-account-type="B2B"
  
  data-activated-trial-date="04/25/2016"


  data-archive="9780136083238"
  data-publishers="Prentice Hall"



  data-htmlfile-name="ch13.html"
  data-epub-title="Clean Code" data-debug=0 data-testing=0><![endif]--><!--[if gt IE 8]><!--><html class=" js flexbox flexboxlegacy no-touch websqldatabase indexeddb history csscolumns csstransforms localstorage sessionstorage applicationcache svg inlinesvg zoom gr__safaribooksonline_com" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#" itemscope="" itemtype="http://schema.org/Book http://schema.org/ItemPage" "="" data-login-url="/accounts/login/" data-offline-url="/" data-url="/library/view/clean-code/9780136083238/ch13.html" data-csrf-cookie="csrfsafari" data-highlight-privacy="" data-user-id="859452" data-user-uuid="4d373bec-fada-4717-9823-769db3ed3a36" data-username="dchen267" data-account-type="B2B" data-activated-trial-date="04/25/2016" data-archive="9780136083238" data-publishers="Prentice Hall" data-htmlfile-name="ch13.html" data-epub-title="Clean Code" data-debug="0" data-testing="0"><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="Safari Books Online"><meta name="format-detection" content="telephone=no"><meta http-equiv="cleartype" content="on"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="apple-itunes-app" content="app-id=881697395, app-argument=safaridetail://9780136083238"><meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0"><meta property="twitter:account_id" content="4503599627559754"><link rel="apple-touch-icon" href="https://www.safaribooksonline.com/static/images/apple-touch-icon.8cc2fd27400e.png"><link rel="shortcut icon" href="https://www.safaribooksonline.com/favicon.ico" type="image/x-icon"><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700,900,200italic,300italic,400italic,600italic,700italic,900italic" rel="stylesheet" type="text/css"><title>13. Concurrency - Clean Code</title><link rel="stylesheet" href="https://www.safaribooksonline.com/static/CACHE/css/e4b0fef39b55.css" type="text/css"><link rel="stylesheet" type="text/css" href="https://www.safaribooksonline.com/static/css/annotator.min.fd58f69f4908.css"><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css"><style type="text/css" title="ibis-book"></style><link rel="canonical" href="/library/view/clean-code/9780136083238/ch13.html"><meta name="description" content="Chapter&nbsp;13.&nbsp;Concurrency <authorgroup>by Brett L. Schuchert</authorgroup> &nbsp; “Objects are abstractions of processing. Threads are abstractions of schedule.” &nbsp; &nbsp; --James O. Coplien[1] Writing clean concurrent programs is hard—very hard ... "><meta property="og:title" content="13. Concurrency"><meta itemprop="isPartOf" content="/library/view/clean-code/9780136083238/"><meta itemprop="name" content="13. Concurrency"><meta property="og:url" itemprop="url" content="https://www.safaribooksonline.com/library/view/clean-code/9780136083238/ch13.html"><meta property="og:site_name" content="Safari"><meta property="og:image" itemprop="thumbnailUrl" content="https://www.safaribooksonline.com/library/cover/9780136083238/"><meta property="og:description" itemprop="description" content="Chapter&nbsp;13.&nbsp;Concurrency <authorgroup>by Brett L. Schuchert</authorgroup> &nbsp; “Objects are abstractions of processing. Threads are abstractions of schedule.” &nbsp; &nbsp; --James O. Coplien[1] Writing clean concurrent programs is hard—very hard ... "><meta itemprop="inLanguage" content="en"><meta itemprop="publisher" content="Prentice Hall"><meta property="og:type" content="book"><meta property="og:book:isbn" itemprop="isbn" content="9780136083238"><meta property="og:book:author" itemprop="author" content="Robert C. Martin"><meta property="og:book:tag" itemprop="about" content="Agile"><meta property="og:book:tag" itemprop="about" content="Core Programming"><meta property="og:book:tag" itemprop="about" content="Lean"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@safari"><style type="text/css" id="font-styles" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-size: <%= font_size %> !important; }"></style><style type="text/css" id="font-family" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-family: <%= font_family %> !important; }"></style><style type="text/css" id="column-width" data-template="#sbo-rt-content { max-width: <%= column_width %>% !important; margin: 0 auto !important; }"></style><!--[if lt IE 9]><script src="/static/js/src/respond.min.cf5c9b7980e5.js"></script><![endif]--><style id="annotator-dynamic-style">.annotator-adder, .annotator-outer, .annotator-notice {
  z-index: 100019;
}
.annotator-filter {
  z-index: 100009;
}</style></head>


<body class="reading sidenav nav-collapsed  scalefonts library" data-gr-c-s-loaded="true">

    
      <div class="hide working" role="status">
        <div class="working-image"></div>
      </div>
      <div class="sbo-site-nav">
        




<a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#container" class="skip">Skip to content</a><header class="topbar t-topbar"><nav role="navigation" class="js-site-nav"><ul class="topnav"><li class="t-logo"><a href="https://www.safaribooksonline.com/home/" class="l0 None safari-home nav-icn js-keyboard-nav-home"><svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" version="1.1" fill="#4A3C31"><desc>Safari Home Icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M4 9.9L4 9.9 4 18 16 18 16 9.9 10 4 4 9.9ZM2.6 8.1L2.6 8.1 8.7 1.9 10 0.5 11.3 1.9 17.4 8.1 18 8.7 18 9.5 18 18.1 18 20 16.1 20 3.9 20 2 20 2 18.1 2 9.5 2 8.7 2.6 8.1Z"></path><rect x="10" y="12" width="3" height="7"></rect><rect transform="translate(18.121320, 10.121320) rotate(-315.000000) translate(-18.121320, -10.121320) " x="16.1" y="9.1" width="4" height="2"></rect><rect transform="translate(2.121320, 10.121320) scale(-1, 1) rotate(-315.000000) translate(-2.121320, -10.121320) " x="0.1" y="9.1" width="4" height="2"></rect></g></svg><span>Safari Home</span></a></li><li><a href="https://www.safaribooksonline.com/r/" class="t-recommendations-nav l0 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" version="1.1" fill="#4A3C31"><desc>recommendations icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M50 25C50 18.2 44.9 12.5 38.3 11.7 37.5 5.1 31.8 0 25 0 18.2 0 12.5 5.1 11.7 11.7 5.1 12.5 0 18.2 0 25 0 31.8 5.1 37.5 11.7 38.3 12.5 44.9 18.2 50 25 50 31.8 50 37.5 44.9 38.3 38.3 44.9 37.5 50 31.8 50 25ZM25 3.1C29.7 3.1 33.6 6.9 34.4 11.8 30.4 12.4 26.9 15.1 25 18.8 23.1 15.1 19.6 12.4 15.6 11.8 16.4 6.9 20.3 3.1 25 3.1ZM34.4 15.6C33.6 19.3 30.7 22.2 27.1 22.9 27.8 19.2 30.7 16.3 34.4 15.6ZM22.9 22.9C19.2 22.2 16.3 19.3 15.6 15.6 19.3 16.3 22.2 19.2 22.9 22.9ZM3.1 25C3.1 20.3 6.9 16.4 11.8 15.6 12.4 19.6 15.1 23.1 18.8 25 15.1 26.9 12.4 30.4 11.8 34.4 6.9 33.6 3.1 29.7 3.1 25ZM22.9 27.1C22.2 30.7 19.3 33.6 15.6 34.4 16.3 30.7 19.2 27.8 22.9 27.1ZM25 46.9C20.3 46.9 16.4 43.1 15.6 38.2 19.6 37.6 23.1 34.9 25 31.3 26.9 34.9 30.4 37.6 34.4 38.2 33.6 43.1 29.7 46.9 25 46.9ZM27.1 27.1C30.7 27.8 33.6 30.7 34.4 34.4 30.7 33.6 27.8 30.7 27.1 27.1ZM38.2 34.4C37.6 30.4 34.9 26.9 31.3 25 34.9 23.1 37.6 19.6 38.2 15.6 43.1 16.4 46.9 20.3 46.9 25 46.9 29.7 43.1 33.6 38.2 34.4Z" fill="currentColor"></path></g></svg><span>Recommended</span></a></li><li><a href="https://www.safaribooksonline.com/s/" class="t-queue-nav l0 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" version="1.1" fill="#4A3C31"><desc>queue icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 29.2C25.4 29.2 25.8 29.1 26.1 28.9L48.7 16.8C49.5 16.4 50 15.5 50 14.6 50 13.7 49.5 12.8 48.7 12.4L26.1 0.3C25.4-0.1 24.6-0.1 23.9 0.3L1.3 12.4C0.5 12.8 0 13.7 0 14.6 0 15.5 0.5 16.4 1.3 16.8L23.9 28.9C24.2 29.1 24.6 29.2 25 29.2ZM7.3 14.6L25 5.2 42.7 14.6 25 24 7.3 14.6ZM48.7 22.4L47.7 21.9 25 34.2 2.3 21.9 1.3 22.4C0.5 22.9 0 23.7 0 24.7 0 25.6 0.5 26.5 1.3 26.9L23.9 39.3C24.2 39.5 24.6 39.6 25 39.6 25.4 39.6 25.8 39.5 26.1 39.3L48.7 26.9C49.5 26.5 50 25.6 50 24.7 50 23.7 49.5 22.9 48.7 22.4ZM48.7 32.8L47.7 32.3 25 44.6 2.3 32.3 1.3 32.8C0.5 33.3 0 34.1 0 35.1 0 36 0.5 36.9 1.3 37.3L23.9 49.7C24.2 49.9 24.6 50 25 50 25.4 50 25.8 49.9 26.1 49.7L48.7 37.3C49.5 36.9 50 36 50 35.1 50 34.1 49.5 33.3 48.7 32.8Z" fill="currentColor"></path></g></svg><span>Queue</span></a></li><li class="search"><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#" class="t-search-nav trigger nav-icn l0" data-dropdown-selector=".searchbox"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" version="1.1" fill="#4A3C31"><desc>search icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M31.3 0C20.9 0 12.5 8.4 12.5 18.8 12.5 22.5 13.6 25.9 15.4 28.8L1.2 42.9C-0.4 44.5-0.4 47.2 1.2 48.8 2 49.6 3.1 50 4.2 50 5.2 50 6.3 49.6 7.1 48.8L21.2 34.6C24.1 36.5 27.5 37.5 31.3 37.5 41.6 37.5 50 29.1 50 18.8 50 8.4 41.6 0 31.3 0ZM31.3 31.3C24.4 31.3 18.8 25.6 18.8 18.8 18.8 11.9 24.4 6.3 31.3 6.3 38.1 6.3 43.8 11.9 43.8 18.8 43.8 25.6 38.1 31.3 31.3 31.3Z" fill="currentColor"></path></g></svg><span>Search</span></a></li><li class="usermenu dropdown"><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#" class="trigger l0 nav-icn nav-dropdown"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" version="1.1" fill="#4A3C31"><desc>navigation arrow</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M0.1 12.5L9.7 3.1C9.8 3 9.9 3 10 3 10.1 3 10.2 3 10.3 3.1L19.9 12.5C20 12.5 20 12.6 20 12.8 20 12.9 20 13 19.9 13L17 15.9C16.9 16 16.8 16 16.7 16 16.5 16 16.4 16 16.4 15.9L10 9.7 3.6 15.9C3.6 16 3.5 16 3.3 16 3.2 16 3.1 16 3 15.9L0.1 13C0 12.9 0 12.8 0 12.7 0 12.7 0 12.6 0.1 12.5Z"></path></g></svg><span>Expand Nav</span></a><div class="drop-content"><ul><li><a href="https://www.safaribooksonline.com/history/" class="t-recent-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" version="1.1" fill="#4A3C31"><desc>recent items icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 0C11.2 0 0 11.2 0 25 0 38.8 11.2 50 25 50 38.8 50 50 38.8 50 25 50 11.2 38.8 0 25 0ZM6.3 25C6.3 14.6 14.6 6.3 25 6.3 35.4 6.3 43.8 14.6 43.8 25 43.8 35.4 35.4 43.8 25 43.8 14.6 43.8 6.3 35.4 6.3 25ZM31.8 31.5C32.5 30.5 32.4 29.2 31.6 28.3L27.1 23.8 27.1 12.8C27.1 11.5 26.2 10.4 25 10.4 23.9 10.4 22.9 11.5 22.9 12.8L22.9 25.7 28.8 31.7C29.2 32.1 29.7 32.3 30.2 32.3 30.8 32.3 31.3 32 31.8 31.5Z" fill="currentColor"></path></g></svg><span>History</span></a></li><li><a href="https://www.safaribooksonline.com/topics" class="t-topics-link l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 55" version="1.1" fill="#4A3C31"><desc>topics icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 55L50 41.262 50 13.762 25 0 0 13.762 0 41.262 25 55ZM8.333 37.032L8.333 17.968 25 8.462 41.667 17.968 41.667 37.032 25 46.538 8.333 37.032Z" fill="currentColor"></path></g></svg><span>Topics</span></a></li><li><a href="https://www.safaribooksonline.com/tutorials/" class="l1 nav-icn t-tutorials-nav js-toggle-menu-item None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" version="1.1" fill="#4A3C31"><desc>tutorials icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M15.8 18.2C15.8 18.2 15.9 18.2 16 18.2 16.1 18.2 16.2 18.2 16.4 18.2 16.5 18.2 16.7 18.1 16.9 18 17 17.9 17.1 17.8 17.2 17.7 17.3 17.6 17.4 17.5 17.4 17.4 17.5 17.2 17.6 16.9 17.6 16.7 17.6 16.6 17.6 16.5 17.6 16.4 17.5 16.2 17.5 16.1 17.4 15.9 17.3 15.8 17.2 15.6 17 15.5 16.8 15.3 16.6 15.3 16.4 15.2 16.2 15.2 16 15.2 15.8 15.2 15.7 15.2 15.5 15.3 15.3 15.4 15.2 15.4 15.1 15.5 15 15.7 14.9 15.8 14.8 15.9 14.7 16 14.7 16.1 14.6 16.3 14.6 16.4 14.6 16.5 14.6 16.6 14.6 16.6 14.6 16.7 14.6 16.9 14.6 17 14.6 17.1 14.7 17.3 14.7 17.4 14.8 17.6 15 17.7 15.1 17.9 15.2 18 15.3 18 15.5 18.1 15.5 18.1 15.6 18.2 15.7 18.2 15.7 18.2 15.7 18.2 15.8 18.2L15.8 18.2ZM9.4 11.5C9.5 11.5 9.5 11.5 9.6 11.5 9.7 11.5 9.9 11.5 10 11.5 10.2 11.5 10.3 11.4 10.5 11.3 10.6 11.2 10.8 11.1 10.9 11 10.9 10.9 11 10.8 11.1 10.7 11.2 10.5 11.2 10.2 11.2 10 11.2 9.9 11.2 9.8 11.2 9.7 11.2 9.5 11.1 9.4 11 9.2 10.9 9.1 10.8 8.9 10.6 8.8 10.5 8.7 10.3 8.6 10 8.5 9.9 8.5 9.7 8.5 9.5 8.5 9.3 8.5 9.1 8.6 9 8.7 8.8 8.7 8.7 8.8 8.6 9 8.5 9.1 8.4 9.2 8.4 9.3 8.2 9.5 8.2 9.8 8.2 10 8.2 10.1 8.2 10.2 8.2 10.3 8.2 10.5 8.3 10.6 8.4 10.7 8.5 10.9 8.6 11.1 8.7 11.2 8.9 11.3 9 11.4 9.1 11.4 9.2 11.4 9.3 11.5 9.3 11.5 9.3 11.5 9.4 11.5 9.4 11.5L9.4 11.5ZM3 4.8C3.1 4.8 3.1 4.8 3.2 4.8 3.4 4.8 3.5 4.8 3.7 4.8 3.8 4.8 4 4.7 4.1 4.6 4.3 4.5 4.4 4.4 4.5 4.3 4.6 4.2 4.6 4.1 4.7 4 4.8 3.8 4.8 3.5 4.8 3.3 4.8 3.1 4.8 3 4.8 2.9 4.7 2.8 4.7 2.6 4.6 2.5 4.5 2.3 4.4 2.2 4.2 2.1 4 1.9 3.8 1.9 3.6 1.8 3.5 1.8 3.3 1.8 3.1 1.8 2.9 1.8 2.7 1.9 2.6 2 2.4 2.1 2.3 2.2 2.2 2.3 2.1 2.4 2 2.5 2 2.6 1.8 2.8 1.8 3 1.8 3.3 1.8 3.4 1.8 3.5 1.8 3.6 1.8 3.8 1.9 3.9 2 4 2.1 4.2 2.2 4.4 2.4 4.5 2.5 4.6 2.6 4.7 2.7 4.7 2.8 4.7 2.9 4.8 2.9 4.8 3 4.8 3 4.8 3 4.8L3 4.8ZM13.1 15.2C13.2 15.1 13.2 15.1 13.2 15.1 13.3 14.9 13.4 14.7 13.6 14.5 13.8 14.2 14.1 14 14.4 13.8 14.7 13.6 15.1 13.5 15.5 13.4 15.9 13.4 16.3 13.4 16.7 13.5 17.2 13.5 17.6 13.7 17.9 13.9 18.2 14.1 18.5 14.4 18.7 14.7 18.9 15 19.1 15.3 19.2 15.6 19.3 15.9 19.4 16.1 19.4 16.4 19.4 17 19.3 17.5 19.1 18.1 19 18.3 18.9 18.5 18.7 18.7 18.5 19 18.3 19.2 18 19.4 17.7 19.6 17.3 19.8 16.9 19.9 16.6 20 16.3 20 16 20 15.8 20 15.6 20 15.4 19.9 15.4 19.9 15.4 19.9 15.4 19.9 15.2 19.9 15 19.8 14.9 19.8 14.8 19.7 14.7 19.7 14.6 19.7 14.4 19.6 14.3 19.5 14.1 19.3 13.7 19.1 13.4 18.7 13.2 18.4 13.1 18.1 12.9 17.8 12.9 17.5 12.8 17.3 12.8 17.1 12.8 16.9L3.5 14.9C3.3 14.9 3.1 14.8 3 14.8 2.7 14.7 2.4 14.5 2.1 14.3 1.7 14 1.4 13.7 1.2 13.3 1 13 0.9 12.6 0.8 12.3 0.7 12 0.7 11.7 0.7 11.4 0.7 11 0.8 10.5 1 10.1 1.1 9.8 1.3 9.5 1.6 9.2 1.8 8.9 2.1 8.7 2.4 8.5 2.8 8.3 3.2 8.1 3.6 8.1 3.9 8 4.2 8 4.5 8 4.6 8 4.8 8 4.9 8.1L6.8 8.5C6.8 8.4 6.8 8.4 6.8 8.4 6.9 8.2 7.1 8 7.2 7.8 7.5 7.5 7.7 7.3 8 7.1 8.4 6.9 8.7 6.8 9.1 6.7 9.5 6.7 10 6.7 10.4 6.8 10.8 6.8 11.2 7 11.5 7.2 11.8 7.5 12.1 7.7 12.4 8 12.6 8.3 12.7 8.6 12.8 8.9 12.9 9.2 13 9.4 13 9.7 13 9.7 13 9.8 13 9.8 13.6 9.9 14.2 10.1 14.9 10.2 15 10.2 15 10.2 15.1 10.2 15.3 10.2 15.4 10.2 15.6 10.2 15.8 10.1 16 10 16.2 9.9 16.4 9.8 16.5 9.6 16.6 9.5 16.8 9.2 16.9 8.8 16.9 8.5 16.9 8.3 16.9 8.2 16.8 8 16.8 7.8 16.7 7.7 16.6 7.5 16.5 7.3 16.3 7.2 16.2 7.1 16 7 15.9 6.9 15.8 6.9 15.7 6.9 15.6 6.8 15.5 6.8L6.2 4.8C6.2 5 6 5.2 5.9 5.3 5.7 5.6 5.5 5.8 5.3 6 4.9 6.2 4.5 6.4 4.1 6.5 3.8 6.6 3.5 6.6 3.2 6.6 3 6.6 2.8 6.6 2.7 6.6 2.6 6.6 2.6 6.5 2.6 6.5 2.5 6.5 2.3 6.5 2.1 6.4 1.8 6.3 1.6 6.1 1.3 6 1 5.7 0.7 5.4 0.5 5 0.3 4.7 0.2 4.4 0.1 4.1 0 3.8 0 3.6 0 3.3 0 2.8 0.1 2.2 0.4 1.7 0.5 1.5 0.7 1.3 0.8 1.1 1.1 0.8 1.3 0.6 1.6 0.5 2 0.3 2.3 0.1 2.7 0.1 3.1 0 3.6 0 4 0.1 4.4 0.2 4.8 0.3 5.1 0.5 5.5 0.8 5.7 1 6 1.3 6.2 1.6 6.3 1.9 6.4 2.3 6.5 2.5 6.6 2.7 6.6 3 6.6 3 6.6 3.1 6.6 3.1 9.7 3.8 12.8 4.4 15.9 5.1 16.1 5.1 16.2 5.2 16.4 5.2 16.7 5.3 16.9 5.5 17.2 5.6 17.5 5.9 17.8 6.2 18.1 6.5 18.3 6.8 18.4 7.2 18.6 7.5 18.6 7.9 18.7 8.2 18.7 8.6 18.7 9 18.6 9.4 18.4 9.8 18.3 10.1 18.2 10.3 18 10.6 17.8 10.9 17.5 11.1 17.3 11.3 16.9 11.6 16.5 11.8 16 11.9 15.7 12 15.3 12 15 12 14.8 12 14.7 12 14.5 11.9 13.9 11.8 13.3 11.7 12.6 11.5 12.5 11.7 12.4 11.9 12.3 12 12.1 12.3 11.9 12.5 11.7 12.7 11.3 12.9 10.9 13.1 10.5 13.2 10.2 13.3 9.9 13.3 9.6 13.3 9.4 13.3 9.2 13.3 9 13.2 9 13.2 9 13.2 9 13.2 8.8 13.2 8.7 13.2 8.5 13.1 8.2 13 8 12.8 7.7 12.6 7.4 12.4 7.1 12 6.8 11.7 6.7 11.4 6.6 11.1 6.5 10.8 6.4 10.6 6.4 10.4 6.4 10.2 5.8 10.1 5.2 9.9 4.5 9.8 4.4 9.8 4.4 9.8 4.3 9.8 4.1 9.8 4 9.8 3.8 9.8 3.6 9.9 3.4 10 3.2 10.1 3 10.2 2.9 10.4 2.8 10.5 2.6 10.8 2.5 11.1 2.5 11.5 2.5 11.6 2.5 11.8 2.6 12 2.6 12.1 2.7 12.3 2.8 12.5 2.9 12.6 3.1 12.8 3.2 12.9 3.3 13 3.5 13.1 3.6 13.1 3.7 13.1 3.8 13.2 3.9 13.2L13.1 15.2 13.1 15.2Z" fill="currentColor"></path></g></svg><span>Tutorials</span></a></li><li class="nav-offers flyout-parent"><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#" class="l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 50 50" version="1.1" fill="#4A3C31"><desc>offers icon</desc><path d="M10.8 43.7L0 39 0 10.2 13.6 4.6 23.3 8.7 11.5 13.5C11 13.6 10.8 13.9 10.8 14.3L10.8 43.7 10.8 43.7Z"></path><polygon points="12.3 44.4 25 50 38 44.3 38 14.7 25.2 9.4 12.3 14.7 12.3 44.4"></polygon><path d="M36.6 4.7L50 10.2 50 39 39.5 43.6 39.5 14.3C39.5 13.8 39.2 13.6 38.8 13.5L27 8.7 36.6 4.7 36.6 4.7Z"></path><polygon points="34.8 4 25 0 15.4 3.9 25.2 7.9 34.8 4"></polygon></svg><span>Offers</span></a><ul class="flyout"><li><a href="https://www.safaribooksonline.com/oreilly-conferences/" class="l2 nav-icn"><span>Conferences</span></a></li><li><a href="https://www.safaribooksonline.com/oreilly-newsletters/" class="l2 nav-icn"><span>Newsletter</span></a></li></ul></li><li class="nav-highlights"><a href="https://www.safaribooksonline.com/u/003o000000t5q9fAAA/" class="t-highlights-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 35" version="1.1" fill="#4A3C31"><desc>highlights icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M13.325 18.071L8.036 18.071C8.036 11.335 12.36 7.146 22.5 5.594L22.5 0C6.37 1.113 0 10.632 0 22.113 0 29.406 3.477 35 10.403 35 15.545 35 19.578 31.485 19.578 26.184 19.578 21.556 17.211 18.891 13.325 18.071L13.325 18.071ZM40.825 18.071L35.565 18.071C35.565 11.335 39.86 7.146 50 5.594L50 0C33.899 1.113 27.5 10.632 27.5 22.113 27.5 29.406 30.977 35 37.932 35 43.045 35 47.078 31.485 47.078 26.184 47.078 21.556 44.74 18.891 40.825 18.071L40.825 18.071Z" fill="currentColor"></path></g></svg><span>Highlights</span></a></li><li><a href="https://www.safaribooksonline.com/u/" class="t-settings-nav l1 js-settings nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z" fill="currentColor"></path></g></svg><span>Settings</span></a></li><li><a href="https://community.safaribooksonline.com/" class="l1 no-icon">Feedback</a></li><li><a href="https://www.safaribooksonline.com/accounts/logout/" class="l1 no-icon">Sign Out</a></li></ul><ul class="profile"><li><a href="https://www.safaribooksonline.com/u/" class="l2 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z" fill="currentColor"></path></g></svg><span>Settings</span></a></li><li><a href="https://community.safaribooksonline.com/" class="l2">Feedback</a></li><li><a href="https://www.safaribooksonline.com/accounts/logout/" class="l2">Sign Out</a></li></ul></div></li></ul></nav></header>


      </div>
      <div id="container" class="application">
        
          <div class="nav-container clearfix">
            


            
            
          </div>

          

  <div class="js-toc">
    
      <div class="sbo-reading-menu sbo-menu-top"><section class="sbo-toc-container toc-menu"><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#" class="sbo-toc-thumb"><span class="sbo-title ss-list"><h1><div class="visuallyhidden">Table of Contents for </div>
      
      Clean Code
      
    </h1></span></a><div class="toc-contents"></div></section></div>

    

    <div class="interface-controls interface-controls-top">
      <ul class="interface-control-btns js-bitlist js-reader">
        <li class="js-search-in-archive search-in-archive t-search-in-archive"><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#" title="Search in archive" class="js-search-controls search-controls"><span class="icon">Search in book...</span></a><form class="search-archive-bar js-search-form"><input type="search" name="query" placeholder="Search inside this book..." autocomplete="off"></form><div class="search-archive-results"><div class="js-sitb-results-region"></div></div></li><li class="queue-control"><button type="button" class="rec-fav ss-queue js-queue js-current-chapter-queue" data-queue-endpoint="/api/v1/book/9780136083238/chapter/ch13.html" data-for-analytics="9780136083238:ch13.html"><span>Add to Queue</span></button></li><li class="js-font-control-panel font-control-activator"><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#" data-push-state="false" id="font-controls" title="Change font size" aria-label="Change font size"><span class="icon">Toggle Font Controls</span></a></li><li class="dropdown sharing-controls"><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#" class="trigger" data-push-state="false" title="Share" aria-label="Share"><i class="fa fa-share"></i></a><ul class="social-sharing dropdown-menu"><li><a class="twitter share-button t-twitter" target="_blank" aria-label="Share this section on Twitter" title="Share this section on Twitter" href="https://twitter.com/share?url=https://www.safaribooksonline.com/library/view/clean-code/9780136083238/ch13.html&amp;text=Clean%20Code&amp;via=safari"><span>Twitter</span></a></li><li><a class="facebook share-button t-facebook" target="_blank" aria-label="Share this section on Facebook" title="Share this section on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://www.safaribooksonline.com/library/view/clean-code/9780136083238/ch13.html"><span>Facebook</span></a></li><li><a class="googleplus share-button t-googleplus" target="_blank" aria-label="Share this secton on Google Plus" title="Share this secton on Google Plus" href="https://plus.google.com/share?url=https://www.safaribooksonline.com/library/view/clean-code/9780136083238/ch13.html"><span>Google Plus</span></a></li><li><a class="email share-button t-email" aria-label="Share this section via email" title="Share this section via email" href="mailto:?subject=Safari:%2013.%20Concurrency&amp;body=https://www.safaribooksonline.com/library/view/clean-code/9780136083238/ch13.html%0D%0Afrom%20Clean%20Code%0D%0A"><span>Email</span></a></li></ul></li>
      </ul>
    </div>

    <section role="document">
      
	  <div class="t-sbo-prev sbo-prev sbo-nav-top">
  
    
      
        <a href="/library/view/clean-code/9780136083238/ch12.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">12. Emergence</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-top">
  
    
      
        <a href="/library/view/clean-code/9780136083238/ch14.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">14. Successive Refinement</div>
        </a>
    
  
  </div>



<div id="sbo-rt-content"><div class="annotator-wrapper"><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="ch13"></a>Chapter&nbsp;13.&nbsp;Concurrency</h1></div></div></div><span style="color: red">&lt;authorgroup&gt;by Brett L. Schuchert&lt;/authorgroup&gt;</span><div class="mediaobject"><a id="f177fig01"></a><img src="https://www.safaribooksonline.com/library/view/clean-code/9780136083238/graphics/13_1fig_martin.jpg" width="160" alt="Concurrency" height="254" data-mfp-src="/library/view/clean-code/9780136083238/graphics/13_1fig_martin.jpg"></div><div class="blockquote"><table border="0" class="blockquote" summary="Block quote"><tbody><tr><td valign="top">&nbsp;</td><td valign="top"><p><span class="italic">“Objects are abstractions of processing. Threads are abstractions of schedule.”</span></p></td><td valign="top">&nbsp;</td></tr><tr><td valign="top">&nbsp;</td><td colspan="2" align="right" valign="top">--<span class="attribution">James O. Coplien<a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ftn.ch13fn01" class="footnote" id="ch13fn01"><sup class="footnote">[1]</sup></a></span></td></tr></tbody></table></div><p><a id="iddle1299" class="indexterm"></a><a id="iddle1306" class="indexterm"></a><a id="iddle1318" class="indexterm"></a><a id="iddle1410" class="indexterm"></a><a id="iddle2124" class="indexterm"></a><a id="iddle2416" class="indexterm"></a><a id="iddle2417" class="indexterm"></a>Writing clean concurrent programs is hard—very hard. It is much easier to write code that executes in a single thread. It is also easy to write multithreaded code that looks fine on the surface but is broken at a deeper level. Such code works fine until the system is placed under stress.</p><p>In this chapter we discuss the need for concurrent programming, and the difficulties it presents. We then present several recommendations for dealing with those difficulties, and writing clean concurrent code. Finally, we conclude with issues related to testing concurrent code.</p><p>Clean Concurrency is a complex topic, worthy of a book by itself. Our strategy in <span class="emphasis"><em>this</em></span> book is to present an overview here and provide a more detailed tutorial in “<a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/apa.html">Concurrency II</a>” on page <a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/apa.html">317</a>. If you are just curious about concurrency, then this chapter will suffice for you now. If you have a need to understand concurrency at a deeper level, then you should read through the tutorial as well.</p><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lev1sec1"></a>Why Concurrency?</h1></div></div></div><p>Concurrency is a decoupling strategy. It helps us decouple <span class="emphasis"><em>what</em></span> gets done from <span class="emphasis"><em>when</em></span> it gets done. In single-threaded applications <span class="emphasis"><em>what</em></span> and <span class="emphasis"><em>when</em></span> are so strongly coupled that the state of the entire application can often be determined by looking at the stack backtrace. A programmer who debugs such a system can set a breakpoint, or a sequence of breakpoints, and <span class="emphasis"><em>know</em></span> the state of the system by which breakpoints are hit.</p><p>Decoupling <span class="emphasis"><em>what</em></span> from <span class="emphasis"><em>when</em></span> can dramatically improve both the throughput and structures of an application. From a structural point of view the application looks like many little collaborating computers rather than one big main loop. This can make the system easier to understand and offers some powerful ways to separate concerns.</p><p>Consider, for example, the standard “Servlet” model of Web applications. These systems run under the umbrella of a Web or EJB container that <span class="emphasis"><em>partially</em></span> manages concurrency for you. The servlets are executed asynchronously whenever Web requests come in. The servlet programmer does not have to manage all the incoming requests. <span class="emphasis"><em>In principle</em></span>, each servlet execution lives in its own little world and is decoupled from all the other servlet executions.</p><p>Of course if it were that easy, this chapter wouldn’t be necessary. In fact, the decoupling provided by Web containers is far less than perfect. Servlet programmers have to be very aware, and very careful, to make sure their concurrent programs are correct. Still, the structural benefits of the servlet model are significant.</p><p>But structure is not the only motive for adopting concurrency. Some systems have response time and throughput constraints that require hand-coded concurrent solutions. For example, consider a single-threaded information aggregator that acquires information from many different Web sites and merges that information into a daily summary. Because <a id="iddle1307" class="indexterm"></a><a id="iddle1310" class="indexterm"></a><a id="iddle1380" class="indexterm"></a><a id="iddle1436" class="indexterm"></a><a id="iddle1953" class="indexterm"></a><a id="iddle1965" class="indexterm"></a><a id="iddle2389" class="indexterm"></a>this system is single threaded, it hits each Web site in turn, always finishing one before starting the next. The daily run needs to execute in less than 24 hours. However, as more and more Web sites are added, the time grows until it takes more than 24 hours to gather all the data. The single-thread involves a lot of waiting at Web sockets for I/O to complete. We could improve the performance by using a multithreaded algorithm that hits more than one Web site at a time.</p><p>Or consider a system that handles one user at a time and requires only one second of time per user. This system is fairly responsive for a few users, but as the number of users increases, the system’s response time increases. No user wants to get in line behind 150 others! We could improve the response time of this system by handling many users concurrently.</p><p>Or consider a system that interprets large data sets but can only give a complete solution after processing all of them. Perhaps each data set could be processed on a different computer, so that many data sets are being processed in parallel.</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ch13lev2sec1"></a>Myths and Misconceptions</h2></div></div></div><p>And so there are compelling reasons to adopt concurrency. However, as we said before, concurrency is <span class="emphasis"><em>hard</em></span>. If you aren’t very careful, you can create some very nasty situations. Consider these common myths and misconceptions:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="italic">Concurrency always improves performance.</span></p><p>Concurrency can <span class="emphasis"><em>sometimes</em></span> improve performance, but only when there is a lot of wait time that can be shared between multiple threads or multiple processors. Neither situation is trivial.</p></li><li class="listitem"><p><span class="italic">Design does not change when writing concurrent programs.</span></p><p>In fact, the design of a concurrent algorithm can be remarkably different from the design of a single-threaded system. The decoupling of <span class="emphasis"><em>what</em></span> from <span class="emphasis"><em>when</em></span> usually has a huge effect on the structure of the system.</p></li><li class="listitem"><p><span class="italic">Understanding concurrency issues is not important when working with a container such as a Web or EJB container.</span></p><p>In fact, you’d better know just what your container is doing and how to guard against the issues of concurrent update and deadlock described later in this chapter.</p><p>Here are a few more balanced sound bites regarding writing concurrent software:</p></li><li class="listitem"><p><span class="emphasis"><em>Concurrency incurs some overhead</em></span>, both in performance as well as writing additional code.</p></li><li class="listitem"><p><span class="emphasis"><em>Correct concurrency is complex</em></span>, even for simple problems.</p></li><li class="listitem"><p><a id="iddle1304" class="indexterm"></a><a id="iddle1313" class="indexterm"></a><a id="iddle1315" class="indexterm"></a><a id="iddle1361" class="indexterm"></a><a id="iddle1615" class="indexterm"></a><a id="iddle1626" class="indexterm"></a><a id="iddle1760" class="indexterm"></a><a id="iddle1928" class="indexterm"></a><a id="iddle2067" class="indexterm"></a><a id="iddle2327" class="indexterm"></a><span class="emphasis"><em>Concurrency bugs aren’t usually repeatable</em></span>, so they are often ignored as one-offs<a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ftn.ch13fn02" class="footnote" id="ch13fn02"><sup class="footnote">[2]</sup></a> instead of the true defects they are.</p></li><li class="listitem"><p><span class="italic">Concurrency often requires a fundamental change in design strategy.</span></p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lev1sec2"></a>Challenges</h1></div></div></div><p>What makes concurrent programming so difficult? Consider the following trivial class:</p><div class="informalexample"><pre class="programlisting">public class X {
   private int lastIdUsed;

   public int getNextId() {
        return ++lastIdUsed;
    }
}</pre></div><p>Let’s say we create an instance of <code class="literal">X</code>, set the <code class="literal">lastIdUsed</code> field to 42, and then share the instance between two threads. Now suppose that both of those threads call the method <code class="literal">getNextId()</code>; there are three possible outcomes:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Thread one gets the value 43, thread two gets the value 44, <code class="literal">lastIdUsed</code> is 44.</p></li><li class="listitem"><p>Thread one gets the value 44, thread two gets the value 43, <code class="literal">lastIdUsed</code> is 44.</p></li><li class="listitem"><p>Thread one gets the value 43, thread two gets the value 43, <code class="literal">lastIdUsed</code> is 43.</p></li></ul></div><p>The surprising third result<a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ftn.ch13fn03" class="footnote" id="ch13fn03"><sup class="footnote">[3]</sup></a> occurs when the two threads step on each other. This happens because there are many possible paths that the two threads can take through that one line of Java code, and some of those paths generate incorrect results. How many different paths are there? To really answer that question, we need to understand what the Just-In-Time Compiler does with the generated byte-code, and understand what the Java memory model considers to be atomic.</p><p>A quick answer, working with just the generated byte-code, is that there are 12,870 different possible execution paths<a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ftn.ch13fn04" class="footnote" id="ch13fn04"><sup class="footnote">[4]</sup></a> for those two threads executing within the <code class="literal">getNextId</code> method. If the type of <code class="literal">lastIdUsed</code> is changed from <code class="literal">int</code> to <code class="literal">long</code>, the number of possible paths increases to 2,704,156. Of course most of those paths generate valid results. The problem is that <span class="emphasis"><em>some of them don’t</em></span>.</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lev1sec3"></a>Concurrency Defense Principles</h1></div></div></div><p>What follows is a series of principles and techniques for defending your systems from the problems of concurrent code.</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ch13lev2sec2"></a>Single Responsibility Principle</h2></div></div></div><p><a id="iddle1051" class="indexterm"></a><a id="iddle1308" class="indexterm"></a><a id="iddle1377" class="indexterm"></a><a id="iddle1378" class="indexterm"></a><a id="iddle1379" class="indexterm"></a><a id="iddle1456" class="indexterm"></a><a id="iddle1898" class="indexterm"></a><a id="iddle1918" class="indexterm"></a><a id="iddle2100" class="indexterm"></a><a id="iddle2134" class="indexterm"></a><a id="iddle2154" class="indexterm"></a><a id="iddle2233" class="indexterm"></a>The SRP<a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ftn.ch13fn05" class="footnote" id="ch13fn05"><sup class="footnote">[5]</sup></a> states that a given method/class/component should have a single reason to change. Concurrency design is complex enough to be a reason to change in it’s own right and therefore deserves to be separated from the rest of the code. Unfortunately, it is all too common for concurrency implementation details to be embedded directly into other production code. Here are a few things to consider:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="emphasis"><em>Concurrency-related code has its own life cycle of development</em></span>, change, and tuning.</p></li><li class="listitem"><p><span class="emphasis"><em>Concurrency-related code has its own challenges</em></span>, which are different from and often more difficult than nonconcurrency-related code.</p></li><li class="listitem"><p>The number of ways in which miswritten concurrency-based code can fail makes it challenging enough without the added burden of surrounding application code.</p></li></ul></div><p><span class="strong"><strong>Recommendation:</strong></span> <span class="emphasis"><em>Keep your concurrency-related code separate from other code</em></span>.<a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ftn.ch13fn06" class="footnote" id="ch13fn06"><sup class="footnote">[6]</sup></a></p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ch13lev2sec3"></a>Corollary: Limit the Scope of Data</h2></div></div></div><p>As we saw, two threads modifying the same field of a shared object can interfere with each other, causing unexpected behavior. One solution is to use the <code class="literal">synchronized</code> keyword to protect a <span class="emphasis"><em>critical section</em></span> in the code that uses the shared object. It is important to restrict the number of such critical sections. The more places shared data can get updated, the more likely:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>You will forget to protect one or more of those places—effectively breaking all code that modifies that shared data.</p></li><li class="listitem"><p>There will be duplication of effort required to make sure everything is effectively guarded (violation of DRY<a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ftn.ch13fn07" class="footnote" id="ch13fn07"><sup class="footnote">[7]</sup></a>).</p></li><li class="listitem"><p>It will be difficult to determine the source of failures, which are already hard enough to find.</p></li></ul></div><p><span class="strong"><strong>Recommendation:</strong></span> <span class="emphasis"><em>Take data encapsulation to heart; severely limit the access of any data that may be shared.</em></span></p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ch13lev2sec4"></a>Corollary: Use Copies of Data</h2></div></div></div><p>A good way to avoid shared data is to avoid sharing the data in the first place. In some situations it is possible to copy objects and treat them as read-only. In other cases it might be possible to copy objects, collect results from multiple threads in these copies and then merge the results in a single thread.</p><p><a id="iddle1316" class="indexterm"></a><a id="iddle1732" class="indexterm"></a><a id="iddle1744" class="indexterm"></a><a id="iddle1773" class="indexterm"></a><a id="iddle2125" class="indexterm"></a><a id="iddle2227" class="indexterm"></a><a id="iddle2235" class="indexterm"></a><a id="iddle2326" class="indexterm"></a><a id="iddle2337" class="indexterm"></a><a id="iddle2341" class="indexterm"></a>If there is an easy way to avoid sharing objects, the resulting code will be far less likely to cause problems. You might be concerned about the cost of all the extra object creation. It is worth experimenting to find out if this is in fact a problem. However, if using copies of objects allows the code to avoid synchronizing, the savings in avoiding the intrinsic lock will likely make up for the additional creation and garbage collection overhead.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ch13lev2sec5"></a>Corollary: Threads Should Be as Independent as Possible</h2></div></div></div><p>Consider writing your threaded code such that each thread exists in its own world, sharing no data with any other thread. Each thread processes one client request, with all of its required data coming from an unshared source and stored as local variables. This makes each of those threads behave as if it were the only thread in the world and there were no synchronization requirements.</p><p>For example, classes that subclass from <code class="literal">HttpServlet</code> receive all of their information as parameters passed in to the <code class="literal">doGet</code> and <code class="literal">doPost</code> methods. This makes each <code class="literal">Servlet</code> act as if it has its own machine. So long as the code in the <code class="literal">Servlet</code> uses only local variables, there is no chance that the <code class="literal">Servlet</code> will cause synchronization problems. Of course, most applications using <code class="literal">Servlets</code> eventually run into shared resources such as database connections.</p><p><span class="strong"><strong>Recommendation:</strong></span> <span class="emphasis"><em>Attempt to partition data into independent subsets than can be operated on by independent threads, possibly in different processors.</em></span></p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lev1sec4"></a>Know Your Library</h1></div></div></div><p>Java 5 offers many improvements for concurrent development over previous versions. There are several things to consider when writing threaded code in Java 5:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Use the provided thread-safe collections.</p></li><li class="listitem"><p>Use the executor framework for executing unrelated tasks.</p></li><li class="listitem"><p>Use nonblocking solutions when possible.</p></li><li class="listitem"><p>Several library classes are not thread safe.</p></li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ch13lev2sec6"></a>Thread-Safe Collections</h2></div></div></div><p>When Java was young, Doug Lea wrote the seminal book<a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ftn.ch13fn08" class="footnote" id="ch13fn08"><sup class="footnote">[8]</sup></a> <span class="emphasis"><em>Concurrent Programming in Java</em></span>. Along with the book he developed several thread-safe collections, which later became part of the JDK in the <code class="literal">java.util.concurrent</code> package. The collections in that package are safe for multithreaded situations and they perform well. In fact, the <a id="iddle1121" class="indexterm"></a><a id="iddle1181" class="indexterm"></a><a id="iddle1311" class="indexterm"></a><a id="iddle1320" class="indexterm"></a><a id="iddle1362" class="indexterm"></a><a id="iddle1399" class="indexterm"></a><a id="iddle1530" class="indexterm"></a><a id="iddle1550" class="indexterm"></a><a id="iddle1791" class="indexterm"></a><a id="iddle1854" class="indexterm"></a><a id="iddle2058" class="indexterm"></a><a id="iddle2071" class="indexterm"></a><a id="iddle2109" class="indexterm"></a><a id="iddle2199" class="indexterm"></a><code class="literal">ConcurrentHashMap</code> implementation performs better than <code class="literal">HashMap</code> in nearly all situations. It also allows for simultaneous concurrent reads and writes, and it has methods supporting common composite operations that are otherwise not thread safe. If Java 5 is the deployment environment, start with <code class="literal">ConcurrentHashMap</code>.</p><p>There are several other kinds of classes added to support advanced concurrency design. Here are a few examples:</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col width="125" style="text-align: left" class="c1"><col width="425" style="text-align: left" class="c2"></colgroup><tbody><tr><td style="text-align: left" valign="top"><p><span class="strong"><strong><code class="literal">ReentrantLock</code></strong></span></p></td><td style="text-align: left" valign="top"><p>A lock that can be acquired in one method and released in another.</p></td></tr><tr><td style="text-align: left" valign="top"><p><span class="strong"><strong><code class="literal">Semaphore</code></strong></span></p></td><td style="text-align: left" valign="top"><p>An implementation of the classic semaphore, a lock with a count.</p></td></tr><tr><td style="text-align: left" valign="top"><p><span class="strong"><strong><code class="literal">CountDownLatch</code></strong></span></p></td><td style="text-align: left" valign="top"><p>A lock that waits for a number of events before releasing all threads waiting on it. This allows all threads to have a fair chance of starting at about the same time.</p></td></tr></tbody></table></div><p><span class="strong"><strong>Recommendation:</strong></span> <span class="emphasis"><em>Review the classes available to you. In the case of Java, become familiar with java.util.concurrent, java.util.concurrent.atomic, java.util.concurrent.locks.</em></span></p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lev1sec5"></a>Know Your Execution Models</h1></div></div></div><p>There are several different ways to partition behavior in a concurrent application. To discuss them we need to understand some basic definitions.</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col width="125" style="text-align: left" class="c1"><col width="425" style="text-align: left" class="c2"></colgroup><tbody><tr><td style="text-align: left" valign="top"><p>Bound Resources</p></td><td style="text-align: left" valign="top"><p>Resources of a fixed size or number used in a concurrent environment. Examples include database connections and fixed-size read/write buffers.</p></td></tr><tr><td style="text-align: left" valign="top"><p>Mutual Exclusion</p></td><td style="text-align: left" valign="top"><p>Only one thread can access shared data or a shared resource at a time.</p></td></tr><tr><td style="text-align: left" valign="top"><p>Starvation</p></td><td style="text-align: left" valign="top"><p>One thread or a group of threads is prohibited from proceeding for an excessively long time or forever. For example, always letting fast-running threads through first could starve out longer running threads if there is no end to the fast-running threads.</p></td></tr><tr><td style="text-align: left" valign="top"><p>Deadlock</p></td><td style="text-align: left" valign="top"><p>Two or more threads waiting for each other to finish. Each thread has a resource that the other thread requires and neither can finish until it gets the other resource.</p></td></tr><tr><td style="text-align: left" valign="top"><p>Livelock</p></td><td style="text-align: left" valign="top"><p>Threads in lockstep, each trying to do work but finding another “in the way.” Due to resonance, threads continue trying to make progress but are unable to for an excessively long time—or forever.</p></td></tr></tbody></table></div><p>Given these definitions, we can now discuss the various execution models used in concurrent programming.</p><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ch13lev2sec7"></a>Producer-Consumer<a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ftn.ch13fn09" class="footnote" id="ch13fn09"><sup class="footnote">[9]</sup></a></h2></div></div></div><p>One or more producer threads create some work and place it in a buffer or queue. One or more consumer threads acquire that work from the queue and complete it. The queue between the producers and consumers is a <span class="emphasis"><em>bound resource</em></span>. This means producers must wait for free space in the queue before writing and consumers must wait until there is something in the queue to consume. Coordination between the producers and consumers via the queue involves producers and consumers signaling each other. The producers write to the queue and signal that the queue is no longer empty. Consumers read from the queue and signal that the queue is no longer full. Both potentially wait to be notified when they can continue.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ch13lev2sec8"></a>Readers-Writers<a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ftn.ch13fn10" class="footnote" id="ch13fn10"><sup class="footnote">[10]</sup></a></h2></div></div></div><p>When you have a shared resource that primarily serves as a source of information for readers, but which is occasionally updated by writers, throughput is an issue. Emphasizing throughput can cause starvation and the accumulation of stale information. Allowing updates can impact throughput. Coordinating readers so they do not read something a writer is updating and vice versa is a tough balancing act. Writers tend to block many readers for a long period of time, thus causing throughput issues.</p><p>The challenge is to balance the needs of both readers and writers to satisfy correct operation, provide reasonable throughput and avoiding starvation. A simple strategy makes writers wait until there are no readers before allowing the writer to perform an update. If there are continuous readers, however, the writers will be starved. On the other hand, if there are frequent writers and they are given priority, throughput will suffer. Finding that balance and avoiding concurrent update issues is what the problem addresses.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ch13lev2sec9"></a>Dining Philosophers<a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ftn.ch13fn11" class="footnote" id="ch13fn11"><sup class="footnote">[11]</sup></a></h2></div></div></div><p>Imagine a number of philosophers sitting around a circular table. A fork is placed to the left of each philosopher. There is a big bowl of spaghetti in the center of the table. The philosophers spend their time thinking unless they get hungry. Once hungry, they pick up the forks on either side of them and eat. A philosopher cannot eat unless he is holding two forks. If the philosopher to his right or left is already using one of the forks he needs, he must wait until that philosopher finishes eating and puts the forks back down. Once a philosopher eats, he puts both his forks back down on the table and waits until he is hungry again.</p><p>Replace philosophers with threads and forks with resources and this problem is similar to many enterprise applications in which processes compete for resources. Unless carefully designed, systems that compete in this way can experience deadlock, livelock, throughput, and efficiency degradation.</p><p><a id="iddle1029" class="indexterm"></a><a id="iddle1194" class="indexterm"></a><a id="iddle1420" class="indexterm"></a><a id="iddle1799" class="indexterm"></a><a id="iddle2123" class="indexterm"></a><a id="iddle2229" class="indexterm"></a><a id="iddle2234" class="indexterm"></a>Most concurrent problems you will likely encounter will be some variation of these three problems. Study these algorithms and write solutions using them on your own so that when you come across concurrent problems, you’ll be more prepared to solve the problem.</p><p><span class="strong"><strong>Recommendation:</strong></span> <span class="emphasis"><em>Learn these basic algorithms and understand their solutions.</em></span></p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lev1sec6"></a>Beware Dependencies Between Synchronized Methods</h1></div></div></div><p>Dependencies between synchronized methods cause subtle bugs in concurrent code. The Java language has the notion of <code class="literal">synchronized</code>, which protects an individual method. However, if there is more than one synchronized method on the same shared class, then your system may be written incorrectly.<a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ftn.ch13fn12" class="footnote" id="ch13fn12"><sup class="footnote">[12]</sup></a></p><p><span class="strong"><strong>Recommendation:</strong></span> <span class="emphasis"><em>Avoid using more than one method on a shared object.</em></span></p><p>There will be times when you must use more than one method on a shared object. When this is the case, there are three ways to make the code correct:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><strong><span class="strong"><strong>Client-Based Locking—</strong></span>.&nbsp;</strong>Have the client lock the server before calling the first method and make sure the lock’s extent includes code calling the last method.</p></li><li class="listitem"><p><strong><span class="strong"><strong>Server-Based Locking—</strong></span>.&nbsp;</strong>Within the server create a method that locks the server, calls all the methods, and then unlocks. Have the client call the new method.</p></li><li class="listitem"><p><strong><span class="strong"><strong>Adapted Server—</strong></span>.&nbsp;</strong>create an intermediary that performs the locking. This is an example of server-based locking, where the original server cannot be changed.</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lev1sec7"></a>Keep Synchronized Sections Small</h1></div></div></div><p>The <code class="literal">synchronized</code> keyword introduces a lock. All sections of code guarded by the same lock are guaranteed to have only one thread executing through them at any given time. Locks are expensive because they create delays and add overhead. So we don’t want to litter our code with <code class="literal">synchronized</code> statements. On the other hand, critical sections<a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ftn.ch13fn13" class="footnote" id="ch13fn13"><sup class="footnote">[13]</sup></a> must be guarded. So we want to design our code with as few critical sections as possible.</p><p>Some naive programmers try to achieve this by making their critical sections very large. However, extending synchronization beyond the minimal critical section increases contention and degrades performance.<a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ftn.ch13fn14" class="footnote" id="ch13fn14"><sup class="footnote">[14]</sup></a></p><p><span class="strong"><strong>Recommendation:</strong></span> <span class="emphasis"><em>Keep your synchronized sections as small as possible.</em></span></p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lev1sec8"></a>Writing Correct Shut-Down Code Is Hard</h1></div></div></div><p><a id="iddle2138" class="indexterm"></a><a id="iddle2139" class="indexterm"></a><a id="iddle2180" class="indexterm"></a><a id="iddle2312" class="indexterm"></a><a id="iddle2336" class="indexterm"></a>Writing a system that is meant to stay live and run forever is different from writing something that works for awhile and then shuts down gracefully.</p><p>Graceful shutdown can be hard to get correct. Common problems involve deadlock,<a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ftn.ch13fn15" class="footnote" id="ch13fn15"><sup class="footnote">[15]</sup></a> with threads waiting for a signal to continue that never comes.</p><p>For example, imagine a system with a parent thread that spawns several child threads and then waits for them all to finish before it releases its resources and shuts down. What if one of the spawned threads is deadlocked? The parent will wait forever, and the system will never shut down.</p><p>Or consider a similar system that has been <span class="emphasis"><em>instructed</em></span> to shut down. The parent tells all the spawned children to abandon their tasks and finish. But what if two of the children were operating as a producer/consumer pair. Suppose the producer receives the signal from the parent and quickly shuts down. The consumer might have been expecting a message from the producer and be blocked in a state where it cannot receive the shutdown signal. It could get stuck waiting for the producer and never finish, preventing the parent from finishing as well.</p><p>Situations like this are not at all uncommon. So if you must write concurrent code that involves shutting down gracefully, expect to spend much of your time getting the shutdown to happen correctly.</p><p><span class="strong"><strong>Recommendation:</strong></span> <span class="emphasis"><em>Think about shut-down early and get it working early. It’s going to take longer than you expect. Review existing algorithms because this is probably harder than you think.</em></span></p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lev1sec9"></a>Testing Threaded Code</h1></div></div></div><p>Proving that code is correct is impractical. Testing does not guarantee correctness. However, good testing can minimize risk. This is all true in a single-threaded solution. As soon as there are two or more threads using the same code and working with shared data, things get substantially more complex.</p><p><span class="strong"><strong>Recommendation:</strong></span> <span class="emphasis"><em>Write tests that have the potential to expose problems and then run them frequently, with different programatic configurations and system configurations and load. If tests ever fail, track down the failure. Don’t ignore a failure just because the tests pass on a subsequent run.</em></span></p><p>That is a whole lot to take into consideration. Here are a few more fine-grained recommendations:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ch13lev2sec10">Treat spurious failures as candidate threading issues.</a></p></li><li class="listitem"><p><a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ch13lev2sec11">Get your nonthreaded code working first.</a></p></li><li class="listitem"><p><a id="iddle1903" class="indexterm"></a><a id="iddle1929" class="indexterm"></a><a id="iddle1973" class="indexterm"></a><a id="iddle1976" class="indexterm"></a><a id="iddle1978" class="indexterm"></a><a id="iddle1979" class="indexterm"></a><a id="iddle2190" class="indexterm"></a><a id="iddle2242" class="indexterm"></a><a id="iddle2333" class="indexterm"></a><a id="iddle2334" class="indexterm"></a><a id="iddle2335" class="indexterm"></a><a id="iddle2375" class="indexterm"></a><a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ch13lev2sec12">Make your threaded code pluggable.</a></p></li><li class="listitem"><p><a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ch13lev2sec13">Make your threaded code tunable.</a></p></li><li class="listitem"><p><a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ch13lev2sec14">Run with more threads than processors.</a></p></li><li class="listitem"><p><a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ch13lev2sec15">Run on different platforms.</a></p></li><li class="listitem"><p><a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ch13lev2sec16">Instrument your code to try and force failures.</a></p></li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ch13lev2sec10"></a>Treat Spurious Failures as Candidate Threading Issues</h2></div></div></div><p>Threaded code causes things to fail that “simply cannot fail.” Most developers do not have an intuitive feel for how threading interacts with other code (authors included). Bugs in threaded code might exhibit their symptoms once in a thousand, or a million, executions. Attempts to repeat the systems can be frustratingly. This often leads developers to write off the failure as a cosmic ray, a hardware glitch, or some other kind of “one-off.” It is best to assume that one-offs do not exist. The longer these “one-offs” are ignored, the more code is built on top of a potentially faulty approach.</p><p><span class="strong"><strong>Recommendation:</strong></span> <span class="emphasis"><em>Do not ignore system failures as one-offs.</em></span></p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ch13lev2sec11"></a>Get Your Nonthreaded Code Working First</h2></div></div></div><p>This may seem obvious, but it doesn’t hurt to reinforce it. Make sure code works outside of its use in threads. Generally, this means creating POJOs that are called by your threads. The POJOs are not thread aware, and can therefore be tested outside of the threaded environment. The more of your system you can place in such POJOs, the better.</p><p><span class="strong"><strong>Recommendation:</strong></span> <span class="emphasis"><em>Do not try to chase down nonthreading bugs and threading bugs at the same time. Make sure your code works outside of threads</em></span>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ch13lev2sec12"></a>Make Your Threaded Code Pluggable</h2></div></div></div><p>Write the concurrency-supporting code such that it can be run in several configurations:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>One thread, several threads, varied as it executes</p></li><li class="listitem"><p>Threaded code interacts with something that can be both real or a test double.</p></li><li class="listitem"><p>Execute with test doubles that run quickly, slowly, variable.</p></li><li class="listitem"><p>Configure tests so they can run for a number of iterations.</p></li></ul></div><p><span class="strong"><strong>Recommendation:</strong></span> <span class="emphasis"><em>Make your thread-based code especially pluggable so that you can run it in various configurations.</em></span></p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ch13lev2sec13"></a>Make Your Threaded Code Tunable</h2></div></div></div><p>Getting the right balance of threads typically requires trial an error. Early on, find ways to time the performance of your system under different configurations. Allow the number of <a id="iddle1218" class="indexterm"></a><a id="iddle1234" class="indexterm"></a><a id="iddle1314" class="indexterm"></a><a id="iddle1828" class="indexterm"></a><a id="iddle1850" class="indexterm"></a><a id="iddle1938" class="indexterm"></a><a id="iddle1960" class="indexterm"></a><a id="iddle1974" class="indexterm"></a><a id="iddle2247" class="indexterm"></a>threads to be easily tuned. Consider allowing it to change while the system is running. Consider allowing self-tuning based on throughput and system utilization.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ch13lev2sec14"></a>Run with More Threads Than Processors</h2></div></div></div><p>Things happen when the system switches between tasks. To encourage task swapping, run with more threads than processors or cores. The more frequently your tasks swap, the more likely you’ll encounter code that is missing a critical section or causes deadlock.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ch13lev2sec15"></a>Run on Different Platforms</h2></div></div></div><p>In the middle of 2007 we developed a course on concurrent programming. The course development ensued primarily under OS X. The class was presented using Windows XP running under a VM. Tests written to demonstrate failure conditions did not fail as frequently in an XP environment as they did running on OS X.</p><p>In all cases the code under test was known to be incorrect. This just reinforced the fact that different operating systems have different threading policies, each of which impacts the code’s execution. Multithreaded code behaves differently in different environments.<a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ftn.ch13fn16" class="footnote" id="ch13fn16"><sup class="footnote">[16]</sup></a> You should run your tests in every potential deployment environment.</p><p><span class="strong"><strong>Recommendation:</strong></span> <span class="emphasis"><em>Run your threaded code on all target platforms early and often.</em></span></p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ch13lev2sec16"></a>Instrument Your Code to Try and Force Failures</h2></div></div></div><p>It is normal for flaws in concurrent code to hide. Simple tests often don’t expose them. Indeed, they often hide during normal processing. They might show up once every few hours, or days, or weeks!</p><p>The reason that threading bugs can be infrequent, sporadic, and hard to repeat, is that only a very few pathways out of the many thousands of possible pathways through a vulnerable section actually fail. So the probability that a failing pathway is taken can be startlingly low. This makes detection and debugging very difficult.</p><p>How might you increase your chances of catching such rare occurrences? You can instrument your code and force it to run in different orderings by adding calls to methods like <code class="literal">Object.wait()</code>, <code class="literal">Object.sleep()</code>, <code class="literal">Object.yield()</code> and <code class="literal">Object.priority()</code>.</p><p>Each of these methods can affect the order of execution, thereby increasing the odds of detecting a flaw. It’s better when broken code fails as early and as often as possible.</p><p>There are two options for code instrumentation:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ch13lev2sec17">Hand-coded</a></p></li><li class="listitem"><p><a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ch13lev2sec18">Automated</a></p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ch13lev2sec17"></a>Hand-Coded</h2></div></div></div><p><a id="iddle1090" class="indexterm"></a><a id="iddle1634" class="indexterm"></a><a id="iddle2137" class="indexterm"></a>You can insert calls to <code class="literal">wait()</code>, <code class="literal">sleep()</code>, <code class="literal">yield()</code>, and <code class="literal">priority()</code> in your code by hand. It might be just the thing to do when you’re testing a particularly thorny piece of code.</p><p>Here is an example of doing just that:</p><div class="informalexample"><pre class="programlisting">public synchronized String nextUrlOrNull() {
    if(hasNext()) {
        String url = urlGenerator.next();
        Thread.yield(); // inserted for testing.
        updateHasNext();
        return url;
    }
    return null;
}</pre></div><p>The inserted call to <code class="literal">yield()</code> will change the execution pathways taken by the code and possibly cause the code to fail where it did not fail before. If the code does break, it was not because you added a call to <code class="literal">yield()</code>.<a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ftn.ch13fn17" class="footnote" id="ch13fn17"><sup class="footnote">[17]</sup></a> Rather, your code was broken and this simply made the failure evident.</p><p>There are many problems with this approach:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>You have to manually find appropriate places to do this.</p></li><li class="listitem"><p>How do you know where to put the call and what kind of call to use?</p></li><li class="listitem"><p>Leaving such code in a production environment unnecessarily slows the code down.</p></li><li class="listitem"><p>It’s a shotgun approach. You may or may not find flaws. Indeed, the odds aren’t with you.</p></li></ul></div><p>What we need is a way to do this during testing but not in production. We also need to easily mix up configurations between different runs, which results in increased chances of finding errors in the aggregate.</p><p>Clearly, if we divide our system up into POJOs that know nothing of threading and classes that control the threading, it will be easier to find appropriate places to instrument the code. Moreover, we could create many different test jigs that invoke the POJOs under different regimes of calls to <code class="literal">sleep</code>, <code class="literal">yield</code>, and so on.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="ch13lev2sec18"></a>Automated</h2></div></div></div><p>You could use tools like an Aspect-Oriented Framework, CGLIB, or ASM to programmatically instrument your code. For example, you could use a class with a single method:</p><div class="informalexample"><pre class="programlisting">public class ThreadJigglePoint {
    public static void jiggle() {
    }
}</pre></div><p><a id="iddle1220" class="indexterm"></a><a id="iddle1305" class="indexterm"></a><a id="iddle1347" class="indexterm"></a><a id="iddle1753" class="indexterm"></a><a id="iddle1981" class="indexterm"></a><a id="iddle2037" class="indexterm"></a><a id="iddle2361" class="indexterm"></a>You can add calls to this in various places within your code:</p><div class="informalexample"><pre class="programlisting">public synchronized String nextUrlOrNull() {
    if(hasNext()) {
        ThreadJiglePoint.jiggle();
        String url = urlGenerator.next();
        ThreadJiglePoint.jiggle();
        updateHasNext();
        ThreadJiglePoint.jiggle();
        return url;
    }
    return null;
}</pre></div><p>Now you use a simple aspect that randomly selects among doing nothing, sleeping, or yielding.</p><p>Or imagine that the <code class="literal">ThreadJigglePoint</code> class has two implementations. The first implements <code class="literal">jiggle</code> to do nothing and is used in production. The second generates a random number to choose between sleeping, yielding, or just falling through. If you run your tests a thousand times with random jiggling, you may root out some flaws. If the tests pass, at least you can say you’ve done due diligence. Though a bit simplistic, this could be a reasonable option in lieu of a more sophisticated tool.</p><p>There is a tool called ConTest,<a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ftn.ch13fn18" class="footnote" id="ch13fn18"><sup class="footnote">[18]</sup></a> developed by IBM that does something similar, but it does so with quite a bit more sophistication.</p><p>The point is to jiggle the code so that threads run in different orderings at different times. The combination of well-written tests and jiggling can dramatically increase the chance finding errors.</p><p><span class="strong"><strong>Recommendation:</strong></span> <span class="emphasis"><em>Use jiggling strategies to ferret out errors.</em></span></p></div></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lev1sec10"></a>Conclusion</h1></div></div></div><p>Concurrent code is difficult to get right. Code that is simple to follow can become nightmarish when multiple threads and shared data get into the mix. If you are faced with writing concurrent code, you need to write clean code with rigor or else face subtle and infrequent failures.</p><p>First and foremost, follow the Single Responsibility Principle. Break your system into POJOs that separate thread-aware code from thread-ignorant code. Make sure when you are testing your thread-aware code, you are only testing it and nothing else. This suggests that your thread-aware code should be small and focused.</p><p>Know the possible sources of concurrency issues: multiple threads operating on shared data, or using a common resource pool. Boundary cases, such as shutting down cleanly or finishing the iteration of a loop, can be especially thorny.</p><p><a id="iddle1930" class="indexterm"></a>Learn your library and know the fundamental algorithms. Understand how some of the features offered by the library support solving problems similar to the fundamental algorithms.</p><p>Learn how to find regions of code that must be locked and lock them. Do not lock regions of code that do not need to be locked. Avoid calling one locked section from another. This requires a deep understanding of whether something is or is not shared. Keep the amount of shared objects and the scope of the sharing as narrow as possible. Change designs of the objects with shared data to accommodate clients rather than forcing clients to manage shared state.</p><p>Issues will crop up. The ones that do not crop up early are often written off as a onetime occurrence. These so-called one-offs typically only happen under load or at seemingly random times. Therefore, you need to be able to run your thread-related code in many configurations on many platforms repeatedly and continuously. Testability, which comes naturally from following the Three Laws of TDD, implies some level of plug-ability, which offers the support necessary to run code in a wider range of configurations.</p><p>You will greatly improve your chances of finding erroneous code if you take the time to instrument your code. You can either do so by hand or using some kind of automated technology. Invest in this early. You want to be running your thread-based code as long as possible before you put it into production.</p><p>If you take a clean approach, your chances of getting it right increase drastically.</p></div><div class="section"><div class="titlepage"><div><div><h1 class="title"><a id="ch13lev1sec11"></a>Bibliography</h1></div></div></div><p><a id="bib13"></a></p><p><a id="bib13_01"></a></p><p><span class="strong"><strong>[Lea99]:</strong></span></p><em class="citetitle">Concurrent Programming in Java: Design Principles and Patterns</em>, 2d. ed., Doug Lea, Prentice Hall, 1999.
<p><a id="bib13_02"></a></p><p><span class="strong"><strong>[PPP]:</strong></span></p><em class="citetitle">Agile Software Development: Principles, Patterns, and Practices</em>, Robert C. Martin, Prentice Hall, 2002.
<p><a id="bib13_03"></a></p><p><span class="strong"><strong>[PRAG]:</strong></span></p><em class="citetitle">The Pragmatic Programmer</em>, Andrew Hunt, Dave Thomas, Addison-Wesley, 2000.

<p>&nbsp;</p></div><div class="footnotes"><br><hr><div id="ftn.ch13fn01" class="footnote"><p><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ch13fn01" class="para"><sup class="para">[1] </sup></a>Private correspondence.</p></div><div id="ftn.ch13fn02" class="footnote"><p><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ch13fn02" class="para"><sup class="para">[2] </sup></a>Cosmic-rays, glitches, and so on.</p></div><div id="ftn.ch13fn03" class="footnote"><p><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ch13fn03" class="para"><sup class="para">[3] </sup></a>See “<a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/apa.html#app01lev2sec6">Digging Deeper</a>” on page <a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/apa.html#app01lev2sec6">323</a>.</p></div><div id="ftn.ch13fn04" class="footnote"><p><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ch13fn04" class="para"><sup class="para">[4] </sup></a>See “<a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/apa.html#app01lev1sec2">Possible Paths of Execution</a>” on page <a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/apa.html#app01lev1sec2">321</a>.</p></div><div id="ftn.ch13fn05" class="footnote"><p><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ch13fn05" class="para"><sup class="para">[5] </sup></a><a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#bib13_02">[PPP]</a></p></div><div id="ftn.ch13fn06" class="footnote"><p><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ch13fn06" class="para"><sup class="para">[6] </sup></a>See “<a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/apa.html#app01lev1sec1">Client/Server Example</a>” on page <a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/apa.html#app01lev1sec1">317</a>.</p></div><div id="ftn.ch13fn07" class="footnote"><p><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ch13fn07" class="para"><sup class="para">[7] </sup></a><a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#bib13_03">[PRAG]</a>.</p></div><div id="ftn.ch13fn08" class="footnote"><p><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ch13fn08" class="para"><sup class="para">[8] </sup></a><a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#bib13_01">[Lea99]</a>.</p></div><div id="ftn.ch13fn09" class="footnote"><p><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ch13fn09" class="para"><sup class="para">[9] </sup></a><a id="iddle1122" class="indexterm"></a><a id="iddle1346" class="indexterm"></a><a id="iddle1352" class="indexterm"></a><a id="iddle1443" class="indexterm"></a><a id="iddle2015" class="indexterm"></a><a id="iddle2017" class="indexterm"></a><a id="iddle2018" class="indexterm"></a><a id="iddle2045" class="indexterm"></a><a id="iddle2046" class="indexterm"></a><a id="iddle2072" class="indexterm"></a><a id="iddle2200" class="indexterm"></a><a id="iddle2343" class="indexterm"></a><a id="iddle2425" class="indexterm"></a><a class="ulink" href="http://en.wikipedia.org/wiki/Producer-consumer">http://en.wikipedia.org/wiki/Producer-consumer</a></p></div><div id="ftn.ch13fn10" class="footnote"><p><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ch13fn10" class="para"><sup class="para">[10] </sup></a><a class="ulink" href="http://en.wikipedia.org/wiki/Readers-writers_problem">http://en.wikipedia.org/wiki/Readers-writers_problem</a></p></div><div id="ftn.ch13fn11" class="footnote"><p><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ch13fn11" class="para"><sup class="para">[11] </sup></a><a class="ulink" href="http://en.wikipedia.org/wiki/Dining_philosophers_problem">http://en.wikipedia.org/wiki/Dining_philosophers_problem</a></p></div><div id="ftn.ch13fn12" class="footnote"><p><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ch13fn12" class="para"><sup class="para">[12] </sup></a>See “<a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/apa.html#app01lev1sec4">Dependencies Between Methods Can Break Concurrent Code</a>” on page <a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/apa.html#app01lev1sec4">329</a>.</p></div><div id="ftn.ch13fn13" class="footnote"><p><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ch13fn13" class="para"><sup class="para">[13] </sup></a>A critical section is any section of code that must be protected from simultaneous use for the program to be correct.</p></div><div id="ftn.ch13fn14" class="footnote"><p><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ch13fn14" class="para"><sup class="para">[14] </sup></a>See “<a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/apa.html#app01lev1sec5">Increasing Throughput</a>” on page <a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/apa.html#app01lev1sec5">333</a>.</p></div><div id="ftn.ch13fn15" class="footnote"><p><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ch13fn15" class="para"><sup class="para">[15] </sup></a>See “<a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/apa.html#app01lev1sec6">Deadlock</a>” on page <a class="link" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/apa.html#app01lev1sec6">335</a>.</p></div><div id="ftn.ch13fn16" class="footnote"><p><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ch13fn16" class="para"><sup class="para">[16] </sup></a>Did you know that the threading model in Java does not guarantee preemptive threading? Modern OS’s support preemptive threading, so you get that “for free.” Even so, it not guaranteed by the JVM.</p></div><div id="ftn.ch13fn17" class="footnote"><p><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ch13fn17" class="para"><sup class="para">[17] </sup></a>This is not strictly the case. Since the JVM does not guarantee preemptive threading, a particular algorithm might always work on an OS that does not preempt threads. The reverse is also possible but for different reasons.</p></div><div id="ftn.ch13fn18" class="footnote"><p><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#ch13fn18" class="para"><sup class="para">[18] </sup></a><a class="ulink" href="http://www.alphaworks.ibm.com/tech/contest">http://www.alphaworks.ibm.com/tech/contest</a></p></div></div></div><div class="annotator-outer annotator-viewer viewer annotator-hide">
  <ul class="annotator-widget annotator-listing"></ul>
</div><div class="annotator-modal-wrapper annotator-editor-modal annotator-editor annotator-hide">
	<div class="annotator-outer editor">
		<h2 class="title">Highlight</h2>
		<form class="annotator-widget">
			<ul class="annotator-listing">
			<li class="annotator-item"><textarea id="annotator-field-0" placeholder="Add a note using markdown (optional)" class="js-editor" maxlength="750"></textarea></li></ul>
			<div class="annotator-controls">
				<a class="link-to-markdown" href="https://daringfireball.net/projects/markdown/basics" target="_blank">?</a>
				<ul>
					<li class="delete annotator-hide"><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#delete" class="annotator-delete-note button positive">Delete Note</a></li>
					<li class="save"><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#save" class="annotator-save annotator-focus button positive">Save Note</a></li>
					<li class="cancel"><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#cancel" class="annotator-cancel button">Cancel</a></li>
				</ul>
			</div>
		</form>
	</div>
</div><div class="annotator-modal-wrapper annotator-delete-confirm-modal" style="display: none;">
  <div class="annotator-outer">
    <h2 class="title">Highlight</h2>
      <a class="js-close-delete-confirm annotator-cancel close" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#close">Close</a>
      <div class="annotator-widget">
         <div class="delete-confirm">
            Are you sure you want to permanently delete this note?
         </div>
         <div class="annotator-controls">
            <a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#cancel" class="annotator-cancel button js-cancel-delete-confirm">No, I changed my mind</a>
            <a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#delete" class="annotator-delete button positive js-delete-confirm">Yes, delete it</a>
         </div>
       </div>
   </div>
</div><div class="annotator-adder" style="display: none;">
	<ul class="adders ">
		
		<li class="copy"><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#">Copy</a></li>
		
		<li class="add-highlight"><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#">Add Highlight</a></li>
		<li class="add-note"><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#">
			
				Add Note
			
		</a></li>
	</ul>
</div></div></div>



  <div class="t-sbo-prev sbo-prev sbo-nav-bottom">
  
    
      
        <a href="/library/view/clean-code/9780136083238/ch12.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">12. Emergence</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-bottom">
  
    
      
        <a href="/library/view/clean-code/9780136083238/ch14.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">14. Successive Refinement</div>
        </a>
    
  
  </div>


      
    </section>
    <div class="reading-controls-bottom">
      <ul class="interface-controls js-bitlist">
        <li class="queue-control">
            <button type="button" class="rec-fav ss-queue js-queue js-current-chapter-queue" data-queue-endpoint="/api/v1/book/9780136083238/chapter/ch13.html" data-for-analytics="9780136083238:ch13.html">
      <span>Add to Queue</span>
  </button>
        </li>
      </ul>
    </div>
  </div>
<section class="sbo-saved-archives"></section>



          
          
  





    
    



        
      </div>
      



  <footer class="pagefoot t-pagefoot">
    <a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#" class="icon-up"><div class="visuallyhidden">Back to top</div></a>
    <ul class="js-footer-nav">
      
        <li><a class="t-recommendations-footer" href="https://www.safaribooksonline.com/r/">Recommended</a></li>
      
      <li><a class="t-queue-footer" href="https://www.safaribooksonline.com/s/">Queue</a></li>
      
        <li><a class="t-recent-footer" href="https://www.safaribooksonline.com/history/">History</a></li>
        <li><a class="t-topics-footer" href="https://www.safaribooksonline.com/topics?q=*&amp;limit=21">Topics</a></li>
      
      
        <li><a class="t-tutorials-footer" href="https://www.safaribooksonline.com/tutorials/">Tutorials</a></li>
      
      <li><a class="t-settings-footer js-settings" href="https://www.safaribooksonline.com/u/">Settings</a></li>
      <li><a href="https://www.safaribooksonline.com/blog/">Blog</a></li>
      <li class="full-support"><a href="https://www.safaribooksonline.com/public/support">Support</a></li>
      <li><a href="https://community.safaribooksonline.com/">Feedback</a></li>
      <li><a href="https://www.safaribooksonline.com/apps/">Get the App</a></li>
      <li><a href="https://www.safaribooksonline.com/accounts/logout/">Sign Out</a></li>
    </ul>
    <span class="copyright">© 2016 <a href="https://www.safaribooksonline.com/" target="_blank">Safari</a>.</span>
    <a href="https://www.safaribooksonline.com/terms/">Terms of Service</a> /
    <a href="https://www.safaribooksonline.com/privacy/">Privacy Policy</a>
  </footer>




    

    
    
  

<div class="annotator-notice"></div><div class="font-flyout"><div class="font-controls-panel">
	<div class="nightmodes">
		<ul>
			<li class="day"><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#" id="day-mode" title="Day Mode">
				<i class="fa fa-sun-o"></i>
				<span>Day Mode</span></a></li>
			<li class="cloudy"><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#" id="cloudy-mode" title="Cloudy Mode">
				<i class="fa fa-cloud"></i>
				<span>Cloud Mode</span>
			</a></li>
			<li class="night"><a href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#" id="night-mode" title="Night Mode">
				<i class="fa fa-moon-o"></i>
				<span>Night Mode</span>
			</a></li>
		</ul>
	</div>

	<div class="font-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-font left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-font-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-font right"></i>
		</div>
	</div>

	<div class="column-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-compress left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-column-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-expand right"></i>
		</div>
	</div>

	<a id="reset" class="button" href="https://www.safaribooksonline.com//library/view/clean-code/9780136083238/ch13.html#">Reset</a>
</div>
</div></body><span class="gr__tooltip"><span class="gr__tooltip-content"></span><i class="gr__tooltip-logo"></i><span class="gr__triangle"></span></span></html>