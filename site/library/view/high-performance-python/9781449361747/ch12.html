<!--[if IE]><![endif]--><!DOCTYPE html><!--[if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage"" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/high-performance-python/9781449361747/ch12.html"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="859452"
  data-user-uuid="4d373bec-fada-4717-9823-769db3ed3a36"
  data-username="dchen267"
  data-account-type="B2B"
  
  data-activated-trial-date="04/25/2016"


  data-archive="9781449361747"
  data-publishers="O&#39;Reilly Media, Inc."



  data-htmlfile-name="ch12.html"
  data-epub-title="High Performance Python" data-debug=0 data-testing=0><![endif]--><!--[if gt IE 8]><!--><html class=" js flexbox flexboxlegacy no-touch websqldatabase indexeddb history csscolumns csstransforms localstorage sessionstorage applicationcache svg inlinesvg zoom gr__safaribooksonline_com" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#" itemscope="" itemtype="http://schema.org/Book http://schema.org/ItemPage" "="" data-login-url="/accounts/login/" data-offline-url="/" data-url="/library/view/high-performance-python/9781449361747/ch12.html" data-csrf-cookie="csrfsafari" data-highlight-privacy="" data-user-id="859452" data-user-uuid="4d373bec-fada-4717-9823-769db3ed3a36" data-username="dchen267" data-account-type="B2B" data-activated-trial-date="04/25/2016" data-archive="9781449361747" data-publishers="O'Reilly Media, Inc." data-htmlfile-name="ch12.html" data-epub-title="High Performance Python" data-debug="0" data-testing="0"><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="Safari Books Online"><meta name="format-detection" content="telephone=no"><meta http-equiv="cleartype" content="on"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="apple-itunes-app" content="app-id=881697395, app-argument=safaridetail://9781449361747"><meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0"><meta property="twitter:account_id" content="4503599627559754"><link rel="apple-touch-icon" href="https://www.safaribooksonline.com/static/images/apple-touch-icon.8cc2fd27400e.png"><link rel="shortcut icon" href="https://www.safaribooksonline.com/favicon.ico" type="image/x-icon"><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700,900,200italic,300italic,400italic,600italic,700italic,900italic" rel="stylesheet" type="text/css"><title>12. Lessons from the Field - High Performance Python</title><link rel="stylesheet" href="https://www.safaribooksonline.com/static/CACHE/css/e4b0fef39b55.css" type="text/css"><link rel="stylesheet" type="text/css" href="https://www.safaribooksonline.com/static/css/annotator.min.fd58f69f4908.css"><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css"><style type="text/css" title="ibis-book">
    @charset "utf-8";#sbo-rt-content html,#sbo-rt-content div,#sbo-rt-content div,#sbo-rt-content span,#sbo-rt-content applet,#sbo-rt-content object,#sbo-rt-content iframe,#sbo-rt-content h1,#sbo-rt-content h2,#sbo-rt-content h3,#sbo-rt-content h4,#sbo-rt-content h5,#sbo-rt-content h6,#sbo-rt-content p,#sbo-rt-content blockquote,#sbo-rt-content pre,#sbo-rt-content a,#sbo-rt-content abbr,#sbo-rt-content acronym,#sbo-rt-content address,#sbo-rt-content big,#sbo-rt-content cite,#sbo-rt-content code,#sbo-rt-content del,#sbo-rt-content dfn,#sbo-rt-content em,#sbo-rt-content font,#sbo-rt-content img,#sbo-rt-content ins,#sbo-rt-content kbd,#sbo-rt-content q,#sbo-rt-content s,#sbo-rt-content samp,#sbo-rt-content small,#sbo-rt-content strike,#sbo-rt-content strong,#sbo-rt-content sub,#sbo-rt-content sup,#sbo-rt-content tt,#sbo-rt-content var,#sbo-rt-content b,#sbo-rt-content u,#sbo-rt-content i,#sbo-rt-content center,#sbo-rt-content dl,#sbo-rt-content dt,#sbo-rt-content dd,#sbo-rt-content ol,#sbo-rt-content ul,#sbo-rt-content li,#sbo-rt-content fieldset,#sbo-rt-content form,#sbo-rt-content label,#sbo-rt-content legend,#sbo-rt-content table,#sbo-rt-content caption,#sbo-rt-content tdiv,#sbo-rt-content tfoot,#sbo-rt-content thead,#sbo-rt-content tr,#sbo-rt-content th,#sbo-rt-content td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}@page{margin:5px !important}#sbo-rt-content p{margin:8px 0 0;line-height:125%;text-align:left}#sbo-rt-content em{font-style:italic;font-family:inherit}#sbo-rt-content em.replaceable{font-style:italic}#sbo-rt-content em strong,#sbo-rt-content strong em{font-weight:bold;font-style:italic;font-family:inherit}#sbo-rt-content strong.userinput{font-weight:bold;font-style:normal}#sbo-rt-content span.bolditalic{font-weight:bold;font-style:italic}#sbo-rt-content strong,#sbo-rt-content span.bold{font-weight:bold}#sbo-rt-content a.ulink,#sbo-rt-content a.xref,#sbo-rt-content a.email,#sbo-rt-content a.link{text-decoration:none;color:#8e0012}#sbo-rt-content sup{font-size:x-small;vertical-align:super}#sbo-rt-content sub{font-size:smaller;vertical-align:sub}#sbo-rt-content span.lineannotation{font-style:italic;color:#A62A2A;font-family:serif,"DejaVuSerif"}#sbo-rt-content span.underline{text-decoration:underline}#sbo-rt-content span.strikethrough{text-decoration:line-through}#sbo-rt-content span.smallcaps{font-variant:small-caps}#sbo-rt-content span.cursor{background:#000;color:#FFF}#sbo-rt-content span.smaller{font-size:75%}#sbo-rt-content .boxedtext,#sbo-rt-content .keycap{border-style:solid;border-width:1px;border-color:#000;padding:1px}#sbo-rt-content span.gray50{color:#7F7F7F;}#sbo-rt-content .gray-background,#sbo-rt-content .reverse-video{background:#2E2E2E;color:#FFF}#sbo-rt-content .light-gray-background{background:#A0A0A0}#sbo-rt-content .preserve-whitespace{white-space:pre-wrap}#sbo-rt-content h1,#sbo-rt-content div.toc-title,#sbo-rt-content h2,#sbo-rt-content h3,#sbo-rt-content h4,#sbo-rt-content h5{-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;font-weight:bold;text-align:left;page-break-after:avoid !important;font-family:sans-serif,"DejaVuSans"}#sbo-rt-content h1,#sbo-rt-content div.toc-title{font-size:1.5em;margin-top:20px !important}#sbo-rt-content h2{font-size:1.3em;color:#8e0012;margin:40px 0 8px 0}#sbo-rt-content h3{font-size:1.1em;margin:30px 0 8px 0 !important}#sbo-rt-content h4{font-size:1em;color:#555;margin:20px 0 8px 0 !important}#sbo-rt-content h5{font-size:1em;font-weight:normal;font-style:italic;margin:15px 0 6px 0 !important}#sbo-rt-content section.chapter div.titlepage,#sbo-rt-content section.appendix div.titlepage,#sbo-rt-content section.preface div.titlepage{page-break-inside:avoid;page-break-after:avoid}#sbo-rt-content section.chapter>div.titlepage,#sbo-rt-content section.preface>div.titlepage,#sbo-rt-content section.appendix>div.titlepage{margin-bottom:50px}#sbo-rt-content section.chapter>div.titlepage h2.title,#sbo-rt-content section.preface>div.titlepage h2.title,#sbo-rt-content section.appendix>div.titlepage h2.title{font-size:2em;line-height:1;margin-bottom:15px;color:#000;padding-bottom:10px;border-bottom:1px solid #000}#sbo-rt-content div.toc-title{margin-bottom:30px !important}#sbo-rt-content div.part h1{font-size:2em;text-align:center;margin-top:0 !important;padding:50px 0 20px 0;border-bottom:1px solid #000}#sbo-rt-content img{max-width:95%;margin:0 auto;padding:0}#sbo-rt-content div.figure{background-color:transparent;text-align:center;-webkit-border-radius:5px;border-radius:5px;border:1px solid #DCDCDC;padding:15px 5px 15px 5px !important;margin:30px 0 30px 0 !important;max-height:100%;page-break-inside:avoid}#sbo-rt-content div.figure-title,#sbo-rt-content div.informalfigure div.caption{font-size:90%;text-align:center;font-weight:normal;font-style:italic;font-family:serif,"DejaVuSerif";color:#000;padding:5px !important;page-break-before:avoid;page-break-after:avoid}#sbo-rt-content div.informalfigure{text-align:center;padding:5px 0 !important}#sbo-rt-content div.sidebar{margin:30px 0 20px 0 !important;-webkit-border-radius:5px;border-radius:5px;border:1px solid #DCDCDC;background-color:#F7F7F7;font-size:90%;padding:15px !important;page-break-inside:avoid}#sbo-rt-content div.sidebar-title{font-weight:bold;font-size:1em;font-family:sans-serif,"DejaVuSans";text-transform:uppercase;letter-spacing:1px;text-align:center;margin:4px 0 6px 0 !important;page-break-inside:avoid}#sbo-rt-content div.sidebar div.figure p.title,#sbo-rt-content div.sidebar div.informalfigure div.caption{font-size:90%;text-align:center;font-weight:normal;font-style:italic;font-family:serif,"DejaVuSerif";color:#000;padding:5px !important;page-break-before:avoid;page-break-after:avoid}#sbo-rt-content div.sidebar ol{margin-left:15px}#sbo-rt-content div.sidebar div.tip,#sbo-rt-content div.sidebar div.note,#sbo-rt-content div.sidebar div.warning,#sbo-rt-content div.sidebar div.caution,#sbo-rt-content div.sidebar div.important{margin:20px auto 20px auto !important;font-size:90%;width:85%}#sbo-rt-content div.sidebar div.figure{border:none}#sbo-rt-content pre{white-space:pre-wrap;font-family:"Ubuntu Mono",monospace;margin:25px 0 25px 20px;font-size:85%;display:block;-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none}#sbo-rt-content div.note pre.programlisting,#sbo-rt-content div.tip pre.programlisting,#sbo-rt-content div.warning pre.programlisting,#sbo-rt-content div.caution pre.programlisting,#sbo-rt-content div.important pre.programlisting{margin-bottom:0}#sbo-rt-content code{font-family:"Ubuntu Mono",monospace}#sbo-rt-content code strong em,#sbo-rt-content code em strong,#sbo-rt-content pre em strong,#sbo-rt-content pre strong em,#sbo-rt-content strong code em code,#sbo-rt-content em code strong code,#sbo-rt-content span.bolditalic code{font-weight:bold;font-style:italic;font-family:"Ubuntu Mono BoldItal",monospace}#sbo-rt-content code em,#sbo-rt-content em code,#sbo-rt-content pre em,#sbo-rt-content em.replaceable{font-family:"Ubuntu Mono Ital",monospace;font-style:italic}#sbo-rt-content code strong,#sbo-rt-content strong code,#sbo-rt-content pre strong,#sbo-rt-content strong.userinput{font-family:"Ubuntu Mono Bold",monospace;font-weight:bold}#sbo-rt-content div.example{margin:10px 0 15px 0 !important}#sbo-rt-content div.example-title{font-style:italic;font-weight:normal;font-family:serif,"DejaVuSerif";margin:10px 0 5px 0 !important;border-bottom:1px solid #000}#sbo-rt-content li pre.example{padding:10px 0 !important}#sbo-rt-content div.example-contents pre.programlisting,#sbo-rt-content div.example-contents pre.screen{margin:0}#sbo-rt-content span.gray{color:#4C4C4C}#sbo-rt-content div.book div.titlepage h1.title{font-size:3em;font-family:sans-serif,"DejaVuSans";font-weight:bold;margin:50px 0 10px 0 !important;line-height:1;text-align:center}#sbo-rt-content div.book div.titlepage h2.subtitle{text-align:center;color:#000;margin:0 !important;font-style:italic;font-family:serif;font-size:1.5em}#sbo-rt-content div.book div.titlepage div.author h3{font-size:2em;font-family:sans-serif,"DejaVuSans";font-weight:bold;color:#8e0012;margin:50px 0 !important;text-align:center}#sbo-rt-content div.book div.titlepage div.publishername{margin-top:60%;margin-bottom:20px;text-align:center;font-size:1.25em}#sbo-rt-content div.book div.titlepage div.locations p{margin:0;text-align:center}#sbo-rt-content div.book div.titlepage div.locations p.cities{font-size:80%;text-align:center;margin-top:5px}#sbo-rt-content section.preface[title="Dedication"]>div.titlepage h2.title{text-align:center;text-transform:uppercase;font-size:1.5em;margin-top:50px;margin-bottom:50px}#sbo-rt-content section.preface[title="Dedication"] p{font-style:italic;text-align:center}#sbo-rt-content div.colophon h1.title{font-size:1.3em;margin:0 !important;font-family:serif,"DejaVuSerif";font-weight:normal}#sbo-rt-content div.colophon h2.subtitle{margin:0 !important;color:#000;font-family:serif,"DejaVuSerif";font-size:1em;font-weight:normal}#sbo-rt-content div.colophon div.author h3.author{font-size:1.1em;font-family:serif,"DejaVuSerif";margin:10px 0 0 !important;font-weight:normal}#sbo-rt-content div.colophon div.editor h4,#sbo-rt-content div.colophon div.editor h3.editor{color:#000;font-size:.8em;margin:15px 0 0 !important;font-family:serif,"DejaVuSerif";font-weight:normal}#sbo-rt-content div.colophon div.editor h3.editor{font-size:.8em;margin:0 !important;font-family:serif,"DejaVuSerif";font-weight:normal}#sbo-rt-content div.colophon div.publisher{margin-top:10px}#sbo-rt-content div.colophon div.publisher p,#sbo-rt-content div.colophon div.publisher span.publishername{margin:0;font-size:.8em}#sbo-rt-content div.legalnotice p,#sbo-rt-content div.timestamp p{font-size:.8em}#sbo-rt-content div.timestamp p{margin-top:10pt}#sbo-rt-content div.colophon[title="About the Author"] h1.title,#sbo-rt-content div.colophon[title="Colophon"] h1.title{font-size:1.5em;margin:0 !important;font-family:sans-serif,"DejaVuSans";font-weight:bold}#sbo-rt-content section.chapter div.titlepage div.author{margin:10px 0 10px 0}#sbo-rt-content section.chapter div.titlepage div.author div.affiliation{font-style:italic}#sbo-rt-content div.attribution{margin:5px 0 0 50px !important}#sbo-rt-content h3.author span.orgname{display:none}#sbo-rt-content div.epigraph{margin:10px 0 10px 20px !important;page-break-inside:avoid;font-size:90%}#sbo-rt-content div.epigraph p{font-style:italic}#sbo-rt-content blockquote,#sbo-rt-content div.blockquote{margin:10px !important;page-break-inside:avoid;font-size:95%}#sbo-rt-content blockquote p,#sbo-rt-content div.blockquote p{font-family:serif,"DejaVuSerif";font-style:italic}#sbo-rt-content blockquote div.attribution{margin:5px 0 0 30px !important;text-align:right;width:80%}#sbo-rt-content blockquote div.attribution p{font-style:normal}#sbo-rt-content p.right{text-align:right;margin:0}#sbo-rt-content div.footnote{font-size:90%}#sbo-rt-content div.refnamediv h2,#sbo-rt-content div.refnamediv h3,#sbo-rt-content div.refsynopsisdiv h2{font-size:1.1em;color:#000;margin-top:15px !important;margin-bottom:0 !important}#sbo-rt-content div.refentry div.refsect1 h2{font-size:1.1em;color:#000;margin-top:15px !important;margin-bottom:0 !important}#sbo-rt-content div.refsect2 h3{font-size:1em;color:#000;margin-top:10px !important;margin-bottom:0 !important}#sbo-rt-content div.refnamediv p{margin-left:15px !important}#sbo-rt-content dt{padding-top:10px !important;padding-bottom:0 !important}#sbo-rt-content dt span.term{font-weight:bold;font-style:italic}#sbo-rt-content dt span.term code.literal{font-style:normal;font-weight:normal}#sbo-rt-content dd{margin-left:1.5em !important}#sbo-rt-content dd,#sbo-rt-content li{text-align:left}#sbo-rt-content ol{list-style-type:decimal;margin-top:8px !important;margin-bottom:8px !important;margin-left:20px !important;padding-left:25px !important}#sbo-rt-content ol ol{list-style-type:lower-alpha}#sbo-rt-content ol ol ol{list-style-type:lower-roman}#sbo-rt-content ul{list-style-type:square;margin-top:8px !important;margin-bottom:8px !important;margin-left:5px !important;padding-left:20px !important}#sbo-rt-content ul ul{list-style-type:none;padding-left:0 !important;margin-left:0 !important}#sbo-rt-content ol li,#sbo-rt-content ul li,#sbo-rt-content dd{margin-bottom:1em}#sbo-rt-content ul ul li p:before{content:"— "}#sbo-rt-content ul ul ul li p:before{content:""}#sbo-rt-content ul ul ul{list-style-type:square;margin-left:20px !important;padding-left:30px !important}#sbo-rt-content div.orderedlistalpha{list-style-type:upper-alpha}#sbo-rt-content table.simplelist{margin-left:20px !important;margin-bottom:10px}#sbo-rt-content table.simplelist td{border:none;font-size:90%}#sbo-rt-content table.simplelist tr{border-bottom:none}#sbo-rt-content table.simplelist tr:nth-of-type(even){background-color:transparent}#sbo-rt-content div.calloutlist p:first-child{margin-top:-25px !important}#sbo-rt-content div.calloutlist dd{padding-left:0;margin-top:-25px}#sbo-rt-content div.calloutlist img{padding:0}#sbo-rt-content a.co img{padding:0}#sbo-rt-content div.calloutlist>dl>dd>div.orderedlist{margin-top:25pt}#sbo-rt-content div.calloutlist>dl>dd>div.orderedlist>ol.orderedlist>li{margin-bottom:25pt}#sbo-rt-content div.toc ol{margin-top:8px !important;margin-bottom:8px !important;margin-left:0 !important;padding-left:0 !important}#sbo-rt-content div.toc ol ol{margin-left:30px !important;padding-left:0 !important}#sbo-rt-content div.toc ol li{list-style-type:none}#sbo-rt-content div.toc a{color:#8e0012}#sbo-rt-content div.toc ol a{font-size:1em;font-weight:bold}#sbo-rt-content div.toc ol>li>ol a{font-weight:bold;font-size:1em}#sbo-rt-content div.toc ol>li>ol>li>ol a{text-decoration:none;font-weight:normal;font-size:1em}#sbo-rt-content div.tip,#sbo-rt-content div.note,#sbo-rt-content div.warning,#sbo-rt-content div.caution,#sbo-rt-content div.important{margin:30px !important;-webkit-border-radius:5px;border-radius:5px;font-size:90%;padding:10px 8px 20px 8px !important;page-break-inside:avoid}#sbo-rt-content div.tip,#sbo-rt-content div.note,#sbo-rt-content div.important{border:1px solid #BEBEBE;background-color:transparent}#sbo-rt-content div.warning,#sbo-rt-content div.caution{border:1px solid #BC8F8F}#sbo-rt-content div.tip h3,#sbo-rt-content div.note h3,#sbo-rt-content div.warning h3,#sbo-rt-content div.caution h3,#sbo-rt-content div.important h3{font:bold 90%;font-family:sans-serif,"DejaVuSans";text-transform:uppercase;letter-spacing:1px;text-align:center;margin:4px 0 6px !important}#sbo-rt-content div.tip h3,#sbo-rt-content div.note h3,#sbo-rt-content div.important h3{color:#737373}#sbo-rt-content div.warning h3,#sbo-rt-content div.caution h3{color:#C67171}#sbo-rt-content div.sect1[title="Safari® Books Online"] div.note{background-color:transparent;margin:8px 0 0 !important;border:0 solid #BEBEBE;-webkit-border-radius:0;border-radius:0;font-size:100%;padding:0 !important;page-break-inside:avoid}#sbo-rt-content div.sect1[title="Safari® Books Online"] div.note h3{display:none}#sbo-rt-content div.table,#sbo-rt-content table{margin:15px auto 30px auto !important;max-width:95%;border-collapse:collapse;border-spacing:0}#sbo-rt-content div.table,#sbo-rt-content div.informaltable{page-break-inside:avoid}#sbo-rt-content tr{border-bottom:1px solid #c3c3c3}#sbo-rt-content thead td{border-bottom:#9d9d9d 1px solid !important;border-top:#9d9d9d 1px solid !important}#sbo-rt-content tr:nth-of-type(even){background-color:#f1f6fc}#sbo-rt-content thead{font-family:sans-serif,"DejaVuSans";color:#000;font-weight:bold}#sbo-rt-content td{padding:.3em;text-align:left;vertical-align:baseline;font-size:80%}#sbo-rt-content div.informaltable table{margin:10px auto !important}#sbo-rt-content div.informaltable table tr{border-bottom:none}#sbo-rt-content div.informaltable table tr:nth-of-type(even){background-color:transparent}#sbo-rt-content div.informaltable td,#sbo-rt-content div.informaltable th{border:#9d9d9d 1px solid}#sbo-rt-content div.table-title{font-weight:normal;font-style:italic;font-family:serif,"DejaVuSerif";margin:20px 0 0 0 !important;text-align:center;padding:0}#sbo-rt-content table code{font-size:smaller}#sbo-rt-content div.equation{margin:10px 0 15px 0 !important}#sbo-rt-content div.equation-title{font-style:italic;font-weight:normal;font-family:serif,"DejaVuSerif";margin:20px 0 10px 0 !important;page-break-after:avoid}#sbo-rt-content div.equation-contents{margin-left:20px}#sbo-rt-content span.inlinemediaobject{height:.85em;display:inline-block;margin-bottom:.2em}#sbo-rt-content span.inlinemediaobject img{margin:0;height:.85em}#sbo-rt-content div.informalequation{margin:20px 0 20px 20px;width:75%}#sbo-rt-content div.informalequation img{width:75%}#sbo-rt-content div.index{font-weight:bold}#sbo-rt-content div.index dt{line-height:140%}#sbo-rt-content div.index a.indexterm{color:#8e0012}#sbo-rt-content code.boolean,#sbo-rt-content .navy{color:rgb(0,0,128);}#sbo-rt-content code.character,#sbo-rt-content .olive{color:rgb(128,128,0);}#sbo-rt-content code.comment,#sbo-rt-content .blue{color:rgb(0,0,255);}#sbo-rt-content code.conditional,#sbo-rt-content .limegreen{color:rgb(50,205,50);}#sbo-rt-content code.constant,#sbo-rt-content .darkorange{color:rgb(255,140,0);}#sbo-rt-content code.debug,#sbo-rt-content .darkred{color:rgb(139,0,0);}#sbo-rt-content code.define,#sbo-rt-content .darkgoldenrod,#sbo-rt-content .gold{color:rgb(184,134,11);}#sbo-rt-content code.delimiter,#sbo-rt-content .dimgray{color:rgb(105,105,105);}#sbo-rt-content code.error,#sbo-rt-content .red{color:rgb(255,0,0);}#sbo-rt-content code.exception,#sbo-rt-content .salmon{color:rgb(250,128,11);}#sbo-rt-content code.float,#sbo-rt-content .steelblue{color:rgb(70,130,180);}#sbo-rt-content pre code.function,#sbo-rt-content .green{color:rgb(0,128,0);}#sbo-rt-content code.identifier,#sbo-rt-content .royalblue{color:rgb(65,105,225);}#sbo-rt-content code.ignore,#sbo-rt-content .gray{color:rgb(128,128,128);}#sbo-rt-content code.include,#sbo-rt-content .purple{color:rgb(128,0,128);}#sbo-rt-content code.keyword,#sbo-rt-content .sienna{color:rgb(160,82,45);}#sbo-rt-content code.label,#sbo-rt-content .deeppink{color:rgb(255,20,147);}#sbo-rt-content code.macro,#sbo-rt-content .orangered{color:rgb(255,69,0);}#sbo-rt-content code.number,#sbo-rt-content .brown{color:rgb(165,42,42);}#sbo-rt-content code.operator,#sbo-rt-content .black{color:#000;}#sbo-rt-content code.preCondit,#sbo-rt-content .teal{color:rgb(0,128,128);}#sbo-rt-content code.preProc,#sbo-rt-content .fuschia{color:rgb(255,0,255);}#sbo-rt-content code.repeat,#sbo-rt-content .indigo{color:rgb(75,0,130);}#sbo-rt-content code.special,#sbo-rt-content .saddlebrown{color:rgb(139,69,19);}#sbo-rt-content code.specialchar,#sbo-rt-content .magenta{color:rgb(255,0,255);}#sbo-rt-content code.specialcomment,#sbo-rt-content .seagreen{color:rgb(46,139,87);}#sbo-rt-content code.statement,#sbo-rt-content .forestgreen{color:rgb(34,139,34);}#sbo-rt-content code.storageclass,#sbo-rt-content .plum{color:rgb(221,160,221);}#sbo-rt-content code.string,#sbo-rt-content .darkred{color:rgb(139,0,0);}#sbo-rt-content code.structure,#sbo-rt-content .chocolate{color:rgb(210,106,30);}#sbo-rt-content code.tag,#sbo-rt-content .darkcyan{color:rgb(0,139,139);}#sbo-rt-content code.todo,#sbo-rt-content .black{color:#000;}#sbo-rt-content code.type,#sbo-rt-content .mediumslateblue{color:rgb(123,104,238);}#sbo-rt-content code.typedef,#sbo-rt-content .darkgreen{color:rgb(0,100,0);}#sbo-rt-content code.underlined{text-decoration:underline;}#sbo-rt-content pre code.hll{background-color:#ffc}#sbo-rt-content pre code.c{color:#09F;font-style:italic}#sbo-rt-content pre code.err{color:#A00}#sbo-rt-content pre code.k{color:#069;font-weight:bold}#sbo-rt-content pre code.o{color:#555}#sbo-rt-content pre code.cm{color:#35586C;font-style:italic}#sbo-rt-content pre code.cp{color:#099}#sbo-rt-content pre code.c1{color:#35586C;font-style:italic}#sbo-rt-content pre code.cs{color:#35586C;font-weight:bold;font-style:italic}#sbo-rt-content pre code.gd{background-color:#FCC}#sbo-rt-content pre code.ge{font-style:italic}#sbo-rt-content pre code.gr{color:#F00}#sbo-rt-content pre code.gh{color:#030;font-weight:bold}#sbo-rt-content pre code.gi{background-color:#CFC}#sbo-rt-content pre code.go{color:#000}#sbo-rt-content pre code.gp{color:#009;font-weight:bold}#sbo-rt-content pre code.gs{font-weight:bold}#sbo-rt-content pre code.gu{color:#030;font-weight:bold}#sbo-rt-content pre code.gt{color:#9C6}#sbo-rt-content pre code.kc{color:#069;font-weight:bold}#sbo-rt-content pre code.kd{color:#069;font-weight:bold}#sbo-rt-content pre code.kn{color:#069;font-weight:bold}#sbo-rt-content pre code.kp{color:#069}#sbo-rt-content pre code.kr{color:#069;font-weight:bold}#sbo-rt-content pre code.kt{color:#078;font-weight:bold}#sbo-rt-content pre code.m{color:#F60}#sbo-rt-content pre code.s{color:#C30}#sbo-rt-content pre code.na{color:#309}#sbo-rt-content pre code.nb{color:#366}#sbo-rt-content pre code.nc{color:#0A8;font-weight:bold}#sbo-rt-content pre code.no{color:#360}#sbo-rt-content pre code.nd{color:#99F}#sbo-rt-content pre code.ni{color:#999;font-weight:bold}#sbo-rt-content pre code.ne{color:#C00;font-weight:bold}#sbo-rt-content pre code.nf{color:#C0F}#sbo-rt-content pre code.nl{color:#99F}#sbo-rt-content pre code.nn{color:#0CF;font-weight:bold}#sbo-rt-content pre code.nt{color:#309;font-weight:bold}#sbo-rt-content pre code.nv{color:#033}#sbo-rt-content pre code.ow{color:#000;font-weight:bold}#sbo-rt-content pre code.w{color:#bbb}#sbo-rt-content pre code.mf{color:#F60}#sbo-rt-content pre code.mh{color:#F60}#sbo-rt-content pre code.mi{color:#F60}#sbo-rt-content pre code.mo{color:#F60}#sbo-rt-content pre code.sb{color:#C30}#sbo-rt-content pre code.sc{color:#C30}#sbo-rt-content pre code.sd{color:#C30;font-style:italic}#sbo-rt-content pre code.s2{color:#C30}#sbo-rt-content pre code.se{color:#C30;font-weight:bold}#sbo-rt-content pre code.sh{color:#C30}#sbo-rt-content pre code.si{color:#A00}#sbo-rt-content pre code.sx{color:#C30}#sbo-rt-content pre code.sr{color:#3AA}#sbo-rt-content pre code.s1{color:#C30}#sbo-rt-content pre code.ss{color:#A60}#sbo-rt-content pre code.bp{color:#366}#sbo-rt-content pre code.vc{color:#033}#sbo-rt-content pre code.vg{color:#033}#sbo-rt-content pre code.vi{color:#033}#sbo-rt-content pre code.il{color:#F60}#sbo-rt-content pre code.g{color:#050}#sbo-rt-content pre code.l{color:#C60}#sbo-rt-content pre code.l{color:#F90}#sbo-rt-content pre code.n{color:#008}#sbo-rt-content pre code.nx{color:#008}#sbo-rt-content pre code.py{color:#96F}#sbo-rt-content pre code.p{color:#000}#sbo-rt-content pre code.x{color:#F06}#sbo-rt-content div.blockquote_sampler_toc{width:95%;margin:5px 5px 5px 10px !important}#sbo-rt-content div{font-family:serif,"DejaVuSerif";text-align:left}
    </style><link rel="canonical" href="/site/library/view/high-performance-python/9781449361747/ch12.html"><meta name="description" content="Chapter&nbsp;12.&nbsp;Lessons from the Field Questions you’ll be able to answer after this chapter How do successful start-ups deal with large volumes of data and machine learning? What ... "><meta property="og:title" content="12. Lessons from the Field"><meta itemprop="isPartOf" content="/library/view/high-performance-python/9781449361747/"><meta itemprop="name" content="12. Lessons from the Field"><meta property="og:url" itemprop="url" content="https://www.safaribooksonline.com/library/view/high-performance-python/9781449361747/ch12.html"><meta property="og:site_name" content="Safari"><meta property="og:image" itemprop="thumbnailUrl" content="https://www.safaribooksonline.com/library/cover/9781449361747/"><meta property="og:description" itemprop="description" content="Chapter&nbsp;12.&nbsp;Lessons from the Field Questions you’ll be able to answer after this chapter How do successful start-ups deal with large volumes of data and machine learning? What ... "><meta itemprop="inLanguage" content="en"><meta itemprop="publisher" content="O'Reilly Media, Inc."><meta property="og:type" content="book"><meta property="og:book:isbn" itemprop="isbn" content="9781449361594"><meta property="og:book:author" itemprop="author" content="Ian Ozsvald"><meta property="og:book:author" itemprop="author" content="Micha Gorelick"><meta property="og:book:tag" itemprop="about" content="Python"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@safari"><style type="text/css" id="font-styles" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-size: <%= font_size %> !important; }"></style><style type="text/css" id="font-family" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-family: <%= font_family %> !important; }"></style><style type="text/css" id="column-width" data-template="#sbo-rt-content { max-width: <%= column_width %>% !important; margin: 0 auto !important; }"></style><!--[if lt IE 9]><script src="/static/js/src/respond.min.cf5c9b7980e5.js"></script><![endif]--><style id="annotator-dynamic-style">.annotator-adder, .annotator-outer, .annotator-notice {
  z-index: 100019;
}
.annotator-filter {
  z-index: 100009;
}</style></head>


<body class="reading sidenav nav-collapsed  scalefonts library" data-gr-c-s-loaded="true">

    
      <div class="hide working" role="status">
        <div class="working-image"></div>
      </div>
      <div class="sbo-site-nav">
        




<a href="https://www.safaribooksonline.com//library/view/high-performance-python/9781449361747/ch12.html#container" class="skip">Skip to content</a><header class="topbar t-topbar" style="display:None"><nav role="navigation" class="js-site-nav"><ul class="topnav"><li class="t-logo"><a href="https://www.safaribooksonline.com/home/" class="l0 None safari-home nav-icn js-keyboard-nav-home"><svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" version="1.1" fill="#4A3C31"><desc>Safari Home Icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M4 9.9L4 9.9 4 18 16 18 16 9.9 10 4 4 9.9ZM2.6 8.1L2.6 8.1 8.7 1.9 10 0.5 11.3 1.9 17.4 8.1 18 8.7 18 9.5 18 18.1 18 20 16.1 20 3.9 20 2 20 2 18.1 2 9.5 2 8.7 2.6 8.1Z"></path><rect x="10" y="12" width="3" height="7"></rect><rect transform="translate(18.121320, 10.121320) rotate(-315.000000) translate(-18.121320, -10.121320) " x="16.1" y="9.1" width="4" height="2"></rect><rect transform="translate(2.121320, 10.121320) scale(-1, 1) rotate(-315.000000) translate(-2.121320, -10.121320) " x="0.1" y="9.1" width="4" height="2"></rect></g></svg><span>Safari Home</span></a></li><li><a href="https://www.safaribooksonline.com/r/" class="t-recommendations-nav l0 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" version="1.1" fill="#4A3C31"><desc>recommendations icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M50 25C50 18.2 44.9 12.5 38.3 11.7 37.5 5.1 31.8 0 25 0 18.2 0 12.5 5.1 11.7 11.7 5.1 12.5 0 18.2 0 25 0 31.8 5.1 37.5 11.7 38.3 12.5 44.9 18.2 50 25 50 31.8 50 37.5 44.9 38.3 38.3 44.9 37.5 50 31.8 50 25ZM25 3.1C29.7 3.1 33.6 6.9 34.4 11.8 30.4 12.4 26.9 15.1 25 18.8 23.1 15.1 19.6 12.4 15.6 11.8 16.4 6.9 20.3 3.1 25 3.1ZM34.4 15.6C33.6 19.3 30.7 22.2 27.1 22.9 27.8 19.2 30.7 16.3 34.4 15.6ZM22.9 22.9C19.2 22.2 16.3 19.3 15.6 15.6 19.3 16.3 22.2 19.2 22.9 22.9ZM3.1 25C3.1 20.3 6.9 16.4 11.8 15.6 12.4 19.6 15.1 23.1 18.8 25 15.1 26.9 12.4 30.4 11.8 34.4 6.9 33.6 3.1 29.7 3.1 25ZM22.9 27.1C22.2 30.7 19.3 33.6 15.6 34.4 16.3 30.7 19.2 27.8 22.9 27.1ZM25 46.9C20.3 46.9 16.4 43.1 15.6 38.2 19.6 37.6 23.1 34.9 25 31.3 26.9 34.9 30.4 37.6 34.4 38.2 33.6 43.1 29.7 46.9 25 46.9ZM27.1 27.1C30.7 27.8 33.6 30.7 34.4 34.4 30.7 33.6 27.8 30.7 27.1 27.1ZM38.2 34.4C37.6 30.4 34.9 26.9 31.3 25 34.9 23.1 37.6 19.6 38.2 15.6 43.1 16.4 46.9 20.3 46.9 25 46.9 29.7 43.1 33.6 38.2 34.4Z" fill="currentColor"></path></g></svg><span>Recommended</span></a></li><li><a href="https://www.safaribooksonline.com/s/" class="t-queue-nav l0 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" version="1.1" fill="#4A3C31"><desc>queue icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 29.2C25.4 29.2 25.8 29.1 26.1 28.9L48.7 16.8C49.5 16.4 50 15.5 50 14.6 50 13.7 49.5 12.8 48.7 12.4L26.1 0.3C25.4-0.1 24.6-0.1 23.9 0.3L1.3 12.4C0.5 12.8 0 13.7 0 14.6 0 15.5 0.5 16.4 1.3 16.8L23.9 28.9C24.2 29.1 24.6 29.2 25 29.2ZM7.3 14.6L25 5.2 42.7 14.6 25 24 7.3 14.6ZM48.7 22.4L47.7 21.9 25 34.2 2.3 21.9 1.3 22.4C0.5 22.9 0 23.7 0 24.7 0 25.6 0.5 26.5 1.3 26.9L23.9 39.3C24.2 39.5 24.6 39.6 25 39.6 25.4 39.6 25.8 39.5 26.1 39.3L48.7 26.9C49.5 26.5 50 25.6 50 24.7 50 23.7 49.5 22.9 48.7 22.4ZM48.7 32.8L47.7 32.3 25 44.6 2.3 32.3 1.3 32.8C0.5 33.3 0 34.1 0 35.1 0 36 0.5 36.9 1.3 37.3L23.9 49.7C24.2 49.9 24.6 50 25 50 25.4 50 25.8 49.9 26.1 49.7L48.7 37.3C49.5 36.9 50 36 50 35.1 50 34.1 49.5 33.3 48.7 32.8Z" fill="currentColor"></path></g></svg><span>Queue</span></a></li><li class="search"><a href="https://www.safaribooksonline.com//library/view/high-performance-python/9781449361747/ch12.html#" class="t-search-nav trigger nav-icn l0" data-dropdown-selector=".searchbox"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" version="1.1" fill="#4A3C31"><desc>search icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M31.3 0C20.9 0 12.5 8.4 12.5 18.8 12.5 22.5 13.6 25.9 15.4 28.8L1.2 42.9C-0.4 44.5-0.4 47.2 1.2 48.8 2 49.6 3.1 50 4.2 50 5.2 50 6.3 49.6 7.1 48.8L21.2 34.6C24.1 36.5 27.5 37.5 31.3 37.5 41.6 37.5 50 29.1 50 18.8 50 8.4 41.6 0 31.3 0ZM31.3 31.3C24.4 31.3 18.8 25.6 18.8 18.8 18.8 11.9 24.4 6.3 31.3 6.3 38.1 6.3 43.8 11.9 43.8 18.8 43.8 25.6 38.1 31.3 31.3 31.3Z" fill="currentColor"></path></g></svg><span>Search</span></a></li><li class="usermenu dropdown"><a href="https://www.safaribooksonline.com//library/view/high-performance-python/9781449361747/ch12.html#" class="trigger l0 nav-icn nav-dropdown"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" version="1.1" fill="#4A3C31"><desc>navigation arrow</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M0.1 12.5L9.7 3.1C9.8 3 9.9 3 10 3 10.1 3 10.2 3 10.3 3.1L19.9 12.5C20 12.5 20 12.6 20 12.8 20 12.9 20 13 19.9 13L17 15.9C16.9 16 16.8 16 16.7 16 16.5 16 16.4 16 16.4 15.9L10 9.7 3.6 15.9C3.6 16 3.5 16 3.3 16 3.2 16 3.1 16 3 15.9L0.1 13C0 12.9 0 12.8 0 12.7 0 12.7 0 12.6 0.1 12.5Z"></path></g></svg><span>Expand Nav</span></a><div class="drop-content"><ul><li><a href="https://www.safaribooksonline.com/history/" class="t-recent-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" version="1.1" fill="#4A3C31"><desc>recent items icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 0C11.2 0 0 11.2 0 25 0 38.8 11.2 50 25 50 38.8 50 50 38.8 50 25 50 11.2 38.8 0 25 0ZM6.3 25C6.3 14.6 14.6 6.3 25 6.3 35.4 6.3 43.8 14.6 43.8 25 43.8 35.4 35.4 43.8 25 43.8 14.6 43.8 6.3 35.4 6.3 25ZM31.8 31.5C32.5 30.5 32.4 29.2 31.6 28.3L27.1 23.8 27.1 12.8C27.1 11.5 26.2 10.4 25 10.4 23.9 10.4 22.9 11.5 22.9 12.8L22.9 25.7 28.8 31.7C29.2 32.1 29.7 32.3 30.2 32.3 30.8 32.3 31.3 32 31.8 31.5Z" fill="currentColor"></path></g></svg><span>History</span></a></li><li><a href="https://www.safaribooksonline.com/topics" class="t-topics-link l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 55" version="1.1" fill="#4A3C31"><desc>topics icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 55L50 41.262 50 13.762 25 0 0 13.762 0 41.262 25 55ZM8.333 37.032L8.333 17.968 25 8.462 41.667 17.968 41.667 37.032 25 46.538 8.333 37.032Z" fill="currentColor"></path></g></svg><span>Topics</span></a></li><li><a href="https://www.safaribooksonline.com/tutorials/" class="l1 nav-icn t-tutorials-nav js-toggle-menu-item None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" version="1.1" fill="#4A3C31"><desc>tutorials icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M15.8 18.2C15.8 18.2 15.9 18.2 16 18.2 16.1 18.2 16.2 18.2 16.4 18.2 16.5 18.2 16.7 18.1 16.9 18 17 17.9 17.1 17.8 17.2 17.7 17.3 17.6 17.4 17.5 17.4 17.4 17.5 17.2 17.6 16.9 17.6 16.7 17.6 16.6 17.6 16.5 17.6 16.4 17.5 16.2 17.5 16.1 17.4 15.9 17.3 15.8 17.2 15.6 17 15.5 16.8 15.3 16.6 15.3 16.4 15.2 16.2 15.2 16 15.2 15.8 15.2 15.7 15.2 15.5 15.3 15.3 15.4 15.2 15.4 15.1 15.5 15 15.7 14.9 15.8 14.8 15.9 14.7 16 14.7 16.1 14.6 16.3 14.6 16.4 14.6 16.5 14.6 16.6 14.6 16.6 14.6 16.7 14.6 16.9 14.6 17 14.6 17.1 14.7 17.3 14.7 17.4 14.8 17.6 15 17.7 15.1 17.9 15.2 18 15.3 18 15.5 18.1 15.5 18.1 15.6 18.2 15.7 18.2 15.7 18.2 15.7 18.2 15.8 18.2L15.8 18.2ZM9.4 11.5C9.5 11.5 9.5 11.5 9.6 11.5 9.7 11.5 9.9 11.5 10 11.5 10.2 11.5 10.3 11.4 10.5 11.3 10.6 11.2 10.8 11.1 10.9 11 10.9 10.9 11 10.8 11.1 10.7 11.2 10.5 11.2 10.2 11.2 10 11.2 9.9 11.2 9.8 11.2 9.7 11.2 9.5 11.1 9.4 11 9.2 10.9 9.1 10.8 8.9 10.6 8.8 10.5 8.7 10.3 8.6 10 8.5 9.9 8.5 9.7 8.5 9.5 8.5 9.3 8.5 9.1 8.6 9 8.7 8.8 8.7 8.7 8.8 8.6 9 8.5 9.1 8.4 9.2 8.4 9.3 8.2 9.5 8.2 9.8 8.2 10 8.2 10.1 8.2 10.2 8.2 10.3 8.2 10.5 8.3 10.6 8.4 10.7 8.5 10.9 8.6 11.1 8.7 11.2 8.9 11.3 9 11.4 9.1 11.4 9.2 11.4 9.3 11.5 9.3 11.5 9.3 11.5 9.4 11.5 9.4 11.5L9.4 11.5ZM3 4.8C3.1 4.8 3.1 4.8 3.2 4.8 3.4 4.8 3.5 4.8 3.7 4.8 3.8 4.8 4 4.7 4.1 4.6 4.3 4.5 4.4 4.4 4.5 4.3 4.6 4.2 4.6 4.1 4.7 4 4.8 3.8 4.8 3.5 4.8 3.3 4.8 3.1 4.8 3 4.8 2.9 4.7 2.8 4.7 2.6 4.6 2.5 4.5 2.3 4.4 2.2 4.2 2.1 4 1.9 3.8 1.9 3.6 1.8 3.5 1.8 3.3 1.8 3.1 1.8 2.9 1.8 2.7 1.9 2.6 2 2.4 2.1 2.3 2.2 2.2 2.3 2.1 2.4 2 2.5 2 2.6 1.8 2.8 1.8 3 1.8 3.3 1.8 3.4 1.8 3.5 1.8 3.6 1.8 3.8 1.9 3.9 2 4 2.1 4.2 2.2 4.4 2.4 4.5 2.5 4.6 2.6 4.7 2.7 4.7 2.8 4.7 2.9 4.8 2.9 4.8 3 4.8 3 4.8 3 4.8L3 4.8ZM13.1 15.2C13.2 15.1 13.2 15.1 13.2 15.1 13.3 14.9 13.4 14.7 13.6 14.5 13.8 14.2 14.1 14 14.4 13.8 14.7 13.6 15.1 13.5 15.5 13.4 15.9 13.4 16.3 13.4 16.7 13.5 17.2 13.5 17.6 13.7 17.9 13.9 18.2 14.1 18.5 14.4 18.7 14.7 18.9 15 19.1 15.3 19.2 15.6 19.3 15.9 19.4 16.1 19.4 16.4 19.4 17 19.3 17.5 19.1 18.1 19 18.3 18.9 18.5 18.7 18.7 18.5 19 18.3 19.2 18 19.4 17.7 19.6 17.3 19.8 16.9 19.9 16.6 20 16.3 20 16 20 15.8 20 15.6 20 15.4 19.9 15.4 19.9 15.4 19.9 15.4 19.9 15.2 19.9 15 19.8 14.9 19.8 14.8 19.7 14.7 19.7 14.6 19.7 14.4 19.6 14.3 19.5 14.1 19.3 13.7 19.1 13.4 18.7 13.2 18.4 13.1 18.1 12.9 17.8 12.9 17.5 12.8 17.3 12.8 17.1 12.8 16.9L3.5 14.9C3.3 14.9 3.1 14.8 3 14.8 2.7 14.7 2.4 14.5 2.1 14.3 1.7 14 1.4 13.7 1.2 13.3 1 13 0.9 12.6 0.8 12.3 0.7 12 0.7 11.7 0.7 11.4 0.7 11 0.8 10.5 1 10.1 1.1 9.8 1.3 9.5 1.6 9.2 1.8 8.9 2.1 8.7 2.4 8.5 2.8 8.3 3.2 8.1 3.6 8.1 3.9 8 4.2 8 4.5 8 4.6 8 4.8 8 4.9 8.1L6.8 8.5C6.8 8.4 6.8 8.4 6.8 8.4 6.9 8.2 7.1 8 7.2 7.8 7.5 7.5 7.7 7.3 8 7.1 8.4 6.9 8.7 6.8 9.1 6.7 9.5 6.7 10 6.7 10.4 6.8 10.8 6.8 11.2 7 11.5 7.2 11.8 7.5 12.1 7.7 12.4 8 12.6 8.3 12.7 8.6 12.8 8.9 12.9 9.2 13 9.4 13 9.7 13 9.7 13 9.8 13 9.8 13.6 9.9 14.2 10.1 14.9 10.2 15 10.2 15 10.2 15.1 10.2 15.3 10.2 15.4 10.2 15.6 10.2 15.8 10.1 16 10 16.2 9.9 16.4 9.8 16.5 9.6 16.6 9.5 16.8 9.2 16.9 8.8 16.9 8.5 16.9 8.3 16.9 8.2 16.8 8 16.8 7.8 16.7 7.7 16.6 7.5 16.5 7.3 16.3 7.2 16.2 7.1 16 7 15.9 6.9 15.8 6.9 15.7 6.9 15.6 6.8 15.5 6.8L6.2 4.8C6.2 5 6 5.2 5.9 5.3 5.7 5.6 5.5 5.8 5.3 6 4.9 6.2 4.5 6.4 4.1 6.5 3.8 6.6 3.5 6.6 3.2 6.6 3 6.6 2.8 6.6 2.7 6.6 2.6 6.6 2.6 6.5 2.6 6.5 2.5 6.5 2.3 6.5 2.1 6.4 1.8 6.3 1.6 6.1 1.3 6 1 5.7 0.7 5.4 0.5 5 0.3 4.7 0.2 4.4 0.1 4.1 0 3.8 0 3.6 0 3.3 0 2.8 0.1 2.2 0.4 1.7 0.5 1.5 0.7 1.3 0.8 1.1 1.1 0.8 1.3 0.6 1.6 0.5 2 0.3 2.3 0.1 2.7 0.1 3.1 0 3.6 0 4 0.1 4.4 0.2 4.8 0.3 5.1 0.5 5.5 0.8 5.7 1 6 1.3 6.2 1.6 6.3 1.9 6.4 2.3 6.5 2.5 6.6 2.7 6.6 3 6.6 3 6.6 3.1 6.6 3.1 9.7 3.8 12.8 4.4 15.9 5.1 16.1 5.1 16.2 5.2 16.4 5.2 16.7 5.3 16.9 5.5 17.2 5.6 17.5 5.9 17.8 6.2 18.1 6.5 18.3 6.8 18.4 7.2 18.6 7.5 18.6 7.9 18.7 8.2 18.7 8.6 18.7 9 18.6 9.4 18.4 9.8 18.3 10.1 18.2 10.3 18 10.6 17.8 10.9 17.5 11.1 17.3 11.3 16.9 11.6 16.5 11.8 16 11.9 15.7 12 15.3 12 15 12 14.8 12 14.7 12 14.5 11.9 13.9 11.8 13.3 11.7 12.6 11.5 12.5 11.7 12.4 11.9 12.3 12 12.1 12.3 11.9 12.5 11.7 12.7 11.3 12.9 10.9 13.1 10.5 13.2 10.2 13.3 9.9 13.3 9.6 13.3 9.4 13.3 9.2 13.3 9 13.2 9 13.2 9 13.2 9 13.2 8.8 13.2 8.7 13.2 8.5 13.1 8.2 13 8 12.8 7.7 12.6 7.4 12.4 7.1 12 6.8 11.7 6.7 11.4 6.6 11.1 6.5 10.8 6.4 10.6 6.4 10.4 6.4 10.2 5.8 10.1 5.2 9.9 4.5 9.8 4.4 9.8 4.4 9.8 4.3 9.8 4.1 9.8 4 9.8 3.8 9.8 3.6 9.9 3.4 10 3.2 10.1 3 10.2 2.9 10.4 2.8 10.5 2.6 10.8 2.5 11.1 2.5 11.5 2.5 11.6 2.5 11.8 2.6 12 2.6 12.1 2.7 12.3 2.8 12.5 2.9 12.6 3.1 12.8 3.2 12.9 3.3 13 3.5 13.1 3.6 13.1 3.7 13.1 3.8 13.2 3.9 13.2L13.1 15.2 13.1 15.2Z" fill="currentColor"></path></g></svg><span>Tutorials</span></a></li><li class="nav-offers flyout-parent"><a href="https://www.safaribooksonline.com//library/view/high-performance-python/9781449361747/ch12.html#" class="l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 50 50" version="1.1" fill="#4A3C31"><desc>offers icon</desc><path d="M10.8 43.7L0 39 0 10.2 13.6 4.6 23.3 8.7 11.5 13.5C11 13.6 10.8 13.9 10.8 14.3L10.8 43.7 10.8 43.7Z"></path><polygon points="12.3 44.4 25 50 38 44.3 38 14.7 25.2 9.4 12.3 14.7 12.3 44.4"></polygon><path d="M36.6 4.7L50 10.2 50 39 39.5 43.6 39.5 14.3C39.5 13.8 39.2 13.6 38.8 13.5L27 8.7 36.6 4.7 36.6 4.7Z"></path><polygon points="34.8 4 25 0 15.4 3.9 25.2 7.9 34.8 4"></polygon></svg><span>Offers</span></a><ul class="flyout"><li><a href="https://www.safaribooksonline.com/oreilly-conferences/" class="l2 nav-icn"><span>Conferences</span></a></li><li><a href="https://www.safaribooksonline.com/oreilly-newsletters/" class="l2 nav-icn"><span>Newsletter</span></a></li></ul></li><li class="nav-highlights"><a href="https://www.safaribooksonline.com/u/003o000000t5q9fAAA/" class="t-highlights-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 35" version="1.1" fill="#4A3C31"><desc>highlights icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M13.325 18.071L8.036 18.071C8.036 11.335 12.36 7.146 22.5 5.594L22.5 0C6.37 1.113 0 10.632 0 22.113 0 29.406 3.477 35 10.403 35 15.545 35 19.578 31.485 19.578 26.184 19.578 21.556 17.211 18.891 13.325 18.071L13.325 18.071ZM40.825 18.071L35.565 18.071C35.565 11.335 39.86 7.146 50 5.594L50 0C33.899 1.113 27.5 10.632 27.5 22.113 27.5 29.406 30.977 35 37.932 35 43.045 35 47.078 31.485 47.078 26.184 47.078 21.556 44.74 18.891 40.825 18.071L40.825 18.071Z" fill="currentColor"></path></g></svg><span>Highlights</span></a></li><li><a href="https://www.safaribooksonline.com/u/" class="t-settings-nav l1 js-settings nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z" fill="currentColor"></path></g></svg><span>Settings</span></a></li><li><a href="https://community.safaribooksonline.com/" class="l1 no-icon">Feedback</a></li><li><a href="https://www.safaribooksonline.com/accounts/logout/" class="l1 no-icon">Sign Out</a></li></ul><ul class="profile"><li><a href="https://www.safaribooksonline.com/u/" class="l2 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z" fill="currentColor"></path></g></svg><span>Settings</span></a></li><li><a href="https://community.safaribooksonline.com/" class="l2">Feedback</a></li><li><a href="https://www.safaribooksonline.com/accounts/logout/" class="l2">Sign Out</a></li></ul></div></li></ul></nav></header>


      </div>
      <div id="container" class="application">
        
          <div class="nav-container clearfix">
            


            
            
          </div>

          

  <div class="js-toc">
    
      <div class="sbo-reading-menu sbo-menu-top"><section class="sbo-toc-container toc-menu"><a href="https://www.safaribooksonline.com//library/view/high-performance-python/9781449361747/ch12.html#" class="sbo-toc-thumb"><span class="sbo-title ss-list"><h1><div class="visuallyhidden">Table of Contents for </div>
      
      High Performance Python
      
    </h1></span></a><div class="toc-contents"></div></section></div>

    

    <div class="interface-controls interface-controls-top">
      <ul class="interface-control-btns js-bitlist js-reader">
        <li class="js-search-in-archive search-in-archive t-search-in-archive"><a href="https://www.safaribooksonline.com//library/view/high-performance-python/9781449361747/ch12.html#" title="Search in archive" class="js-search-controls search-controls"><span class="icon">Search in book...</span></a><form class="search-archive-bar js-search-form"><input type="search" name="query" placeholder="Search inside this book..." autocomplete="off"></form><div class="search-archive-results"><div class="js-sitb-results-region"></div></div></li><li class="queue-control"><button type="button" class="rec-fav ss-queue js-queue js-current-chapter-queue" data-queue-endpoint="/api/v1/book/9781449361747/chapter/ch12.html" data-for-analytics="9781449361747:ch12.html"><span>Add to Queue</span></button></li><li class="js-font-control-panel font-control-activator"><a href="https://www.safaribooksonline.com//library/view/high-performance-python/9781449361747/ch12.html#" data-push-state="false" id="font-controls" title="Change font size" aria-label="Change font size"><span class="icon">Toggle Font Controls</span></a></li><li class="dropdown sharing-controls"><a href="https://www.safaribooksonline.com//library/view/high-performance-python/9781449361747/ch12.html#" class="trigger" data-push-state="false" title="Share" aria-label="Share"><i class="fa fa-share"></i></a><ul class="social-sharing dropdown-menu"><li><a class="twitter share-button t-twitter" target="_blank" aria-label="Share this section on Twitter" title="Share this section on Twitter" href="https://twitter.com/share?url=https://www.safaribooksonline.com/library/view/high-performance-python/9781449361747/ch12.html&amp;text=High%20Performance%20Python&amp;via=safari"><span>Twitter</span></a></li><li><a class="facebook share-button t-facebook" target="_blank" aria-label="Share this section on Facebook" title="Share this section on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://www.safaribooksonline.com/library/view/high-performance-python/9781449361747/ch12.html"><span>Facebook</span></a></li><li><a class="googleplus share-button t-googleplus" target="_blank" aria-label="Share this secton on Google Plus" title="Share this secton on Google Plus" href="https://plus.google.com/share?url=https://www.safaribooksonline.com/library/view/high-performance-python/9781449361747/ch12.html"><span>Google Plus</span></a></li><li><a class="email share-button t-email" aria-label="Share this section via email" title="Share this section via email" href="mailto:?subject=Safari:%2012.%20Lessons%20from%20the%20Field&amp;body=https://www.safaribooksonline.com/library/view/high-performance-python/9781449361747/ch12.html%0D%0Afrom%20High%20Performance%20Python%0D%0A"><span>Email</span></a></li></ul></li>
      </ul>
    </div>

    <section role="document">
      
	  <div class="t-sbo-prev sbo-prev sbo-nav-top">
  
    
      
        <a href="/site/library/view/high-performance-python/9781449361747/ch11.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">11. Using Less RAM</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-top">
  
    
      
        <a href="/site/library/view/high-performance-python/9781449361747/author_bios.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">About the Authors</div>
        </a>
    
  
  </div>



<div id="sbo-rt-content"><div class="annotator-wrapper"><section class="chapter" epub:type="chapter" id="chapter-lessons-from-the-field"><div class="titlepage"><div><div><h2 class="title">Chapter&nbsp;12.&nbsp;Lessons from the Field</h2></div></div></div><div class="sidebar"><div class="sidebar-title">Questions you’ll be able to answer after this chapter</div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
How do successful start-ups deal with large volumes of data and machine learning?
</li><li class="listitem">
What monitoring and deployment technologies keep systems stables?
</li><li class="listitem">
What lessons have successful CTOs learned about their technology and teams?
</li><li class="listitem">
How widely can PyPy be deployed?
</li></ul></div></div><p>In this chapter Micha and I have collected stories from successful companies where Python is used in high-data-volume and speed-critical situations. The stories are written by key people in each organization who have many years of experience, they share not just their technology choices but also some of their hard-won wisdom.</p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="lessons-from-field-ben">AdpativeLab for Social Media Analytics (SoMA)</h2></div></div></div><p>Adaptive Lab are a product development and innovation company, based in London’s Tech City area, Shoreditch.  We apply our lean, user-centric method of product design and delivery collaboratively with a wide range of companies, from startups to large corporates.</p><p>YouGov is a global market research company who state “[it is their] ambition to supply a live stream of continuous, accurate data and insight into what people are thinking and doing all over the world”, and that’s just what we managed to provide for them.  Adaptive Lab designed a way to listen passively to real discussions happening in social media and gain insight to their feelings on a customisable range of topics.  We built a scalable system capable of capturing a large volume of streaming information, processing it, storing it indefinitely and presenting it through a powerful, filterable interface in real-time.  The system was built using Python.</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="_python_at_adaptive_lab">Python at Adaptive Lab</h3></div></div></div><p>Python is one of our core technologies.  We use it in performance-critical applications and whenever we work with clients that have in-house Python skills so that the work we produce for them can be taken on in-house.</p><p>Python is ideal for small, self-contained, long-running daemons and it’s just as great with flexible, feature-rich web frameworks like Django and Pyramid.  The Python community is thriving, which means that there’s a huge library of open-source tools out there that allow us to build quickly, with confidence, leaving us to focus on the new and innovative stuff, solving problems for users.</p><p>Across all of our projects, Adaptive Lab re-use several tools that are built in Python, but that can be used in a language-agnostic way.  For example, we use SaltStack for server provisioning and Mozilla’s Circus for managing long-running processes.  The benefit to us when a tool is open-sourced and written in a language we’re familiar with is that if we find any problems, we can solve them ourselves and get those solutions taken up, which benefits the community.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="_soma_s_design">SoMA’s Design</h3></div></div></div><p>Our Social Media Analytics tool needed to cope with a high throughput of social media data and the storage and retrieval in real-time of a large amount of information.  Through researching various data stores and search engines, we settled on elasticsearch as our real-time document store.  As its name suggests, it’s highly scalable, but is also very easy to use and is very capable of providing statistical responses as well as search - ideal for our application.  elasticsearch itself is built in Java but as with any well-architected component of a modern system, it has a good API and is well-catered for with a Python library and tutorials.</p><p>The system we designed uses queues with Celery held in Redis to quickly hand off such a large stream of data to any number of servers for independent processing and indexing.  Each component of the whole, complex system was designed to be small, individually simple and able to work in isolation.  Each focussed on one task, like analysing a conversation for sentiment or preparing a document for indexing into elasticsearch.  Several of these were configured to run as daemons using Mozilla’s Circus, which keeps all the processes up and running and allows them to be scaled up or down on individual servers.</p><p>SaltStack is used to define and provision the complex cluster and handles the set up of all of the libraries, languages, databases and document stores.  We also make use of Fabric, a Python tool for running arbitrary tasks on the command line.  Defining servers in code has many benefits: Complete parity with the production environment; Version control of your configuration; Having everything in one place; It also serves as documentation on the setup and dependencies required by your cluster.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="_our_development_methodology">Our Development Methodology</h3></div></div></div><p>We aim to make it as easy as possible for a newcomer to a project to be able to quickly get into adding code and deploying confidently.  We use Vagrant to build the complexities of a system locally, inside a virtual machine that has complete parity with the production environment.  A simple ‘vagrant up’ is all a newcomer needs to get set up with all the dependencies required for their work.</p><p>We work in an agile way, planning together to discuss architecture decisions and determining a consensus on task estimates.  We made the decision to include at least a few tasks considered as corrections for ‘technical debt’ in each sprint.  Also included were tasks for documenting the system (we eventually established a wiki to house all the knowledge for this ever-expanding project).  Team members review each other’s code after each task, to sanity-check, offer feedback and to understand the new code that is about to get added to the system.</p><p>A good test suite helped bolster confidence that any changes weren’t going to cause existing features to fail.  Integration tests are vital in a system like SoMA, comprised of many moving parts.  A staging environment offers a way to test the performance of new code; on SoMA in particular, it was only through testing against the kind of large datasets seen in production that problems could occur, so it was often necessary to reproduce that amount of data in a separate environment, which Amazon’s EC2 compute cloud gave us the flexibility to do.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="_maintaining_soma">Maintaining SoMA</h3></div></div></div><p>The SoMA system runs continuously and the amount of information it consumes grows every day.  We have to account for peaks in the data stream, network issues and problems in any of the third-party service providers it relies on.  So to make things easy on ourselves, SoMA is designed to fix itself whenever it can.  Thanks to Circus, processes that crash out will come back to life and resume their tasks from where they left off.  A task will queue up until a process can consume it and there’s enough breathing room there to stack up tasks while the system recovers.</p><p>We use Server Density to monitor the many SoMA servers.  It’s very simple to set up, but quite powerful.  A nominated engineer can receive a push message on their phone as soon as a problem is likely to occur, so they can react in time to ensure it doesn’t become a problem.  With Server Density it’s also very easy to write custom plugins in Python, making it possible for example to set up instant alerts on aspects of elasticsearch’s behaviour.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="_advice_for_fellow_engineers">Advice for Fellow Engineers</h3></div></div></div><p>Above all, you and your team need to be confident and comfortable that what is about to be deployed into a live environment is going to work flawlessly.  To get to that point, you have to work backwards, spending time on all of the components of the system that will give you that sense of comfort: Make deployment simple and fool-proof; Use a staging environment to test the performance with real-world data; Ensure you have a good, solid test suite with high coverage; Implement a process for incorporating new code into the system; Make sure technical debt gets addressed sooner rather than later.  The more you shore up your technical infrastructure and improve your processes, the happier and more successful your team will be at engineering the right solutions.</p><p>If a solid foundation of code and ecosystem is not in place and the business are pressuring you to get things live, it’s only going to lead to problem software.  It’s going to be your responsibility to push back and stake out time for incremental improvements to the code, the tests and the operations involved in getting things out the door.</p><p>Ben Jackson (adaptivelab.co.uk)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="lessons-from-field-radim">Making deep learning fly with RadimRehurek.com</h2></div></div></div><p>When Ian asked me to write “lessons from the field” on Python &amp; optimizations for this book, I immediately thought, “tell them how you made a Python port faster than Google’s C original!”. It’s an inspiring story of making a machine learning algorithm, Google’s poster child for deep learning, 12,000x faster than a naive Python implementation. Anyone can write bad code to then fanfare large speed ups though. But the optimized Python port also runs, somewhat astonishingly, almost four times faster than the original code by Google’s team! That is, four times faster than opaque, tightly profiled and optimized C.</p><p>But before drawing “machine-level” optimization lessons, some general advice about “human-level” optimizations.</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="_the_sweet_spot">The Sweet Spot</h3></div></div></div><p>I run a small consulting business <sup>[<a id="id836662" href="https://www.safaribooksonline.com//library/view/high-performance-python/9781449361747/ch12.html#ftn.id836662" class="footnote">140</a>]</sup> laser-focused on machine learning, where me and my colleagues help companies make sense of the tumultuous world of data analysis, in order to make money or save costs (or both). We help clients design and build wondrous systems for data processing, especially text data.</p><p>The clients range from large multinationals to nascent startups and while each project is different and requires a different tech stack, plugging into client’s existing data flows and pipelines, Python is a clear favourite. Not to preach to the choir, but Python’s no-nonsense development philosophy, its malleability and the rich library ecosystem make it an ideal choice.</p><p>First, a few thoughts “from the field” on what works:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
<span class="strong"><strong>Communication, communication, communication.</strong></span> This one’s obvious, but worth repeating. Understand the client’s problem on a higher, business level before deciding on an approach. Sit down and talk through what they think they need (based on their partial knowledge of what’s possible and or what they googled up before contacting you), until it becomes clear what they really need, free of cruft and preconceptions. Agree on ways to validate the solution beforehand. I like to visualize this process as a long, winding road to be built: get the starting line right (problem definition, available data sources) and the finish line right (evaluation, solution priorities) and the path in between falls into place.
</li><li class="listitem">
<span class="strong"><strong>Be on the lookout for promising technologies.</strong></span> An emergent tech that is reasonably well-understood and robust, gaining traction, yet is still relatively obscure in the industry brings huge value to the client (or yourself). As an example, a few years ago, Elasticsearch was a little known and somewhat raw open source project. But I evaluated its approach as solid (built on top of Apache Lucene, replication, cluster sharding…) and recommended its use to a client. We consequently built a search system with Elasticsearch at its core, saving the client significant amounts of money in licensing, dev and maintenance compared to the considered alternatives (large commercial databases). Even more importantly, using a new, flexible and powerful technology offered a massive competitive advantage to the product, beyond simply saving costs. Nowadays ES has entered the enterprise and conveys no competitive advantage at all—everyone knows it and uses it. Getting the timing right is what I call the “sweet spot”, maximizing value/cost ratio.
</li><li class="listitem">
<span class="strong"><strong>KISS aka “Keep It Simple, Stupid”.</strong></span> Another no-brainer. The best code is one you don’t have to write, and maintain. Start simple, improve and iterate where necessary. I prefer tools that follow the UNIX philosophy of “do one thing, and do it well”. Grand programming frameworks can be tempting, with everything imaginable under one roof and fitting neatly together. But invariably, sooner or later you need something the grand framework didn’t imagine, and then even simple modifications (conceptually) cascade into a nightmare (programmatically). Grand projects and their all-encompassing APIs tend to collapse under their own weight. Use modular, focused tools, with as small and uncomplicated APIs in between as possible. Prefer text formats that are open to simple visual inspection, unless performance dictates otherwise.
</li><li class="listitem">
<span class="strong"><strong>Use manual sanity checks in data pipelines.</strong></span> When optimizing data processing systems, it’s easy to stay in the “binary mindset” mode, using tight pipelines, efficient binary data formats, compressed I/O. As the data passes through the system unseen, unchecked (except for perhaps its type), it remains invisible until something outright blows up. Debugging commences. I advocate sprinkling a few simple log messages, showing what the data looks at various internal points of processing, as good practice. Nothing fancy, just an analogy to the “head” UNIX command, picking and visualizing a few data points. Not only does this help during the aforementioned debugging, but seeing the data in a human readable format leads to “aha!” moments surprisingly often even when all seems to go well. Strange tokenization! They promised input would always be encoded in latin1! How did a document in this language get in there? Image files leaked into a pipeline that expects and parses text files! These are often insights that go way beyond automatic type checking or a fixed unit test, hinting at issues beyond component boundaries. Real world data is messy. Catch early even things that wouldn’t necessarily lead to exceptions or glaring errors. Err on the side of too much verbosity.
</li><li class="listitem">
<span class="strong"><strong>Navigate fads carefully.</strong></span> Because a client keeps hearing about X and says they must have X too, doesn’t mean they really need it. It might be a marketing problem rather than a technology one, so take care to discern the two and deliver accordingly. “X” changes over time as hype waves come and go; a recent value would be “X=big data”.
</li></ul></div><p>Alright, enough business talk, here’s how I got word2vec in Python to run faster than C.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="_lessons_in_optimizing">Lessons in Optimizing</h3></div></div></div><p>Word2vec <sup>[<a id="id836897" href="https://www.safaribooksonline.com//library/view/high-performance-python/9781449361747/ch12.html#ftn.id836897" class="footnote">141</a>]</sup> is a deep learning algorithm that allows detection of similar words and phrases. With interesting applications in text analytics and SEO, and with Google’s lustrous brand name attached to it, startups and businesses flock to take advantage of this new tool.</p><p>Unfortunately the only available code used to be due to Google itself, an open source Linux command line tool written in C. A well optimized but rather hard to use implementation. The primary reason why I decided to port word2vec to Python was so I could extend word2vec to other platforms, making it easier to integrate and extend for clients.</p><p>The details are not relevant here, but word2vec requires a training phase which needs a lot of input data to produce a useful similarity model. For example, the folks at Google ran word2vec on their GoogleNews dataset, training on approximately 100 billion words. Datasets of this scale obviously don’t fit in RAM, so a memory-efficient approach must be taken.</p><p>I’ve authored a machine learning library, gensim <sup>[<a id="id836813" href="https://www.safaribooksonline.com//library/view/high-performance-python/9781449361747/ch12.html#ftn.id836813" class="footnote">142</a>]</sup>, that targets exactly that sort of memory-optimization problem: datasets that are no longer trivial (anything that fits fully into RAM), yet not large enough to warrant petabyte-scale clusters of MapReduce computers. This “terabyte” problem range fits a surprisingly large portion of real-world cases, word2vec included.</p><p>Details <sup>[<a id="id836800" href="https://www.safaribooksonline.com//library/view/high-performance-python/9781449361747/ch12.html#ftn.id836800" class="footnote">143</a>]</sup> are described on my blog, but here are a few optimization takeaways:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem">
<span class="strong"><strong>Stream your data, watch your memory.</strong></span> Let your input be accessed and processed one data point at a time, for a small, constant memory footprint. The streamed data points (sentences, in case of word2vec) may be grouped into larger batches internally for performance (such as processing 100 sentences at a time), but a high-level, streamed API proved a powerful and flexible abstraction. The Python language supports this pattern very naturally and elegantly, with its built-in generators. A truly beautiful problem-tech match. Avoid committing to algorithms and tools that load everything into RAM, unless you know your data will always remain small, or don’t mind re-implementing a production version yourself later.
</li><li class="listitem">
<span class="strong"><strong>Take advantage of Python’s rich ecosystem.</strong></span> I started with a readable, clean port of word2vec in NumPy. I am sure Ian and Micha cover NumPy elsewhere in this book (Note - see <code class="literal">numpy</code> discussion in  <a class="xref" href="https://www.safaribooksonline.com//library/view/high-performance-python/9781449361747/ch06.html">Chapter&nbsp;6</a>), but as a short reminder, NumPy is an amazing library, a cornerstone of Python’s scientific community and the de facto standard for number crunching in Python. Tapping into NumPy’s powerful arrays interfaces, memory access patterns and its wrapped BLAS routines for ultra-fast common vector operations lead to concise, clean and fast code. Hundreds of times faster than naive Python code. Normally I’d call it a day at this point, but “hundreds of times faster” was still 20x slower than Google’s optimized C version, so I pressed on.
</li><li class="listitem">
<span class="strong"><strong>Profile &amp; compile hotspots.</strong></span> Word2vec is a typical HPC app in that a few lines of code in one inner loop account for 90% of the entire training runtime. Here I rewrote a single core routine (approximately 20 lines of code) in C, using an external Python library, Cython, as the glue. While technically brilliant, I don’t consider Cython a particularly convenient tool conceptually—it’s basically like learning another language, a non-intuitive mix between Python, NumPy and C, with its own caveats and idiosyncrasies. But until Python’s JIT (just-in-time compilation) technologies mature, Cython is probably our best bet. With a Cython-compiled hotspot, performance of the Python word2vec port is now on par with the original C code. An additional advantage of having started with a clean NumPy version: free tests for correctness, by comparing against the slower but correct version.
</li><li class="listitem">
<span class="strong"><strong>Know your BLAS.</strong></span> A neat feature of NumPy is that it internally wraps BLAS (Basic Linear Algebra Subroutines), where available. These are sets of low-level routines, optimized directly by processor vendors (Intel, AMD…) in assembly, Fortran or C, to squeeze out maximum performance from a particular processor architecture. For example, calling an AXPY BLAS routine computes vector_y += scalar * vector_x, way faster than what a generic compiler would produce for an equivalent explicit for-loop. Expressing word2vec training as BLAS operations resulted in another 4x speed up, topping the performance of C word2vec. Victory! To be fair, the C code could of course link to BLAS as well, so this is not some inherent advantage of Python per se. NumPy just makes things like these stand out and easy to take advantage of.
</li><li class="listitem">
<span class="strong"><strong>Parallelization and multiple cores.</strong></span> Gensim contains distributed, cluster implementations of a few algorithms. For word2vec, I opted for multithreading on a single machine, because of the fine grained nature of its training algorithm. Using threads also allows us to avoid fork-without-exec POSIX issues that Python’s multiprocessing brings, especially in combination with certain BLAS libraries. Because our core routine is already in Cython, we can afford to release Python’s GIL (Global Interpreter Lock - see <a class="xref" href="https://www.safaribooksonline.com//library/view/high-performance-python/9781449361747/ch07.html#compiling-cython-omp">Parallelizing the solution with OpenMP on One Machine</a>) that normally renders multithreading useless for CPU intensive tasks. Speed up: another 3x, on a machine with four cores.
</li><li class="listitem">
<span class="strong"><strong>Static memory allocations.</strong></span> At this point, we’re processing tens of thousand of sentences per second. Training is so fast that even little things like creating a new NumPy array (calling malloc for each streamed sentence) slow us down. Solution: pre-allocate a static “work” memory and pass it around, in good old Fortran fashion. Brings tears to my eyes. The lesson here is to keep as much bookkeeping and app logic in the clean, Python code as possible, and keep the optimized hotspot lean and mean.
</li><li class="listitem">
<span class="strong"><strong>Problem-specific optimizations.</strong></span> The original C implementation contained specific micro optimizations, such as aligning arrays onto specific memory boundaries or precomputing certain functions into memory lookup tables. A nostalgic blast from the past, but with today’s complex CPU instruction pipelines, memory cache hierarchies and coprocessors, such optimizations are no longer a clear winner. Careful profiling suggested a few percent improvement, which may not be worth the extra code complexity. Takeaway: use annotation and profiling tools to highlight poorly optimized spots. Use your domain knowledge to introduce algorithmic approximations that trade accuracy for performance (or vice versa). But never take it on faith, profile, preferably using real, production data.
</li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="_wrap_up_7">Wrap up</h3></div></div></div><p>Optimize where appropriate; in my experience, there’s never enough communication to ascertain problem scope, priorities and connection to client’s business goals. Aka the “human-level” optimizations. Make sure you deliver on a problem that matters, rather than getting lost in “geek stuff” for the sake of it. And when you do roll up your sleeves, make it worth it!</p><p>Radim Řehůřek (radimrehurek.com)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="lessons-from-field-sebastjan">Large scale productionized machine learning at Lyst.com</h2></div></div></div><p>Lyst.com is a fashion recommendation engine based in London, it has over 2,000,000 monthly users who learn about new fashion through Lyst’s scraping, cleaning and modelling processes. Founded in 2010 it has raised $20M of investment.</p><p>Sebastjan Trepca was the technical founder and is the CTO, he created the site using Django and Python has helped the team to quickly test new ideas.</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="_python_s_place_at_lyst">Python’s place at Lyst</h3></div></div></div><p>Python and Django has been at the heart of Lyst since the site’s creation. As internal projects have grown some of the Python components has been replaced with other tools and languages to fit the maturing needs of the system.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="_cluster_design">Cluster design</h3></div></div></div><p>The cluster runs on Amazon EC2, in total there are approximately 100 machines including the more recent C3 instances which have good CPU performance.</p><p>Redis is used for queueing with PyRes and storing meta data. The dominant data format is JSON for ease of human comprehension. supervisord keeps the processes alive.</p><p>ElasticSearch and pyES are used to index all products. The ElasticSearch cluster stores 60M documents across 7 machines. Solr was investigated and discounted almost a year ago due to it’s lack of real-time updating features.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="_code_evolution_in_a_fast_moving_start_up">Code evolution in a fast moving start-up</h3></div></div></div><p>It is better for code to be quickly implemented so that a business idea can be tested than to write “perfect code” in the first pass. If code is useful then it can be refactored, if the idea behind the code is poor then it is cheap to delete it and remove a feature. This can lead to a complicated code base with many objects being passed around, this is acceptable as the team makes time to refactor code that is useful to the business.</p><p>Docstrings are used heavily, an external Sphinx documentation system was tried but dropped in favour of just reading the code. A wiki is used to document processes and larger systems. We also started creating very small services instead of chucking everything into one codebase.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="_building_the_recommendation_engine">Building the recommendation engine</h3></div></div></div><p>At first the recommendation engine was coded in Python, using numpy and scipy for computations. Subsequently, performance-critical parts of the recommender were speeded up using Cython; the core matrix factorization operations were written entirely in Cython, yielding an order of magnitude improvement in speed. This was mostly due to the ability to write performant loops over numpy arrays in Python, something that is extremely slow in pure Python, and performing poorly when vectorized because it necessitated memory copies of numpy arrays. The culprit was numpy fancy indexing, which always makes a data copy of the array being sliced: if no data copy is necessary or intended, Cython loops will be far faster.</p><p>Over time, the online components of the system, responsible for computing recommendations at request time, were integrated into our search component, ElasticSearch. In the process, it was translated into Java to allow full integration with ElasticSearch. The main reason behind this is not performance, but the utility of integrating the recommender with the full power of a search engine, allowing us to apply business rules to served recommendations more easily. The Java component itself is extremely simple and implements primarily efficient sparse vector inner products. The more complex offline component remains written in Python, using standard components of the Python scientific stack (mostly Python and Cython).</p><p>In our experience, Python is useful as more than a prototyping language: the availability of tools such as numpy, Cython, and weave (and more recently Numba) allowed us to achieve very good performance in the performance critical parts of the code while maintaining Python’s clarity and expressiveness where low-level optimization would be counterproductive.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="_reporting_and_monitoring">Reporting and Monitoring</h3></div></div></div><p>Graphite is used for reporting, currently performance regressions can be seen by eye after a deployment. This makes it easy to drill into detailed event reports or to zoom out and see a high level report of the site’s behaviour, adding and removing events as necessary.</p><p>Internally a larger infrastructure for performance testing is being designed, it will include representative data and use cases to properly test new builds of the site.</p><p>A staging site will also be used to let a small fraction of real visitors see the latest version of the deployment - if a bug or performance regression is seen then it will only have affected a minority of visitors and this version could quickly be retired. This will make the deployment of bugs significantly less costly and problematic.</p><p>Sentry is used to log and diagnose Python stack traces.</p><p>Jenkins is used for CI with an in-memory database configuration. This enables parallelised testing so that check-ins quickly reveal any bugs to the developer.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="_some_advice">Some advice</h3></div></div></div><p>It’s really important to have a good tools to track effectiveness of what you’re building and that you’re super practical in the beginning. Startups change constantly and engineering goes from super exploratory, building prototypes all the time and deleting code until you hit the goldmine and then you start to go deeper, improving code, performance etc. Until then, it’s just quick iterations and good monitoring/analytics. I guess this is pretty standard anyway and been repeated over and over, but I think many don’t really get it how important it is.</p><p>I don’t think technologies matter that much nowadays, whatever works for you, I’d think twice before moving to hosted environments like AppEngine or Heroku though.</p><p>Sebastjan Trepca (lyst.com)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="lessons-from-field-alex">Large Scale Social Media Analysis at Sme.sh</h2></div></div></div><p>At Smesh we produce software which ingests data from a wide variety of APIs across the Web, filters, process and aggregates them, and then use that data to build bespoke apps for a variety of clients. For example we provide the tech that powers the tweet filtering and streaming in Beamly’s second screen TV app, run a brand and campaign monitoring platform for mobile network EE, and run a bunch of Adwords data analysis projects for Google.</p><p>To do that we run a variety of different streaming and polling services, processing several million tweets daily, and frequently polling Twitter, Facebook, YouTube and a host of other services for content.</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="_python_s_role_at_smesh">Python’s role at Smesh</h3></div></div></div><p>We use Python extensively - the majority of our platform and services are built with it. The wide variety of libraries, tools and frameworks available allows us to use it across the board for most of what we do.</p><p>That variety gives us the ability to (hopefully) pick the right tool for the job. For example we’ve created apps using each of Django, Flask, and Pyramid. Each has it’s own benefits and allows us to pick what’s right for the task in hand. We use Celery for tasks, Boto for interacting with AWS, PyMongo, Mongoengine, redis-py, Psycopg etc. for all our data needs. The list goes on and on.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="_the_platform">The Platform</h3></div></div></div><p>Our main platform consists of a central Python module which provides hooks for data input, filtering, aggregations and processing and a variety of other core functions. Project specific code imports functionality from that core and then implements more specific data processing and view logic as each application requires.</p><p>This has worked well for us up to now, and allows us to build fairly complex applications which ingest and process data from a wide variety of sources without much duplication of effort. However it isn’t without it’s drawbacks - each app is dependent on a common core module, making the process of updating the code in that module and keeping all the apps which use it up-to-date a major task.</p><p>We’re currently working on a project to redesign that core software and move towards a more SoA based approach. It seems that finding the right time to make that sort of architectural change is one of the challenges that faces most software teams as a platform grows. There is overhead in building components as individual services, and often the deep domain specific knowledge required to build each service is only acquired through an initial iteration of development, where that architectural overhead is a hinderance to solving the real problem at hand. Hopefully we’ve chosen a sensible time to re-visit our architectural choices to move things forward. Time will tell.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="_high_performance_real_time_string_matching">High performance real-time string matching</h3></div></div></div><p>We consume lots of data from the Twitter Streaming API. As we stream in tweets, we match the input strings against a set of keywords so that we know which of the terms we’re tracking that tweet is related to. That’s not such a problem with a low rate of input, or a small set of keywords, but doing that matching for hundreds of tweets per second, against hundreds or thousands of possible keywords starts to get tricky.</p><p>To make things more tricky, we’re not interested in simply whether the keyword string exists in the tweet, but more complex pattern matching against word boundaries, start and end of line, and optionally allow ‘#’ and ‘@’ characters to prefix the string. The most effective way to encapsulate that matching knowledge is using regular expressions. However running thousands of regex patterns across hundreds of tweets per second is computationally intensive. Previously it required us to run many worker nodes across a cluster of machines to perform the matching reliably in real-time.</p><p>Knowing this was a major performance bottleneck in the system, we tried a variety of things to improve the performance of our matching system. Simplifying the regexes, running enough processes to ensure we were utilising all the cores on our servers, ensuring all our regex patterns are compiled and cached properly, running the matching tasks under PyPy not CPython etc. Each of these resulted in a small increase in performance, but it’s clear this approach was only ever going to shave a fraction of our processing time. We were looking for an order of magnitude speedup, not a fractional improvement.</p><p>It was obvious that rather than trying to increase the performance of each match, we needed to reduce the problem space before the pattern matching takes place. So we needed to either reduce the number of tweets to process, or the number of regex patterns we needed to match the tweets against. Dropping the incoming tweets wasn’t an option - that’s the data we’re interested in. So we set about finding a way to reduce the number of patterns we need to compare an incoming tweet to in order to perform the matching.</p><p>We started looking at various trie structures for allowing us to do pattern matching between sets of strings more efficiently, and came across the Aho-Corasick string matching algorithm. It turns out to be ideal for our use-case. The dictionary from which the trie is built needs to be static - you can’t add new members to the trie once the automaton has been finalised. For us this isn’t a problem as the set of keywords is static for the duration of a session streaming from Twitter. When we change the terms we’re tracking we must disconnect from, and reconnect to the API - so we can rebuild the Aho-Corasick trie at the same time.</p><p>Processing an input against the strings using Aho-Corasick finds all possible matches simultaneously, stepping through the input string a character at a time and finding matching nodes at the next level down in the trie, or not as the case may be. So we can very quickly find which of our keyword terms may exist in the tweet. We still don’t know for sure as the pure string-in-string matching of Aho-Corasick doesn’t allow us to apply any of the more complex logic which is encapsulated in the regex patterns. However we use the Aho-Corasick matching as a pre-filter. Keywords which don’t exist in the string can’t match, so we know we only have to try a small subset of all our regex patterns, based on the keywords which do appear in the text. Rather than evaluating hundreds or thousands of regex patterns against every input, we rule out the majority, and only need to process a handful for each tweet.</p><p>By reducing the number of patterns we attempt to match against each incoming tweet to just a small handful, we’ve managed to achieve the speedup we were looking for. Depending on the complexity of the trie, and average length of input tweets, our keyword matching system now performs somewhere between 10-100x faster than the original naïve implementation.</p><p>If you’re doing a lot of regex processing, or other pattern matching, I highly recommend having a dig around the different variations of prefix and suffix tries that might help you to find a blazingly fast solution to your problem.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="_reporting_monitoring_debugging_and_deployment">Reporting, monitoring, debugging and deployment</h3></div></div></div><p>We maintain a bunch of different systems running our Python software and all the rest of the infrastructure that powers it all. Keeping it all up and running without interruption can be tricky. Here’s a few lessons we’ve learned along the way.</p><p>It’s really powerful to be able to see both in real-time, and historically, what’s going on inside your systems. Whether that be in your own software, or the infrastructure it runs on. We use Graphite with collectd and StatsD to allow us to draw pretty graphs of what’s going on. That gives us a way to spot trends, and to retrospectively analyse problems to find the root cause. We haven’t got around to implementing it yet, but Etsy’s Skyline also looks brilliant as a way to spot the unexpected when you have more metrics than you can keep track of. Sentry is a great system for event logging and keeping track of exceptions being raised across a cluster of machines.</p><p>Deployment can be painful, no matter what you’re using to do it. We’ve been users of Puppet, Ansible and Salt. They all have pros and cons, but none of them will make a complex deployment problem magically go away.</p><p>To maintain high availability for some of our systems we run multiple geographically distributed clusters of infrastructure, running one system live and others as hot spares, with switchover being done by updates to DNS with low TTLs. Obviously that’s not always straightforward, especially when you have tight constraints on data consistency. Thankfully we’re not affected by that too badly, making the approach relatively straightforward. It also provides us with a fairly safe deployment strategy, updating one of our spare clusters and performing testing, before promoting that cluster to live and updating the others.</p><p>Along with everyone else we’re really excited by the prospect of what can be done with Docker. Also along with pretty much everyone else we’re still just at the stage of playing around with it to figure out how to make it part of our deployment processes. However the prospect of being able to rapidly deploy our software in a lightweight and reproducible fashion, with all it’s binary dependencies and system libraries included seems to be just around the corner.</p><p>At a server level there’s a whole bunch of routine stuff that just makes life easier. Monit is great for keeping an eye on things for you. Upstart and Supervisord make running things reliably as services less painful. Munin is useful for some quick and easy system level graphing if you’re not using a full graphite/collectd setup. And Corosync/Pacemaker can be a good solution for running services across a cluster of nodes. For example where you have a bunch of services which you need to run somewhere, but not everywhere.</p><p>I’ve tried not to just list buzzwords here, but to point you towards software we’re using every day, which is really making a difference to how effectively we can deploy and run our systems. If you’ve heard of them all already, I’m sure you must have a whole bunch of other useful tips to share, so please drop me a line with some pointers. If not, go check them out, hopefully some of them will be as useful to you as they are to us.</p><p>Alex Kelly (sme.sh)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="lessons-from-field-marko">PyPy for successful web and data processing systems</h2></div></div></div><p>This document explains steps taken by a small team of developers to implement high performance cloud applications without prior knowledge of obstacles and with limited access to large computational and storage resources. Data structures, algorithms and “under the hood” logic of libraries, frameworks and servers used is essential to understand. This document is slightly technical, but it is also more practical approach for common reader. Installation and configuration is out of scope of this document.</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="_introduction">Introduction</h3></div></div></div><p>Since I have had a great experience before with pypy (“PyPy”), python implementation, I chose to use it everywhere where it was applicable. I used it from small toy projects where speed was essential to medium size projects. First project where I used it was protocol implementation, and protocols we implemented were Modbus and DNP3. Later, I used it for compression algorithms implementation, and everyone was amazed by its speed. First version I used in production was pypy 1.2 with JIT out of box, if I recall correctly. By its version 1.4 we were sure it is future of all our projects because many bugs got fixed and speed just increased more and more. We were surprised how simple cases were 2-3x faster just by upgrading pypy up to next version.</p><p>I will explain two separate but deeply related projects that share 90% of same code, but to keep explanation simple for reader to follow, I will refer to both of them as “project”.</p><p>Project was about to create system which will collect newspapers, magazines, blogs, apply OCR if necessary, classify them, translate, apply sentiment analysing, analyse documents structure, and index them for later search. User can search for keywords in any of available languages and retrieve information about indexed documents. Search is cross-language, so user can write in English and get results in French. Additionally, user will receive articles and keywords highlighted from document’s page with information of space occupied and price of publication. More advanced use case would be report generation, where user can see tabular view of results with detailed information on spending by any particular company on advertising in monitored newspapers, magazines, blogs. Not only advertising, but also it can “guess” if article is paid or objective, and determine its tone.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="_prerequisites">Prerequisites</h3></div></div></div><p>Obviously, pypy was our favorite python implementation. For database we used Cassandra and ElasticSearch. Cache servers used Redis. We used Celery as distributed task queue (workers), and for its broker (task queue), we used RabbitMQ while results were kept in redis backend. Later on celery used redis more exclusively for both brokers and backend. OCR engine used is Tesseract. Language translation engine and server used is Moses. We used scrapy for crawling websites. For distributed locking in whole system we use ZooKeeper server, but initially redis was used for that. Web application is based on excellent Flask web framework, and many of its extensions such as flask-login, flask-principal, etc. Flask application was hosted by gunicorn and tornado on every web server, and nginx as reverse proxy server to web servers. Rest of code is written by us, and it is in pure python that runs on top of pypy.</p><p>The whole project is hosted on in-house OpenStack private cloud, and executes ArchLinux ranging between 100 and 1000 instances depending on requirements which can dynamically change on-fly. The whole system consumes up to 200TB of storage every 6-12 months depending on mentioned requirements. All processing is done by our python code, except OCR and translation.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="_database">Database</h3></div></div></div><p>We developed python package that unifies model classes for cassandra, elasticsearch and redis. It is simple ORM that maps everything to dict or list of dicts in case of many records are retrieved from database.</p><p>Since cassandra 1.2 did not support complex queries on indices, we supported them with join-like queries. However, we allowed complex queries over small datasets up to 4GB because much of that had to be processed while held in memory. PyPy run in cases where CPython could not even load data into memory thanks to its strategies applied to homogeneous lists, so they could be more compact into the memory. Another benefit of pypy is that its JIT kicked in loops where data manipulation or analysis happened. We wrote code that way that types stay static inside of loops because thats where JIT’ed code is especially good.</p><p>ElasticSearch was used for indexing and fast searching of documents. It is very flexible when it comes to query complexity, so we did not have any major issues with it. One of issues we had was related to updating documents because it is not designed for rapidly changing documents, so we had to migrate that part to cassandra. Another limitation was related to facets and memory required on database instance, but it was solved by having more smaller queries and then manually manipulating data in celery workers. No major issues faced between pypy and pyes library used for interaction with ElasticSearch server pools.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="_web_application">Web Application</h3></div></div></div><p>As mentioned above, we used Flask framework with its third party extensions. Initially, we started everything in Django, but switched to Flask because of rapid changes in requirements. This does not mean that Flask is better than Django, it was just easier for us to follow code in Flask then in Django, since its project layout is very flexible. Gunicorn was used as WSGI HTTP server, and its IO loop was executed by tornado. This allowed us to have up to 100 concurrent connections per web server. Reason why it is lower than expected is because many user queries can take longer because a lot of analysing happens on user request, also user has interaction with data returned.</p><p>Web application depended on PIL for article and word highlighting. We had issue with PIL library and pypy because at that time there were many memory leaks associated with PIL. Then we switched to Pillow which was more frequently maintained. But, at the end we wrote library that interacted with GraphicsMagick via subprocess module.</p><p>PyPy run well, and results we comparable with CPython. The only reason why they are compatible is because usually web applications are IO bound. However, with development of STM in pypy we hope to have scalable event handling on multi-core instance level.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="_ocr_and_translation">OCR and Translation</h3></div></div></div><p>We wrote pure python libraries for tesseract and moses because we had problem with CPython API dependant extensions. PyPy has good support for CPython API using cpyext, but we wanted to be more in control of what happens under the hood. As a result we got pypy compatible solution and slightly faster code than on CPython. Reason why it was not more faster is that most of processing happened in C/C++ code of both tesseract and moses. We could only speed up output processing and building python structure of documents. No major issues at this stage happened with pypy compatibility.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="_task_distribution_and_workers">Task Distribution and Workers</h3></div></div></div><p>Celery gave us power to massively run tasks in background. Typical tasks are OCR, translation, analysis, etc. The whole thing could be done using Hadoop for MapReduce, but we chose celery because of knowing fact that project requirements might change often.</p><p>We had about 20 workers, and a worker had between 10 and 20 functions. Almost all functions had loop or many nested loops. We cared that types stay static, so JIT can do its job. End results were 2-5x speedup over CPython. Reason why we did not get better speedup is because our loops were relatively small, between 20K and 100K iterations. In some cases where we had to do analysis on word level, we had over 1M iterations, and thats where get over 10x speedup.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="_conclusion">Conclusion</h3></div></div></div><p>PyPy is an excellent choice for every pure python project that depends on speed of execution of readable and maintainable large source code. We found pypy also very stable. All our programs were long running with static and/or homogeneous types inside data structures, so JIT could do its job. When we tested whole system on CPython results did not surprise us, we had rough 2x speedup with pypy over CPython. In eyes of our clients this meant 2x better performance for same price. In the end, besides all good stuff that pypy brought to us, we hope that STM implementation will bring to us scalable parallel execution for python code.</p><p>Marko Tasic (github.com/mtasic85)</p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both" id="lessons-from-field-andrew">Task queues at Lanyrd.com</h2></div></div></div><p>Lanyrd is a website for social discovery of conferences - our users sign in, and we use their friend graphs from social networks as well as other indicators, like their industry of work or their geographic location.</p><p>The main work of the site is in distilling this raw data down into something we can show to the users - essentially, a ranked list of conferences. We have to do this offline, as we refresh it every couple of days as well as the fact that we’re hitting external APIs that are often slow. We also use the Celery task queue for other things that take a long time - like fetching thumbnails for links people provide or sending email. There is usually well over 100,000 tasks in the queue each day, sometimes much more.</p><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="_python_s_role_at_lanyrd">Python’s role at Lanyrd</h3></div></div></div><p>Lanyrd was built with Python and Django from day one, and virtually every part of it is written in Python - the website itself, the offline processing, our statistical and analysis tools, our mobile backend servers and the deployment system. It’s a very versatile and mature language and one that’s incredibly easy to write things in quickly, mostly thanks to the large amount of libraries available and the language’s easily-readable and concise syntax, which means it’s easy to update and refactor as well as easy to write initially.</p><p>The Celery task queue was already a mature project when we evolved the need for a task queue very early on, and the rest of Lanyrd was already in Python, so it was a natural fit. As we grew, there was some need to change the queue which backed it (which ended up being Redis), but it’s generally scaled very well.</p><p>As a startup, we had to ship some known technical debt in order to make some headway - this is something you just have to do, and as long as you know what your issues are and when they might surface, it’s not necessarily a bad thing. Python’s flexibility in this regard is fantastic; it generally encourages loose coupling of components which means it’s often easy to ship something with a “good enough” implementation and then easily refactor a better one in later.</p><p>Anything critical - such as payment code - would have full unit test coverage, but for other parts of the site and task queue flow (especially display-related code) things were often moving too fast to make unit tests worthwhile (they would be too fragile). Instead, we adopted a very agile approach and had a two-minute deploy time and excellent error tracking; if a bug made it into live, we could often fix and deploy it within five minutes.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="_making_the_task_queue_performant">Making the task queue performant</h3></div></div></div><p>The main issue with a task queue is throughput. If it gets backlogged then the website keeps working but starts getting mysteriously outdated - lists don’t update, page content is wrong, and emails don’t get sent for hours.</p><p>Fortunately though, task queues also encourage a very scalable design; as long as your central messaging server (in our case, Redis) can handle the messaging overhead of the job requests and responses, for the actual processing you can spin up any number of worker daemons to handle the load.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="_reporting_monitoring_debugging_and_deployment_2">Reporting, monitoring, debugging and deployment</h3></div></div></div><p>We had monitoring that kept track of our queue length and if it started becoming long we would just deploy another server with more worker daemons - Celery makes this very easy to do. Our deployment system had hooks where we could increase the number of worker threads on a box (if our CPU utilisation wasn’t optimal) and could easily turn a fresh server into a celery worker within 30 minutes. It’s not like website response times going through the floor - if your task queues suddenly get a load spike you have some time to implement a fix and usually it’ll smooth over itself, if you’ve left enough spare capacity.</p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title" id="_advice_to_a_fellow_developer">Advice to a fellow developer</h3></div></div></div><p>My main advice would be to shove as much as you can into a task queue (or a similar loosely coupled architecture) as soon as possible. It takes some initial engineering effort, but as you grow, operations that used to take half a second can grow to half a minute, and you’ll be glad they’re not blocking your main rendering thread. Once you’ve got there, make sure you keep a close eye on your average queue latency (how long it takes a job from submission to completion), and make sure there’s some spare capacity for when your load increases.</p><p>Finally, be aware that having multiple task queues for different priorities of tasks makes sense. Sending email isn’t very high priority; people are used to emails taking minutes to arrive, whereas if you’re rendering a thumbnail in the background and showing a spinner while you do it, you want that job to be high priority, as otherwise you’re making the user experience worse. You don’t want your 100,000-person mailshot to delay all thumbnailing on your site for the next 20 minutes!</p><p>Andrew Godwin (lanyrd.com)</p></div></div><div class="footnotes" epub:type="footnotes"><br><hr style="width: 100; align: left;"><div class="footnote" id="ftn.id836662"><p><sup>[<a href="https://www.safaribooksonline.com//library/view/high-performance-python/9781449361747/ch12.html#id836662" class="simpara">140</a>] </sup><a class="ulink" href="http://radimrehurek.com/" target="_top">http://radimrehurek.com/</a></p></div><div class="footnote" id="ftn.id836897"><p><sup>[<a href="https://www.safaribooksonline.com//library/view/high-performance-python/9781449361747/ch12.html#id836897" class="simpara">141</a>] </sup><a class="ulink" href="https://code.google.com/p/word2vec/" target="_top">https://code.google.com/p/word2vec/</a></p></div><div class="footnote" id="ftn.id836813"><p><sup>[<a href="https://www.safaribooksonline.com//library/view/high-performance-python/9781449361747/ch12.html#id836813" class="simpara">142</a>] </sup><a class="ulink" href="http://radimrehurek.com/gensim/" target="_top">http://radimrehurek.com/gensim/</a></p></div><div class="footnote" id="ftn.id836800"><p><sup>[<a href="https://www.safaribooksonline.com//library/view/high-performance-python/9781449361747/ch12.html#id836800" class="simpara">143</a>] </sup><a class="ulink" href="http://radimrehurek.com/2013/09/deep-learning-with-word2vec-and-gensim/" target="_top">http://radimrehurek.com/2013/09/deep-learning-with-word2vec-and-gensim/</a></p></div></div></section><div class="annotator-outer annotator-viewer viewer annotator-hide">
  <ul class="annotator-widget annotator-listing"></ul>
</div><div class="annotator-modal-wrapper annotator-editor-modal annotator-editor annotator-hide">
	<div class="annotator-outer editor">
		<h2 class="title">Highlight</h2>
		<form class="annotator-widget">
			<ul class="annotator-listing">
			<li class="annotator-item"><textarea id="annotator-field-0" placeholder="Add a note using markdown (optional)" class="js-editor" maxlength="750"></textarea></li></ul>
			<div class="annotator-controls">
				<a class="link-to-markdown" href="https://daringfireball.net/projects/markdown/basics" target="_blank">?</a>
				<ul>
					<li class="delete annotator-hide"><a href="https://www.safaribooksonline.com//library/view/high-performance-python/9781449361747/ch12.html#delete" class="annotator-delete-note button positive">Delete Note</a></li>
					<li class="save"><a href="https://www.safaribooksonline.com//library/view/high-performance-python/9781449361747/ch12.html#save" class="annotator-save annotator-focus button positive">Save Note</a></li>
					<li class="cancel"><a href="https://www.safaribooksonline.com//library/view/high-performance-python/9781449361747/ch12.html#cancel" class="annotator-cancel button">Cancel</a></li>
				</ul>
			</div>
		</form>
	</div>
</div><div class="annotator-modal-wrapper annotator-delete-confirm-modal" style="display: none;">
  <div class="annotator-outer">
    <h2 class="title">Highlight</h2>
      <a class="js-close-delete-confirm annotator-cancel close" href="https://www.safaribooksonline.com//library/view/high-performance-python/9781449361747/ch12.html#close">Close</a>
      <div class="annotator-widget">
         <div class="delete-confirm">
            Are you sure you want to permanently delete this note?
         </div>
         <div class="annotator-controls">
            <a href="https://www.safaribooksonline.com//library/view/high-performance-python/9781449361747/ch12.html#cancel" class="annotator-cancel button js-cancel-delete-confirm">No, I changed my mind</a>
            <a href="https://www.safaribooksonline.com//library/view/high-performance-python/9781449361747/ch12.html#delete" class="annotator-delete button positive js-delete-confirm">Yes, delete it</a>
         </div>
       </div>
   </div>
</div><div class="annotator-adder" style="display: none;">
	<ul class="adders ">
		
		<li class="copy"><a href="https://www.safaribooksonline.com//library/view/high-performance-python/9781449361747/ch12.html#">Copy</a></li>
		
		<li class="add-highlight"><a href="https://www.safaribooksonline.com//library/view/high-performance-python/9781449361747/ch12.html#">Add Highlight</a></li>
		<li class="add-note"><a href="https://www.safaribooksonline.com//library/view/high-performance-python/9781449361747/ch12.html#">
			
				Add Note
			
		</a></li>
	</ul>
</div></div></div>



  <div class="t-sbo-prev sbo-prev sbo-nav-bottom">
  
    
      
        <a href="/site/library/view/high-performance-python/9781449361747/ch11.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">11. Using Less RAM</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-bottom">
  
    
      
        <a href="/site/library/view/high-performance-python/9781449361747/author_bios.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">About the Authors</div>
        </a>
    
  
  </div>


      
    </section>
    <div class="reading-controls-bottom">
      <ul class="interface-controls js-bitlist">
        <li class="queue-control">
            <button type="button" class="rec-fav ss-queue js-queue js-current-chapter-queue" data-queue-endpoint="/api/v1/book/9781449361747/chapter/ch12.html" data-for-analytics="9781449361747:ch12.html">
      <span>Add to Queue</span>
  </button>
        </li>
      </ul>
    </div>
  </div>
<section class="sbo-saved-archives"></section>



          
          
  





    
    



        
      </div>
      



  <footer class="pagefoot t-pagefoot">
    <a href="https://www.safaribooksonline.com//library/view/high-performance-python/9781449361747/ch12.html#" class="icon-up"><div class="visuallyhidden">Back to top</div></a>
    <ul class="js-footer-nav">
      
        <li><a class="t-recommendations-footer" href="https://www.safaribooksonline.com/r/">Recommended</a></li>
      
      <li><a class="t-queue-footer" href="https://www.safaribooksonline.com/s/">Queue</a></li>
      
        <li><a class="t-recent-footer" href="https://www.safaribooksonline.com/history/">History</a></li>
        <li><a class="t-topics-footer" href="https://www.safaribooksonline.com/topics?q=*&amp;limit=21">Topics</a></li>
      
      
        <li><a class="t-tutorials-footer" href="https://www.safaribooksonline.com/tutorials/">Tutorials</a></li>
      
      <li><a class="t-settings-footer js-settings" href="https://www.safaribooksonline.com/u/">Settings</a></li>
      <li><a href="https://www.safaribooksonline.com/blog/">Blog</a></li>
      <li class="full-support"><a href="https://www.safaribooksonline.com/public/support">Support</a></li>
      <li><a href="https://community.safaribooksonline.com/">Feedback</a></li>
      <li><a href="https://www.safaribooksonline.com/apps/">Get the App</a></li>
      <li><a href="https://www.safaribooksonline.com/accounts/logout/">Sign Out</a></li>
    </ul>
    <span class="copyright">© 2016 <a href="https://www.safaribooksonline.com/" target="_blank">Safari</a>.</span>
    <a href="https://www.safaribooksonline.com/terms/">Terms of Service</a> /
    <a href="https://www.safaribooksonline.com/privacy/">Privacy Policy</a>
  </footer>




    

    
    
  

<div class="annotator-notice"></div><div class="font-flyout"><div class="font-controls-panel">
	<div class="nightmodes">
		<ul>
			<li class="day"><a href="https://www.safaribooksonline.com//library/view/high-performance-python/9781449361747/ch12.html#" id="day-mode" title="Day Mode">
				<i class="fa fa-sun-o"></i>
				<span>Day Mode</span></a></li>
			<li class="cloudy"><a href="https://www.safaribooksonline.com//library/view/high-performance-python/9781449361747/ch12.html#" id="cloudy-mode" title="Cloudy Mode">
				<i class="fa fa-cloud"></i>
				<span>Cloud Mode</span>
			</a></li>
			<li class="night"><a href="https://www.safaribooksonline.com//library/view/high-performance-python/9781449361747/ch12.html#" id="night-mode" title="Night Mode">
				<i class="fa fa-moon-o"></i>
				<span>Night Mode</span>
			</a></li>
		</ul>
	</div>

	<div class="font-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-font left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-font-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-font right"></i>
		</div>
	</div>

	<div class="column-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-compress left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-column-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-expand right"></i>
		</div>
	</div>

	<a id="reset" class="button" href="https://www.safaribooksonline.com//library/view/high-performance-python/9781449361747/ch12.html#">Reset</a>
</div>
</div></body><span class="gr__tooltip"><span class="gr__tooltip-content"></span><i class="gr__tooltip-logo"></i><span class="gr__triangle"></span></span></html>