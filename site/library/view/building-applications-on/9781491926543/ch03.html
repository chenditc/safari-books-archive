<!--[if IE]><![endif]--><!DOCTYPE html><!--[if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage"" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/building-applications-on/9781491926543/ch03.html"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="859452"
  data-user-uuid="4d373bec-fada-4717-9823-769db3ed3a36"
  data-username="dchen267"
  data-account-type="B2B"
  
  data-activated-trial-date="04/25/2016"


  data-archive="9781491926543"
  data-publishers="O&#39;Reilly Media, Inc."



  data-htmlfile-name="ch03.html"
  data-epub-title="Building Applications on Mesos" data-debug=0 data-testing=0><![endif]--><!--[if gt IE 8]><!--><html class=" js flexbox flexboxlegacy no-touch websqldatabase indexeddb history csscolumns csstransforms localstorage sessionstorage applicationcache svg inlinesvg zoom gr__safaribooksonline_com" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#" itemscope="" itemtype="http://schema.org/Book http://schema.org/ItemPage" "="" data-login-url="/accounts/login/" data-offline-url="/" data-url="/library/view/building-applications-on/9781491926543/ch03.html" data-csrf-cookie="csrfsafari" data-highlight-privacy="" data-user-id="859452" data-user-uuid="4d373bec-fada-4717-9823-769db3ed3a36" data-username="dchen267" data-account-type="B2B" data-activated-trial-date="04/25/2016" data-archive="9781491926543" data-publishers="O'Reilly Media, Inc." data-htmlfile-name="ch03.html" data-epub-title="Building Applications on Mesos" data-debug="0" data-testing="0"><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="Safari Books Online"><meta name="format-detection" content="telephone=no"><meta http-equiv="cleartype" content="on"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="apple-itunes-app" content="app-id=881697395, app-argument=safaridetail://9781491926543"><meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0"><meta property="twitter:account_id" content="4503599627559754"><link rel="apple-touch-icon" href="https://www.safaribooksonline.com/static/images/apple-touch-icon.8cc2fd27400e.png"><link rel="shortcut icon" href="https://www.safaribooksonline.com/favicon.ico" type="image/x-icon"><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700,900,200italic,300italic,400italic,600italic,700italic,900italic" rel="stylesheet" type="text/css"><title>3. Porting an Existing Application to Mesos - Building Applications on Mesos</title><link rel="stylesheet" href="https://www.safaribooksonline.com/static/CACHE/css/e4b0fef39b55.css" type="text/css"><link rel="stylesheet" type="text/css" href="https://www.safaribooksonline.com/static/css/annotator.min.fd58f69f4908.css"><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css"><style type="text/css" title="ibis-book">
    @charset "utf-8";#sbo-rt-content html,#sbo-rt-content div,#sbo-rt-content div,#sbo-rt-content span,#sbo-rt-content applet,#sbo-rt-content object,#sbo-rt-content iframe,#sbo-rt-content h1,#sbo-rt-content h2,#sbo-rt-content h3,#sbo-rt-content h4,#sbo-rt-content h5,#sbo-rt-content h6,#sbo-rt-content p,#sbo-rt-content blockquote,#sbo-rt-content pre,#sbo-rt-content a,#sbo-rt-content abbr,#sbo-rt-content acronym,#sbo-rt-content address,#sbo-rt-content big,#sbo-rt-content cite,#sbo-rt-content code,#sbo-rt-content del,#sbo-rt-content dfn,#sbo-rt-content em,#sbo-rt-content font,#sbo-rt-content img,#sbo-rt-content ins,#sbo-rt-content kbd,#sbo-rt-content q,#sbo-rt-content s,#sbo-rt-content samp,#sbo-rt-content small,#sbo-rt-content strike,#sbo-rt-content strong,#sbo-rt-content sub,#sbo-rt-content sup,#sbo-rt-content tt,#sbo-rt-content var,#sbo-rt-content b,#sbo-rt-content u,#sbo-rt-content i,#sbo-rt-content center,#sbo-rt-content dl,#sbo-rt-content dt,#sbo-rt-content dd,#sbo-rt-content ol,#sbo-rt-content ul,#sbo-rt-content li,#sbo-rt-content fieldset,#sbo-rt-content form,#sbo-rt-content label,#sbo-rt-content legend,#sbo-rt-content table,#sbo-rt-content caption,#sbo-rt-content tdiv,#sbo-rt-content tfoot,#sbo-rt-content thead,#sbo-rt-content tr,#sbo-rt-content th,#sbo-rt-content td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}@page{margin:5px !important}#sbo-rt-content p{margin:8px 0 0;line-height:125%;text-align:left}#sbo-rt-content em{font-style:italic;font-family:inherit}#sbo-rt-content em.replaceable{font-style:italic}#sbo-rt-content em strong,#sbo-rt-content strong em{font-weight:bold;font-style:italic;font-family:inherit}#sbo-rt-content strong.userinput{font-weight:bold;font-style:normal}#sbo-rt-content span.bolditalic{font-weight:bold;font-style:italic}#sbo-rt-content strong,#sbo-rt-content span.bold{font-weight:bold}#sbo-rt-content a.ulink,#sbo-rt-content a.xref,#sbo-rt-content a.email,#sbo-rt-content a.link,#sbo-rt-content a{text-decoration:none;color:#8e0012}#sbo-rt-content sup{font-size:x-small;vertical-align:super}#sbo-rt-content sub{font-size:smaller;vertical-align:sub}#sbo-rt-content span.lineannotation{font-style:italic;color:#A62A2A;font-family:serif,"DejaVuSerif"}#sbo-rt-content span.underline{text-decoration:underline}#sbo-rt-content span.strikethrough{text-decoration:line-through}#sbo-rt-content span.smallcaps{font-variant:small-caps}#sbo-rt-content span.cursor{background:#000;color:#FFF}#sbo-rt-content span.smaller{font-size:75%}#sbo-rt-content .boxedtext,#sbo-rt-content .keycap{border-style:solid;border-width:1px;border-color:#000;padding:1px}#sbo-rt-content span.gray50{color:#7F7F7F;}#sbo-rt-content .gray-background,#sbo-rt-content .reverse-video{background:#2E2E2E;color:#FFF}#sbo-rt-content .light-gray-background{background:#A0A0A0}#sbo-rt-content .preserve-whitespace{white-space:pre-wrap}#sbo-rt-content h1,#sbo-rt-content div.toc-title,#sbo-rt-content h2,#sbo-rt-content h3,#sbo-rt-content h4,#sbo-rt-content h5{-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;font-weight:bold;text-align:left;page-break-after:avoid !important;font-family:sans-serif,"DejaVuSans"}#sbo-rt-content div.toc-title{font-size:1.5em;margin-top:20px !important;margin-bottom:30px !important}#sbo-rt-content section[data-type="sect1"] h1{font-size:1.3em;color:#8e0012;margin:40px 0 8px 0}#sbo-rt-content section[data-type="sect2"] h2{font-size:1.1em;margin:30px 0 8px 0 !important}#sbo-rt-content section[data-type="sect3"] h3{font-size:1em;color:#555;margin:20px 0 8px 0 !important}#sbo-rt-content section[data-type="sect4"] h4{font-size:1em;font-weight:normal;font-style:italic;margin:15px 0 6px 0 !important}#sbo-rt-content section[data-type="chapter"]>div>h1,#sbo-rt-content section[data-type="preface"]>div>h1,#sbo-rt-content section[data-type="appendix"]>div>h1,#sbo-rt-content section[data-type="glossary"]>div>h1,#sbo-rt-content section[data-type="bibliography"]>div>h1,#sbo-rt-content section[data-type="index"]>div>h1{font-size:2em;line-height:1;margin-bottom:50px;color:#000;padding-bottom:10px;border-bottom:1px solid #000}#sbo-rt-content div[data-type="part"] h1{font-size:2em;text-align:center;margin-top:0 !important;margin-bottom:50px;padding:50px 0 10px 0;border-bottom:1px solid #000}#sbo-rt-content img.width-ninety{width:90%}#sbo-rt-content img{max-width:95%;margin:0 auto;padding:0}#sbo-rt-content div.figure{background-color:transparent;text-align:center;-webkit-border-radius:5px;border-radius:5px;border:1px solid #DCDCDC;padding:15px 5px 15px 5px !important;margin:15px 0 15px 0 !important;page-break-inside:avoid}#sbo-rt-content figure{margin:15px 0 15px 0 !important;page-break-inside:avoid}#sbo-rt-content div.figure h6{font-size:90%;text-align:center;font-weight:normal;font-style:italic;font-family:serif,"DejaVuSerif";color:#000;padding-top:10px !important;page-break-before:avoid;page-break-after:avoid}#sbo-rt-content div.informalfigure{text-align:center;padding:5px 0 !important}#sbo-rt-content div.sidebar{margin:15px 0 10px 0 !important;-webkit-border-radius:5px;border-radius:5px;border:1px solid #DCDCDC;background-color:#F7F7F7;font-size:90%;padding:15px !important;page-break-inside:avoid}#sbo-rt-content aside[data-type="sidebar"]{margin:15px 0 10px 0 !important;page-break-inside:avoid}#sbo-rt-content div.sidebar-title,#sbo-rt-content aside[data-type="sidebar"] h5{font-weight:bold;font-size:1em;font-family:sans-serif,"DejaVuSans";text-transform:uppercase;letter-spacing:1px;text-align:center;margin:4px 0 6px 0 !important;page-break-inside:avoid}#sbo-rt-content div.sidebar div.figure p.title,#sbo-rt-content aside[data-type="sidebar"] figcaption,#sbo-rt-content div.sidebar div.informalfigure div.caption{font-size:90%;text-align:center;font-weight:normal;font-style:italic;font-family:serif,"DejaVuSerif";color:#000;padding:5px !important;page-break-before:avoid;page-break-after:avoid}#sbo-rt-content div.sidebar ol,#sbo-rt-content aside[data-type="sidebar"] ul{margin-left:15px}#sbo-rt-content div.sidebar div.tip,#sbo-rt-content div.sidebar div.note,#sbo-rt-content div.sidebar div.warning,#sbo-rt-content div.sidebar div.caution,#sbo-rt-content div.sidebar div.important{margin:20px auto 20px auto !important;font-size:90%;width:85%}#sbo-rt-content div.sidebar div.figure,#sbo-rt-content aside[data-type="sidebar"] figure{border:none}#sbo-rt-content pre{white-space:pre-wrap;font-family:"Ubuntu Mono",monospace;margin:25px 0 25px 20px;font-size:85%;display:block;-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none}#sbo-rt-content div.note pre.programlisting,#sbo-rt-content div.tip pre.programlisting,#sbo-rt-content div.warning pre.programlisting,#sbo-rt-content div.caution pre.programlisting,#sbo-rt-content div.important pre.programlisting{margin-bottom:0}#sbo-rt-content code{font-family:"Ubuntu Mono",monospace;-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none}#sbo-rt-content code strong em,#sbo-rt-content code em strong,#sbo-rt-content pre em strong,#sbo-rt-content pre strong em,#sbo-rt-content strong code em code,#sbo-rt-content em code strong code,#sbo-rt-content span.bolditalic code{font-weight:bold;font-style:italic;font-family:"Ubuntu Mono BoldItal",monospace}#sbo-rt-content code em,#sbo-rt-content em code,#sbo-rt-content pre em,#sbo-rt-content em.replaceable{font-family:"Ubuntu Mono Ital",monospace;font-style:italic}#sbo-rt-content code strong,#sbo-rt-content strong code,#sbo-rt-content pre strong,#sbo-rt-content strong.userinput{font-family:"Ubuntu Mono Bold",monospace;font-weight:bold}#sbo-rt-content div[data-type="example"]{margin:10px 0 15px 0 !important}#sbo-rt-content div[data-type="example"] h1,#sbo-rt-content div[data-type="example"] h2,#sbo-rt-content div[data-type="example"] h3,#sbo-rt-content div[data-type="example"] h4,#sbo-rt-content div[data-type="example"] h5,#sbo-rt-content div[data-type="example"] h6{font-style:italic;font-weight:normal;font-family:serif,"DejaVuSerif";margin:10px 0 5px 0 !important;border-bottom:1px solid #000}#sbo-rt-content li pre.example{padding:10px 0 !important}#sbo-rt-content div[data-type="example"] pre[data-type="programlisting"],#sbo-rt-content div[data-type="example"] pre[data-type="screen"]{margin:0}#sbo-rt-content span.gray{color:#4C4C4C}#sbo-rt-content section[data-type="titlepage"]>div>h1{font-size:3em;font-family:sans-serif,"DejaVuSans";font-weight:bold;margin:50px 0 10px 0 !important;line-height:1;text-align:center}#sbo-rt-content section[data-type="titlepage"]>div>h2[data-type="author"]{font-size:2em;font-family:sans-serif,"DejaVuSans";font-weight:bold;color:#8e0012;margin:50px 0 !important;text-align:center}#sbo-rt-content div.book div.titlepage div.publishername{margin-top:60%;margin-bottom:20px;text-align:center;font-size:1.25em}#sbo-rt-content div.book div.titlepage div.locations p{margin:0;text-align:center}#sbo-rt-content div.book div.titlepage div.locations p.cities{font-size:80%;text-align:center;margin-top:5px}#sbo-rt-content section.preface[title="Dedication"]>div.titlepage h2.title{text-align:center;text-transform:uppercase;font-size:1.5em;margin-top:50px;margin-bottom:50px}#sbo-rt-content section.preface[title="Dedication"] p{font-style:italic;text-align:center}#sbo-rt-content div.colophon h1.title{font-size:1.3em;margin:0 !important;font-family:serif,"DejaVuSerif";font-weight:normal}#sbo-rt-content div.colophon h2.subtitle{margin:0 !important;color:#000;font-family:serif,"DejaVuSerif";font-size:1em;font-weight:normal}#sbo-rt-content div.colophon div.author h3.author{font-size:1.1em;font-family:serif,"DejaVuSerif";margin:10px 0 0 !important;font-weight:normal}#sbo-rt-content div.colophon div.editor h4,#sbo-rt-content div.colophon div.editor h3.editor{color:#000;font-size:.8em;margin:15px 0 0 !important;font-family:serif,"DejaVuSerif";font-weight:normal}#sbo-rt-content div.colophon div.editor h3.editor{font-size:.8em;margin:0 !important;font-family:serif,"DejaVuSerif";font-weight:normal}#sbo-rt-content div.colophon div.publisher{margin-top:10px}#sbo-rt-content div.colophon div.publisher p,#sbo-rt-content div.colophon div.publisher span.publishername{margin:0;font-size:.8em}#sbo-rt-content div.legalnotice p,#sbo-rt-content div.timestamp p{font-size:.8em}#sbo-rt-content div.timestamp p{margin-top:10pt}#sbo-rt-content div.colophon[title="About the Author"] h1.title,#sbo-rt-content div.colophon[title="Colophon"] h1.title{font-size:1.5em;margin:0 !important;font-family:sans-serif,"DejaVuSans";font-weight:bold}#sbo-rt-content section.chapter div.titlepage div.author{margin:10px 0 10px 0}#sbo-rt-content section.chapter div.titlepage div.author div.affiliation{font-style:italic}#sbo-rt-content div.attribution{margin:5px 0 0 50px !important}#sbo-rt-content h3.author span.orgname{display:none}#sbo-rt-content div.epigraph{margin:10px 0 10px 20px !important;page-break-inside:avoid;font-size:90%}#sbo-rt-content div.epigraph p{font-style:italic}#sbo-rt-content blockquote,#sbo-rt-content div.blockquote{margin:10px !important;page-break-inside:avoid;font-size:95%}#sbo-rt-content blockquote p,#sbo-rt-content div.blockquote p{font-family:serif,"DejaVuSerif";font-style:italic}#sbo-rt-content blockquote div.attribution{margin:5px 0 0 30px !important;text-align:right;width:80%}#sbo-rt-content blockquote div.attribution p{font-style:normal}#sbo-rt-content p.right{text-align:right;margin:0}#sbo-rt-content div.footnote{font-size:90%}#sbo-rt-content div.refnamediv h2,#sbo-rt-content div.refnamediv h3,#sbo-rt-content div.refsynopsisdiv h2{font-size:1.1em;color:#000;margin-top:15px !important;margin-bottom:0 !important}#sbo-rt-content div.refentry div.refsect1 h2{font-size:1.1em;color:#000;margin-top:15px !important;margin-bottom:0 !important}#sbo-rt-content div.refsect2 h3{font-size:1em;color:#000;margin-top:10px !important;margin-bottom:0 !important}#sbo-rt-content div.refnamediv p{margin-left:15px !important}#sbo-rt-content dt{padding-top:10px !important;padding-bottom:0 !important}#sbo-rt-content dt span.term{font-weight:bold;font-style:italic}#sbo-rt-content dt span.term code.literal{font-style:normal;font-weight:normal}#sbo-rt-content dd{margin-left:1.5em !important}#sbo-rt-content dd,#sbo-rt-content li{text-align:left}#sbo-rt-content ol{list-style-type:decimal;margin-top:8px !important;margin-bottom:8px !important;margin-left:20px !important;padding-left:25px !important}#sbo-rt-content ol ol{list-style-type:lower-alpha}#sbo-rt-content ol ol ol{list-style-type:lower-roman}#sbo-rt-content ul{list-style-type:square;margin-top:8px !important;margin-bottom:8px !important;margin-left:5px !important;padding-left:20px !important}#sbo-rt-content ul ul{list-style-type:none;padding-left:0 !important;margin-left:0 !important}#sbo-rt-content ol li,#sbo-rt-content ul li,#sbo-rt-content dd{margin-bottom:.25em}#sbo-rt-content ul ul li p:before{content:"— "}#sbo-rt-content ul ul ul li p:before{content:""}#sbo-rt-content ul ul ul{list-style-type:square;margin-left:20px !important;padding-left:30px !important}#sbo-rt-content div.orderedlistalpha{list-style-type:upper-alpha}#sbo-rt-content table.simplelist{margin-left:20px !important;margin-bottom:10px}#sbo-rt-content table.simplelist td{border:none;font-size:90%}#sbo-rt-content table.simplelist tr{border-bottom:none}#sbo-rt-content table.simplelist tr:nth-of-type(even){background-color:transparent}#sbo-rt-content dl.calloutlist p:first-child{margin-top:-25px !important}#sbo-rt-content dl.calloutlist dd{padding-left:0;margin-top:-25px}#sbo-rt-content dl.calloutlist img{padding:0}#sbo-rt-content a.co img{padding:0}#sbo-rt-content div.toc ol{margin-top:8px !important;margin-bottom:8px !important;margin-left:0 !important;padding-left:0 !important}#sbo-rt-content div.toc ol ol{margin-left:30px !important;padding-left:0 !important}#sbo-rt-content div.toc ol li{list-style-type:none}#sbo-rt-content div.toc a{color:#8e0012}#sbo-rt-content div.toc ol a{font-size:1em;font-weight:bold}#sbo-rt-content div.toc ol>li>ol a{font-weight:bold;font-size:1em}#sbo-rt-content div.toc ol>li>ol>li>ol a{text-decoration:none;font-weight:normal;font-size:1em}#sbo-rt-content div.tip,#sbo-rt-content div[data-type="tip"],#sbo-rt-content div.note,#sbo-rt-content div[data-type="note"],#sbo-rt-content div.warning,#sbo-rt-content div[data-type="warning"],#sbo-rt-content div[data-type="caution"],#sbo-rt-content div[data-type="important"]{margin:30px !important;-webkit-border-radius:5px;border-radius:5px;font-size:90%;padding:10px 8px 20px 8px !important;page-break-inside:avoid}#sbo-rt-content div.tip,#sbo-rt-content div[data-type="tip"],#sbo-rt-content div.note,#sbo-rt-content div[data-type="note"]{border:1px solid #BEBEBE;background-color:transparent}#sbo-rt-content div.warning,#sbo-rt-content div[data-type="warning"],#sbo-rt-content div[data-type="caution"],#sbo-rt-content div[data-type="important"]{border:1px solid #BC8F8F}#sbo-rt-content div.tip h3,#sbo-rt-content div[data-type="tip"] h6,#sbo-rt-content div[data-type="tip"] h1,#sbo-rt-content div.note h3,#sbo-rt-content div[data-type="note"] h6,#sbo-rt-content div[data-type="note"] h1,#sbo-rt-content div.warning h3,#sbo-rt-content div[data-type="warning"] h6,#sbo-rt-content div[data-type="warning"] h1,#sbo-rt-content div[data-type="caution"] h6,#sbo-rt-content div[data-type="caution"] h1,#sbo-rt-content div[data-type="important"] h1{font-weight:bold;font-size:110%;font-family:sans-serif,"DejaVuSans";text-transform:uppercase;letter-spacing:1px;text-align:center;margin:4px 0 6px !important}#sbo-rt-content div.tip h3,#sbo-rt-content div[data-type="tip"] h6,#sbo-rt-content div.note h3,#sbo-rt-content div[data-type="note"] h6{color:#737373}#sbo-rt-content div.warning h3,#sbo-rt-content div[data-type="warning"] h6,#sbo-rt-content div[data-type="caution"] h6,#sbo-rt-content div[data-type="important"] h6{color:#C67171}#sbo-rt-content div.sect1[title="Safari® Books Online"] div.note,#sbo-rt-content div.safarienabled{background-color:transparent;margin:8px 0 0 !important;border:0 solid #BEBEBE;-webkit-border-radius:0;border-radius:0;font-size:100%;padding:0 !important;page-break-inside:avoid}#sbo-rt-content div.sect1[title="Safari® Books Online"] div.note h3{display:none}#sbo-rt-content div.table,#sbo-rt-content table{margin:15px auto 30px auto !important;max-width:95%;border-collapse:collapse;border-spacing:0}#sbo-rt-content div.table,#sbo-rt-content div.informaltable{page-break-inside:avoid}#sbo-rt-content tr,#sbo-rt-content tr td{border-bottom:1px solid #c3c3c3}#sbo-rt-content thead td,#sbo-rt-content thead th{border-bottom:#9d9d9d 1px solid !important;border-top:#9d9d9d 1px solid !important}#sbo-rt-content tr:nth-of-type(even){background-color:#f1f6fc}#sbo-rt-content thead{font-family:sans-serif,"DejaVuSans";color:#000;font-weight:bold}#sbo-rt-content td,#sbo-rt-content th{padding:.3em;text-align:left;vertical-align:baseline;font-size:80%}#sbo-rt-content div.informaltable table{margin:10px auto !important}#sbo-rt-content div.informaltable table tr{border-bottom:none}#sbo-rt-content div.informaltable table tr:nth-of-type(even){background-color:transparent}#sbo-rt-content div.informaltable td,#sbo-rt-content div.informaltable th{border:#9d9d9d 1px solid}#sbo-rt-content div.table-title,#sbo-rt-content table caption{font-weight:normal;font-style:italic;font-family:serif,"DejaVuSerif";margin:10px 0 10px 0 !important;text-align:center;padding:0;page-break-after:avoid}#sbo-rt-content table code{font-size:smaller}#sbo-rt-content div.equation{margin:10px 0 15px 0 !important}#sbo-rt-content div.equation-title{font-style:italic;font-weight:normal;font-family:serif,"DejaVuSerif";margin:20px 0 10px 0 !important;page-break-after:avoid}#sbo-rt-content div.equation-contents{margin-left:20px}#sbo-rt-content span.inlinemediaobject{height:.85em;display:inline-block;margin-bottom:.2em}#sbo-rt-content span.inlinemediaobject img{margin:0;height:.85em}#sbo-rt-content div.informalequation{margin:20px 0 20px 20px;width:75%}#sbo-rt-content div.informalequation img{width:75%}#sbo-rt-content div.index{font-weight:bold;text-indent:0}#sbo-rt-content div.index li{line-height:140%}#sbo-rt-content div.index a.indexterm{color:#8e0012}#sbo-rt-content div.index ul{list-style-type:none;padding-left:0;margin-left:0}#sbo-rt-content div.index ul li{padding-left:0;margin-left:0}#sbo-rt-content div.index ul li ul li{margin-left:20px}#sbo-rt-content code.boolean,#sbo-rt-content .navy{color:rgb(0,0,128);}#sbo-rt-content code.character,#sbo-rt-content .olive{color:rgb(128,128,0);}#sbo-rt-content code.comment,#sbo-rt-content .blue{color:rgb(0,0,255);}#sbo-rt-content code.conditional,#sbo-rt-content .limegreen{color:rgb(50,205,50);}#sbo-rt-content code.constant,#sbo-rt-content .darkorange{color:rgb(255,140,0);}#sbo-rt-content code.debug,#sbo-rt-content .darkred{color:rgb(139,0,0);}#sbo-rt-content code.define,#sbo-rt-content .darkgoldenrod,#sbo-rt-content .gold{color:rgb(184,134,11);}#sbo-rt-content code.delimiter,#sbo-rt-content .dimgray{color:rgb(105,105,105);}#sbo-rt-content code.error,#sbo-rt-content .red{color:rgb(255,0,0);}#sbo-rt-content code.exception,#sbo-rt-content .salmon{color:rgb(250,128,11);}#sbo-rt-content code.float,#sbo-rt-content .steelblue{color:rgb(70,130,180);}#sbo-rt-content pre code.function,#sbo-rt-content .green{color:rgb(0,128,0);}#sbo-rt-content code.identifier,#sbo-rt-content .royalblue{color:rgb(65,105,225);}#sbo-rt-content code.ignore,#sbo-rt-content .gray{color:rgb(128,128,128);}#sbo-rt-content code.include,#sbo-rt-content .purple{color:rgb(128,0,128);}#sbo-rt-content code.keyword,#sbo-rt-content .sienna{color:rgb(160,82,45);}#sbo-rt-content code.label,#sbo-rt-content .deeppink{color:rgb(255,20,147);}#sbo-rt-content code.macro,#sbo-rt-content .orangered{color:rgb(255,69,0);}#sbo-rt-content code.number,#sbo-rt-content .brown{color:rgb(165,42,42);}#sbo-rt-content code.operator,#sbo-rt-content .black{color:#000;}#sbo-rt-content code.preCondit,#sbo-rt-content .teal{color:rgb(0,128,128);}#sbo-rt-content code.preProc,#sbo-rt-content .fuschia{color:rgb(255,0,255);}#sbo-rt-content code.repeat,#sbo-rt-content .indigo{color:rgb(75,0,130);}#sbo-rt-content code.special,#sbo-rt-content .saddlebrown{color:rgb(139,69,19);}#sbo-rt-content code.specialchar,#sbo-rt-content .magenta{color:rgb(255,0,255);}#sbo-rt-content code.specialcomment,#sbo-rt-content .seagreen{color:rgb(46,139,87);}#sbo-rt-content code.statement,#sbo-rt-content .forestgreen{color:rgb(34,139,34);}#sbo-rt-content code.storageclass,#sbo-rt-content .plum{color:rgb(221,160,221);}#sbo-rt-content code.string,#sbo-rt-content .darkred{color:rgb(139,0,0);}#sbo-rt-content code.structure,#sbo-rt-content .chocolate{color:rgb(210,106,30);}#sbo-rt-content code.tag,#sbo-rt-content .darkcyan{color:rgb(0,139,139);}#sbo-rt-content code.todo,#sbo-rt-content .black{color:#000;}#sbo-rt-content code.type,#sbo-rt-content .mediumslateblue{color:rgb(123,104,238);}#sbo-rt-content code.typedef,#sbo-rt-content .darkgreen{color:rgb(0,100,0);}#sbo-rt-content code.underlined{text-decoration:underline;}#sbo-rt-content pre code.hll{background-color:#ffc}#sbo-rt-content pre code.c{color:#09F;font-style:italic}#sbo-rt-content pre code.err{color:#A00}#sbo-rt-content pre code.k{color:#069;font-weight:bold}#sbo-rt-content pre code.o{color:#555}#sbo-rt-content pre code.cm{color:#35586C;font-style:italic}#sbo-rt-content pre code.cp{color:#099}#sbo-rt-content pre code.c1{color:#35586C;font-style:italic}#sbo-rt-content pre code.cs{color:#35586C;font-weight:bold;font-style:italic}#sbo-rt-content pre code.gd{background-color:#FCC}#sbo-rt-content pre code.ge{font-style:italic}#sbo-rt-content pre code.gr{color:#F00}#sbo-rt-content pre code.gh{color:#030;font-weight:bold}#sbo-rt-content pre code.gi{background-color:#CFC}#sbo-rt-content pre code.go{color:#000}#sbo-rt-content pre code.gp{color:#009;font-weight:bold}#sbo-rt-content pre code.gs{font-weight:bold}#sbo-rt-content pre code.gu{color:#030;font-weight:bold}#sbo-rt-content pre code.gt{color:#9C6}#sbo-rt-content pre code.kc{color:#069;font-weight:bold}#sbo-rt-content pre code.kd{color:#069;font-weight:bold}#sbo-rt-content pre code.kn{color:#069;font-weight:bold}#sbo-rt-content pre code.kp{color:#069}#sbo-rt-content pre code.kr{color:#069;font-weight:bold}#sbo-rt-content pre code.kt{color:#078;font-weight:bold}#sbo-rt-content pre code.m{color:#F60}#sbo-rt-content pre code.s{color:#C30}#sbo-rt-content pre code.na{color:#309}#sbo-rt-content pre code.nb{color:#366}#sbo-rt-content pre code.nc{color:#0A8;font-weight:bold}#sbo-rt-content pre code.no{color:#360}#sbo-rt-content pre code.nd{color:#99F}#sbo-rt-content pre code.ni{color:#999;font-weight:bold}#sbo-rt-content pre code.ne{color:#C00;font-weight:bold}#sbo-rt-content pre code.nf{color:#C0F}#sbo-rt-content pre code.nl{color:#99F}#sbo-rt-content pre code.nn{color:#0CF;font-weight:bold}#sbo-rt-content pre code.nt{color:#309;font-weight:bold}#sbo-rt-content pre code.nv{color:#033}#sbo-rt-content pre code.ow{color:#000;font-weight:bold}#sbo-rt-content pre code.w{color:#bbb}#sbo-rt-content pre code.mf{color:#F60}#sbo-rt-content pre code.mh{color:#F60}#sbo-rt-content pre code.mi{color:#F60}#sbo-rt-content pre code.mo{color:#F60}#sbo-rt-content pre code.sb{color:#C30}#sbo-rt-content pre code.sc{color:#C30}#sbo-rt-content pre code.sd{color:#C30;font-style:italic}#sbo-rt-content pre code.s2{color:#C30}#sbo-rt-content pre code.se{color:#C30;font-weight:bold}#sbo-rt-content pre code.sh{color:#C30}#sbo-rt-content pre code.si{color:#A00}#sbo-rt-content pre code.sx{color:#C30}#sbo-rt-content pre code.sr{color:#3AA}#sbo-rt-content pre code.s1{color:#C30}#sbo-rt-content pre code.ss{color:#A60}#sbo-rt-content pre code.bp{color:#366}#sbo-rt-content pre code.vc{color:#033}#sbo-rt-content pre code.vg{color:#033}#sbo-rt-content pre code.vi{color:#033}#sbo-rt-content pre code.il{color:#F60}#sbo-rt-content pre code.g{color:#050}#sbo-rt-content pre code.l{color:#C60}#sbo-rt-content pre code.l{color:#F90}#sbo-rt-content pre code.n{color:#008}#sbo-rt-content pre code.nx{color:#008}#sbo-rt-content pre code.py{color:#96F}#sbo-rt-content pre code.p{color:#000}#sbo-rt-content pre code.x{color:#F06}#sbo-rt-content div.blockquote_sampler_toc{width:95%;margin:5px 5px 5px 10px !important}#sbo-rt-content div{font-family:serif,"DejaVuSerif";text-align:left}
    </style><link rel="canonical" href="/library/view/building-applications-on/9781491926543/ch03.html"><meta name="description" content=" Chapter 3. Porting an Existing Application to Mesos It’s time to learn how to build an application on top of Mesos. Rather than building everything from first principles, however ... "><meta property="og:title" content="3. Porting an Existing Application to Mesos"><meta itemprop="isPartOf" content="/library/view/building-applications-on/9781491926543/"><meta itemprop="name" content="3. Porting an Existing Application to Mesos"><meta property="og:url" itemprop="url" content="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/ch03.html"><meta property="og:site_name" content="Safari"><meta property="og:image" itemprop="thumbnailUrl" content="https://www.safaribooksonline.com/library/cover/9781491926543/"><meta property="og:description" itemprop="description" content=" Chapter 3. Porting an Existing Application to Mesos It’s time to learn how to build an application on top of Mesos. Rather than building everything from first principles, however ... "><meta itemprop="inLanguage" content="en"><meta itemprop="publisher" content="O'Reilly Media, Inc."><meta property="og:type" content="book"><meta property="og:book:isbn" itemprop="isbn" content="9781491926529"><meta property="og:book:author" itemprop="author" content="David Greenberg"><meta property="og:book:tag" itemprop="about" content="Databases"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@safari"><style type="text/css" id="font-styles" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-size: <%= font_size %> !important; }"></style><style type="text/css" id="font-family" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-family: <%= font_family %> !important; }"></style><style type="text/css" id="column-width" data-template="#sbo-rt-content { max-width: <%= column_width %>% !important; margin: 0 auto !important; }"></style><!--[if lt IE 9]><script src="/static/js/src/respond.min.cf5c9b7980e5.js"></script><![endif]--><style id="annotator-dynamic-style">.annotator-adder, .annotator-outer, .annotator-notice {
  z-index: 100019;
}
.annotator-filter {
  z-index: 100009;
}</style></head>


<body class="reading sidenav nav-collapsed  scalefonts library" data-gr-c-s-loaded="true">

    
      <div class="hide working" role="status">
        <div class="working-image"></div>
      </div>
      <div class="sbo-site-nav">
        




<a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#container" class="skip">Skip to content</a><header class="topbar t-topbar"><nav role="navigation" class="js-site-nav"><ul class="topnav"><li class="t-logo"><a href="https://www.safaribooksonline.com/home/" class="l0 None safari-home nav-icn js-keyboard-nav-home"><svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" version="1.1" fill="#4A3C31"><desc>Safari Home Icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M4 9.9L4 9.9 4 18 16 18 16 9.9 10 4 4 9.9ZM2.6 8.1L2.6 8.1 8.7 1.9 10 0.5 11.3 1.9 17.4 8.1 18 8.7 18 9.5 18 18.1 18 20 16.1 20 3.9 20 2 20 2 18.1 2 9.5 2 8.7 2.6 8.1Z"></path><rect x="10" y="12" width="3" height="7"></rect><rect transform="translate(18.121320, 10.121320) rotate(-315.000000) translate(-18.121320, -10.121320) " x="16.1" y="9.1" width="4" height="2"></rect><rect transform="translate(2.121320, 10.121320) scale(-1, 1) rotate(-315.000000) translate(-2.121320, -10.121320) " x="0.1" y="9.1" width="4" height="2"></rect></g></svg><span>Safari Home</span></a></li><li><a href="https://www.safaribooksonline.com/r/" class="t-recommendations-nav l0 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" version="1.1" fill="#4A3C31"><desc>recommendations icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M50 25C50 18.2 44.9 12.5 38.3 11.7 37.5 5.1 31.8 0 25 0 18.2 0 12.5 5.1 11.7 11.7 5.1 12.5 0 18.2 0 25 0 31.8 5.1 37.5 11.7 38.3 12.5 44.9 18.2 50 25 50 31.8 50 37.5 44.9 38.3 38.3 44.9 37.5 50 31.8 50 25ZM25 3.1C29.7 3.1 33.6 6.9 34.4 11.8 30.4 12.4 26.9 15.1 25 18.8 23.1 15.1 19.6 12.4 15.6 11.8 16.4 6.9 20.3 3.1 25 3.1ZM34.4 15.6C33.6 19.3 30.7 22.2 27.1 22.9 27.8 19.2 30.7 16.3 34.4 15.6ZM22.9 22.9C19.2 22.2 16.3 19.3 15.6 15.6 19.3 16.3 22.2 19.2 22.9 22.9ZM3.1 25C3.1 20.3 6.9 16.4 11.8 15.6 12.4 19.6 15.1 23.1 18.8 25 15.1 26.9 12.4 30.4 11.8 34.4 6.9 33.6 3.1 29.7 3.1 25ZM22.9 27.1C22.2 30.7 19.3 33.6 15.6 34.4 16.3 30.7 19.2 27.8 22.9 27.1ZM25 46.9C20.3 46.9 16.4 43.1 15.6 38.2 19.6 37.6 23.1 34.9 25 31.3 26.9 34.9 30.4 37.6 34.4 38.2 33.6 43.1 29.7 46.9 25 46.9ZM27.1 27.1C30.7 27.8 33.6 30.7 34.4 34.4 30.7 33.6 27.8 30.7 27.1 27.1ZM38.2 34.4C37.6 30.4 34.9 26.9 31.3 25 34.9 23.1 37.6 19.6 38.2 15.6 43.1 16.4 46.9 20.3 46.9 25 46.9 29.7 43.1 33.6 38.2 34.4Z" fill="currentColor"></path></g></svg><span>Recommended</span></a></li><li><a href="https://www.safaribooksonline.com/s/" class="t-queue-nav l0 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" version="1.1" fill="#4A3C31"><desc>queue icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 29.2C25.4 29.2 25.8 29.1 26.1 28.9L48.7 16.8C49.5 16.4 50 15.5 50 14.6 50 13.7 49.5 12.8 48.7 12.4L26.1 0.3C25.4-0.1 24.6-0.1 23.9 0.3L1.3 12.4C0.5 12.8 0 13.7 0 14.6 0 15.5 0.5 16.4 1.3 16.8L23.9 28.9C24.2 29.1 24.6 29.2 25 29.2ZM7.3 14.6L25 5.2 42.7 14.6 25 24 7.3 14.6ZM48.7 22.4L47.7 21.9 25 34.2 2.3 21.9 1.3 22.4C0.5 22.9 0 23.7 0 24.7 0 25.6 0.5 26.5 1.3 26.9L23.9 39.3C24.2 39.5 24.6 39.6 25 39.6 25.4 39.6 25.8 39.5 26.1 39.3L48.7 26.9C49.5 26.5 50 25.6 50 24.7 50 23.7 49.5 22.9 48.7 22.4ZM48.7 32.8L47.7 32.3 25 44.6 2.3 32.3 1.3 32.8C0.5 33.3 0 34.1 0 35.1 0 36 0.5 36.9 1.3 37.3L23.9 49.7C24.2 49.9 24.6 50 25 50 25.4 50 25.8 49.9 26.1 49.7L48.7 37.3C49.5 36.9 50 36 50 35.1 50 34.1 49.5 33.3 48.7 32.8Z" fill="currentColor"></path></g></svg><span>Queue</span></a></li><li class="search"><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#" class="t-search-nav trigger nav-icn l0" data-dropdown-selector=".searchbox"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" version="1.1" fill="#4A3C31"><desc>search icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M31.3 0C20.9 0 12.5 8.4 12.5 18.8 12.5 22.5 13.6 25.9 15.4 28.8L1.2 42.9C-0.4 44.5-0.4 47.2 1.2 48.8 2 49.6 3.1 50 4.2 50 5.2 50 6.3 49.6 7.1 48.8L21.2 34.6C24.1 36.5 27.5 37.5 31.3 37.5 41.6 37.5 50 29.1 50 18.8 50 8.4 41.6 0 31.3 0ZM31.3 31.3C24.4 31.3 18.8 25.6 18.8 18.8 18.8 11.9 24.4 6.3 31.3 6.3 38.1 6.3 43.8 11.9 43.8 18.8 43.8 25.6 38.1 31.3 31.3 31.3Z" fill="currentColor"></path></g></svg><span>Search</span></a></li><li class="usermenu dropdown"><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#" class="trigger l0 nav-icn nav-dropdown"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" version="1.1" fill="#4A3C31"><desc>navigation arrow</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M0.1 12.5L9.7 3.1C9.8 3 9.9 3 10 3 10.1 3 10.2 3 10.3 3.1L19.9 12.5C20 12.5 20 12.6 20 12.8 20 12.9 20 13 19.9 13L17 15.9C16.9 16 16.8 16 16.7 16 16.5 16 16.4 16 16.4 15.9L10 9.7 3.6 15.9C3.6 16 3.5 16 3.3 16 3.2 16 3.1 16 3 15.9L0.1 13C0 12.9 0 12.8 0 12.7 0 12.7 0 12.6 0.1 12.5Z"></path></g></svg><span>Expand Nav</span></a><div class="drop-content"><ul><li><a href="https://www.safaribooksonline.com/history/" class="t-recent-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" version="1.1" fill="#4A3C31"><desc>recent items icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 0C11.2 0 0 11.2 0 25 0 38.8 11.2 50 25 50 38.8 50 50 38.8 50 25 50 11.2 38.8 0 25 0ZM6.3 25C6.3 14.6 14.6 6.3 25 6.3 35.4 6.3 43.8 14.6 43.8 25 43.8 35.4 35.4 43.8 25 43.8 14.6 43.8 6.3 35.4 6.3 25ZM31.8 31.5C32.5 30.5 32.4 29.2 31.6 28.3L27.1 23.8 27.1 12.8C27.1 11.5 26.2 10.4 25 10.4 23.9 10.4 22.9 11.5 22.9 12.8L22.9 25.7 28.8 31.7C29.2 32.1 29.7 32.3 30.2 32.3 30.8 32.3 31.3 32 31.8 31.5Z" fill="currentColor"></path></g></svg><span>History</span></a></li><li><a href="https://www.safaribooksonline.com/topics" class="t-topics-link l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 55" version="1.1" fill="#4A3C31"><desc>topics icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 55L50 41.262 50 13.762 25 0 0 13.762 0 41.262 25 55ZM8.333 37.032L8.333 17.968 25 8.462 41.667 17.968 41.667 37.032 25 46.538 8.333 37.032Z" fill="currentColor"></path></g></svg><span>Topics</span></a></li><li><a href="https://www.safaribooksonline.com/tutorials/" class="l1 nav-icn t-tutorials-nav js-toggle-menu-item None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" version="1.1" fill="#4A3C31"><desc>tutorials icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M15.8 18.2C15.8 18.2 15.9 18.2 16 18.2 16.1 18.2 16.2 18.2 16.4 18.2 16.5 18.2 16.7 18.1 16.9 18 17 17.9 17.1 17.8 17.2 17.7 17.3 17.6 17.4 17.5 17.4 17.4 17.5 17.2 17.6 16.9 17.6 16.7 17.6 16.6 17.6 16.5 17.6 16.4 17.5 16.2 17.5 16.1 17.4 15.9 17.3 15.8 17.2 15.6 17 15.5 16.8 15.3 16.6 15.3 16.4 15.2 16.2 15.2 16 15.2 15.8 15.2 15.7 15.2 15.5 15.3 15.3 15.4 15.2 15.4 15.1 15.5 15 15.7 14.9 15.8 14.8 15.9 14.7 16 14.7 16.1 14.6 16.3 14.6 16.4 14.6 16.5 14.6 16.6 14.6 16.6 14.6 16.7 14.6 16.9 14.6 17 14.6 17.1 14.7 17.3 14.7 17.4 14.8 17.6 15 17.7 15.1 17.9 15.2 18 15.3 18 15.5 18.1 15.5 18.1 15.6 18.2 15.7 18.2 15.7 18.2 15.7 18.2 15.8 18.2L15.8 18.2ZM9.4 11.5C9.5 11.5 9.5 11.5 9.6 11.5 9.7 11.5 9.9 11.5 10 11.5 10.2 11.5 10.3 11.4 10.5 11.3 10.6 11.2 10.8 11.1 10.9 11 10.9 10.9 11 10.8 11.1 10.7 11.2 10.5 11.2 10.2 11.2 10 11.2 9.9 11.2 9.8 11.2 9.7 11.2 9.5 11.1 9.4 11 9.2 10.9 9.1 10.8 8.9 10.6 8.8 10.5 8.7 10.3 8.6 10 8.5 9.9 8.5 9.7 8.5 9.5 8.5 9.3 8.5 9.1 8.6 9 8.7 8.8 8.7 8.7 8.8 8.6 9 8.5 9.1 8.4 9.2 8.4 9.3 8.2 9.5 8.2 9.8 8.2 10 8.2 10.1 8.2 10.2 8.2 10.3 8.2 10.5 8.3 10.6 8.4 10.7 8.5 10.9 8.6 11.1 8.7 11.2 8.9 11.3 9 11.4 9.1 11.4 9.2 11.4 9.3 11.5 9.3 11.5 9.3 11.5 9.4 11.5 9.4 11.5L9.4 11.5ZM3 4.8C3.1 4.8 3.1 4.8 3.2 4.8 3.4 4.8 3.5 4.8 3.7 4.8 3.8 4.8 4 4.7 4.1 4.6 4.3 4.5 4.4 4.4 4.5 4.3 4.6 4.2 4.6 4.1 4.7 4 4.8 3.8 4.8 3.5 4.8 3.3 4.8 3.1 4.8 3 4.8 2.9 4.7 2.8 4.7 2.6 4.6 2.5 4.5 2.3 4.4 2.2 4.2 2.1 4 1.9 3.8 1.9 3.6 1.8 3.5 1.8 3.3 1.8 3.1 1.8 2.9 1.8 2.7 1.9 2.6 2 2.4 2.1 2.3 2.2 2.2 2.3 2.1 2.4 2 2.5 2 2.6 1.8 2.8 1.8 3 1.8 3.3 1.8 3.4 1.8 3.5 1.8 3.6 1.8 3.8 1.9 3.9 2 4 2.1 4.2 2.2 4.4 2.4 4.5 2.5 4.6 2.6 4.7 2.7 4.7 2.8 4.7 2.9 4.8 2.9 4.8 3 4.8 3 4.8 3 4.8L3 4.8ZM13.1 15.2C13.2 15.1 13.2 15.1 13.2 15.1 13.3 14.9 13.4 14.7 13.6 14.5 13.8 14.2 14.1 14 14.4 13.8 14.7 13.6 15.1 13.5 15.5 13.4 15.9 13.4 16.3 13.4 16.7 13.5 17.2 13.5 17.6 13.7 17.9 13.9 18.2 14.1 18.5 14.4 18.7 14.7 18.9 15 19.1 15.3 19.2 15.6 19.3 15.9 19.4 16.1 19.4 16.4 19.4 17 19.3 17.5 19.1 18.1 19 18.3 18.9 18.5 18.7 18.7 18.5 19 18.3 19.2 18 19.4 17.7 19.6 17.3 19.8 16.9 19.9 16.6 20 16.3 20 16 20 15.8 20 15.6 20 15.4 19.9 15.4 19.9 15.4 19.9 15.4 19.9 15.2 19.9 15 19.8 14.9 19.8 14.8 19.7 14.7 19.7 14.6 19.7 14.4 19.6 14.3 19.5 14.1 19.3 13.7 19.1 13.4 18.7 13.2 18.4 13.1 18.1 12.9 17.8 12.9 17.5 12.8 17.3 12.8 17.1 12.8 16.9L3.5 14.9C3.3 14.9 3.1 14.8 3 14.8 2.7 14.7 2.4 14.5 2.1 14.3 1.7 14 1.4 13.7 1.2 13.3 1 13 0.9 12.6 0.8 12.3 0.7 12 0.7 11.7 0.7 11.4 0.7 11 0.8 10.5 1 10.1 1.1 9.8 1.3 9.5 1.6 9.2 1.8 8.9 2.1 8.7 2.4 8.5 2.8 8.3 3.2 8.1 3.6 8.1 3.9 8 4.2 8 4.5 8 4.6 8 4.8 8 4.9 8.1L6.8 8.5C6.8 8.4 6.8 8.4 6.8 8.4 6.9 8.2 7.1 8 7.2 7.8 7.5 7.5 7.7 7.3 8 7.1 8.4 6.9 8.7 6.8 9.1 6.7 9.5 6.7 10 6.7 10.4 6.8 10.8 6.8 11.2 7 11.5 7.2 11.8 7.5 12.1 7.7 12.4 8 12.6 8.3 12.7 8.6 12.8 8.9 12.9 9.2 13 9.4 13 9.7 13 9.7 13 9.8 13 9.8 13.6 9.9 14.2 10.1 14.9 10.2 15 10.2 15 10.2 15.1 10.2 15.3 10.2 15.4 10.2 15.6 10.2 15.8 10.1 16 10 16.2 9.9 16.4 9.8 16.5 9.6 16.6 9.5 16.8 9.2 16.9 8.8 16.9 8.5 16.9 8.3 16.9 8.2 16.8 8 16.8 7.8 16.7 7.7 16.6 7.5 16.5 7.3 16.3 7.2 16.2 7.1 16 7 15.9 6.9 15.8 6.9 15.7 6.9 15.6 6.8 15.5 6.8L6.2 4.8C6.2 5 6 5.2 5.9 5.3 5.7 5.6 5.5 5.8 5.3 6 4.9 6.2 4.5 6.4 4.1 6.5 3.8 6.6 3.5 6.6 3.2 6.6 3 6.6 2.8 6.6 2.7 6.6 2.6 6.6 2.6 6.5 2.6 6.5 2.5 6.5 2.3 6.5 2.1 6.4 1.8 6.3 1.6 6.1 1.3 6 1 5.7 0.7 5.4 0.5 5 0.3 4.7 0.2 4.4 0.1 4.1 0 3.8 0 3.6 0 3.3 0 2.8 0.1 2.2 0.4 1.7 0.5 1.5 0.7 1.3 0.8 1.1 1.1 0.8 1.3 0.6 1.6 0.5 2 0.3 2.3 0.1 2.7 0.1 3.1 0 3.6 0 4 0.1 4.4 0.2 4.8 0.3 5.1 0.5 5.5 0.8 5.7 1 6 1.3 6.2 1.6 6.3 1.9 6.4 2.3 6.5 2.5 6.6 2.7 6.6 3 6.6 3 6.6 3.1 6.6 3.1 9.7 3.8 12.8 4.4 15.9 5.1 16.1 5.1 16.2 5.2 16.4 5.2 16.7 5.3 16.9 5.5 17.2 5.6 17.5 5.9 17.8 6.2 18.1 6.5 18.3 6.8 18.4 7.2 18.6 7.5 18.6 7.9 18.7 8.2 18.7 8.6 18.7 9 18.6 9.4 18.4 9.8 18.3 10.1 18.2 10.3 18 10.6 17.8 10.9 17.5 11.1 17.3 11.3 16.9 11.6 16.5 11.8 16 11.9 15.7 12 15.3 12 15 12 14.8 12 14.7 12 14.5 11.9 13.9 11.8 13.3 11.7 12.6 11.5 12.5 11.7 12.4 11.9 12.3 12 12.1 12.3 11.9 12.5 11.7 12.7 11.3 12.9 10.9 13.1 10.5 13.2 10.2 13.3 9.9 13.3 9.6 13.3 9.4 13.3 9.2 13.3 9 13.2 9 13.2 9 13.2 9 13.2 8.8 13.2 8.7 13.2 8.5 13.1 8.2 13 8 12.8 7.7 12.6 7.4 12.4 7.1 12 6.8 11.7 6.7 11.4 6.6 11.1 6.5 10.8 6.4 10.6 6.4 10.4 6.4 10.2 5.8 10.1 5.2 9.9 4.5 9.8 4.4 9.8 4.4 9.8 4.3 9.8 4.1 9.8 4 9.8 3.8 9.8 3.6 9.9 3.4 10 3.2 10.1 3 10.2 2.9 10.4 2.8 10.5 2.6 10.8 2.5 11.1 2.5 11.5 2.5 11.6 2.5 11.8 2.6 12 2.6 12.1 2.7 12.3 2.8 12.5 2.9 12.6 3.1 12.8 3.2 12.9 3.3 13 3.5 13.1 3.6 13.1 3.7 13.1 3.8 13.2 3.9 13.2L13.1 15.2 13.1 15.2Z" fill="currentColor"></path></g></svg><span>Tutorials</span></a></li><li class="nav-offers flyout-parent"><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#" class="l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 50 50" version="1.1" fill="#4A3C31"><desc>offers icon</desc><path d="M10.8 43.7L0 39 0 10.2 13.6 4.6 23.3 8.7 11.5 13.5C11 13.6 10.8 13.9 10.8 14.3L10.8 43.7 10.8 43.7Z"></path><polygon points="12.3 44.4 25 50 38 44.3 38 14.7 25.2 9.4 12.3 14.7 12.3 44.4"></polygon><path d="M36.6 4.7L50 10.2 50 39 39.5 43.6 39.5 14.3C39.5 13.8 39.2 13.6 38.8 13.5L27 8.7 36.6 4.7 36.6 4.7Z"></path><polygon points="34.8 4 25 0 15.4 3.9 25.2 7.9 34.8 4"></polygon></svg><span>Offers</span></a><ul class="flyout"><li><a href="https://www.safaribooksonline.com/oreilly-conferences/" class="l2 nav-icn"><span>Conferences</span></a></li><li><a href="https://www.safaribooksonline.com/oreilly-newsletters/" class="l2 nav-icn"><span>Newsletter</span></a></li></ul></li><li class="nav-highlights"><a href="https://www.safaribooksonline.com/u/003o000000t5q9fAAA/" class="t-highlights-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 35" version="1.1" fill="#4A3C31"><desc>highlights icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M13.325 18.071L8.036 18.071C8.036 11.335 12.36 7.146 22.5 5.594L22.5 0C6.37 1.113 0 10.632 0 22.113 0 29.406 3.477 35 10.403 35 15.545 35 19.578 31.485 19.578 26.184 19.578 21.556 17.211 18.891 13.325 18.071L13.325 18.071ZM40.825 18.071L35.565 18.071C35.565 11.335 39.86 7.146 50 5.594L50 0C33.899 1.113 27.5 10.632 27.5 22.113 27.5 29.406 30.977 35 37.932 35 43.045 35 47.078 31.485 47.078 26.184 47.078 21.556 44.74 18.891 40.825 18.071L40.825 18.071Z" fill="currentColor"></path></g></svg><span>Highlights</span></a></li><li><a href="https://www.safaribooksonline.com/u/" class="t-settings-nav l1 js-settings nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z" fill="currentColor"></path></g></svg><span>Settings</span></a></li><li><a href="https://community.safaribooksonline.com/" class="l1 no-icon">Feedback</a></li><li><a href="https://www.safaribooksonline.com/accounts/logout/" class="l1 no-icon">Sign Out</a></li></ul><ul class="profile"><li><a href="https://www.safaribooksonline.com/u/" class="l2 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z" fill="currentColor"></path></g></svg><span>Settings</span></a></li><li><a href="https://community.safaribooksonline.com/" class="l2">Feedback</a></li><li><a href="https://www.safaribooksonline.com/accounts/logout/" class="l2">Sign Out</a></li></ul></div></li></ul></nav></header>


      </div>
      <div id="container" class="application">
        
          <div class="nav-container clearfix">
            


            
            
          </div>

          

  <div class="js-toc">
    
      <div class="sbo-reading-menu sbo-menu-top"><section class="sbo-toc-container toc-menu"><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#" class="sbo-toc-thumb"><span class="sbo-title ss-list"><h1><div class="visuallyhidden">Table of Contents for </div>
      
      Building Applications on Mesos
      
    </h1></span></a><div class="toc-contents"></div></section></div>

    

    <div class="interface-controls interface-controls-top">
      <ul class="interface-control-btns js-bitlist js-reader">
        <li class="js-search-in-archive search-in-archive t-search-in-archive"><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#" title="Search in archive" class="js-search-controls search-controls"><span class="icon">Search in book...</span></a><form class="search-archive-bar js-search-form"><input type="search" name="query" placeholder="Search inside this book..." autocomplete="off"></form><div class="search-archive-results"><div class="js-sitb-results-region"></div></div></li><li class="queue-control"><button type="button" class="rec-fav ss-queue js-queue js-current-chapter-queue" data-queue-endpoint="/api/v1/book/9781491926543/chapter/ch03.html" data-for-analytics="9781491926543:ch03.html"><span>Add to Queue</span></button></li><li class="js-font-control-panel font-control-activator"><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#" data-push-state="false" id="font-controls" title="Change font size" aria-label="Change font size"><span class="icon">Toggle Font Controls</span></a></li><li class="dropdown sharing-controls"><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#" class="trigger" data-push-state="false" title="Share" aria-label="Share"><i class="fa fa-share"></i></a><ul class="social-sharing dropdown-menu"><li><a class="twitter share-button t-twitter" target="_blank" aria-label="Share this section on Twitter" title="Share this section on Twitter" href="https://twitter.com/share?url=https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/ch03.html&amp;text=Building%20Applications%20on%20Mesos&amp;via=safari"><span>Twitter</span></a></li><li><a class="facebook share-button t-facebook" target="_blank" aria-label="Share this section on Facebook" title="Share this section on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/ch03.html"><span>Facebook</span></a></li><li><a class="googleplus share-button t-googleplus" target="_blank" aria-label="Share this secton on Google Plus" title="Share this secton on Google Plus" href="https://plus.google.com/share?url=https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/ch03.html"><span>Google Plus</span></a></li><li><a class="email share-button t-email" aria-label="Share this section via email" title="Share this section via email" href="mailto:?subject=Safari:%203.%20Porting%20an%20Existing%20Application%20to%20Mesos&amp;body=https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/ch03.html%0D%0Afrom%20Building%20Applications%20on%20Mesos%0D%0A"><span>Email</span></a></li></ul></li>
      </ul>
    </div>

    <section role="document">
      
	  <div class="t-sbo-prev sbo-prev sbo-nav-top">
  
    
      
        <a href="/library/view/building-applications-on/9781491926543/ch02.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">2. Getting Started with Mesos</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-top">
  
    
      
        <a href="/library/view/building-applications-on/9781491926543/ch04.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">4. Creating a New Framework for Mesos</div>
        </a>
    
  
  </div>



<div id="sbo-rt-content"><div class="annotator-wrapper"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 3. Porting an Existing Application to Mesos"><div class="chapter" id="marathon_chapter">
<h1><span class="label">Chapter 3. </span>Porting an Existing Application to Mesos</h1>


<p>It’s <a data-type="indexterm" data-primary="Marathon" id="m3"></a><a data-type="indexterm" data-primary="porting existing applications" data-see="Marathon" id="idp7819504"></a><a data-type="indexterm" data-primary="existing application porting" data-see="Marathon" id="idp7820352"></a><a data-type="indexterm" data-primary="legacy applications, porting" data-see="Marathon" id="idp7821200"></a>time to learn how to build an application on top of Mesos.
Rather than building everything from first principles, however, let’s take a look how to utilize existing frameworks to port our legacy applications.
When we think about most applications, they typically fall into two categories: applications that respond to requests and applications that do actions at a particular time.
In the <a href="http://bit.ly/LAMPwiki">LAMP stack</a>, these two components are PHP and cron jobs.</p>

<p>First, we’re going to look at how to move an existing HTTP-based application from your current infrastructure onto Mesos.
In doing so, we’re going to begin to be able to take advantage of Mesos’s scalability and resiliency, ending up with a system that can automatically heal and recover from common failure classes.
Besides improving the resiliency of the application, we’re also going to improve the isolation of the application’s components.
This will help us to achieve a better quality of service without struggling and suffering to build this directly on virtual machines.
We’ll use Marathon, a popular Mesos framework, to host our HTTP-based application.</p>

<p>Then, we’ll look at Chronos as a case study in using Marathon to add high availability and reliability to other frameworks.
Chronos will enable us to run programs at a specified interval—it can be used to schedule nightly data generation jobs or reports every 15 minutes.
We’ll also go over some recommendations for utilizing Chronos effectively and maintainably.</p>

<p>Finally, we’ll briefly touch on some alternatives to Marathon, Singularity and Aurora, which were developed by HubSpot and Twitter, respectively.</p>






<section data-type="sect1" data-pdf-bookmark="Moving a Web Application to Mesos"><div class="sect1" id="idp7825712">
<h1>Moving a Web Application to Mesos</h1>

<p>Nearly every company has a web application.
However, no matter whether it’s written in Ruby on Rails, Scala Play!, or Python’s Flask, deploying it in a reliable, scalable, highly available manner is always a challenge.
In this section, we’re going to learn about using Marathon—an easy-to-use Platform as a Service (PaaS) developed by <a data-type="indexterm" data-primary="Mesosphere" data-seealso="Marathon" id="idp7827200"></a>Mesosphere—and how to integrate with other tools, such as HAProxy.
Through this process, it is our goal to realize a few benefits over previous architectures:</p>
<ol>
<li>
<p>All of our backend processes will be able to run on any machine, and our Mesos framework will handle automatically spinning up new instances of the backend when existing instances fail.</p>
</li>
<li>
<p>We will host our static assets, fast-responding endpoints, dangerous endpoints,<sup><a data-type="noteref" id="idp7830224-marker" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#idp7830224" class="totri-footnote">1</a></sup> and API in entirely different containers to improve our isolation.</p>
</li>
<li>
<p>We will make it easy to deploy a new version or to roll back, and to do so in a matter of seconds.</p>
</li>
<li>
<p>We will put the pieces in place to allow our applications to autoscale based on demand.</p>
</li>

</ol>

<p>At its core, Marathon allows you to specify a command line or Docker image, number of CPUs, amount of memory, and number of instances, and it will start that many instances of that command line or image in containers with the requested amount of CPU and memory.
We will explore this basic configuration as well as a few ways to integrate Marathon with load balancers, in order to expose our services internally and to the outside world.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Setting Up Marathon"><div class="sect1" id="idp7834064">
<h1>Setting Up Marathon</h1>

<p>Obviously, <a data-type="indexterm" data-primary="Marathon" data-secondary="setting up" id="m3su"></a>in order to use Marathon, you’ll need to download it. Marathon comes prepackaged for Ubuntu, Debian, Red Hat, and CentOS on the <a href="https://mesosphere.com/downloads/">Mesosphere website</a>.
Of course, you can also build it yourself, by downloading the latest tarball from Mesosphere’s website, or by cloning it from <a href="https://github.com/mesosphere/marathon">GitHub</a>.
Marathon is written in Scala, so you simply need to run <code>sbt assembly</code> to build it.
From here on out, we’ll assume that you’ve got a copy of Marathon installed.</p>

<p>Marathon is trivial to run as a highly available application.
In fact, all you need to do to run Marathon in a highly available configuration is to ensure that you start two or three instances of Marathon, and that they all share the same <code>--zk</code> <a data-type="indexterm" data-primary="Marathon" data-secondary="command-line options" id="idp7839936"></a>command-line argument.
You should also make other options the same, such as the <code>--master</code>, <code>--framework-name</code>, and the ports that it listens for HTTP requests on, or you could see confusing behavior.
When running Marathon in this mode, all the instances of Marathon will correctly respond to requests, and they’ll magically synchronize their state so that you don’t need to worry about this.
Typically, you’ll finish the setup by assigning the instances of Marathon to a round-robin DNS name, or putting it behind a load balancer.
Please see <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#marathon_cmd_line_opts">Table&nbsp;3-1</a> for further information on selected command-line options.</p>
<table id="marathon_cmd_line_opts">
<caption><span class="label">Table 3-1. </span>Selected Marathon command-line options</caption>
<thead>
<tr>
<th>Flag</th>
<th>Functionality</th>
</tr>
</thead>
<tbody>
<tr>
<td><p><span class="keep-together"><code>--master <em>&lt;instance&gt;</em></code></span></p></td>
<td><p>The URL of the Mesos master. Usually of the form <code>zk:<em>//host1</em>:<em>port</em>,<em>host2</em>:<em>port,host3</em>:<em>port/mesos</em></code>.</p></td>
</tr>
<tr>
<td><p><span class="keep-together"><code>--framework-name <em>&lt;name&gt;</em></code></span></p></td>
<td><p>Allows you to customize the name of this instance of Marathon in Mesos; useful if you have multiple instances of Marathon running to stay organized.</p></td>
</tr>
<tr>
<td><p><span class="keep-together"><code>--zk <em>&lt;instance&gt;</em></code></span></p></td>
<td><p>Sets the instance of ZooKeeper in which Marathon’s state is stored. Usually of the form <code>zk:<em>//host1</em>:<em>port</em>,<em>host2</em>:<em>port</em>,<em>host3</em>:<em>port</em>/marathon</code>.</p></td>
</tr>
<tr>
<td><p><span class="keep-together"><code>--https-port <em>&lt;port&gt;</em></code></span></p></td>
<td><p>Enables HTTPS access to Marathon. See <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#chaos_https">“Securing Marathon and Chronos”</a> for details.</p></td>
</tr>
</tbody>
</table>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="chaos_https">
<h5>Securing Marathon and Chronos</h5>
<p>In <a data-type="indexterm" data-primary="Marathon" data-secondary="securing" id="m3s"></a><a data-type="indexterm" data-primary="Chronos" data-secondary="securing" id="ch3s"></a><a data-type="indexterm" data-primary="securing Marathon and Chronos" id="smc3"></a>this sidebar, we’ll go over how to secure Marathon and Chronos by requiring authentication before making any changes to them, and ensuring all API communications are protected with SSL.
Although many organizations run Marathon and Chronos within their trusted networks, others will need to apply access restrictions to ensure that only authorized users can view or make changes to the running jobs.
Note that this will not secure the connection between Marathon or Chronos and Mesos;
to do that, you’ll need to configure <code>--mesos_authentication_principal</code> and <code>--mesos_authentication_secret_file</code> for the Mesos authentication scheme you’ve chosen.
This is useful to guard against someone accidentally deleting or changing a production-critical service, or a rogue employee acting maliciously.</p>

<p>All of these security settings can be configured either with environment variables or with command-line options.
You should use the environment variables, because the command-line options will enable anyone logged into the machine running Marathon or Chronos to see the passwords by running <code>ps -f</code>.
The environment variables can be protected by having the script that starts the application <code>export</code> all the sensitive environment variables before launching.
The launcher script can have the permissions set to be unreadable to most users on the machine, which is how you’ll secure those passwords.</p>

<p>Chronos and Marathon are built on top of the same HTTP/REST services library, which is named <a data-type="indexterm" data-primary="Chaos" id="idp7869440"></a>Chaos. Chaos currently only supports HTTP Basic <a data-type="indexterm" data-primary="HTTP Basic Authentication  (HBA)" id="idp7870176"></a>authentication, also known as <a data-type="indexterm" data-primary="username/password authentication" id="idp7870912"></a>username/password authentication.
To set the <code>username:password</code> pair, you should format them as such (separated by a colon).
You can pass them as a command-line argument via:</p>
<pre data-type="programlisting">--http_credentials <em>username</em>:<em>password</em>
</pre>

<p>or as an environment variable via:</p>
<pre data-type="programlisting">MESOSPHERE_HTTP_CREDENTIALS=<em>username</em>:<em>password</em>
</pre>

<p>HTTP authentication is not terribly useful on its own, however, because anyone could listen to the connection between the client and server to recover the password.
To prevent this, you can enable SSL as well.
Because Chaos is a Java application, it needs to use the Java certificate file format, known as a <a href="http://en.wikipedia.org/wiki/Keystore">keystore</a>.
The <a data-type="indexterm" data-primary="keystore (Java)" id="idp7877184"></a><a data-type="indexterm" data-primary="Java keystore" id="idp7877920"></a>keystore is a password-protected container for the SSL certificate.
To configure this, you specify the path to the keystore on the command line via:</p>
<pre data-type="programlisting">--ssl_keystore_path <em>/path/to/keystore</em>
</pre>

<p>or as an environment variable via:</p>
<pre data-type="programlisting">MESOSPHERE_KEYSTORE_PATH=<em>/path/to/keystore</em>
</pre>

<p>You’ll also need to provide the password. You can do this on the command line via:</p>

<pre data-type="programlisting">--ssl_keystore_password password</pre>

<p>or as an environment variable via:</p>
<pre data-type="programlisting">MESOSPHERE_KEYSTORE_PASS=<em>password</em>
</pre>

<p>At this point, you are probably thinking, “Why does Java have to do everything differently? Why can’t it just be compatible with normal certificates?”
Luckily, it’s easy to convert a standard PEM-format PKCS12 certificate (such as the type most Certificate Authorities issue) into a keystore.
To do this, you’ll need your key (<em>mykey.pem</em>) and certificate (<em>mycert.pem</em>).
First, you’ll make a combined file (<em>mykeycert.pem</em>) by running:</p>

<pre data-type="programlisting">cat mykey.pem mycert.pem &gt; mykeycert.pem</pre>

<p>Then, you’ll use <code>openssl</code> to create the keystore (<em>mykeystore.pkcs12</em>) containing this certificate.
Strangely, keystores require all certificates that they store to have “aliases.”
Our certificate will be called <code>myalias</code>.
Without further ado, here’s the command:</p>

<pre data-type="programlisting">openssl pkcs12 -export -in mykeycert.pem -out mykeystore.pkcs12 \
    -name myalias -noiter -nomaciter</pre>

<p>And voilà! You can now use any standard issue certificate to secure Marathon and Chronos.</p>

<p>Make sure to disable the HTTP access once you’ve done this though, or you’ll have put a lock on the front door but left the back door wide open!
This can be done with the command-line argument <code>--disable_http</code> to Marathon and <a data-type="indexterm" data-primary="Marathon" data-secondary="securing" data-startref="m3s" id="idp7891408"></a><a data-type="indexterm" data-primary="Chronos" data-secondary="securing" data-startref="ch3s" id="idp7892688"></a><a data-type="indexterm" data-primary="securing Marathon and Chronos" data-startref="smc3" id="idp7893904"></a>Chronos.</p>
</div></aside>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Using Marathon"><div class="sect1" id="idp7861312">
<h1>Using Marathon</h1>

<p>Marathon <a data-type="indexterm" data-primary="Marathon" data-secondary="setting up" data-startref="m3su" id="idp7896640"></a><a data-type="indexterm" data-primary="Marathon" data-secondary="using" id="m3u"></a>is controlled entirely through its HTTP API. With a working instance of Marathon, let’s try launching an application.</p>

<p>We’ll run a simple application: the famous <a data-type="indexterm" data-primary="Python  SimpleHTTPServer" id="idp7899776"></a><a data-type="indexterm" data-primary="SimpleHTTPServer" id="idp7900448"></a>Python <code>SimpleHTTPServer</code>.
This application simply serves the files in the directory in which it was started.
We’re going to base our example on it because nearly everyone’s got Python installed, and it’s available by default.</p>

<p>If you run this command:</p>

<pre data-type="programlisting">python -m SimpleHTTPServer 8000</pre>

<p>on your computer, then you should be able to navigate to <code>localhost:8000</code> in your browser and see a directory listing of the folder in which you started the server.</p>

<p>Let’s see how we can run that on a Marathon server running on <code>marathon.example.com:8080</code>.
We’ll first make a file containing the JSON descriptor of the Marathon application shown in <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#basic_marathon_json_descriptor">Example&nbsp;3-1</a>.</p>
<div id="basic_marathon_json_descriptor" data-type="example">
<h5><span class="label">Example 3-1. </span>SimpleHTTPServer JSON descriptor</h5>

<pre data-type="programlisting" data-code-language="json"><code class="p">{</code><code>
    </code><code class="nt">"cmd"</code><code class="p">:</code><code> </code><code class="s2">"python -m SimpleHTTPServer 31500"</code><code class="p">,</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO1-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO1-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a><code>
    </code><code class="nt">"cpus"</code><code class="p">:</code><code> </code><code class="mf">0.5</code><code class="p">,</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO1-2" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO1-2"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a><code>
    </code><code class="nt">"mem"</code><code class="p">:</code><code> </code><code class="mi">50</code><code class="p">,</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO1-3" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO1-3"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a><code>
    </code><code class="nt">"instances"</code><code class="p">:</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO1-4" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO1-4"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/4.png" alt="4" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/4.png"></a><code>
    </code><code class="nt">"id"</code><code class="p">:</code><code> </code><code class="s2">"my-first-app"</code><code class="p">,</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO1-5" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO1-5"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/5.png" alt="5" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/5.png"></a><code>
    </code><code class="nt">"ports"</code><code class="p">:</code><code> </code><code class="p">[</code><code class="mi">31500</code><code class="p">]</code><code class="p">,</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO1-6" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO1-6"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/6.png" alt="6" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/6.png"></a><code>
    </code><code class="nt">"requirePorts"</code><code class="p">:</code><code> </code><code class="kc">true</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO1-7" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO1-7"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/7.png" alt="7" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/7.png"></a><code>
</code><code class="p">}</code></pre></div>
<dl class="calloutlist">
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO1-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO1-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a></dt>
<dd><p>The <code>"cmd"</code> <a data-type="indexterm" data-primary="cmd" id="idp7955088"></a>specifies the command line that will launch your application.</p></dd>
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO1-2" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO1-2"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a></dt>
<dd><p><code>"cpus"</code> <a data-type="indexterm" data-primary="resources" data-secondary="cpus" id="idp7958592"></a>specifies the number of CPUs that your application’s container should have. This number can be fractional.</p></dd>
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO1-3" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO1-3"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a></dt>
<dd><p><code>"mem"</code> <a data-type="indexterm" data-primary="resources" data-secondary="mem (memory)" id="idp8003408"></a>specifies the number of MB of memory that your application’s container should have.</p></dd>
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO1-4" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO1-4"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/4.png" alt="4" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/4.png"></a></dt>
<dd><p><code>"instances"</code> <a data-type="indexterm" data-primary="instances" id="idp8006864"></a>specifies how many copies of this application should be started on the cluster. For this demo, we’ll only make one instance, but typical applications will have anywhere from 2 to 2,000 instances.</p></dd>
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO1-5" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO1-5"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/5.png" alt="5" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/5.png"></a></dt>
<dd><p><code>"id"</code> <a data-type="indexterm" data-primary="id" id="idp8010288"></a>is how we’ll refer to this application in the future via the APIs. This should be unique for each application.</p></dd>
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO1-6" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO1-6"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/6.png" alt="6" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/6.png"></a></dt>
<dd><p><code>"ports"</code> <a data-type="indexterm" data-primary="resources" data-secondary="ports" id="idp8013632"></a>is an array of the ports that the application requires. In this case, we only need a single port. Later, we’ll see how to dynamically allocate and bind to ports.</p></dd>
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO1-7" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO1-7"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/7.png" alt="7" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/7.png"></a></dt>
<dd><p>Since we’re explicitly specifying which ports we want to allocate, we must tell Marathon, or else it will default to automatic port assignment.</p></dd>
</dl>

<p>Now let’s suppose that data has been stored in a file called <em>my-first-app.json</em>.
In order to start this application, we’ll use an HTTP <code>POST</code> to send the data to a Marathon server running at <code>marathon.example.com:8080</code>:</p>

<pre data-type="programlisting">curl -X POST -H 'Content-Type: application/json' \
    marathon.example.com:8080/v2/apps --data @my-first-app.json</pre>

<p>This should give us a response that looks something like:</p>

<pre data-type="programlisting" data-code-language="json"><code class="p">{</code>
   <code class="err">//</code> <code class="err">This</code> <code class="err">section</code> <code class="err">contains</code> <code class="err">parameters</code> <code class="err">we</code> <code class="err">specified</code>
   <code class="nt">"id"</code> <code class="p">:</code> <code class="s2">"/my-first-app"</code><code class="p">,</code>
   <code class="nt">"instances"</code> <code class="p">:</code> <code class="mi">1</code><code class="p">,</code>
   <code class="nt">"cmd"</code> <code class="p">:</code> <code class="s2">"python -m SimpleHTTPServer 31500"</code><code class="p">,</code>
   <code class="nt">"ports"</code> <code class="p">:</code> <code class="p">[</code> <code class="mi">31500</code> <code class="p">],</code>
   <code class="nt">"requirePorts"</code><code class="p">:</code> <code class="kc">true</code><code class="p">,</code>
   <code class="nt">"mem"</code> <code class="p">:</code> <code class="mi">50</code><code class="p">,</code>
   <code class="nt">"cpus"</code> <code class="p">:</code> <code class="mf">0.5</code><code class="p">,</code>

   <code class="err">//</code> <code class="err">This</code> <code class="err">section</code> <code class="err">contains</code> <code class="err">parameters</code> <code class="err">with</code> <code class="err">their</code> <code class="err">automatically</code> <code class="err">assigned</code> <code class="err">values</code>
   <code class="nt">"backoffFactor"</code> <code class="p">:</code> <code class="mf">1.15</code><code class="p">,</code>
   <code class="nt">"maxLaunchDelaySeconds"</code> <code class="p">:</code> <code class="mi">3600</code><code class="p">,</code>
   <code class="nt">"upgradeStrategy"</code> <code class="p">:</code> <code class="p">{</code>
      <code class="nt">"minimumHealthCapacity"</code> <code class="p">:</code> <code class="mi">1</code><code class="p">,</code>
      <code class="nt">"maximumOverCapacity"</code> <code class="p">:</code> <code class="mi">1</code>
   <code class="p">},</code>
   <code class="nt">"version"</code> <code class="p">:</code> <code class="s2">"2015-06-04T18:26:18.834Z"</code><code class="p">,</code>
   <code class="nt">"deployments"</code> <code class="p">:</code> <code class="p">[</code>
      <code class="p">{</code>
         <code class="nt">"id"</code> <code class="p">:</code> <code class="s2">"54e5fdf8-8a81-4f95-805f-b9ecc9293095"</code>
      <code class="p">}</code>
   <code class="p">],</code>
   <code class="nt">"backoffSeconds"</code> <code class="p">:</code> <code class="mi">1</code><code class="p">,</code>
   <code class="nt">"disk"</code> <code class="p">:</code> <code class="mi">0</code><code class="p">,</code>
   <code class="nt">"tasksRunning"</code> <code class="p">:</code> <code class="mi">0</code><code class="p">,</code>
   <code class="nt">"tasksHealthy"</code> <code class="p">:</code> <code class="mi">0</code><code class="p">,</code>
   <code class="nt">"tasks"</code> <code class="p">:</code> <code class="p">[],</code>
   <code class="nt">"tasksStaged"</code> <code class="p">:</code> <code class="mi">0</code><code class="p">,</code>

   <code class="err">//</code> <code class="err">This</code> <code class="err">section</code> <code class="err">contains</code> <code class="err">unspecified</code> <code class="err">parameters</code>
   <code class="nt">"executor"</code> <code class="p">:</code> <code class="s2">""</code><code class="p">,</code>
   <code class="nt">"storeUrls"</code> <code class="p">:</code> <code class="p">[],</code>
   <code class="nt">"dependencies"</code> <code class="p">:</code> <code class="p">[],</code>
   <code class="nt">"args"</code> <code class="p">:</code> <code class="kc">null</code><code class="p">,</code>
   <code class="nt">"healthChecks"</code> <code class="p">:</code> <code class="p">[],</code>
   <code class="nt">"uris"</code> <code class="p">:</code> <code class="p">[],</code>
   <code class="nt">"env"</code> <code class="p">:</code> <code class="p">{},</code>
   <code class="nt">"tasksUnhealthy"</code> <code class="p">:</code> <code class="mi">0</code><code class="p">,</code>
   <code class="nt">"user"</code> <code class="p">:</code> <code class="kc">null</code><code class="p">,</code>
   <code class="nt">"requirePorts"</code> <code class="p">:</code> <code class="kc">true</code><code class="p">,</code>
   <code class="nt">"container"</code> <code class="p">:</code> <code class="kc">null</code><code class="p">,</code>
   <code class="nt">"constraints"</code> <code class="p">:</code> <code class="p">[],</code>
   <code class="nt">"labels"</code> <code class="p">:</code> <code class="p">{},</code>
<code class="p">}</code></pre>

<p>which indicates that the application was started correctly.</p>

<p>We can find all the information about the running application by querying for information about <code>my-first-app</code> (what we decided to name this application):</p>

<pre data-type="programlisting">curl marathon.example.com:8080/v2/apps/my-first-app | python -m json.tool</pre>

<p>This query returns almost the exact same data as we got when we created the application.
The difference is that by now our application has had time to start running, so we can see information about the running tasks:</p>

<pre data-type="programlisting" data-code-language="json"><code class="err">/</code><code class="err">/</code><code> </code><code class="err">.</code><code class="err">.</code><code class="err">.</code><code> </code><code class="err">s</code><code class="err">n</code><code class="err">i</code><code class="err">p</code><code> </code><code class="err">(</code><code class="err">s</code><code class="err">a</code><code class="err">m</code><code class="err">e</code><code> </code><code class="err">a</code><code class="err">s</code><code> </code><code class="err">b</code><code class="err">e</code><code class="err">f</code><code class="err">o</code><code class="err">r</code><code class="err">e</code><code class="err">)</code><code> </code><code class="err">.</code><code class="err">.</code><code class="err">.</code><code>
    </code><code class="s2">"tasks"</code><code class="err">:</code><code> </code><code class="p">[</code><code>
        </code><code class="p">{</code><code>
            </code><code class="nt">"appId"</code><code class="p">:</code><code> </code><code class="s2">"/my-first-app"</code><code class="p">,</code><code>
            </code><code class="nt">"host"</code><code class="p">:</code><code> </code><code class="s2">"10.141.141.10"</code><code class="p">,</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO2-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO2-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a><code>
            </code><code class="nt">"id"</code><code class="p">:</code><code> </code><code class="s2">"my-first-app.7345b7b5-0ae7-11e5-b3a7-56847afe9799"</code><code class="p">,</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO2-2" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO2-2"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a><code>
            </code><code class="nt">"ports"</code><code class="p">:</code><code> </code><code class="p">[</code><code> </code><code class="mi">31500</code><code> </code><code class="p">]</code><code class="p">,</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO2-3" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO2-3"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a><code>
            </code><code class="nt">"stagedAt"</code><code class="p">:</code><code> </code><code class="s2">"2015-06-04T18:28:09.235Z"</code><code class="p">,</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO2-4" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO2-4"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/4.png" alt="4" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/4.png"></a><code>
            </code><code class="nt">"startedAt"</code><code class="p">:</code><code> </code><code class="s2">"2015-06-04T18:28:09.404Z"</code><code class="p">,</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO2-5" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO2-5"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/5.png" alt="5" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/5.png"></a><code>
            </code><code class="nt">"version"</code><code class="p">:</code><code> </code><code class="s2">"2015-06-04T18:28:05.214Z"</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO2-6" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO2-6"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/6.png" alt="6" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/6.png"></a><code>
        </code><code class="p">}</code><code>
    </code><code class="p">]</code><code class="err">,</code><code>
    </code><code class="s2">"tasksHealthy"</code><code> </code><code class="err">:</code><code> </code><code class="mi">1</code><code class="err">,</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO2-7" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO2-7"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/7.png" alt="7" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/7.png"></a><code>
</code><code class="err">/</code><code class="err">/</code><code> </code><code class="err">.</code><code class="err">.</code><code class="err">.</code><code> </code><code class="err">s</code><code class="err">n</code><code class="err">i</code><code class="err">p</code><code> </code><code class="err">(</code><code class="err">s</code><code class="err">a</code><code class="err">m</code><code class="err">e</code><code> </code><code class="err">a</code><code class="err">s</code><code> </code><code class="err">b</code><code class="err">e</code><code class="err">f</code><code class="err">o</code><code class="err">r</code><code class="err">e</code><code class="err">)</code><code> </code><code class="err">.</code><code class="err">.</code><code class="err">.</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO2-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO2-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a></dt>
<dd><p>This tells us the DNS name or IP address of the host that is running the task.</p></dd>
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO2-2" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO2-2"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a></dt>
<dd><p>The <code>id</code> of the task is a Mesos construct. We can use the Mesos master’s UI to inspect this task; for instance, we can examine its <code>stdout</code> and <code>stderr</code>.</p></dd>
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO2-3" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO2-3"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a></dt>
<dd><p>Whether we chose the port that the application is running on or allowed Marathon to choose for us (see <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#marathon_json_desc_with_dynamic_port">Example&nbsp;3-2</a> for details), we can find the actually reserved ports for the task.</p></dd>
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO2-4" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO2-4"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/4.png" alt="4" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/4.png"></a></dt>
<dd><p>The staging time of the task is when we submitted the task to a Mesos offer.</p></dd>
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO2-5" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO2-5"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/5.png" alt="5" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/5.png"></a></dt>
<dd><p>The start time of the task is when Mesos actually got around to launching the task.</p></dd>
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO2-6" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO2-6"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/6.png" alt="6" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/6.png"></a></dt>
<dd><p>Every time we update the Marathon descriptor, it gets stamped with a new version (see the response to the initial <code>POST</code> given earlier). Every task is annotated with the version from which it was launched.</p></dd>
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO2-7" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO2-7"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/7.png" alt="7" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/7.png"></a></dt>
<dd><p>This gives a summary of the number of currently healthy tasks in the application.</p></dd>
</dl>

<p>Let’s look at some of the rich information available about the application.
First, we can see all of the configuration parameters that we specified when we created the application.
We also see tons and tons of other settings, many of which we’ll go over soon.
The next very interesting field is <code>"tasks"</code>, <a data-type="indexterm" data-primary="tasks" id="idp8342032"></a>which is an array of all of the actual running instances of the application.
Each task is represented as a JSON object, which has several useful fields:</p>

<ul>
<li>
<p><code>"host"</code> and <code>"ports"</code> tell <a data-type="indexterm" data-primary="host" id="idp8344832"></a><a data-type="indexterm" data-primary="resources" data-secondary="ports" id="idp8345568"></a>us what the actual host and ports that were assigned to this task are. These fields are the key to discovering where an application is actually running so that we can connect to it.</p>
</li>
<li>
<p><code>"id"</code> is the mesos <code>TaskID</code>. <a data-type="indexterm" data-primary="id" id="idp8348400"></a>This is constructed by adding a unique per-task UUID to the application’s ID, which allows for convenient discovery with the Mesos CLI tools or in the Mesos UI.</p>
</li>
<li>
<p><code>"stagedAt"</code> and <code>"startedAt"</code> <a data-type="indexterm" data-primary="stagedAt" id="idp8351232"></a><a data-type="indexterm" data-primary="startedAt" id="idp8351968"></a>give us information about when lifecycle events happened to this task. A task is <em>staged</em> once Marathon actually requests Mesos to start the task on a particular offer; a task is <em>started</em> once it begins running.</p>
</li>
</ul>
<div data-type="tip"><h1>Upcoming Change in Marathon REST API</h1>
<p>The REST API <a data-type="indexterm" data-primary="Marathon" data-secondary="REST API changes" id="idp8355296"></a>examples in this book are valid as of Marathon 0.9.
In the future, Marathon will filter the results so requests don’t need to return megabytes of JSON data.
When this happens, you’ll need to specify an additional, repeatable URL parameter: <code>embed</code>.
<span class="keep-together">That is, instead</span> of <code>/v2/apps/my-first-app</code>, you need to <span class="keep-together">request</span> <code>/v2/apps/my-first-app?embed=app.counts&amp;embed=app</code> <code>.tasks</code> to retrieve the data for the preceding examples.
You can read about all of the options for <code>embed</code> in the Marathon <a href="https://mesosphere.github.io/marathon/docs/rest-api.html">REST API documentation</a>.</p>
</div>

<p>Usually, you won’t want to hardcode the port for your application: after all, if you did this, then you’d only ever be able to run one instance of the application per slave.
Marathon can specify the <a data-type="indexterm" data-primary="Marathon" data-secondary="specifying ports" id="idp8467280"></a>port for you, instead: simply choose each port your application requires as <code>0</code>, and the assigned ports will be available in the environment variables <code>$PORT0</code>, <code>$PORT1</code>, etc.
If we changed our earlier configuration to take advantage of this, we’d end up with <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#marathon_json_desc_with_dynamic_port">Example&nbsp;3-2</a>.</p>
<div id="marathon_json_desc_with_dynamic_port" data-type="example">
<h5><span class="label">Example 3-2. </span>SimpleHTTPServer JSON descriptor with dynamically chosen port</h5>

<pre data-type="programlisting" data-code-language="json"><code class="p">{</code><code>
    </code><code class="nt">"cmd"</code><code class="p">:</code><code> </code><code class="s2">"./python -m SimpleHTTPServer $PORT0"</code><code class="p">,</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO3-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO3-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a><code>
    </code><code class="nt">"cpus"</code><code class="p">:</code><code> </code><code class="mf">0.5</code><code class="p">,</code><code>
    </code><code class="nt">"mem"</code><code class="p">:</code><code> </code><code class="mi">50</code><code class="p">,</code><code>
    </code><code class="nt">"instances"</code><code class="p">:</code><code> </code><code class="mi">1</code><code class="p">,</code><code>
    </code><code class="nt">"id"</code><code class="p">:</code><code> </code><code class="s2">"my-first-app"</code><code class="p">,</code><code>
    </code><code class="nt">"ports"</code><code class="p">:</code><code> </code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="p">,</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO3-2" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO3-2"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a><code>
    </code><code class="nt">"uris"</code><code class="p">:</code><code> </code><code class="p">[</code><code>
        </code><code class="s2">"http://fetchable/uri/with/python.tar.gz"</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO3-3" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO3-3"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a><code>
    </code><code class="p">]</code><code>
</code><code class="p">}</code></pre></div>
<dl class="calloutlist">
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO3-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO3-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a></dt>
<dd><p>Note that we use <code>$PORT0</code> to access the environment variable that contains the port assigned to the first index of the <code>"ports"</code> array.</p></dd>
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO3-2" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO3-2"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a></dt>
<dd><p>We provided <code>0</code> as the desired port, meaning that we’re allowing Marathon to choose for us.</p></dd>
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO3-3" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO3-3"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a></dt>
<dd><p>We can also provide a list of URIs to be fetched and unzipped into the container before running the command. See <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch04.html#configuring_process_environment">“Configuring the process’s environment”</a> for details on the URI schemes supported.</p></dd>
</dl>

<p>Some applications you’d like to run on Marathon don’t accept their ports via the command line.
Don’t worry!
There’s an easy way for us to propagate our <code>$PORT0</code> environment variables into configuration files. I’ll assume that the application’s configuration file is set as a URL to be downloaded with the application.
Now, we’re going to use <code>sed</code> to <a data-type="indexterm" data-primary="sed command" id="idp8556656"></a>replace a special string in the configuration file with the desired environment variable, be it a <code>$PORT0</code> or the <code>$MESOS_DIRECTORY</code>:</p>

<pre data-type="programlisting" data-code-language="bash"><code>sed</code><code> </code><code>-e</code><code> </code><code class="s1">'s#@MESOSDIR@#'</code><code class="s2">"</code><code class="nv">$MESOS_DIRECTORY</code><code class="s2">"</code><code class="s1">'#'</code><code> </code><code>config.templ</code><code> </code><code>&gt;</code><code> </code><code>config</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO4-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO4-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a><code>
</code><code>sed</code><code> </code><code>-e</code><code> </code><code class="s1">'s#@PORT@#'</code><code class="s2">"</code><code class="nv">$PORT0</code><code class="s2">"</code><code class="s1">'#'</code><code> </code><code>config2.templ</code><code> </code><code>&gt;</code><code> </code><code>config2</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO4-2" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO4-2"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO4-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO4-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a></dt>
<dd><p>In our first example, we are replacing the string <code>@MESOSDIR@</code> with the task’s sandbox directory. We surround the string in the configuration file with <code>@</code> symbols, because they so rarely show up in configuration languages (of course, you could use any unique string). Also, we use single quotes around the “constants” in our <code>sed</code> command and double quotes around the environment variable to ensure that our shell doesn’t corrupt our command. Finally, we use <code>#</code> instead of / for the <code>sed</code> command so that we can successfully template an environment variable that itself contains forward slashes.</p></dd>
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO4-2" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO4-2"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a></dt>
<dd><p>Here, we template the port at index 0 into the configuration file. In fact, we could pass multiple <code>-e</code> arguments to a single invocation of <code>sed</code> if we wanted to template several variables in one configuration file.</p></dd>
</dl>

<p>We’ll look at other fields as we cover the features that utilize them.</p>








<section data-type="sect2" data-pdf-bookmark="Scaling Your Application"><div class="sect2" id="idp8635984">
<h2>Scaling Your Application</h2>

<p>Let’s <a data-type="indexterm" data-primary="Marathon" data-secondary="scaling" id="idp8637360"></a><a data-type="indexterm" data-primary="scaling" id="idp8638208"></a>see what it would take to scale our HTTP server to have five instances. Ready?</p>

<pre data-type="programlisting">curl -X PUT -H 'Content-Type: application/json' \
    marathon.example.com:8080/v2/apps --data '{"instances": 5}'</pre>

<p>Of course, no one would ever actually want to have five instances of such a useless application, so why don’t we scale it down?</p>

<pre data-type="programlisting">curl -X PUT -H 'Content-Type: application/json' \
    marathon.example.com:8080/v2/apps --data '{"instances": 1}'</pre>

<p>Luckily, scaling is extremely easy!</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Using Placement Constraints"><div class="sect2" id="marathon_using_placement_constraints">
<h2>Using Placement Constraints</h2>

<p>Marathon <a data-type="indexterm" data-primary="Marathon" data-secondary="placement constraints" id="m3upc"></a><a data-type="indexterm" data-primary="placement constraints" id="pc3"></a><a data-type="indexterm" data-primary="constraints, placement" id="cp3"></a>supports constraints on where the application is launched.
These constraints can be driven either by the hostname of the slave or any slave attribute.
Constraints are provided in an array to the application; each constraint is itself an array of two or three elements, depending on whether there’s an argument.
Let’s take a look at what constraints are available and how to use them:</p>
<dl>
<dt><code>GROUP_BY</code></dt>
<dd>
<p>This <a data-type="indexterm" data-primary="Marathon" data-secondary="placement operators" data-tertiary="GROUP_BY" id="idp8648368"></a>operator ensures that instances of the application are evenly spread across nodes with a particular attribute.
You can use this to spread the application equitably across hosts (<a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#marathon_placement_even_hosts">Example&nbsp;3-3</a>) or racks (assuming that the rack is encoded by the <code>rack</code> attribute on the slave; see <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#marathon_placement_even_racks">Example&nbsp;3-4</a>).</p>
<div id="marathon_placement_even_hosts" data-type="example">
<h5><span class="label">Example 3-3. </span>Spread evenly by host</h5>

<pre data-type="programlisting" data-code-language="json"><code class="p">{</code>
    <code class="err">//</code> <code class="err">...</code> <code class="err">snip</code> <code class="err">...</code>
    <code class="nt">"constraints"</code><code class="p">:</code> <code class="p">[[</code><code class="s2">"hostname"</code><code class="p">,</code> <code class="s2">"GROUP_BY"</code><code class="p">]]</code>
<code class="p">}</code></pre></div>
<div id="marathon_placement_even_racks" data-type="example">
<h5><span class="label">Example 3-4. </span>Spread evenly by rack</h5>

<pre data-type="programlisting" data-code-language="json"><code class="p">{</code>
    <code class="err">//</code> <code class="err">...</code> <code class="err">snip</code> <code class="err">...</code>
    <code class="nt">"constraints"</code><code class="p">:</code> <code class="p">[[</code><code class="s2">"rack"</code><code class="p">,</code> <code class="s2">"GROUP_BY"</code><code class="p">]]</code>
<code class="p">}</code></pre></div>
</dd>
<dt><code>UNIQUE</code></dt>
<dd>
<p>This <a data-type="indexterm" data-primary="Marathon" data-secondary="placement operators" data-tertiary="UNIQUE" id="idp8683952"></a>operator ensures that every instance of the application has a different value for the <code>UNIQUE</code> constraint.
It’s similar to <code>GROUP_BY</code>, except if there are not enough different values for the attribute, the application will fail to fully deploy, rather than running multiple instances on some slaves.
Usually, <code>GROUP_BY</code> is the best choice for availability, since it’s generally preferable to have multiple tasks running on a single slave rather than fewer than the desired number.
<a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#marathon_placement_unique">Example&nbsp;3-5</a> shows how you could use <code>UNIQUE</code> to ensure that there’s no more than one instance of some application per slave in the cluster.</p>
<div id="marathon_placement_unique" data-type="example">
<h5><span class="label">Example 3-5. </span>Run at most one instance per host</h5>

<pre data-type="programlisting" data-code-language="json"><code class="p">{</code>
    <code class="err">//</code> <code class="err">...</code> <code class="err">snip</code> <code class="err">...</code>
    <code class="nt">"constraints"</code><code class="p">:</code> <code class="p">[[</code><code class="s2">"hostname"</code><code class="p">,</code> <code class="s2">"UNIQUE"</code><code class="p">]]</code>
<code class="p">}</code></pre></div>
</dd>
<dt><code>CLUSTER</code></dt>
<dd>
<p>This <a data-type="indexterm" data-primary="Marathon" data-secondary="placement operators" data-tertiary="CLUSTER" id="idp8796864"></a>operator allows you to run an application only on slaves with a specific value for an attribute.
If certain slaves have special hardware configurations, or if you want to restrict placement to a specific rack, this operator can be useful; however, <code>LIKE</code> is more powerful and often a better fit.
For example, suppose that we’ve got a mixture of ARM and x86 processors in our data center, and we’ve made a <code>cpu_arch</code> attribute for our slaves to help us distinguish their architectures.
<a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#marathon_placement_x86">Example&nbsp;3-6</a> shows how to ensure that our application only runs on x86 processors.</p>
<div id="marathon_placement_x86" data-type="example">
<h5><span class="label">Example 3-6. </span>Only run on x86</h5>

<pre data-type="programlisting" data-code-language="json"><code class="p">{</code><code>
    </code><code class="err">/</code><code class="err">/</code><code> </code><code class="err">.</code><code class="err">.</code><code class="err">.</code><code> </code><code class="err">s</code><code class="err">n</code><code class="err">i</code><code class="err">p</code><code> </code><code class="err">.</code><code class="err">.</code><code class="err">.</code><code>
    </code><code class="nt">"constraints"</code><code class="p">:</code><code> </code><code class="p">[</code><code class="p">[</code><code class="s2">"cpu_arch"</code><code class="p">,</code><code> </code><code class="s2">"CLUSTER"</code><code class="p">,</code><code> </code><code class="s2">"x86"</code><code class="p">]</code><code class="p">]</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO5-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO5-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a><code>
</code><code class="p">}</code></pre></div>
<dl class="calloutlist">
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO5-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO5-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a></dt>
<dd><p>Note that the <code>CLUSTER</code> operator takes an argument.</p></dd>
</dl>
</dd>
<dt><code>LIKE</code></dt>
<dd>
<p>This <a data-type="indexterm" data-primary="Marathon" data-secondary="placement operators" data-tertiary="LIKE" id="idp8695920"></a>operator ensures that the application runs only on slaves that have a certain attribute, and where the value of that attribute matches the provided regular expression.
This can be used like <code>CLUSTER</code>, but it has more flexibility, since many values can be matched.
For example, suppose that we’re running on Amazon, and we set the <code>instance_type</code> attribute on all of our slaves.
<a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#marathon_placement_like">Example&nbsp;3-7</a> shows how we could restrict our application to run only on the biggest C4 compute-optimized machines.</p>
<div id="marathon_placement_like" data-type="example">
<h5><span class="label">Example 3-7. </span>Only run on c4.4xlarge and c4.8xlarge machines</h5>

<pre data-type="programlisting" data-code-language="json"><code class="p">{</code><code>
    </code><code class="err">/</code><code class="err">/</code><code> </code><code class="err">.</code><code class="err">.</code><code class="err">.</code><code> </code><code class="err">s</code><code class="err">n</code><code class="err">i</code><code class="err">p</code><code> </code><code class="err">.</code><code class="err">.</code><code class="err">.</code><code>
    </code><code class="nt">"constraints"</code><code class="p">:</code><code> </code><code class="p">[</code><code class="p">[</code><code class="s2">"cpu_arch"</code><code class="p">,</code><code> </code><code class="s2">"LIKE"</code><code class="p">,</code><code> </code><code class="s2">"c4.[48]xlarge"</code><code class="p">]</code><code class="p">]</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO6-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO6-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a><code>
</code><code class="p">}</code></pre></div>
<dl class="calloutlist">
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO6-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO6-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a></dt>
<dd><p><code>LIKE</code>’s argument is a regular expression.</p></dd>
</dl>
</dd>
<dt><code>UNLIKE</code></dt>
<dd>
<p><code>UNLIKE</code> <a data-type="indexterm" data-primary="Marathon" data-secondary="placement operators" data-tertiary="UNLIKE" id="idp8881024"></a>is the complement of <code>LIKE</code>: it allows us to avoid running on certain slaves.
Maybe you don’t want some daemons (such as ones processing user billing information) to run on machines that are in the DMZ, which is an unsecured network area.
By setting the attribute <code>dmz</code> to <code>true</code> on machines in the DMZ, we can have our application avoid those machines, as in <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#marathon_placement_unlike">Example&nbsp;3-8</a>.</p>
<div id="marathon_placement_unlike" data-type="example">
<h5><span class="label">Example 3-8. </span>Don’t run in the DMZ</h5>

<pre data-type="programlisting" data-code-language="json"><code class="p">{</code><code>
    </code><code class="err">/</code><code class="err">/</code><code> </code><code class="err">.</code><code class="err">.</code><code class="err">.</code><code> </code><code class="err">s</code><code class="err">n</code><code class="err">i</code><code class="err">p</code><code> </code><code class="err">.</code><code class="err">.</code><code class="err">.</code><code>
    </code><code class="nt">"constraints"</code><code class="p">:</code><code> </code><code class="p">[</code><code class="p">[</code><code class="s2">"dmz"</code><code class="p">,</code><code> </code><code class="s2">"UNLIKE"</code><code class="p">,</code><code> </code><code class="s2">"true"</code><code class="p">]</code><code class="p">]</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO7-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO7-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a><code>
</code><code class="p">}</code></pre></div>
<dl class="calloutlist">
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO7-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO7-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a></dt>
<dd><p><code>UNLIKE</code>’s argument can be a regular expression.</p></dd>
</dl>
</dd>
</dl>

<p>Placement constraints can also be combined.
For example, we could ensure that our application isn’t running in the DMZ and is evenly distributed amongst the remaining machines as shown in <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#combining_constraints">Example&nbsp;3-9</a>.</p>
<div id="combining_constraints" data-type="example">
<h5><span class="label">Example 3-9. </span>Combining constraints</h5>

<pre data-type="programlisting" data-code-language="json"><code class="p">{</code>
    <code class="err">//</code> <code class="err">...</code> <code class="err">snip</code> <code class="err">...</code>
    <code class="nt">"constraints"</code><code class="p">:</code> <code class="p">[[</code><code class="s2">"dmz"</code><code class="p">,</code> <code class="s2">"UNLIKE"</code><code class="p">,</code> <code class="s2">"true"</code><code class="p">],</code>
                    <code class="p">[</code><code class="s2">"hostname"</code><code class="p">,</code> <code class="s2">"GROUP_BY"</code><code class="p">]]</code>
<code class="p">}</code></pre></div>

<p>Combining constraints will allow you to precisely control how your applications are placed across the <a data-type="indexterm" data-primary="Marathon" data-secondary="placement constraints" data-startref="m3upc" id="idp8988976"></a><a data-type="indexterm" data-primary="placement constraints" data-startref="pc3" id="idp8990064"></a><a data-type="indexterm" data-primary="constraints, placement" data-startref="cp3" id="idp8990976"></a>cluster.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Running Dockerized Applications"><div class="sect2" id="idp8992176">
<h2>Running Dockerized Applications</h2>

<p>Marathon <a data-type="indexterm" data-primary="Marathon" data-secondary="running Dockerized applications" id="m3urda"></a><a data-type="indexterm" data-primary="Docker" data-secondary="Marathon and" id="dawm3"></a>has first-class support for Docker containers.
If your app is already Dockerized, then it’s very easy to run it on Marathon.</p>

<p>In order to get started, you’ll first need to make sure that your Mesos cluster has Docker support enabled.
To do this, make sure that you’ve enabled the Docker containerizer and increased the executor timeout (see <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch06.html#docker_support">“Using Docker”</a> for details).</p>

<p>At this point, we can simply add the Docker configuration to the JSON that we use to configure our application.
Let’s take a look at the options we have when using Docker, as illustrated in <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#marathon_docker_json_cfg">Example&nbsp;3-10</a>.
Note that this JSON configuration is partial; it must also include additional options such as those in <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#basic_marathon_json_descriptor">Example&nbsp;3-1</a>.</p>
<div id="marathon_docker_json_cfg" data-type="example">
<h5><span class="label">Example 3-10. </span>Marathon Docker JSON configuration</h5>

<pre data-type="programlisting" data-code-language="json"><code class="p">{</code><code>
    </code><code class="err">/</code><code class="err">/</code><code> </code><code class="err">.</code><code class="err">.</code><code class="err">.</code><code> </code><code class="err">s</code><code class="err">n</code><code class="err">i</code><code class="err">p</code><code> </code><code class="err">.</code><code class="err">.</code><code class="err">.</code><code>
    </code><code class="nt">"container"</code><code class="p">:</code><code> </code><code class="p">{</code><code>
        </code><code class="nt">"type"</code><code class="p">:</code><code> </code><code class="s2">"DOCKER"</code><code class="p">,</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO8-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO8-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a><code>
        </code><code class="nt">"docker"</code><code class="p">:</code><code> </code><code class="p">{</code><code>
            </code><code class="nt">"image"</code><code class="p">:</code><code> </code><code class="s2">"group/image"</code><code class="p">,</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO8-2" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO8-2"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a><code>
            </code><code class="nt">"network"</code><code class="p">:</code><code> </code><code class="s2">"HOST"</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO8-3" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO8-3"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a><code>
        </code><code class="p">}</code><code>
    </code><code class="p">}</code><code>
</code><code class="p">}</code></pre></div>
<dl class="calloutlist">
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO8-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO8-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a></dt>
<dd><p>Since Mesos will continue to add new container types, such as Rocket or KVM containers, much of the container configuration isn’t Docker-specific. Here, we must specify that we’ll provide Docker-specific configuration, because this is a <code>DOCKER</code> container.</p></dd>
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO8-2" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO8-2"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a></dt>
<dd><p>This is the most important part: where you specify your container image.<sup><a data-type="noteref" id="idp9056944-marker" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#idp9056944" class="totri-footnote">2</a></sup></p></dd>
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO8-3" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO8-3"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a></dt>
<dd><p>We’re going to run Docker in host networking mode; this means that Docker is using the slave’s networking resources directly.</p></dd>
</dl>

<p>Once the Docker container launches, it’ll also have access to the Mesos sandbox directory, which will be available in the environment variable <code>$MESOS_SANDBOX</code>.</p>










<section data-type="sect3" data-pdf-bookmark="Mounting host volumes"><div class="sect3" id="mounting_host_volumes">
<h3>Mounting host volumes</h3>

<p>Often, <a data-type="indexterm" data-primary="Docker" data-secondary="mounting host volumes" id="d3mhv"></a><a data-type="indexterm" data-primary="host volumes, mounting" id="hvm3"></a>when using Docker, you may want to mount some volume available on the host.
This may be some globally distributed configuration files, data files, or maybe you’d just like a data directory that won’t be automatically garbage collected.
<a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#marathon_docker_host_volume">Example&nbsp;3-11</a> shows how to add this to the JSON configuration.</p>
<div id="marathon_docker_host_volume" data-type="example">
<h5><span class="label">Example 3-11. </span>Mounting host volumes</h5>

<pre data-type="programlisting" data-code-language="json"><code class="p">{</code><code>
    </code><code class="nt">"container"</code><code class="p">:</code><code> </code><code class="p">{</code><code>
        </code><code class="nt">"type"</code><code class="p">:</code><code> </code><code class="s2">"DOCKER"</code><code class="p">,</code><code>
        </code><code class="nt">"docker"</code><code class="p">:</code><code> </code><code class="p">{</code><code>
            </code><code class="nt">"image"</code><code class="p">:</code><code> </code><code class="s2">"group/image"</code><code class="p">,</code><code>
            </code><code class="nt">"network"</code><code class="p">:</code><code> </code><code class="s2">"HOST"</code><code>
        </code><code class="p">}</code><code class="p">,</code><code>
        </code><code class="nt">"volumes"</code><code class="p">:</code><code> </code><code class="p">[</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO9-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO9-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a><code>
            </code><code class="p">{</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO9-2" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO9-2"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a><code>
                </code><code class="nt">"containerPath"</code><code class="p">:</code><code> </code><code class="s2">"/var/hostlib"</code><code class="p">,</code><code>
                </code><code class="nt">"hostPath"</code><code class="p">:</code><code> </code><code class="s2">"/usr/lib"</code><code class="p">,</code><code>
                </code><code class="nt">"mode"</code><code class="p">:</code><code> </code><code class="s2">"RO"</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO9-3" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO9-3"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a><code>
            </code><code class="p">}</code><code class="p">,</code><code>
            </code><code class="p">{</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO9-4" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO9-4"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/4.png" alt="4" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/4.png"></a><code>
                </code><code class="nt">"containerPath"</code><code class="p">:</code><code> </code><code class="s2">"/var/scratch"</code><code class="p">,</code><code>
                </code><code class="nt">"hostPath"</code><code class="p">:</code><code> </code><code class="s2">"/mount/ssd"</code><code class="p">,</code><code>
                </code><code class="nt">"mode"</code><code class="p">:</code><code> </code><code class="s2">"RW"</code><code>
            </code><code class="p">}</code><code>
        </code><code class="p">]</code><code>
    </code><code class="p">}</code><code>
</code><code class="p">}</code></pre></div>
<dl class="calloutlist">
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO9-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO9-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a></dt>
<dd><p>Note that the <code>"volumes"</code> aren’t considered Docker-specific, and you can specify an array of them.</p></dd>
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO9-2" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO9-2"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a></dt>
<dd><p>This volume allows us to access the <em>/usr/lib</em> directory of the host machine from within our Docker container. This could be useful if we’d like to access <em>libmesos.so</em> from the host, rather than needing to keep updating our Docker image.</p></dd>
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO9-3" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO9-3"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a></dt>
<dd><p>We can mount the volume in read-only (<code>RO</code>) or read-write (<code>RW</code>) mode.</p></dd>
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO9-4" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO9-4"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/4.png" alt="4" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/4.png"></a></dt>
<dd><p>This volume gives us some SSD-mounted scratch space, assuming that an SSD is mounted at <em>/mount/ssd</em> on the host.</p></dd>
</dl>

<p>Mounting host volumes into the Docker container might seem like a great way to host databases on Marathon; after all, you can provide persistent host storage to containers.
Unfortunately, even though you can mount volumes with Docker, there are a few reasons why this is very hard (at least, until Mesos natively supports volumes).
First of all, it’s tedious to communicate which machines have disks available.
In order to accomplish this, you’ll need to use placement constraints to ensure all of the following:</p>
<ol>
<li>
<p>Each slave with a spare volume has a special attribute identifying it as having that volume, so that you can use the <code>CLUSTER</code> <a data-type="indexterm" data-primary="Marathon" data-secondary="placement operators" data-tertiary="CLUSTER" id="idp9253616"></a>operator to ensure placement on those slaves.</p>
</li>
<li>
<p>The application has the <code>UNIQUE</code> operator <a data-type="indexterm" data-primary="Marathon" data-secondary="placement operators" data-tertiary="UNIQUE" id="idp9255984"></a>set on the hostname, so that only one instance of the application launches on each slave (since there’s only one special mount point per machine).</p>
</li>
<li>
<p>Every one of the slaves has its host volume mounted on the same path (luckily, this is the easiest part).</p>
</li>

</ol>

<p>If you feel up to the task, this can help you to get certain types of databases running on Marathon. Sadly, you won’t have scaling or automatic recovery handled for you, since there’s so much special configuration necessary on each slave.
Happily, as Mesos adds support for persistent disks, more and more specialized frameworks that handle launching and configuring databases will pop up, and this mess will no longer <a data-type="indexterm" data-primary="Marathon" data-secondary="running Dockerized applications" data-startref="m3urda" id="idp9259328"></a><a data-type="indexterm" data-primary="Docker" data-secondary="Marathon and" data-startref="dawm3" id="idp9260416"></a><a data-type="indexterm" data-primary="Docker" data-secondary="mounting host volumes" data-startref="d3mhv" id="idp9261504"></a><a data-type="indexterm" data-primary="host volumes, mounting" data-startref="hvm3" id="idp9262592"></a>be needed.</p>
</div></section>



</div></section>













<section data-type="sect2" data-pdf-bookmark="Health Checks"><div class="sect2" id="health_checks">
<h2>Health Checks</h2>

<p>Marathon <a data-type="indexterm" data-primary="Marathon" data-secondary="health checks" id="m3uhc"></a><a data-type="indexterm" data-primary="health checks" id="hc3"></a>keeps track of whether it believes an application is healthy or not.
This information is exported via the REST API, making it easy to use Marathon to centralize management of its application health checks.
When you query the REST API for information about a particular application, all of its tasks will include their latest health check results.
By default, Marathon assumes that a task is healthy if it is in the <code>RUNNING</code> state.
Of course, just because an application has started executing doesn’t mean that it’s actually healthy.
To improve the usefulness of the application’s health data, you can specify three additional types of health checks that the tasks should undergo: command-based, HTTP, and TCP.</p>

<p><a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#marathon_health_check">Example&nbsp;3-12</a> shows the common fields of the <a data-type="indexterm" data-primary="JSON" id="idp9269488"></a>JSON health check specification.</p>
<div id="marathon_health_check" data-type="example">
<h5><span class="label">Example 3-12. </span>Common health check fields</h5>

<pre data-type="programlisting" data-code-language="json"><code class="p">{</code><code>
    </code><code class="nt">"gracePeriodSeconds"</code><code class="p">:</code><code> </code><code class="mi">300</code><code class="p">,</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO10-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO10-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a><code>
    </code><code class="nt">"intervalSeconds"</code><code class="p">:</code><code> </code><code class="mi">60</code><code class="p">,</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO10-2" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO10-2"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a><code>
    </code><code class="nt">"maxConsecutiveFailures"</code><code class="p">:</code><code> </code><code class="mi">3</code><code class="p">,</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO10-3" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO10-3"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a><code>
    </code><code class="nt">"timeoutSeconds"</code><code class="p">:</code><code> </code><code class="mi">30</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO10-4" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO10-4"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/4.png" alt="4" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/4.png"></a><code>
</code><code class="p">}</code></pre></div>
<dl class="calloutlist">
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO10-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO10-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a></dt>
<dd><p>The grace period is the amount of time that a task is given to start itself up. Health checks will not begin to run against a particular task until this many seconds have elapsed. This parameter is optional, with a default value of a 5-minute grace period.</p></dd>
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO10-2" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO10-2"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a></dt>
<dd><p>The interval is the amount of time between runs of this health check. This parameter is optional, with a default value of 1 minute between each check.</p></dd>
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO10-3" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO10-3"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a></dt>
<dd><p>The maximum number of consecutive failures determines how many failed health checks in a row should cause Marathon to forcibly kill the task, so that it can be restarted elsewhere. If this is set to <code>0</code>, then this health check failing will never result in the task getting killed. This parameter is optional, with tasks by default being killed after three failures of this health check.</p></dd>
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO10-4" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO10-4"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/4.png" alt="4" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/4.png"></a></dt>
<dd><p>Sometimes, a health check just hangs. Rather than simply ignoring the check, Marathon will treat the slow or hung health check as a failure if it doesn’t complete in this many seconds. This parameter is optional, and by default health checks have 20 seconds to run.</p></dd>
</dl>

<p>We’ll look at the two of the three types of health checks here: HTTP and TCP.
Command health checks are still relatively new, and due to some of their limitations, I recommend waiting a bit longer for them to stabilize.
Bear in mind, though, that HTTP and TCP health checks here are currently performed by the Marathon master, which means that they’re not scalable to thousands of tasks.<sup><a data-type="noteref" id="idp9340864-marker" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#idp9340864" class="totri-footnote">3</a></sup></p>










<section data-type="sect3" data-pdf-bookmark="HTTP checks"><div class="sect3" id="idp9342656">
<h3>HTTP checks</h3>

<p>HTTP <a data-type="indexterm" data-primary="HTTP health checks" id="idp9344032"></a>health checks validate if doing a <code>GET</code> on a particular route results in a successful HTTP status code.
Successful status codes can either be true successes, or redirects; thus, the response code must be in the range 200–399, inclusive.
To configure an HTTP health check, there are two required fields and one optional field, as shown in <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#marathon_hc_http">Example&nbsp;3-13</a>.</p>
<div id="marathon_hc_http" data-type="example">
<h5><span class="label">Example 3-13. </span>HTTP health check fields</h5>

<pre data-type="programlisting" data-code-language="json"><code class="p">{</code><code>
    </code><code class="nt">"protocol"</code><code class="p">:</code><code> </code><code class="s2">"HTTP"</code><code class="p">,</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO11-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO11-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a><code>
    </code><code class="nt">"path"</code><code class="p">:</code><code> </code><code class="s2">"/healthcheck"</code><code class="p">,</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO11-2" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO11-2"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a><code>
    </code><code class="nt">"portIndex"</code><code class="p">:</code><code> </code><code class="mi">0</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO11-3" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO11-3"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a><code>
</code><code class="p">}</code></pre></div>
<dl class="calloutlist">
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO11-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO11-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a></dt>
<dd><p>You must specify that this is an HTTP health check in the <code>"protocol"</code> field.</p></dd>
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO11-2" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO11-2"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a></dt>
<dd><p>You must specify what the route for the health check should be. In this case, we’re going to attempt a <code>GET</code> on <code>http://myserver.example.com:8888/healthcheck</code>, where <code>myserver.example.com:8888</code> is the host and port that Marathon started the task on.</p></dd>
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO11-3" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO11-3"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a></dt>
<dd><p>You can optionally specify a <code>"portIndex"</code> for the health check. By default, the port index is <code>0</code>.</p></dd>
</dl>
<div data-type="note" epub:type="note" id="marathon_port_index_healthcheck"><h1>Why Do Health Checks Use “portIndex” Instead of “port”?</h1>
<p>You might be confused as to what the <code>"portIndex"</code> is in the health check specification, and why we don’t simply specify the actual port.
Remember that Marathon can (and by best practices does) choose the ports that your application will bind to.
As a result, we don’t actually know when we’re configuring the health check what port the application is running on.
Instead, however, remember that all the ports our application used were specified in the <code>"ports"</code> array of the application descriptor.
Therefore, we can simply specify which index of the <code>"ports"</code> array corresponds to the port that we want to run the health check on!</p>
</div>
</div></section>













<section data-type="sect3" data-pdf-bookmark="TCP checks"><div class="sect3" id="idp9409952">
<h3>TCP checks</h3>

<p>TCP <a data-type="indexterm" data-primary="TCP health checks" id="idp9411280"></a>health checks validate whether it’s possible to successfully open a TCP connection to the task.
They do not send or receive any data—they simply attempt to open the socket.
To configure a TCP health check, there is one required and one optional field, shown in <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#marathon_hc_tcp">Example&nbsp;3-14</a>.</p>
<div id="marathon_hc_tcp" data-type="example">
<h5><span class="label">Example 3-14. </span>TCP health check fields</h5>

<pre data-type="programlisting" data-code-language="json"><code class="p">{</code><code>
    </code><code class="nt">"protocol"</code><code class="p">:</code><code> </code><code class="s2">"TCP"</code><code class="p">,</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO12-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO12-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a><code>
    </code><code class="nt">"portIndex"</code><code class="p">:</code><code> </code><code class="mi">0</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO12-2" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO12-2"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a><code>
</code><code class="p">}</code></pre></div>
<dl class="calloutlist">
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO12-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO12-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a></dt>
<dd><p>You must specify that this is a TCP health check in the <code>"protocol"</code> field.</p></dd>
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO12-2" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO12-2"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a></dt>
<dd><p>You can optionally specify a <code>"portIndex"</code> for the health check. By default, the port index is <code>0</code>.</p></dd>
</dl>
</div></section>



</div></section>













<section data-type="sect2" data-pdf-bookmark="Application Versioning and Rolling Upgrades"><div class="sect2" id="idp9446544">
<h2>Application Versioning and Rolling Upgrades</h2>

<p>What <a data-type="indexterm" data-primary="Marathon" data-secondary="health checks" data-startref="m3uhc" id="idp9462816"></a><a data-type="indexterm" data-primary="health checks" data-startref="hc3" id="idp9463936"></a><a data-type="indexterm" data-primary="Marathon" data-secondary="application versioning and rolling upgrades" id="m3uavaru"></a><a data-type="indexterm" data-primary="rolling upgrades" id="ru3"></a><a data-type="indexterm" data-primary="versioning" id="v3"></a><a data-type="indexterm" data-primary="upgrades" id="ug3"></a>use would a distributed, scalable PaaS have if it couldn’t do rolling upgrades?
An <em>upgrade</em> is any time that you modify the application, which is typically done by making a <code>PUT</code> to the <code>/v2/apps/$appid</code> route on Marathon.
Every upgrade creates a new version, which is named with the timestamp of when the upgrade was made.
When you query the REST API for information about the application, every task will say which version it is running.
You can query which versions are available from the <code>/v2/apps/$appid/versions</code> route on Marathon, and you can find details of the versions from the <code>/v2/apps/$appid/versions/$version</code> route.
<a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#marathon_app_upgrade">Example&nbsp;3-15</a> demonstrates how to configure the upgrade behavior of an application.</p>
<div id="marathon_app_upgrade" data-type="example">
<h5><span class="label">Example 3-15. </span>Application upgrades</h5>

<pre data-type="programlisting" data-code-language="json"><code class="p">{</code>
    <code class="nt">"upgradeStrategy"</code><code class="p">:</code> <code class="p">{</code>
        <code class="nt">"minimumHealthCapacity"</code><code class="p">:</code> <code class="mf">0.5</code><code class="p">,</code>
        <code class="nt">"maximumOverCapacity"</code><code class="p">:</code> <code class="mf">0.1</code>
    <code class="p">}</code>
<code class="p">}</code></pre></div>

<p>With Marathon, you can easily specify how much of the application you want to be available during an upgrade via the <code>"minimumHealthCapacity"</code> field of the application descriptor.
The <code>"minimumHealthCapacity"</code> can be set to any value between <code>0</code> and <code>1</code>.</p>

<p>If you set this to <code>0</code>, when you deploy a new version Marathon will first kill all the old tasks, then start up new ones.</p>

<p>If you set this to <code>0.6</code>, when you deploy a new version Marathon will first kill 40% of the old tasks, then start up 60% of the new tasks, then kill the rest of the old tasks and start the rest of the new tasks.</p>

<p>If you set this to <code>1</code>, when you deploy a new version Marathon will first start up all the new tasks (at which point your application could use twice as many resources as during regular operations), and then shut down the old tasks.</p>

<p>The <code>"maximumOverCapacity"</code> setting provides an additional level of safety, so that an application doesn’t consume too many resources temporarily during an upgrade.
The <code>"maximumOverCapacity"</code> can be set to any value between <code>0</code> and <code>1</code>.</p>

<p>If you set this to <code>0</code>, when you deploy a new version Marathon will not start more tasks than the target number of instances.</p>

<p>If you set this to <code>0.6</code>, when you deploy a new version Marathon will never exceed a combined total of 160% of the target number of tasks.</p>

<p>If you set this to <code>1</code>, when you deploy a new version Marathon will be allowed to start every new task before it kills any of the old tasks, if it so <a data-type="indexterm" data-primary="Marathon" data-secondary="application versioning and rolling upgrades" data-startref="m3uavaru" id="idp9501200"></a><a data-type="indexterm" data-primary="rolling upgrades" data-startref="ru3" id="idp9502544"></a><a data-type="indexterm" data-primary="versioning" data-startref="v3" id="idp9503488"></a><a data-type="indexterm" data-primary="upgrades" data-startref="ug3" id="idp9504432"></a>chooses.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="The Event Bus"><div class="sect2" id="marathon_event_bus">
<h2>The Event Bus</h2>

<p>Often, <a data-type="indexterm" data-primary="event bus" id="idp9507072"></a><a data-type="indexterm" data-primary="Marathon" data-secondary="event bus" id="idp9507808"></a>when building applications with Marathon, you’ll want to receive notifications when various events happen, such as when an application gets a new deployment, or when it scales up or down.
These notifications could then be used to reconfigure proxies and routers, log statistics, and generate reports.
Marathon has a built-in feature for automatically <code>POST</code>ing all of its internal events to a provided URI.
To use this feature, simply provide two additional command-line arguments to Marathon:</p>
<dl>
<dt><code>--event_subscriber</code></dt>
<dd>
<p>This argument should be passed the value <code>http_callback</code> in order to enable this subsystem.
At this time, no other options are supported.</p>
</dd>
<dt><code>--http_endpoints</code></dt>
<dd>
<p>This argument is a comma-separated list of destination URIs to send the JSON-formatted events to. For example, a valid argument would be <code>http://host1/foo,http://host2/bar</code>.</p>
</dd>
</dl>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Setting Up HAProxy with Marathon"><div class="sect2" id="setting_up_marathon_haproxy">
<h2>Setting Up HAProxy with Marathon</h2>

<p>What <a data-type="indexterm" data-primary="Marathon" data-secondary="HAProxy setup" id="m3uhaps"></a><a data-type="indexterm" data-primary="HAProxy" id="hap3"></a><a data-type="indexterm" data-primary="proxies" data-secondary="HAProxy" id="p3hap"></a>a great day!
We’ve learned all about Marathon and decided that it would make an excellent platform for our applications.
Now that our applications are running on Marathon, however, we’ve reached an impasse: how can the outside world actually connect to them?
Some types of applications, such as Celery or Resque workers, need no additional configuration: they communicate via a shared database.
Other types of applications, such as HTTP servers and Redis instances, need to be made easily discoverable.
The most popular way to do this on Mesos clusters is to run proxies on static, non-Mesos managed hosts, and automatically update those proxies to point at running instances of the application.
This way, the application is always available on a known host and port (i.e., the proxy), but we can still dynamically scale its capacity on the backend.
Also, each proxy host can typically serve many applications, each on a different port, so that a small number of proxy hosts are sufficient for hundreds of backends.
Typically, proxies are constrained either by the total bandwidth used by all active connections, or by the total CPU usage if they’re providing SSL termination.<sup><a data-type="noteref" id="idp9521072-marker" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#idp9521072" class="totri-footnote">4</a></sup></p>

<p>There are two proxies that are far and away the most popular choices for use in modern application stacks: HAProxy and Nginx.
HAProxy is a proxy with very few features: it can proxy HTTP and TCP connections, perform basic health checks, and terminate SSL.
It is built for stability and performance: there have been no reported crashes or deadlock bugs in HAProxy for 13 years.
This is why HAProxy is popular amongst Mesos users today.</p>

<p>Nginx, <a data-type="indexterm" data-primary="proxies" data-secondary="Nginx" id="idp9523136"></a><a data-type="indexterm" data-primary="Nginx" id="idp9524144"></a>by comparison, has no limits on its features.
Besides acting as a proxy, it is able to run custom user code written in Lua, JavaScript, or JVM-based languages.
This code can affect the proxy operations, or even serve responses directly.
Many systems actually use both proxies: clients connect to HAProxy instances, which themselves forward the requests to Nginx instances.
The Nginx instances then either respond directly, or proxy the requests to backend servers to be processed.</p>

<p>In this section, we’re only going to discuss HAProxy, but be aware that Nginx can be used in exactly the same way, if you require the additional functionality it offers.</p>
<div data-type="warning" epub:type="warning"><h1>haproxy-marathon-bridge</h1>
<p>In the Marathon <a data-type="indexterm" data-primary="haproxy-marathon-bridge script" id="idp9527312"></a>repository, there’s a script called <em>bin/haproxy-marathon-bridge</em>.
This script is intended to help generate an HA<span class="keep-together">Proxy</span> configuration file for Marathon.
Unfortunately, it doesn’t allow you to specify which port the services on Marathon will be bound to on the HAProxy host.
As a result, this script is best avoided.</p>
</div>

<p>Let’s take a look at the most popular configurations for setting up proxies with Mesos.</p>










<section data-type="sect3" data-pdf-bookmark="Bamboo"><div class="sect3" id="bamboo">
<h3>Bamboo</h3>

<p><a href="https://github.com/QubitProducts/bamboo">Bamboo</a> is an <a data-type="indexterm" data-primary="HAProxy" data-secondary="Bamboo, setting up with" id="hap3msuw"></a><a data-type="indexterm" data-primary="Bamboo" id="b3"></a>HAProxy configuration daemon with a web interface.
It provides a UI for viewing and managing the current state of HAProxy rules.
At its core, Bamboo monitors Marathon for changes to applications, and keeps its HAProxy instance’s backends up-to-date.
Bamboo also provides several useful features, all of which are exposed via the web interface and an HTTP REST API.</p>

<p>Most importantly, Bamboo supports using HAProxy <a data-type="indexterm" data-primary="ACL rules" id="idp9535664"></a><a data-type="indexterm" data-primary="HAProxy" data-secondary="ACL rules" id="idp9536368"></a>ACL rules for each Marathon application.
An ACL rule is a fine-grained way to choose which server backend should handle a request.
ACL rules can route requests based on their URL, cookies, headers, and many other factors.
For instance, you can use ACL rules to route requests whose paths start with <code>/static</code> to the static content-serving backends, but all other requests to your application servers.
ACL rules are extremely powerful, since they allow you to separate your application into isolated components or services, scale those components separately, but still expose a single URL to clients.
With ACL rules, you could choose to route anonymous visitors to one pool of servers, logged-in users to another pool of servers, and requests for static data to a third pool of servers, thus enabling you to scale each of their capacities separately.</p>

<p>Bamboo also has a powerful templating system, based on the Go language’s <a href="http://golang.org/pkg/text/template/"><code>text/template</code> package</a>.
This templating system is flexible, but does have a steep learning curve compared to simpler, more popular systems like <a href="https://mustache.github.io/">mustache templates</a>.</p>

<p>All proxy configuration information is stored in <a data-type="indexterm" data-primary="ZooKeeper" id="idp9541408"></a>ZooKeeper, which simplifies configuration management by keeping all instances of Bamboo in sync.</p>

<p>Bamboo uses the <a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#marathon_event_bus">Marathon event bus</a> to discover changes in backend configurations, which means that your HAProxy configurations typically lag changes in Marathon by mere hundreds of milliseconds.</p>

<p>Additionally, Bamboo has basic integration with <a href="https://github.com/etsy/statsd">StatsD</a> to report on when reconfiguration events occurred.</p>

<p>Bamboo provides a complete solution for sophisticated HAProxy configurations for Marathon <a data-type="indexterm" data-primary="Bamboo" data-startref="b3" id="idp9545408"></a><a data-type="indexterm" data-primary="HAProxy" data-secondary="Bamboo, setting up with" data-startref="hap3msuw" id="idp9546384"></a>applications.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="HAProxy for microservices"><div class="sect3" id="idp9547856">
<h3>HAProxy for microservices</h3>

<p>Nowadays, <a data-type="indexterm" data-primary="HAProxy" data-secondary="for microservices" id="hap3fm"></a><a data-type="indexterm" data-primary="microservices" id="ms3"></a>microservices are a popular architectural pattern.
Mesos and Marathon form a great substrate for building microservices-based applications: after all, you can host all your services on Marathon.
Unfortunately, service discovery is typically a substantial problem for microservice deployments.
Let’s look at how we can use Mesos and Marathon to create a <a href="http://nerds.airbnb.com/smartstack-service-discovery-cloud/">SmartStack</a>-like system.</p>

<p>We need to consider two issues: how can we do <a data-type="indexterm" data-primary="service discovery" id="sd3"></a>service discovery, and what are the problems with the standard options? These options include:</p>
<dl>
<dt>DNS</dt>
<dd>
<p>We <a data-type="indexterm" data-primary="DNS discovery" id="idp9556256"></a>could choose to use round-robin DNS to give all our backend servers the same DNS name.
There are two problems we’ll face, however: DNS changes typically take at least several seconds to propagate through our infrastructure, and some applications cache DNS resolutions forever (meaning they’ll never see DNS changes).
The other problem is that, unless you write a custom client library that can use <code>SRV</code> records, DNS doesn’t provided a simple solution to running multiple applications on the same server but with different or randomly assigned ports.</p>
</dd>
<dt>Centralized load balancing</dt>
<dd>
<p>This <a data-type="indexterm" data-primary="centralized load balancing" id="idp9559360"></a>is akin to what we discussed in <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#bamboo">“Bamboo”</a>.
For some applications, this is actually a great design; however, it does require a globally accessible pool of load balancers.
This centralization can make it tedious to securely isolate applications from one another: in order to isolate the applications, you must configure the Nginx or HAProxy rules for the specific isolation requirements.<sup><a data-type="noteref" id="idp9561408-marker" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#idp9561408" class="totri-footnote">5</a></sup></p>
</dd>
<dt>In-app discovery</dt>
<dd>
<p>Companies <a data-type="indexterm" data-primary="in-app discovery" id="idp9563488"></a>like <a data-type="indexterm" data-primary="Twitter" id="idp9564352"></a><a data-type="indexterm" data-primary="Google" id="idp9565056"></a><a data-type="indexterm" data-primary="Finagle" id="idp9565728"></a><a data-type="indexterm" data-primary="Stubby" id="idp9566400"></a>Twitter and Google use specialized service request and discovery layers, such as Finagle and Stubby, respectively.
These RPC layers integrate service discovery directly into the application, querying ZooKeeper or Chubby (Google’s internal ZooKeeper-like system) when they need to find a server to which they can send a request.
If this is possible in your environment, using a specialized service discovery layer offers the most flexibility in terms of routing, load balancing, and reliability due to the fact that you can control every aspect of the system.
Unfortunately, if you need to integrate applications written in several languages, it can be onerous and time-consuming to develop parallel implementations of the discovery system for every language.
Furthermore, this approach can be a nonstarter if you need to integrate with existing applications that weren’t developed with this service discovery mechanism built in.</p>
</dd>
</dl>

<p>The shortcomings of these approaches led many engineers to come up with a fourth pattern: one that combines the ease of integration of centralized load balancing with the fault tolerance of the decentralized options.
With this approach, we will run a copy of HAProxy on every single machine in our data center.
Then, we’ll assign each application a port (but not a hostname).
Finally, we’ll keep all of our HAProxy instances pointing each application’s port at its backends, wherever they’re running on the cluster.</p>

<p>This approach has two main benefits:</p>
<dl>
<dt>Ease of setup</dt>
<dd>
<p>You can use <a data-type="indexterm" data-primary="Bamboo" id="idp9571120"></a>Bamboo or a simple cron job on every machine in your cluster to keep the local instances of HAProxy in sync with Marathon.
Even if some part of your infrastructure is temporarily unavailable, the local HAProxy will continue to route traffic directly to the backends.
This means that even a disruption of Marthon won’t impact the application’s operations.</p>
</dd>
<dt>Ease of use</dt>
<dd>
<p>Every application can communicate with any other microservice simply by connecting to <code>localhost:$PORT</code>, where <code>$PORT</code> is what you assigned to that microservice.
There’s no need to write any specialized or custom code for your applications, as all you need to do is remember which port corresponds to which application.</p>
</dd>
</dl>

<p>There are also a few downsides to this approach.
One is that you need to carefully maintain the mapping from service to port.
If you try to store that mapping globally and have applications fetch it on startup, you’ll have to write custom code for every language again.
On the other hand, if you hardcode the ports themselves, you run the risk of typos, which can be very difficult to debug.</p>

<p>The other downside is the lack of coordination between proxies. Our system continues to function even when partial failures happen, because each machine operates independently.
Due to the independent operation of each machine, it’s possible for several HAProxies to all route to the same backend, thus spiking the load on that backend, which can result in cascading failures.
It is normal to see the variance of request times increase as the number of nodes in a cluster increases.</p>

<p>Today, this approach of tying services to ports and having every client connect to HAProxy at <code>localhost</code> seems to be the most popular way to manage service discovery on Mesos <a data-type="indexterm" data-primary="proxies" data-secondary="HAProxy" data-startref="p3hap" id="idp9577984"></a><a data-type="indexterm" data-primary="Marathon" data-secondary="HAProxy setup" data-startref="m3uhaps" id="idp9579232"></a><a data-type="indexterm" data-primary="HAProxy" data-startref="hap3" id="idp9580448"></a><a data-type="indexterm" data-primary="Marathon" data-secondary="using" data-startref="m3u" id="idp9581392"></a><a data-type="indexterm" data-primary="HAProxy" data-secondary="for microservices" data-startref="hap3fm" id="idp9582608"></a><a data-type="indexterm" data-primary="microservices" data-startref="ms3" id="idp9583824"></a><a data-type="indexterm" data-primary="service discovery" data-startref="sd3" id="idp9604064"></a>clusters.</p>
</div></section>



</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Running Mesos Frameworks on Marathon"><div class="sect1" id="idp9514832">
<h1>Running Mesos Frameworks on Marathon</h1>

<p>A <a data-type="indexterm" data-primary="Marathon" data-secondary="running Mesos frameworks on" data-seealso="Chronos" id="m3rmfo"></a><a data-type="indexterm" data-primary="Chronos" id="ch3"></a>very common choice in Mesos clusters is to run the cluster’s Mesos frameworks on Marathon.
But Marathon is a Mesos framework itself!
So what does it mean to run a Mesos framework on Marathon?
Rather than worrying about deploying each framework’s scheduler to specific hosts and dealing with those hosts’ failures, Marathon will ensure that the framework’s scheduler is always running somewhere on the cluster.
This greatly simplifies deploying new frameworks in a highly reliable configuration.</p>
<div data-type="note" epub:type="note"><h1>What About Resource Allocation for Frameworks Run by Marathon?</h1>
<p>New Mesos users often wonder, “If I run a framework on Marathon, how does that affect the allocation of resources?”
In fact, although the framework’s scheduler is run by Marathon, the scheduler still must connect directly to Mesos, and <em>it will receive resources in an identical way as if you ran it on specifically chosen machines</em>.
The benefit of running it on Marathon, of course, is that any Mesos slave can run the scheduler, and Marathon can restart it automatically if that slave fails.</p>
</div>








<section data-type="sect2" data-pdf-bookmark="What Is Chronos?"><div class="sect2" id="idp9611088">
<h2>What Is Chronos?</h2>

<p>Chronos is a Mesos framework that provides a highly available, distributed time-based job scheduler, like cron.
With Chronos, you can launch jobs that are either command-line programs (optionally downloaded from URIs) or Docker containers.
Like Marathon, Chronos has a web UI and an easily programmable REST API.
Although the Chronos endpoints have a slightly different interface than Marathon’s, we won’t go over their details, as the online <a href="https://mesos.github.io/chronos/">documentation</a> is sufficient.
Chronos has four key features for <a data-type="indexterm" data-primary="Chronos" data-secondary="key features for scheduling" id="ch3kffs"></a>scheduling jobs:</p>
<dl>
<dt>Interval scheduling</dt>
<dd>
<p>Chronos <a data-type="indexterm" data-primary="Chronos" data-secondary="interval scheduling" id="idp9616736"></a><a data-type="indexterm" data-primary="interval scheduling" id="idp9617744"></a>uses the standard ISO 8601 notation to specify repeating intervals.
Through the web UI or REST API, you can specify the frequency at which you want the job to rerun.
This makes Chronos suitable for running quick jobs every few minutes, or a nightly data generation job.</p>
</dd>
<dt>Dependency tracking</dt>
<dd>
<p>In theory, <a data-type="indexterm" data-primary="Chronos" data-secondary="dependency tracking" id="idp9620112"></a><a data-type="indexterm" data-primary="dependency tracking" id="idp9621120"></a>Chronos supports dependent jobs.
Dependent jobs run only if their prerequisites ran successfully.
Unfortunately, Chronos’s implementation of dependent jobs misses the mark.
In Chronos, a job’s dependencies are considered satisfied if the last invocation of that job was successful.
A dependent job is run as soon as all of its dependencies have been run at least once.
This means that unless every parent has the exact same interval, the dependent jobs can run at potentially unexpected times.
In <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#chronos_ops">“Chronos Operational Concerns”</a>, we’ll look at a popular mitigation strategy for this.</p>
</dd>
<dt>Deferred start</dt>
<dd>
<p>Chronos <a data-type="indexterm" data-primary="Chronos" data-secondary="deferred start" id="idp9624592"></a><a data-type="indexterm" data-primary="deferred start" id="idp9625600"></a>can also be used to run a job once or on a repeating interval at a point in the future.
When you specify the ISO 8601 interval on which to repeat the job, you also specify when you’d like the first run of the job to start.
This means that you can use Chronos to schedule jobs to run days, weeks, or months in the future, which can be useful for planning purposes.</p>
</dd>
<dt>Worker scalability</dt>
<dd>
<p>The <a data-type="indexterm" data-primary="Chronos" data-secondary="worker scalability" id="idp9628064"></a><a data-type="indexterm" data-primary="scalability" id="idp9629072"></a>key differentiator between Chronos and most other job schedulers is that Chronos runs its jobs inside of containers on Mesos. This means that jobs are isolated and workers are scalable, so no matter what load Chronos generates, you’re able to add new Mesos slaves to handle the additional work and ensure that the jobs receive their necessary resources.</p>
</dd>
</dl>

<p>Like all production-ready Mesos frameworks, Chronos has high-availability support with hot spares—most Chronos deployments will run at least two instances of the scheduler, to ensure that Chronos never has more than a couple seconds of downtime if a scheduler or its host fails.
Chronos also comes with a synchronization tool, <code>chronos-sync.rb</code>.
This tool synchronizes the Chronos state to disk in JSON format.
Using <code>chronos-sync.rb</code>, you can version the jobs you run on your cluster by committing the file to version control.
This is the most popular approach to ensure repeatability, since it allows you to keep your Chronos configuration in a repository.</p>

<p>The combination of its REST API and synchronize-to-disk tool make Chronos easy to integrate.
Since its features are somewhat limited, it’s easy to use, but it’s not a complete solution for dependent workflow <a data-type="indexterm" data-primary="Chronos" data-secondary="key features for scheduling" data-startref="ch3kffs" id="idp9632912"></a>management.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Running Chronos on Marathon"><div class="sect2" id="idp9634384">
<h2>Running Chronos on Marathon</h2>

<p>One <a data-type="indexterm" data-primary="Chronos" data-secondary="running on Marathon" id="ch3rom"></a><a data-type="indexterm" data-primary="Marathon" data-secondary="running Chronos on" id="m3rco"></a>of the most common techniques seen in Mesos framework deployment is to run framework schedulers on Marathon.
The reason for this is that those schedulers can rely on Marathon to ensure they’re always running somewhere.
This removes a huge burden from the operator, who would otherwise need to ensure that every scheduler had a well-monitored, multimachine deployment.</p>

<p>In order to be deployable on Marathon, a scheduler must do some sort of leader election. As we’ll learn in <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch04.html#chapter_creating_new_scheduler">Chapter&nbsp;4</a>, a scheduler connects to Mesos from a single host.
This means that if we’d like to run our scheduler in two locations (e.g., to have a hot spare), we’ll need some sort of signaling to ensure that only one scheduler runs at a time.
The most common way to solve this is to use <a data-type="indexterm" data-primary="ZooKeeper" id="idp9640480"></a>ZooKeeper, since it has an easily integrated leader election component (see <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch04.html#scheduler_ha">“Adding High Availability”</a> for details).
Marathon and Chronos both take this approach.</p>

<p>Let’s look at an example <a data-type="indexterm" data-primary="JSON" id="idp9642544"></a>JSON expression for launching Chronos on Marathon (<a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#chronos_json_descriptor">Example&nbsp;3-16</a>).
In order to maximize the efficiency of our port allocations, we’ll allow Chronos to bind to any port.
To connect to Chronos, we’ll either click through the Marathon UI or use one of the HAProxy service discovery mechanisms described earlier.</p>
<div id="chronos_json_descriptor" data-type="example">
<h5><span class="label">Example 3-16. </span>Chronos JSON descriptor</h5>

<pre data-type="programlisting" data-code-language="json"><code class="p">{</code><code>
    </code><code class="nt">"cmd"</code><code class="p">:</code><code> </code><code class="s2">"java -jar chronos.jar -Xmx350m -Xms350m ---port $PORT0"</code><code class="p">,</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO13-1a" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO13-1a"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a><code>
    </code><code class="nt">"uris"</code><code class="p">:</code><code> </code><code class="p">[</code><code>
        </code><code class="s2">"http://fetchable/uri/with/chronos.jar"</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO13-2a" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO13-2a"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a><code>
    </code><code class="p">]</code><code class="p">,</code><code>
    </code><code class="nt">"cpus"</code><code class="p">:</code><code> </code><code class="mi">1</code><code class="p">,</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO13-3a" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO13-3a"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a><code>
    </code><code class="nt">"mem"</code><code class="p">:</code><code> </code><code class="mi">384</code><code class="p">,</code><code> </code><a class="co" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO13-3a"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a><code>
    </code><code class="nt">"instances"</code><code class="p">:</code><code> </code><code class="mi">2</code><code class="p">,</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO13-4a" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO13-4a"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/4.png" alt="4" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/4.png"></a><code>
    </code><code class="nt">"id"</code><code class="p">:</code><code> </code><code class="s2">"chronos"</code><code class="p">,</code><code>
    </code><code class="nt">"ports"</code><code class="p">:</code><code> </code><code class="p">[</code><code class="mi">0</code><code class="p">]</code><code class="p">,</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO13-5a" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO13-5a"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/5.png" alt="5" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/5.png"></a><code>
    </code><code class="nt">"constraints"</code><code class="p">:</code><code> </code><code class="p">[</code><code class="p">[</code><code class="s2">"hostname"</code><code class="p">,</code><code> </code><code class="s2">"UNIQUE"</code><code class="p">]</code><code class="p">]</code><code> </code><a class="co" id="co_porting_an_existing_application_to_mesos_CO13-6a" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#callout_porting_an_existing_application_to_mesos_CO13-6a"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/6.png" alt="6" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/6.png"></a><code>
</code><code class="p">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO13-1a" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO13-1a"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a></dt>
<dd><p>We assume that <code>java</code> is already installed on all the Mesos slaves. Thus, we only need to pass the dynamically assigned port to Chronos so that it can start up successfully.</p></dd>
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO13-2a" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO13-2a"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a></dt>
<dd><p>Rather than installing Chronos on every Mesos slave, we’ll store its <em>.jar</em> file in some known location. This way, it’ll be downloaded on the fly to any slave that is assigned to run the Chronos scheduler, simplifying deployment.</p></dd>
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO13-3a" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO13-3a"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a></dt>
<dd><p>We’ll choose a container size to match the amount of memory we allow the JVM to allocate (we leave 34 MB of headroom for the JVM itself).</p></dd>
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO13-4a" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO13-4a"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/4.png" alt="4" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/4.png"></a></dt>
<dd><p>Running two instances of Chronos gives us near-instantaneous failover, since the standby Chronos scheduler will already be running.</p></dd>
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO13-5a" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO13-5a"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/5.png" alt="5" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/5.png"></a></dt>
<dd><p>Chronos needs only one port to be assigned.</p></dd>
<dt><a class="co" id="callout_porting_an_existing_application_to_mesos_CO13-6a" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#co_porting_an_existing_application_to_mesos_CO13-6a"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/6.png" alt="6" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/6.png"></a></dt>
<dd><p>We will use a unique host constraint to ensure that the standby instance of Chronos is running on a different machine. If there are slave attributes that indicate the rack of each slave, it would be better to rack-isolate the scheduler and its standby.</p></dd>
</dl></div>

<p>The simplest way to verify that Chronos is running is to click on the assigned port number from the Marathon app view.
Each task’s port assignment will be a link to that host and port combination, which will load the Chronos UI.
The Chronos UI is somewhat buggy, so it’s recommended to use <code>curl</code> or <code>chronos-sync.rb</code> to configure your instance of <a data-type="indexterm" data-primary="Chronos" data-secondary="running on Marathon" data-startref="ch3rom" id="idp9768224"></a><a data-type="indexterm" data-primary="Marathon" data-secondary="running Chronos on" data-startref="m3rco" id="idp9769376"></a>Chronos.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Chronos Operational Concerns"><div class="sect2" id="chronos_ops">
<h2>Chronos Operational Concerns</h2>

<p>Chronos <a data-type="indexterm" data-primary="Chronos" data-secondary="operational concerns" id="idp9772592"></a>is a useful part of the Mesos ecosystem; however, care must be taken not to overly rely on it.
There are a few things that one must be aware of when running Chronos in production:</p>
<ol>
<li>
<p>The <a data-type="indexterm" data-primary="Chronos" data-secondary="dependent jobs feature" id="idp9774944"></a>dependent jobs feature isn’t useful—you must use a workflow manager.</p>
</li>
<li>
<p>Chronos is still a complex distributed system—it’s only necessary if you need jobs to run scalably in containers.</p>
</li>

</ol>

<p>Almost no one uses the Chronos dependent jobs feature.
Instead, they use Chronos to schedule invocations of popular data workflow tools.
For simple workflows (such as running a few processes in order), Bash scripts are a popular option;
however, beyond 20 lines, Bash scripts become unwieldy, and their syntax for complex loops and conditionals leaves much to be desired.
<code>make</code> is <a data-type="indexterm" data-primary="make" id="idp9778512"></a>another popular way to express dependencies, since it has superior syntax for workflows and supports basic parallelism.
<a href="https://github.com/spotify/luigi">Luigi</a> <a data-type="indexterm" data-primary="Luigi" id="idp9780144"></a>is a much richer and more powerful workflow manager.
It supports checkpoints in HDFS and databases, which can improve the efficiency of retries of jobs that failed partway through, since it won’t need to redo earlier checkpointed work.
Regardless of your particular needs and use case, you should use some other tool to order the jobs that Chronos will be scheduling.</p>

<p>If you’ve made it this far, you’re almost ready to use Chronos in production!
The final consideration is whether you truly need the scalable isolation that Chronos gets from Mesos.
Even though you’re running a Mesos cluster, you don’t need to use Chronos for your task management.
There are many other job-scheduling servers that could easily be run on Marathon; only use Chronos if you need each job to run in its own container.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Chronos on Marathon: Summary"><div class="sect2" id="idp9782352">
<h2>Chronos on Marathon: Summary</h2>

<p>Chronos is a powerful tool for Mesos clusters that need reliable, scalable, interval-based job scheduling.
It powers the data generation processes at many companies, including Airbnb.
Just remember the several quirks, workarounds, and advice discussed here!</p>

<p>Chronos on Marathon is just one example of how Marathon can be used to provide high availability and ease of deployment to other Mesos schedulers.
<a href="https://mesosphere.com/product/">DCOS</a>, a commercial Mesos product, takes this further and requires all frameworks on DCOS to be hosted by Marathon.
Whether you’re deploying <a href="http://mesos.github.io/chronos/">Chronos</a>, <a href="https://github.com/mesos/kafka">Kafka</a>, or <a href="https://github.com/apache/incubator-cotton">Cotton</a>, Marathon is an excellent choice for hosting other Mesos frameworks’ <a data-type="indexterm" data-primary="Marathon" data-secondary="running Mesos frameworks on" data-seealso="Chronos" data-startref="m3rmfo" id="idp9787632"></a><a data-type="indexterm" data-primary="Chronos" data-startref="ch3" id="idp9789120"></a>schedulers.</p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Alternatives to Marathon + Chronos"><div class="sect1" id="idp9790320">
<h1>Alternatives to Marathon + Chronos</h1>

<p>Of <a data-type="indexterm" data-primary="Marathon" data-secondary="alternatives to" id="idp9791616"></a><a data-type="indexterm" data-primary="Chronos" data-secondary="alternatives to" id="idp9792624"></a>course, Marathon (and Chronos) won’t fit every cluster’s needs.
Let’s briefly look at two other popular Mesos PaaS frameworks: Aurora and Singularity.
Both frameworks have a much steeper learning curve, but they offer many additional features.</p>








<section data-type="sect2" data-pdf-bookmark="Singularity"><div class="sect2" id="idp9794096">
<h2>Singularity</h2>

<p><a href="https://github.com/HubSpot/Singularity">Singularity</a> is a <a data-type="indexterm" data-primary="Singularity" id="idp9796144"></a>Mesos framework developed by <a data-type="indexterm" data-primary="Hubspot" id="idp9797008"></a>HubSpot.
It offers the ability to deploy services just like Marathon (including Dockerized applications); beyond this, if a service begins to fail its health checks after a deployment, Singularity will automatically roll back the deployment.
Singularity also supports repeating jobs, like Chronos, as well as one-shot jobs, which can be triggered via a REST API. This simplifies adding containerized, asynchronous background processing to any service or repeating job.
For managing service discovery and proxies, Singularity is integrated with another tool called <a href="https://github.com/HubSpot/Baragon">Baragon</a>, which manages and <a data-type="indexterm" data-primary="proxies" data-secondary="HAProxy" id="idp9799008"></a><a data-type="indexterm" data-primary="HAProxy" id="idp9800016"></a><a data-type="indexterm" data-primary="Nginx" id="idp9800688"></a><a data-type="indexterm" data-primary="Amazon Elastic Load Balancer" id="idp9801360"></a><a data-type="indexterm" data-primary="Elastic Load Balancer" id="idp9802000"></a>integrates HAProxy, Nginx, and Amazon’s Elastic Load Balancer.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Aurora"><div class="sect2" id="idp9802928">
<h2>Aurora</h2>

<p><a href="http://aurora.apache.org/">Aurora</a> is the <a data-type="indexterm" data-primary="Aurora" id="idp9804800"></a><a data-type="indexterm" data-primary="Twitter" id="idp9805536"></a>Mesos framework that powers Twitter.
Aurora has a highly advanced job description API written in Python.
This API, called <a data-type="indexterm" data-primary="Thermos" id="idp9806480"></a>Thermos, allows users to specify how to build and install applications, as well as the workflow and sequence of processes to run within the Mesos executor.
Aurora comes with a high-performance distributed service discovery API with bindings for C++, Java, and Python.
It’s able to run repeating jobs with cron-style syntax.
Also, just like Singularity, Aurora can automatically detect when a service’s <a data-type="indexterm" data-primary="health checks" id="idp9807696"></a>health checks start failing and roll it back to the previous working version.
Aurora’s most powerful features are related to its multitenancy controls: Aurora can allow for some tasks to use spare cluster capacity, and then preempt those tasks when higher-priority production tasks need to be scheduled.
It also can enforce quotas between users.
These features were born out of the needs of a company running huge numbers of applications written by hundreds of developers on massive Mesos clusters;
if that sounds like the kind of organization you’re building a Mesos cluster for, Aurora’s worth a closer look.</p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Summary"><div class="sect1" id="idp9809520">
<h1>Summary</h1>

<p>In this chapter, we learned how to build standard stateless server-based applications with Mesos.
What we achieved was self-healing, self-restarting, and simplified service discovery—we basically built a PaaS on Mesos!
This was accomplished by using Marathon, a popular Mesos framework.</p>

<p>Marathon launches, monitors, and restarts processes across your Mesos cluster.
It simplifies rollout, allows for push-button scale up and scale down, and provides a simple JSON API that’s easy to integrate with.</p>

<p>First, we learned how to start up Marathon, how to secure it, and how to ensure that it’s highly available.
Then, we learned how to write a Marathon service descriptor, which allowed us to launch the omnipresent <code>SimpleHTTPServer</code>.
This was just an example application; any other application could be launched simply by changing the command line.
We also learned how to programmatically query for information about the status of applications on Marathon.</p>

<p>Next, we learned about scaling applications on Marathon.
Most importantly, we discussed placement constraints, and how to easily ensure that applications run on the correct class of slave machines and are spread evenly amongst racks.</p>

<p>Docker is the most popular application containerization technology.
We learned how to launch Dockerized applications on Marathon with minimal fuss, and how to configure various Docker-specific options, such as mounting host disks.</p>

<p>Our applications wouldn’t be fully robust without including health checks and automatic incremental rollouts and rollbacks.
We discussed how to configure TCP, HTTP, and command-based health checks, as well as how to specify the application’s behavior during upgrades.
We also discussed how to subscribe to an event stream from Marathon to build custom integrations.</p>

<p>Then, we learned about integrating Marathon with a service discovery proxy.
Bamboo, an open-source HAProxy configuration manager, is a powerful tool for synchronizing HAProxy with Marathon tasks.
We also learned about popular approaches for building scalable, multilanguage microservices architectures with HAProxy and Marathon.</p>

<p>Finally, we looked at how to use Marathon to host other Mesos frameworks’ schedulers, using Chronos, a distributed cron-like framework, as an example.
We also briefly surveyed alternative PaaS frameworks to Marathon, since they offer many additional features (at the cost of a steeper learning curve).</p>

<p>Perhaps <a data-type="indexterm" data-primary="Marathon" data-startref="m3" id="idp9817440"></a>Marathon and its alternatives don’t satisfy the needs of your application, and you need more control over how processes are launched or how failures are handled.
In that case, you’ll need to write your own framework.
In the next chapter, we’ll learn about the techniques used to build Marathon, so that you can build your own custom Mesos framework.</p>
</div></section>







<div data-type="footnotes"><p data-type="footnote" id="idp7830224"><sup><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#idp7830224-marker" class="totri-footnote">1</a></sup> By this, I mean endpoints that may result in running a query on the database or making an external service call that you can’t predict how long it will take, or whether we’ll consume resources indefinitely.</p><p data-type="footnote" id="idp9056944"><sup><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#idp9056944-marker" class="totri-footnote">2</a></sup> If you’d like to use a private Docker repository, you can add the <em>.dockercfg</em> to the <code>"uris"</code> field of the application descriptor, as described in the <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch06.html#Advanced_Docker_Configuration">Advanced Docker Configuration</a> note in the section <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch06.html#docker_support">“Using Docker”</a>.</p><p data-type="footnote" id="idp9340864"><sup><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#idp9340864-marker" class="totri-footnote">3</a></sup> These will be made horizontally scalable in a future version of Mesos. You can see whether these features have been added yet by checking MESOS-2533 and MESOS-3567 on <a href="https://issues.apache.org/jira"><em class="hyperlink">https://issues.apache.org/jira</em></a>.</p><p data-type="footnote" id="idp9521072"><sup><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#idp9521072-marker" class="totri-footnote">4</a></sup> SSL termination is when clients communicate with the proxy over a secure SSL connection, and the proxy handles the SSL so that the backends need not waste CPU resources on cryptography, or even support it.</p><p data-type="footnote" id="idp9561408"><sup><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#idp9561408-marker" class="totri-footnote">5</a></sup> The other options, DNS and in-app discovery, delegate communication directly to each application, so there’s no central system to configure for isolation. Instead, each application can handle its authorization in complete isolation from other applications.</p></div></div></section><div class="annotator-outer annotator-viewer viewer annotator-hide">
  <ul class="annotator-widget annotator-listing"></ul>
</div><div class="annotator-modal-wrapper annotator-editor-modal annotator-editor annotator-hide">
	<div class="annotator-outer editor">
		<h2 class="title">Highlight</h2>
		<form class="annotator-widget">
			<ul class="annotator-listing">
			<li class="annotator-item"><textarea id="annotator-field-0" placeholder="Add a note using markdown (optional)" class="js-editor" maxlength="750"></textarea></li></ul>
			<div class="annotator-controls">
				<a class="link-to-markdown" href="https://daringfireball.net/projects/markdown/basics" target="_blank">?</a>
				<ul>
					<li class="delete annotator-hide"><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#delete" class="annotator-delete-note button positive">Delete Note</a></li>
					<li class="save"><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#save" class="annotator-save annotator-focus button positive">Save Note</a></li>
					<li class="cancel"><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#cancel" class="annotator-cancel button">Cancel</a></li>
				</ul>
			</div>
		</form>
	</div>
</div><div class="annotator-modal-wrapper annotator-delete-confirm-modal" style="display: none;">
  <div class="annotator-outer">
    <h2 class="title">Highlight</h2>
      <a class="js-close-delete-confirm annotator-cancel close" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#close">Close</a>
      <div class="annotator-widget">
         <div class="delete-confirm">
            Are you sure you want to permanently delete this note?
         </div>
         <div class="annotator-controls">
            <a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#cancel" class="annotator-cancel button js-cancel-delete-confirm">No, I changed my mind</a>
            <a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#delete" class="annotator-delete button positive js-delete-confirm">Yes, delete it</a>
         </div>
       </div>
   </div>
</div><div class="annotator-adder" style="display: none;">
	<ul class="adders ">
		
		<li class="copy"><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#">Copy</a></li>
		
		<li class="add-highlight"><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#">Add Highlight</a></li>
		<li class="add-note"><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#">
			
				Add Note
			
		</a></li>
	</ul>
</div></div></div>



  <div class="t-sbo-prev sbo-prev sbo-nav-bottom">
  
    
      
        <a href="/library/view/building-applications-on/9781491926543/ch02.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">2. Getting Started with Mesos</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-bottom">
  
    
      
        <a href="/library/view/building-applications-on/9781491926543/ch04.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">4. Creating a New Framework for Mesos</div>
        </a>
    
  
  </div>


      
    </section>
    <div class="reading-controls-bottom">
      <ul class="interface-controls js-bitlist">
        <li class="queue-control">
            <button type="button" class="rec-fav ss-queue js-queue js-current-chapter-queue" data-queue-endpoint="/api/v1/book/9781491926543/chapter/ch03.html" data-for-analytics="9781491926543:ch03.html">
      <span>Add to Queue</span>
  </button>
        </li>
      </ul>
    </div>
  </div>
<section class="sbo-saved-archives"></section>



          
          
  





    
    



        
      </div>
      



  <footer class="pagefoot t-pagefoot">
    <a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#" class="icon-up"><div class="visuallyhidden">Back to top</div></a>
    <ul class="js-footer-nav">
      
        <li><a class="t-recommendations-footer" href="https://www.safaribooksonline.com/r/">Recommended</a></li>
      
      <li><a class="t-queue-footer" href="https://www.safaribooksonline.com/s/">Queue</a></li>
      
        <li><a class="t-recent-footer" href="https://www.safaribooksonline.com/history/">History</a></li>
        <li><a class="t-topics-footer" href="https://www.safaribooksonline.com/topics?q=*&amp;limit=21">Topics</a></li>
      
      
        <li><a class="t-tutorials-footer" href="https://www.safaribooksonline.com/tutorials/">Tutorials</a></li>
      
      <li><a class="t-settings-footer js-settings" href="https://www.safaribooksonline.com/u/">Settings</a></li>
      <li><a href="https://www.safaribooksonline.com/blog/">Blog</a></li>
      <li class="full-support"><a href="https://www.safaribooksonline.com/public/support">Support</a></li>
      <li><a href="https://community.safaribooksonline.com/">Feedback</a></li>
      <li><a href="https://www.safaribooksonline.com/apps/">Get the App</a></li>
      <li><a href="https://www.safaribooksonline.com/accounts/logout/">Sign Out</a></li>
    </ul>
    <span class="copyright">© 2016 <a href="https://www.safaribooksonline.com/" target="_blank">Safari</a>.</span>
    <a href="https://www.safaribooksonline.com/terms/">Terms of Service</a> /
    <a href="https://www.safaribooksonline.com/privacy/">Privacy Policy</a>
  </footer>




    

    
    
  

<div class="annotator-notice"></div><div class="font-flyout"><div class="font-controls-panel">
	<div class="nightmodes">
		<ul>
			<li class="day"><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#" id="day-mode" title="Day Mode">
				<i class="fa fa-sun-o"></i>
				<span>Day Mode</span></a></li>
			<li class="cloudy"><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#" id="cloudy-mode" title="Cloudy Mode">
				<i class="fa fa-cloud"></i>
				<span>Cloud Mode</span>
			</a></li>
			<li class="night"><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#" id="night-mode" title="Night Mode">
				<i class="fa fa-moon-o"></i>
				<span>Night Mode</span>
			</a></li>
		</ul>
	</div>

	<div class="font-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-font left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-font-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-font right"></i>
		</div>
	</div>

	<div class="column-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-compress left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-column-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-expand right"></i>
		</div>
	</div>

	<a id="reset" class="button" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#">Reset</a>
</div>
</div></body><span class="gr__tooltip"><span class="gr__tooltip-content"></span><i class="gr__tooltip-logo"></i><span class="gr__triangle"></span></span></html>