<!--[if IE]><![endif]--><!DOCTYPE html><!--[if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage"" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/building-applications-on/9781491926543/ch05.html"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="859452"
  data-user-uuid="4d373bec-fada-4717-9823-769db3ed3a36"
  data-username="dchen267"
  data-account-type="B2B"
  
  data-activated-trial-date="04/25/2016"


  data-archive="9781491926543"
  data-publishers="O&#39;Reilly Media, Inc."



  data-htmlfile-name="ch05.html"
  data-epub-title="Building Applications on Mesos" data-debug=0 data-testing=0><![endif]--><!--[if gt IE 8]><!--><html class=" js flexbox flexboxlegacy no-touch websqldatabase indexeddb history csscolumns csstransforms localstorage sessionstorage applicationcache svg inlinesvg zoom gr__safaribooksonline_com" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#" itemscope="" itemtype="http://schema.org/Book http://schema.org/ItemPage" "="" data-login-url="/accounts/login/" data-offline-url="/" data-url="/library/view/building-applications-on/9781491926543/ch05.html" data-csrf-cookie="csrfsafari" data-highlight-privacy="" data-user-id="859452" data-user-uuid="4d373bec-fada-4717-9823-769db3ed3a36" data-username="dchen267" data-account-type="B2B" data-activated-trial-date="04/25/2016" data-archive="9781491926543" data-publishers="O'Reilly Media, Inc." data-htmlfile-name="ch05.html" data-epub-title="Building Applications on Mesos" data-debug="0" data-testing="0"><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="Safari Books Online"><meta name="format-detection" content="telephone=no"><meta http-equiv="cleartype" content="on"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="apple-itunes-app" content="app-id=881697395, app-argument=safaridetail://9781491926543"><meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0"><meta property="twitter:account_id" content="4503599627559754"><link rel="apple-touch-icon" href="https://www.safaribooksonline.com/static/images/apple-touch-icon.8cc2fd27400e.png"><link rel="shortcut icon" href="https://www.safaribooksonline.com/favicon.ico" type="image/x-icon"><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700,900,200italic,300italic,400italic,600italic,700italic,900italic" rel="stylesheet" type="text/css"><title>5. Building a Mesos Executor - Building Applications on Mesos</title><link rel="stylesheet" href="https://www.safaribooksonline.com/static/CACHE/css/e4b0fef39b55.css" type="text/css"><link rel="stylesheet" type="text/css" href="https://www.safaribooksonline.com/static/css/annotator.min.fd58f69f4908.css"><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css"><style type="text/css" title="ibis-book">
    @charset "utf-8";#sbo-rt-content html,#sbo-rt-content div,#sbo-rt-content div,#sbo-rt-content span,#sbo-rt-content applet,#sbo-rt-content object,#sbo-rt-content iframe,#sbo-rt-content h1,#sbo-rt-content h2,#sbo-rt-content h3,#sbo-rt-content h4,#sbo-rt-content h5,#sbo-rt-content h6,#sbo-rt-content p,#sbo-rt-content blockquote,#sbo-rt-content pre,#sbo-rt-content a,#sbo-rt-content abbr,#sbo-rt-content acronym,#sbo-rt-content address,#sbo-rt-content big,#sbo-rt-content cite,#sbo-rt-content code,#sbo-rt-content del,#sbo-rt-content dfn,#sbo-rt-content em,#sbo-rt-content font,#sbo-rt-content img,#sbo-rt-content ins,#sbo-rt-content kbd,#sbo-rt-content q,#sbo-rt-content s,#sbo-rt-content samp,#sbo-rt-content small,#sbo-rt-content strike,#sbo-rt-content strong,#sbo-rt-content sub,#sbo-rt-content sup,#sbo-rt-content tt,#sbo-rt-content var,#sbo-rt-content b,#sbo-rt-content u,#sbo-rt-content i,#sbo-rt-content center,#sbo-rt-content dl,#sbo-rt-content dt,#sbo-rt-content dd,#sbo-rt-content ol,#sbo-rt-content ul,#sbo-rt-content li,#sbo-rt-content fieldset,#sbo-rt-content form,#sbo-rt-content label,#sbo-rt-content legend,#sbo-rt-content table,#sbo-rt-content caption,#sbo-rt-content tdiv,#sbo-rt-content tfoot,#sbo-rt-content thead,#sbo-rt-content tr,#sbo-rt-content th,#sbo-rt-content td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}@page{margin:5px !important}#sbo-rt-content p{margin:8px 0 0;line-height:125%;text-align:left}#sbo-rt-content em{font-style:italic;font-family:inherit}#sbo-rt-content em.replaceable{font-style:italic}#sbo-rt-content em strong,#sbo-rt-content strong em{font-weight:bold;font-style:italic;font-family:inherit}#sbo-rt-content strong.userinput{font-weight:bold;font-style:normal}#sbo-rt-content span.bolditalic{font-weight:bold;font-style:italic}#sbo-rt-content strong,#sbo-rt-content span.bold{font-weight:bold}#sbo-rt-content a.ulink,#sbo-rt-content a.xref,#sbo-rt-content a.email,#sbo-rt-content a.link,#sbo-rt-content a{text-decoration:none;color:#8e0012}#sbo-rt-content sup{font-size:x-small;vertical-align:super}#sbo-rt-content sub{font-size:smaller;vertical-align:sub}#sbo-rt-content span.lineannotation{font-style:italic;color:#A62A2A;font-family:serif,"DejaVuSerif"}#sbo-rt-content span.underline{text-decoration:underline}#sbo-rt-content span.strikethrough{text-decoration:line-through}#sbo-rt-content span.smallcaps{font-variant:small-caps}#sbo-rt-content span.cursor{background:#000;color:#FFF}#sbo-rt-content span.smaller{font-size:75%}#sbo-rt-content .boxedtext,#sbo-rt-content .keycap{border-style:solid;border-width:1px;border-color:#000;padding:1px}#sbo-rt-content span.gray50{color:#7F7F7F;}#sbo-rt-content .gray-background,#sbo-rt-content .reverse-video{background:#2E2E2E;color:#FFF}#sbo-rt-content .light-gray-background{background:#A0A0A0}#sbo-rt-content .preserve-whitespace{white-space:pre-wrap}#sbo-rt-content h1,#sbo-rt-content div.toc-title,#sbo-rt-content h2,#sbo-rt-content h3,#sbo-rt-content h4,#sbo-rt-content h5{-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;font-weight:bold;text-align:left;page-break-after:avoid !important;font-family:sans-serif,"DejaVuSans"}#sbo-rt-content div.toc-title{font-size:1.5em;margin-top:20px !important;margin-bottom:30px !important}#sbo-rt-content section[data-type="sect1"] h1{font-size:1.3em;color:#8e0012;margin:40px 0 8px 0}#sbo-rt-content section[data-type="sect2"] h2{font-size:1.1em;margin:30px 0 8px 0 !important}#sbo-rt-content section[data-type="sect3"] h3{font-size:1em;color:#555;margin:20px 0 8px 0 !important}#sbo-rt-content section[data-type="sect4"] h4{font-size:1em;font-weight:normal;font-style:italic;margin:15px 0 6px 0 !important}#sbo-rt-content section[data-type="chapter"]>div>h1,#sbo-rt-content section[data-type="preface"]>div>h1,#sbo-rt-content section[data-type="appendix"]>div>h1,#sbo-rt-content section[data-type="glossary"]>div>h1,#sbo-rt-content section[data-type="bibliography"]>div>h1,#sbo-rt-content section[data-type="index"]>div>h1{font-size:2em;line-height:1;margin-bottom:50px;color:#000;padding-bottom:10px;border-bottom:1px solid #000}#sbo-rt-content div[data-type="part"] h1{font-size:2em;text-align:center;margin-top:0 !important;margin-bottom:50px;padding:50px 0 10px 0;border-bottom:1px solid #000}#sbo-rt-content img.width-ninety{width:90%}#sbo-rt-content img{max-width:95%;margin:0 auto;padding:0}#sbo-rt-content div.figure{background-color:transparent;text-align:center;-webkit-border-radius:5px;border-radius:5px;border:1px solid #DCDCDC;padding:15px 5px 15px 5px !important;margin:15px 0 15px 0 !important;page-break-inside:avoid}#sbo-rt-content figure{margin:15px 0 15px 0 !important;page-break-inside:avoid}#sbo-rt-content div.figure h6{font-size:90%;text-align:center;font-weight:normal;font-style:italic;font-family:serif,"DejaVuSerif";color:#000;padding-top:10px !important;page-break-before:avoid;page-break-after:avoid}#sbo-rt-content div.informalfigure{text-align:center;padding:5px 0 !important}#sbo-rt-content div.sidebar{margin:15px 0 10px 0 !important;-webkit-border-radius:5px;border-radius:5px;border:1px solid #DCDCDC;background-color:#F7F7F7;font-size:90%;padding:15px !important;page-break-inside:avoid}#sbo-rt-content aside[data-type="sidebar"]{margin:15px 0 10px 0 !important;page-break-inside:avoid}#sbo-rt-content div.sidebar-title,#sbo-rt-content aside[data-type="sidebar"] h5{font-weight:bold;font-size:1em;font-family:sans-serif,"DejaVuSans";text-transform:uppercase;letter-spacing:1px;text-align:center;margin:4px 0 6px 0 !important;page-break-inside:avoid}#sbo-rt-content div.sidebar div.figure p.title,#sbo-rt-content aside[data-type="sidebar"] figcaption,#sbo-rt-content div.sidebar div.informalfigure div.caption{font-size:90%;text-align:center;font-weight:normal;font-style:italic;font-family:serif,"DejaVuSerif";color:#000;padding:5px !important;page-break-before:avoid;page-break-after:avoid}#sbo-rt-content div.sidebar ol,#sbo-rt-content aside[data-type="sidebar"] ul{margin-left:15px}#sbo-rt-content div.sidebar div.tip,#sbo-rt-content div.sidebar div.note,#sbo-rt-content div.sidebar div.warning,#sbo-rt-content div.sidebar div.caution,#sbo-rt-content div.sidebar div.important{margin:20px auto 20px auto !important;font-size:90%;width:85%}#sbo-rt-content div.sidebar div.figure,#sbo-rt-content aside[data-type="sidebar"] figure{border:none}#sbo-rt-content pre{white-space:pre-wrap;font-family:"Ubuntu Mono",monospace;margin:25px 0 25px 20px;font-size:85%;display:block;-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none}#sbo-rt-content div.note pre.programlisting,#sbo-rt-content div.tip pre.programlisting,#sbo-rt-content div.warning pre.programlisting,#sbo-rt-content div.caution pre.programlisting,#sbo-rt-content div.important pre.programlisting{margin-bottom:0}#sbo-rt-content code{font-family:"Ubuntu Mono",monospace;-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none}#sbo-rt-content code strong em,#sbo-rt-content code em strong,#sbo-rt-content pre em strong,#sbo-rt-content pre strong em,#sbo-rt-content strong code em code,#sbo-rt-content em code strong code,#sbo-rt-content span.bolditalic code{font-weight:bold;font-style:italic;font-family:"Ubuntu Mono BoldItal",monospace}#sbo-rt-content code em,#sbo-rt-content em code,#sbo-rt-content pre em,#sbo-rt-content em.replaceable{font-family:"Ubuntu Mono Ital",monospace;font-style:italic}#sbo-rt-content code strong,#sbo-rt-content strong code,#sbo-rt-content pre strong,#sbo-rt-content strong.userinput{font-family:"Ubuntu Mono Bold",monospace;font-weight:bold}#sbo-rt-content div[data-type="example"]{margin:10px 0 15px 0 !important}#sbo-rt-content div[data-type="example"] h1,#sbo-rt-content div[data-type="example"] h2,#sbo-rt-content div[data-type="example"] h3,#sbo-rt-content div[data-type="example"] h4,#sbo-rt-content div[data-type="example"] h5,#sbo-rt-content div[data-type="example"] h6{font-style:italic;font-weight:normal;font-family:serif,"DejaVuSerif";margin:10px 0 5px 0 !important;border-bottom:1px solid #000}#sbo-rt-content li pre.example{padding:10px 0 !important}#sbo-rt-content div[data-type="example"] pre[data-type="programlisting"],#sbo-rt-content div[data-type="example"] pre[data-type="screen"]{margin:0}#sbo-rt-content span.gray{color:#4C4C4C}#sbo-rt-content section[data-type="titlepage"]>div>h1{font-size:3em;font-family:sans-serif,"DejaVuSans";font-weight:bold;margin:50px 0 10px 0 !important;line-height:1;text-align:center}#sbo-rt-content section[data-type="titlepage"]>div>h2[data-type="author"]{font-size:2em;font-family:sans-serif,"DejaVuSans";font-weight:bold;color:#8e0012;margin:50px 0 !important;text-align:center}#sbo-rt-content div.book div.titlepage div.publishername{margin-top:60%;margin-bottom:20px;text-align:center;font-size:1.25em}#sbo-rt-content div.book div.titlepage div.locations p{margin:0;text-align:center}#sbo-rt-content div.book div.titlepage div.locations p.cities{font-size:80%;text-align:center;margin-top:5px}#sbo-rt-content section.preface[title="Dedication"]>div.titlepage h2.title{text-align:center;text-transform:uppercase;font-size:1.5em;margin-top:50px;margin-bottom:50px}#sbo-rt-content section.preface[title="Dedication"] p{font-style:italic;text-align:center}#sbo-rt-content div.colophon h1.title{font-size:1.3em;margin:0 !important;font-family:serif,"DejaVuSerif";font-weight:normal}#sbo-rt-content div.colophon h2.subtitle{margin:0 !important;color:#000;font-family:serif,"DejaVuSerif";font-size:1em;font-weight:normal}#sbo-rt-content div.colophon div.author h3.author{font-size:1.1em;font-family:serif,"DejaVuSerif";margin:10px 0 0 !important;font-weight:normal}#sbo-rt-content div.colophon div.editor h4,#sbo-rt-content div.colophon div.editor h3.editor{color:#000;font-size:.8em;margin:15px 0 0 !important;font-family:serif,"DejaVuSerif";font-weight:normal}#sbo-rt-content div.colophon div.editor h3.editor{font-size:.8em;margin:0 !important;font-family:serif,"DejaVuSerif";font-weight:normal}#sbo-rt-content div.colophon div.publisher{margin-top:10px}#sbo-rt-content div.colophon div.publisher p,#sbo-rt-content div.colophon div.publisher span.publishername{margin:0;font-size:.8em}#sbo-rt-content div.legalnotice p,#sbo-rt-content div.timestamp p{font-size:.8em}#sbo-rt-content div.timestamp p{margin-top:10pt}#sbo-rt-content div.colophon[title="About the Author"] h1.title,#sbo-rt-content div.colophon[title="Colophon"] h1.title{font-size:1.5em;margin:0 !important;font-family:sans-serif,"DejaVuSans";font-weight:bold}#sbo-rt-content section.chapter div.titlepage div.author{margin:10px 0 10px 0}#sbo-rt-content section.chapter div.titlepage div.author div.affiliation{font-style:italic}#sbo-rt-content div.attribution{margin:5px 0 0 50px !important}#sbo-rt-content h3.author span.orgname{display:none}#sbo-rt-content div.epigraph{margin:10px 0 10px 20px !important;page-break-inside:avoid;font-size:90%}#sbo-rt-content div.epigraph p{font-style:italic}#sbo-rt-content blockquote,#sbo-rt-content div.blockquote{margin:10px !important;page-break-inside:avoid;font-size:95%}#sbo-rt-content blockquote p,#sbo-rt-content div.blockquote p{font-family:serif,"DejaVuSerif";font-style:italic}#sbo-rt-content blockquote div.attribution{margin:5px 0 0 30px !important;text-align:right;width:80%}#sbo-rt-content blockquote div.attribution p{font-style:normal}#sbo-rt-content p.right{text-align:right;margin:0}#sbo-rt-content div.footnote{font-size:90%}#sbo-rt-content div.refnamediv h2,#sbo-rt-content div.refnamediv h3,#sbo-rt-content div.refsynopsisdiv h2{font-size:1.1em;color:#000;margin-top:15px !important;margin-bottom:0 !important}#sbo-rt-content div.refentry div.refsect1 h2{font-size:1.1em;color:#000;margin-top:15px !important;margin-bottom:0 !important}#sbo-rt-content div.refsect2 h3{font-size:1em;color:#000;margin-top:10px !important;margin-bottom:0 !important}#sbo-rt-content div.refnamediv p{margin-left:15px !important}#sbo-rt-content dt{padding-top:10px !important;padding-bottom:0 !important}#sbo-rt-content dt span.term{font-weight:bold;font-style:italic}#sbo-rt-content dt span.term code.literal{font-style:normal;font-weight:normal}#sbo-rt-content dd{margin-left:1.5em !important}#sbo-rt-content dd,#sbo-rt-content li{text-align:left}#sbo-rt-content ol{list-style-type:decimal;margin-top:8px !important;margin-bottom:8px !important;margin-left:20px !important;padding-left:25px !important}#sbo-rt-content ol ol{list-style-type:lower-alpha}#sbo-rt-content ol ol ol{list-style-type:lower-roman}#sbo-rt-content ul{list-style-type:square;margin-top:8px !important;margin-bottom:8px !important;margin-left:5px !important;padding-left:20px !important}#sbo-rt-content ul ul{list-style-type:none;padding-left:0 !important;margin-left:0 !important}#sbo-rt-content ol li,#sbo-rt-content ul li,#sbo-rt-content dd{margin-bottom:.25em}#sbo-rt-content ul ul li p:before{content:"— "}#sbo-rt-content ul ul ul li p:before{content:""}#sbo-rt-content ul ul ul{list-style-type:square;margin-left:20px !important;padding-left:30px !important}#sbo-rt-content div.orderedlistalpha{list-style-type:upper-alpha}#sbo-rt-content table.simplelist{margin-left:20px !important;margin-bottom:10px}#sbo-rt-content table.simplelist td{border:none;font-size:90%}#sbo-rt-content table.simplelist tr{border-bottom:none}#sbo-rt-content table.simplelist tr:nth-of-type(even){background-color:transparent}#sbo-rt-content dl.calloutlist p:first-child{margin-top:-25px !important}#sbo-rt-content dl.calloutlist dd{padding-left:0;margin-top:-25px}#sbo-rt-content dl.calloutlist img{padding:0}#sbo-rt-content a.co img{padding:0}#sbo-rt-content div.toc ol{margin-top:8px !important;margin-bottom:8px !important;margin-left:0 !important;padding-left:0 !important}#sbo-rt-content div.toc ol ol{margin-left:30px !important;padding-left:0 !important}#sbo-rt-content div.toc ol li{list-style-type:none}#sbo-rt-content div.toc a{color:#8e0012}#sbo-rt-content div.toc ol a{font-size:1em;font-weight:bold}#sbo-rt-content div.toc ol>li>ol a{font-weight:bold;font-size:1em}#sbo-rt-content div.toc ol>li>ol>li>ol a{text-decoration:none;font-weight:normal;font-size:1em}#sbo-rt-content div.tip,#sbo-rt-content div[data-type="tip"],#sbo-rt-content div.note,#sbo-rt-content div[data-type="note"],#sbo-rt-content div.warning,#sbo-rt-content div[data-type="warning"],#sbo-rt-content div[data-type="caution"],#sbo-rt-content div[data-type="important"]{margin:30px !important;-webkit-border-radius:5px;border-radius:5px;font-size:90%;padding:10px 8px 20px 8px !important;page-break-inside:avoid}#sbo-rt-content div.tip,#sbo-rt-content div[data-type="tip"],#sbo-rt-content div.note,#sbo-rt-content div[data-type="note"]{border:1px solid #BEBEBE;background-color:transparent}#sbo-rt-content div.warning,#sbo-rt-content div[data-type="warning"],#sbo-rt-content div[data-type="caution"],#sbo-rt-content div[data-type="important"]{border:1px solid #BC8F8F}#sbo-rt-content div.tip h3,#sbo-rt-content div[data-type="tip"] h6,#sbo-rt-content div[data-type="tip"] h1,#sbo-rt-content div.note h3,#sbo-rt-content div[data-type="note"] h6,#sbo-rt-content div[data-type="note"] h1,#sbo-rt-content div.warning h3,#sbo-rt-content div[data-type="warning"] h6,#sbo-rt-content div[data-type="warning"] h1,#sbo-rt-content div[data-type="caution"] h6,#sbo-rt-content div[data-type="caution"] h1,#sbo-rt-content div[data-type="important"] h1{font-weight:bold;font-size:110%;font-family:sans-serif,"DejaVuSans";text-transform:uppercase;letter-spacing:1px;text-align:center;margin:4px 0 6px !important}#sbo-rt-content div.tip h3,#sbo-rt-content div[data-type="tip"] h6,#sbo-rt-content div.note h3,#sbo-rt-content div[data-type="note"] h6{color:#737373}#sbo-rt-content div.warning h3,#sbo-rt-content div[data-type="warning"] h6,#sbo-rt-content div[data-type="caution"] h6,#sbo-rt-content div[data-type="important"] h6{color:#C67171}#sbo-rt-content div.sect1[title="Safari® Books Online"] div.note,#sbo-rt-content div.safarienabled{background-color:transparent;margin:8px 0 0 !important;border:0 solid #BEBEBE;-webkit-border-radius:0;border-radius:0;font-size:100%;padding:0 !important;page-break-inside:avoid}#sbo-rt-content div.sect1[title="Safari® Books Online"] div.note h3{display:none}#sbo-rt-content div.table,#sbo-rt-content table{margin:15px auto 30px auto !important;max-width:95%;border-collapse:collapse;border-spacing:0}#sbo-rt-content div.table,#sbo-rt-content div.informaltable{page-break-inside:avoid}#sbo-rt-content tr,#sbo-rt-content tr td{border-bottom:1px solid #c3c3c3}#sbo-rt-content thead td,#sbo-rt-content thead th{border-bottom:#9d9d9d 1px solid !important;border-top:#9d9d9d 1px solid !important}#sbo-rt-content tr:nth-of-type(even){background-color:#f1f6fc}#sbo-rt-content thead{font-family:sans-serif,"DejaVuSans";color:#000;font-weight:bold}#sbo-rt-content td,#sbo-rt-content th{padding:.3em;text-align:left;vertical-align:baseline;font-size:80%}#sbo-rt-content div.informaltable table{margin:10px auto !important}#sbo-rt-content div.informaltable table tr{border-bottom:none}#sbo-rt-content div.informaltable table tr:nth-of-type(even){background-color:transparent}#sbo-rt-content div.informaltable td,#sbo-rt-content div.informaltable th{border:#9d9d9d 1px solid}#sbo-rt-content div.table-title,#sbo-rt-content table caption{font-weight:normal;font-style:italic;font-family:serif,"DejaVuSerif";margin:10px 0 10px 0 !important;text-align:center;padding:0;page-break-after:avoid}#sbo-rt-content table code{font-size:smaller}#sbo-rt-content div.equation{margin:10px 0 15px 0 !important}#sbo-rt-content div.equation-title{font-style:italic;font-weight:normal;font-family:serif,"DejaVuSerif";margin:20px 0 10px 0 !important;page-break-after:avoid}#sbo-rt-content div.equation-contents{margin-left:20px}#sbo-rt-content span.inlinemediaobject{height:.85em;display:inline-block;margin-bottom:.2em}#sbo-rt-content span.inlinemediaobject img{margin:0;height:.85em}#sbo-rt-content div.informalequation{margin:20px 0 20px 20px;width:75%}#sbo-rt-content div.informalequation img{width:75%}#sbo-rt-content div.index{font-weight:bold;text-indent:0}#sbo-rt-content div.index li{line-height:140%}#sbo-rt-content div.index a.indexterm{color:#8e0012}#sbo-rt-content div.index ul{list-style-type:none;padding-left:0;margin-left:0}#sbo-rt-content div.index ul li{padding-left:0;margin-left:0}#sbo-rt-content div.index ul li ul li{margin-left:20px}#sbo-rt-content code.boolean,#sbo-rt-content .navy{color:rgb(0,0,128);}#sbo-rt-content code.character,#sbo-rt-content .olive{color:rgb(128,128,0);}#sbo-rt-content code.comment,#sbo-rt-content .blue{color:rgb(0,0,255);}#sbo-rt-content code.conditional,#sbo-rt-content .limegreen{color:rgb(50,205,50);}#sbo-rt-content code.constant,#sbo-rt-content .darkorange{color:rgb(255,140,0);}#sbo-rt-content code.debug,#sbo-rt-content .darkred{color:rgb(139,0,0);}#sbo-rt-content code.define,#sbo-rt-content .darkgoldenrod,#sbo-rt-content .gold{color:rgb(184,134,11);}#sbo-rt-content code.delimiter,#sbo-rt-content .dimgray{color:rgb(105,105,105);}#sbo-rt-content code.error,#sbo-rt-content .red{color:rgb(255,0,0);}#sbo-rt-content code.exception,#sbo-rt-content .salmon{color:rgb(250,128,11);}#sbo-rt-content code.float,#sbo-rt-content .steelblue{color:rgb(70,130,180);}#sbo-rt-content pre code.function,#sbo-rt-content .green{color:rgb(0,128,0);}#sbo-rt-content code.identifier,#sbo-rt-content .royalblue{color:rgb(65,105,225);}#sbo-rt-content code.ignore,#sbo-rt-content .gray{color:rgb(128,128,128);}#sbo-rt-content code.include,#sbo-rt-content .purple{color:rgb(128,0,128);}#sbo-rt-content code.keyword,#sbo-rt-content .sienna{color:rgb(160,82,45);}#sbo-rt-content code.label,#sbo-rt-content .deeppink{color:rgb(255,20,147);}#sbo-rt-content code.macro,#sbo-rt-content .orangered{color:rgb(255,69,0);}#sbo-rt-content code.number,#sbo-rt-content .brown{color:rgb(165,42,42);}#sbo-rt-content code.operator,#sbo-rt-content .black{color:#000;}#sbo-rt-content code.preCondit,#sbo-rt-content .teal{color:rgb(0,128,128);}#sbo-rt-content code.preProc,#sbo-rt-content .fuschia{color:rgb(255,0,255);}#sbo-rt-content code.repeat,#sbo-rt-content .indigo{color:rgb(75,0,130);}#sbo-rt-content code.special,#sbo-rt-content .saddlebrown{color:rgb(139,69,19);}#sbo-rt-content code.specialchar,#sbo-rt-content .magenta{color:rgb(255,0,255);}#sbo-rt-content code.specialcomment,#sbo-rt-content .seagreen{color:rgb(46,139,87);}#sbo-rt-content code.statement,#sbo-rt-content .forestgreen{color:rgb(34,139,34);}#sbo-rt-content code.storageclass,#sbo-rt-content .plum{color:rgb(221,160,221);}#sbo-rt-content code.string,#sbo-rt-content .darkred{color:rgb(139,0,0);}#sbo-rt-content code.structure,#sbo-rt-content .chocolate{color:rgb(210,106,30);}#sbo-rt-content code.tag,#sbo-rt-content .darkcyan{color:rgb(0,139,139);}#sbo-rt-content code.todo,#sbo-rt-content .black{color:#000;}#sbo-rt-content code.type,#sbo-rt-content .mediumslateblue{color:rgb(123,104,238);}#sbo-rt-content code.typedef,#sbo-rt-content .darkgreen{color:rgb(0,100,0);}#sbo-rt-content code.underlined{text-decoration:underline;}#sbo-rt-content pre code.hll{background-color:#ffc}#sbo-rt-content pre code.c{color:#09F;font-style:italic}#sbo-rt-content pre code.err{color:#A00}#sbo-rt-content pre code.k{color:#069;font-weight:bold}#sbo-rt-content pre code.o{color:#555}#sbo-rt-content pre code.cm{color:#35586C;font-style:italic}#sbo-rt-content pre code.cp{color:#099}#sbo-rt-content pre code.c1{color:#35586C;font-style:italic}#sbo-rt-content pre code.cs{color:#35586C;font-weight:bold;font-style:italic}#sbo-rt-content pre code.gd{background-color:#FCC}#sbo-rt-content pre code.ge{font-style:italic}#sbo-rt-content pre code.gr{color:#F00}#sbo-rt-content pre code.gh{color:#030;font-weight:bold}#sbo-rt-content pre code.gi{background-color:#CFC}#sbo-rt-content pre code.go{color:#000}#sbo-rt-content pre code.gp{color:#009;font-weight:bold}#sbo-rt-content pre code.gs{font-weight:bold}#sbo-rt-content pre code.gu{color:#030;font-weight:bold}#sbo-rt-content pre code.gt{color:#9C6}#sbo-rt-content pre code.kc{color:#069;font-weight:bold}#sbo-rt-content pre code.kd{color:#069;font-weight:bold}#sbo-rt-content pre code.kn{color:#069;font-weight:bold}#sbo-rt-content pre code.kp{color:#069}#sbo-rt-content pre code.kr{color:#069;font-weight:bold}#sbo-rt-content pre code.kt{color:#078;font-weight:bold}#sbo-rt-content pre code.m{color:#F60}#sbo-rt-content pre code.s{color:#C30}#sbo-rt-content pre code.na{color:#309}#sbo-rt-content pre code.nb{color:#366}#sbo-rt-content pre code.nc{color:#0A8;font-weight:bold}#sbo-rt-content pre code.no{color:#360}#sbo-rt-content pre code.nd{color:#99F}#sbo-rt-content pre code.ni{color:#999;font-weight:bold}#sbo-rt-content pre code.ne{color:#C00;font-weight:bold}#sbo-rt-content pre code.nf{color:#C0F}#sbo-rt-content pre code.nl{color:#99F}#sbo-rt-content pre code.nn{color:#0CF;font-weight:bold}#sbo-rt-content pre code.nt{color:#309;font-weight:bold}#sbo-rt-content pre code.nv{color:#033}#sbo-rt-content pre code.ow{color:#000;font-weight:bold}#sbo-rt-content pre code.w{color:#bbb}#sbo-rt-content pre code.mf{color:#F60}#sbo-rt-content pre code.mh{color:#F60}#sbo-rt-content pre code.mi{color:#F60}#sbo-rt-content pre code.mo{color:#F60}#sbo-rt-content pre code.sb{color:#C30}#sbo-rt-content pre code.sc{color:#C30}#sbo-rt-content pre code.sd{color:#C30;font-style:italic}#sbo-rt-content pre code.s2{color:#C30}#sbo-rt-content pre code.se{color:#C30;font-weight:bold}#sbo-rt-content pre code.sh{color:#C30}#sbo-rt-content pre code.si{color:#A00}#sbo-rt-content pre code.sx{color:#C30}#sbo-rt-content pre code.sr{color:#3AA}#sbo-rt-content pre code.s1{color:#C30}#sbo-rt-content pre code.ss{color:#A60}#sbo-rt-content pre code.bp{color:#366}#sbo-rt-content pre code.vc{color:#033}#sbo-rt-content pre code.vg{color:#033}#sbo-rt-content pre code.vi{color:#033}#sbo-rt-content pre code.il{color:#F60}#sbo-rt-content pre code.g{color:#050}#sbo-rt-content pre code.l{color:#C60}#sbo-rt-content pre code.l{color:#F90}#sbo-rt-content pre code.n{color:#008}#sbo-rt-content pre code.nx{color:#008}#sbo-rt-content pre code.py{color:#96F}#sbo-rt-content pre code.p{color:#000}#sbo-rt-content pre code.x{color:#F06}#sbo-rt-content div.blockquote_sampler_toc{width:95%;margin:5px 5px 5px 10px !important}#sbo-rt-content div{font-family:serif,"DejaVuSerif";text-align:left}
    </style><link rel="canonical" href="/safari-books-archive/site/library/view/building-applications-on/9781491926543/ch05.html"><meta name="description" content=" Chapter 5. Building a Mesos Executor Now you’ve seen how to build a scheduler for Mesos. However, there are some things that can’t be done with the scheduler ... "><meta property="og:title" content="5. Building a Mesos Executor"><meta itemprop="isPartOf" content="/library/view/building-applications-on/9781491926543/"><meta itemprop="name" content="5. Building a Mesos Executor"><meta property="og:url" itemprop="url" content="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/ch05.html"><meta property="og:site_name" content="Safari"><meta property="og:image" itemprop="thumbnailUrl" content="https://www.safaribooksonline.com/library/cover/9781491926543/"><meta property="og:description" itemprop="description" content=" Chapter 5. Building a Mesos Executor Now you’ve seen how to build a scheduler for Mesos. However, there are some things that can’t be done with the scheduler ... "><meta itemprop="inLanguage" content="en"><meta itemprop="publisher" content="O'Reilly Media, Inc."><meta property="og:type" content="book"><meta property="og:book:isbn" itemprop="isbn" content="9781491926529"><meta property="og:book:author" itemprop="author" content="David Greenberg"><meta property="og:book:tag" itemprop="about" content="Databases"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@safari"><style type="text/css" id="font-styles" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-size: <%= font_size %> !important; }"></style><style type="text/css" id="font-family" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-family: <%= font_family %> !important; }"></style><style type="text/css" id="column-width" data-template="#sbo-rt-content { max-width: <%= column_width %>% !important; margin: 0 auto !important; }"></style><!--[if lt IE 9]><script src="/static/js/src/respond.min.cf5c9b7980e5.js"></script><![endif]--><style id="annotator-dynamic-style">.annotator-adder, .annotator-outer, .annotator-notice {
  z-index: 100019;
}
.annotator-filter {
  z-index: 100009;
}</style></head>


<body class="reading sidenav nav-collapsed  scalefonts library" data-gr-c-s-loaded="true">

    
      <div class="hide working" role="status">
        <div class="working-image"></div>
      </div>
      <div class="sbo-site-nav">
        




<a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#container" class="skip">Skip to content</a><header class="topbar t-topbar" style="display:None"><nav role="navigation" class="js-site-nav"><ul class="topnav"><li class="t-logo"><a href="https://www.safaribooksonline.com/home/" class="l0 None safari-home nav-icn js-keyboard-nav-home"><svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" version="1.1" fill="#4A3C31"><desc>Safari Home Icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M4 9.9L4 9.9 4 18 16 18 16 9.9 10 4 4 9.9ZM2.6 8.1L2.6 8.1 8.7 1.9 10 0.5 11.3 1.9 17.4 8.1 18 8.7 18 9.5 18 18.1 18 20 16.1 20 3.9 20 2 20 2 18.1 2 9.5 2 8.7 2.6 8.1Z"></path><rect x="10" y="12" width="3" height="7"></rect><rect transform="translate(18.121320, 10.121320) rotate(-315.000000) translate(-18.121320, -10.121320) " x="16.1" y="9.1" width="4" height="2"></rect><rect transform="translate(2.121320, 10.121320) scale(-1, 1) rotate(-315.000000) translate(-2.121320, -10.121320) " x="0.1" y="9.1" width="4" height="2"></rect></g></svg><span>Safari Home</span></a></li><li><a href="https://www.safaribooksonline.com/r/" class="t-recommendations-nav l0 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" version="1.1" fill="#4A3C31"><desc>recommendations icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M50 25C50 18.2 44.9 12.5 38.3 11.7 37.5 5.1 31.8 0 25 0 18.2 0 12.5 5.1 11.7 11.7 5.1 12.5 0 18.2 0 25 0 31.8 5.1 37.5 11.7 38.3 12.5 44.9 18.2 50 25 50 31.8 50 37.5 44.9 38.3 38.3 44.9 37.5 50 31.8 50 25ZM25 3.1C29.7 3.1 33.6 6.9 34.4 11.8 30.4 12.4 26.9 15.1 25 18.8 23.1 15.1 19.6 12.4 15.6 11.8 16.4 6.9 20.3 3.1 25 3.1ZM34.4 15.6C33.6 19.3 30.7 22.2 27.1 22.9 27.8 19.2 30.7 16.3 34.4 15.6ZM22.9 22.9C19.2 22.2 16.3 19.3 15.6 15.6 19.3 16.3 22.2 19.2 22.9 22.9ZM3.1 25C3.1 20.3 6.9 16.4 11.8 15.6 12.4 19.6 15.1 23.1 18.8 25 15.1 26.9 12.4 30.4 11.8 34.4 6.9 33.6 3.1 29.7 3.1 25ZM22.9 27.1C22.2 30.7 19.3 33.6 15.6 34.4 16.3 30.7 19.2 27.8 22.9 27.1ZM25 46.9C20.3 46.9 16.4 43.1 15.6 38.2 19.6 37.6 23.1 34.9 25 31.3 26.9 34.9 30.4 37.6 34.4 38.2 33.6 43.1 29.7 46.9 25 46.9ZM27.1 27.1C30.7 27.8 33.6 30.7 34.4 34.4 30.7 33.6 27.8 30.7 27.1 27.1ZM38.2 34.4C37.6 30.4 34.9 26.9 31.3 25 34.9 23.1 37.6 19.6 38.2 15.6 43.1 16.4 46.9 20.3 46.9 25 46.9 29.7 43.1 33.6 38.2 34.4Z" fill="currentColor"></path></g></svg><span>Recommended</span></a></li><li><a href="https://www.safaribooksonline.com/s/" class="t-queue-nav l0 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" version="1.1" fill="#4A3C31"><desc>queue icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 29.2C25.4 29.2 25.8 29.1 26.1 28.9L48.7 16.8C49.5 16.4 50 15.5 50 14.6 50 13.7 49.5 12.8 48.7 12.4L26.1 0.3C25.4-0.1 24.6-0.1 23.9 0.3L1.3 12.4C0.5 12.8 0 13.7 0 14.6 0 15.5 0.5 16.4 1.3 16.8L23.9 28.9C24.2 29.1 24.6 29.2 25 29.2ZM7.3 14.6L25 5.2 42.7 14.6 25 24 7.3 14.6ZM48.7 22.4L47.7 21.9 25 34.2 2.3 21.9 1.3 22.4C0.5 22.9 0 23.7 0 24.7 0 25.6 0.5 26.5 1.3 26.9L23.9 39.3C24.2 39.5 24.6 39.6 25 39.6 25.4 39.6 25.8 39.5 26.1 39.3L48.7 26.9C49.5 26.5 50 25.6 50 24.7 50 23.7 49.5 22.9 48.7 22.4ZM48.7 32.8L47.7 32.3 25 44.6 2.3 32.3 1.3 32.8C0.5 33.3 0 34.1 0 35.1 0 36 0.5 36.9 1.3 37.3L23.9 49.7C24.2 49.9 24.6 50 25 50 25.4 50 25.8 49.9 26.1 49.7L48.7 37.3C49.5 36.9 50 36 50 35.1 50 34.1 49.5 33.3 48.7 32.8Z" fill="currentColor"></path></g></svg><span>Queue</span></a></li><li class="search"><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#" class="t-search-nav trigger nav-icn l0" data-dropdown-selector=".searchbox"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" version="1.1" fill="#4A3C31"><desc>search icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M31.3 0C20.9 0 12.5 8.4 12.5 18.8 12.5 22.5 13.6 25.9 15.4 28.8L1.2 42.9C-0.4 44.5-0.4 47.2 1.2 48.8 2 49.6 3.1 50 4.2 50 5.2 50 6.3 49.6 7.1 48.8L21.2 34.6C24.1 36.5 27.5 37.5 31.3 37.5 41.6 37.5 50 29.1 50 18.8 50 8.4 41.6 0 31.3 0ZM31.3 31.3C24.4 31.3 18.8 25.6 18.8 18.8 18.8 11.9 24.4 6.3 31.3 6.3 38.1 6.3 43.8 11.9 43.8 18.8 43.8 25.6 38.1 31.3 31.3 31.3Z" fill="currentColor"></path></g></svg><span>Search</span></a></li><li class="usermenu dropdown"><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#" class="trigger l0 nav-icn nav-dropdown"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" version="1.1" fill="#4A3C31"><desc>navigation arrow</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M0.1 12.5L9.7 3.1C9.8 3 9.9 3 10 3 10.1 3 10.2 3 10.3 3.1L19.9 12.5C20 12.5 20 12.6 20 12.8 20 12.9 20 13 19.9 13L17 15.9C16.9 16 16.8 16 16.7 16 16.5 16 16.4 16 16.4 15.9L10 9.7 3.6 15.9C3.6 16 3.5 16 3.3 16 3.2 16 3.1 16 3 15.9L0.1 13C0 12.9 0 12.8 0 12.7 0 12.7 0 12.6 0.1 12.5Z"></path></g></svg><span>Expand Nav</span></a><div class="drop-content"><ul><li><a href="https://www.safaribooksonline.com/history/" class="t-recent-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" version="1.1" fill="#4A3C31"><desc>recent items icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 0C11.2 0 0 11.2 0 25 0 38.8 11.2 50 25 50 38.8 50 50 38.8 50 25 50 11.2 38.8 0 25 0ZM6.3 25C6.3 14.6 14.6 6.3 25 6.3 35.4 6.3 43.8 14.6 43.8 25 43.8 35.4 35.4 43.8 25 43.8 14.6 43.8 6.3 35.4 6.3 25ZM31.8 31.5C32.5 30.5 32.4 29.2 31.6 28.3L27.1 23.8 27.1 12.8C27.1 11.5 26.2 10.4 25 10.4 23.9 10.4 22.9 11.5 22.9 12.8L22.9 25.7 28.8 31.7C29.2 32.1 29.7 32.3 30.2 32.3 30.8 32.3 31.3 32 31.8 31.5Z" fill="currentColor"></path></g></svg><span>History</span></a></li><li><a href="https://www.safaribooksonline.com/topics" class="t-topics-link l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 55" version="1.1" fill="#4A3C31"><desc>topics icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 55L50 41.262 50 13.762 25 0 0 13.762 0 41.262 25 55ZM8.333 37.032L8.333 17.968 25 8.462 41.667 17.968 41.667 37.032 25 46.538 8.333 37.032Z" fill="currentColor"></path></g></svg><span>Topics</span></a></li><li><a href="https://www.safaribooksonline.com/tutorials/" class="l1 nav-icn t-tutorials-nav js-toggle-menu-item None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" version="1.1" fill="#4A3C31"><desc>tutorials icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M15.8 18.2C15.8 18.2 15.9 18.2 16 18.2 16.1 18.2 16.2 18.2 16.4 18.2 16.5 18.2 16.7 18.1 16.9 18 17 17.9 17.1 17.8 17.2 17.7 17.3 17.6 17.4 17.5 17.4 17.4 17.5 17.2 17.6 16.9 17.6 16.7 17.6 16.6 17.6 16.5 17.6 16.4 17.5 16.2 17.5 16.1 17.4 15.9 17.3 15.8 17.2 15.6 17 15.5 16.8 15.3 16.6 15.3 16.4 15.2 16.2 15.2 16 15.2 15.8 15.2 15.7 15.2 15.5 15.3 15.3 15.4 15.2 15.4 15.1 15.5 15 15.7 14.9 15.8 14.8 15.9 14.7 16 14.7 16.1 14.6 16.3 14.6 16.4 14.6 16.5 14.6 16.6 14.6 16.6 14.6 16.7 14.6 16.9 14.6 17 14.6 17.1 14.7 17.3 14.7 17.4 14.8 17.6 15 17.7 15.1 17.9 15.2 18 15.3 18 15.5 18.1 15.5 18.1 15.6 18.2 15.7 18.2 15.7 18.2 15.7 18.2 15.8 18.2L15.8 18.2ZM9.4 11.5C9.5 11.5 9.5 11.5 9.6 11.5 9.7 11.5 9.9 11.5 10 11.5 10.2 11.5 10.3 11.4 10.5 11.3 10.6 11.2 10.8 11.1 10.9 11 10.9 10.9 11 10.8 11.1 10.7 11.2 10.5 11.2 10.2 11.2 10 11.2 9.9 11.2 9.8 11.2 9.7 11.2 9.5 11.1 9.4 11 9.2 10.9 9.1 10.8 8.9 10.6 8.8 10.5 8.7 10.3 8.6 10 8.5 9.9 8.5 9.7 8.5 9.5 8.5 9.3 8.5 9.1 8.6 9 8.7 8.8 8.7 8.7 8.8 8.6 9 8.5 9.1 8.4 9.2 8.4 9.3 8.2 9.5 8.2 9.8 8.2 10 8.2 10.1 8.2 10.2 8.2 10.3 8.2 10.5 8.3 10.6 8.4 10.7 8.5 10.9 8.6 11.1 8.7 11.2 8.9 11.3 9 11.4 9.1 11.4 9.2 11.4 9.3 11.5 9.3 11.5 9.3 11.5 9.4 11.5 9.4 11.5L9.4 11.5ZM3 4.8C3.1 4.8 3.1 4.8 3.2 4.8 3.4 4.8 3.5 4.8 3.7 4.8 3.8 4.8 4 4.7 4.1 4.6 4.3 4.5 4.4 4.4 4.5 4.3 4.6 4.2 4.6 4.1 4.7 4 4.8 3.8 4.8 3.5 4.8 3.3 4.8 3.1 4.8 3 4.8 2.9 4.7 2.8 4.7 2.6 4.6 2.5 4.5 2.3 4.4 2.2 4.2 2.1 4 1.9 3.8 1.9 3.6 1.8 3.5 1.8 3.3 1.8 3.1 1.8 2.9 1.8 2.7 1.9 2.6 2 2.4 2.1 2.3 2.2 2.2 2.3 2.1 2.4 2 2.5 2 2.6 1.8 2.8 1.8 3 1.8 3.3 1.8 3.4 1.8 3.5 1.8 3.6 1.8 3.8 1.9 3.9 2 4 2.1 4.2 2.2 4.4 2.4 4.5 2.5 4.6 2.6 4.7 2.7 4.7 2.8 4.7 2.9 4.8 2.9 4.8 3 4.8 3 4.8 3 4.8L3 4.8ZM13.1 15.2C13.2 15.1 13.2 15.1 13.2 15.1 13.3 14.9 13.4 14.7 13.6 14.5 13.8 14.2 14.1 14 14.4 13.8 14.7 13.6 15.1 13.5 15.5 13.4 15.9 13.4 16.3 13.4 16.7 13.5 17.2 13.5 17.6 13.7 17.9 13.9 18.2 14.1 18.5 14.4 18.7 14.7 18.9 15 19.1 15.3 19.2 15.6 19.3 15.9 19.4 16.1 19.4 16.4 19.4 17 19.3 17.5 19.1 18.1 19 18.3 18.9 18.5 18.7 18.7 18.5 19 18.3 19.2 18 19.4 17.7 19.6 17.3 19.8 16.9 19.9 16.6 20 16.3 20 16 20 15.8 20 15.6 20 15.4 19.9 15.4 19.9 15.4 19.9 15.4 19.9 15.2 19.9 15 19.8 14.9 19.8 14.8 19.7 14.7 19.7 14.6 19.7 14.4 19.6 14.3 19.5 14.1 19.3 13.7 19.1 13.4 18.7 13.2 18.4 13.1 18.1 12.9 17.8 12.9 17.5 12.8 17.3 12.8 17.1 12.8 16.9L3.5 14.9C3.3 14.9 3.1 14.8 3 14.8 2.7 14.7 2.4 14.5 2.1 14.3 1.7 14 1.4 13.7 1.2 13.3 1 13 0.9 12.6 0.8 12.3 0.7 12 0.7 11.7 0.7 11.4 0.7 11 0.8 10.5 1 10.1 1.1 9.8 1.3 9.5 1.6 9.2 1.8 8.9 2.1 8.7 2.4 8.5 2.8 8.3 3.2 8.1 3.6 8.1 3.9 8 4.2 8 4.5 8 4.6 8 4.8 8 4.9 8.1L6.8 8.5C6.8 8.4 6.8 8.4 6.8 8.4 6.9 8.2 7.1 8 7.2 7.8 7.5 7.5 7.7 7.3 8 7.1 8.4 6.9 8.7 6.8 9.1 6.7 9.5 6.7 10 6.7 10.4 6.8 10.8 6.8 11.2 7 11.5 7.2 11.8 7.5 12.1 7.7 12.4 8 12.6 8.3 12.7 8.6 12.8 8.9 12.9 9.2 13 9.4 13 9.7 13 9.7 13 9.8 13 9.8 13.6 9.9 14.2 10.1 14.9 10.2 15 10.2 15 10.2 15.1 10.2 15.3 10.2 15.4 10.2 15.6 10.2 15.8 10.1 16 10 16.2 9.9 16.4 9.8 16.5 9.6 16.6 9.5 16.8 9.2 16.9 8.8 16.9 8.5 16.9 8.3 16.9 8.2 16.8 8 16.8 7.8 16.7 7.7 16.6 7.5 16.5 7.3 16.3 7.2 16.2 7.1 16 7 15.9 6.9 15.8 6.9 15.7 6.9 15.6 6.8 15.5 6.8L6.2 4.8C6.2 5 6 5.2 5.9 5.3 5.7 5.6 5.5 5.8 5.3 6 4.9 6.2 4.5 6.4 4.1 6.5 3.8 6.6 3.5 6.6 3.2 6.6 3 6.6 2.8 6.6 2.7 6.6 2.6 6.6 2.6 6.5 2.6 6.5 2.5 6.5 2.3 6.5 2.1 6.4 1.8 6.3 1.6 6.1 1.3 6 1 5.7 0.7 5.4 0.5 5 0.3 4.7 0.2 4.4 0.1 4.1 0 3.8 0 3.6 0 3.3 0 2.8 0.1 2.2 0.4 1.7 0.5 1.5 0.7 1.3 0.8 1.1 1.1 0.8 1.3 0.6 1.6 0.5 2 0.3 2.3 0.1 2.7 0.1 3.1 0 3.6 0 4 0.1 4.4 0.2 4.8 0.3 5.1 0.5 5.5 0.8 5.7 1 6 1.3 6.2 1.6 6.3 1.9 6.4 2.3 6.5 2.5 6.6 2.7 6.6 3 6.6 3 6.6 3.1 6.6 3.1 9.7 3.8 12.8 4.4 15.9 5.1 16.1 5.1 16.2 5.2 16.4 5.2 16.7 5.3 16.9 5.5 17.2 5.6 17.5 5.9 17.8 6.2 18.1 6.5 18.3 6.8 18.4 7.2 18.6 7.5 18.6 7.9 18.7 8.2 18.7 8.6 18.7 9 18.6 9.4 18.4 9.8 18.3 10.1 18.2 10.3 18 10.6 17.8 10.9 17.5 11.1 17.3 11.3 16.9 11.6 16.5 11.8 16 11.9 15.7 12 15.3 12 15 12 14.8 12 14.7 12 14.5 11.9 13.9 11.8 13.3 11.7 12.6 11.5 12.5 11.7 12.4 11.9 12.3 12 12.1 12.3 11.9 12.5 11.7 12.7 11.3 12.9 10.9 13.1 10.5 13.2 10.2 13.3 9.9 13.3 9.6 13.3 9.4 13.3 9.2 13.3 9 13.2 9 13.2 9 13.2 9 13.2 8.8 13.2 8.7 13.2 8.5 13.1 8.2 13 8 12.8 7.7 12.6 7.4 12.4 7.1 12 6.8 11.7 6.7 11.4 6.6 11.1 6.5 10.8 6.4 10.6 6.4 10.4 6.4 10.2 5.8 10.1 5.2 9.9 4.5 9.8 4.4 9.8 4.4 9.8 4.3 9.8 4.1 9.8 4 9.8 3.8 9.8 3.6 9.9 3.4 10 3.2 10.1 3 10.2 2.9 10.4 2.8 10.5 2.6 10.8 2.5 11.1 2.5 11.5 2.5 11.6 2.5 11.8 2.6 12 2.6 12.1 2.7 12.3 2.8 12.5 2.9 12.6 3.1 12.8 3.2 12.9 3.3 13 3.5 13.1 3.6 13.1 3.7 13.1 3.8 13.2 3.9 13.2L13.1 15.2 13.1 15.2Z" fill="currentColor"></path></g></svg><span>Tutorials</span></a></li><li class="nav-offers flyout-parent"><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#" class="l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 50 50" version="1.1" fill="#4A3C31"><desc>offers icon</desc><path d="M10.8 43.7L0 39 0 10.2 13.6 4.6 23.3 8.7 11.5 13.5C11 13.6 10.8 13.9 10.8 14.3L10.8 43.7 10.8 43.7Z"></path><polygon points="12.3 44.4 25 50 38 44.3 38 14.7 25.2 9.4 12.3 14.7 12.3 44.4"></polygon><path d="M36.6 4.7L50 10.2 50 39 39.5 43.6 39.5 14.3C39.5 13.8 39.2 13.6 38.8 13.5L27 8.7 36.6 4.7 36.6 4.7Z"></path><polygon points="34.8 4 25 0 15.4 3.9 25.2 7.9 34.8 4"></polygon></svg><span>Offers</span></a><ul class="flyout"><li><a href="https://www.safaribooksonline.com/oreilly-conferences/" class="l2 nav-icn"><span>Conferences</span></a></li><li><a href="https://www.safaribooksonline.com/oreilly-newsletters/" class="l2 nav-icn"><span>Newsletter</span></a></li></ul></li><li class="nav-highlights"><a href="https://www.safaribooksonline.com/u/003o000000t5q9fAAA/" class="t-highlights-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 35" version="1.1" fill="#4A3C31"><desc>highlights icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M13.325 18.071L8.036 18.071C8.036 11.335 12.36 7.146 22.5 5.594L22.5 0C6.37 1.113 0 10.632 0 22.113 0 29.406 3.477 35 10.403 35 15.545 35 19.578 31.485 19.578 26.184 19.578 21.556 17.211 18.891 13.325 18.071L13.325 18.071ZM40.825 18.071L35.565 18.071C35.565 11.335 39.86 7.146 50 5.594L50 0C33.899 1.113 27.5 10.632 27.5 22.113 27.5 29.406 30.977 35 37.932 35 43.045 35 47.078 31.485 47.078 26.184 47.078 21.556 44.74 18.891 40.825 18.071L40.825 18.071Z" fill="currentColor"></path></g></svg><span>Highlights</span></a></li><li><a href="https://www.safaribooksonline.com/u/" class="t-settings-nav l1 js-settings nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z" fill="currentColor"></path></g></svg><span>Settings</span></a></li><li><a href="https://community.safaribooksonline.com/" class="l1 no-icon">Feedback</a></li><li><a href="https://www.safaribooksonline.com/accounts/logout/" class="l1 no-icon">Sign Out</a></li></ul><ul class="profile"><li><a href="https://www.safaribooksonline.com/u/" class="l2 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z" fill="currentColor"></path></g></svg><span>Settings</span></a></li><li><a href="https://community.safaribooksonline.com/" class="l2">Feedback</a></li><li><a href="https://www.safaribooksonline.com/accounts/logout/" class="l2">Sign Out</a></li></ul></div></li></ul></nav></header>


      </div>
      <div id="container" class="application">
        
          <div class="nav-container clearfix">
            


            
            
          </div>

          

  <div class="js-toc">
    
      <div class="sbo-reading-menu sbo-menu-top"><section class="sbo-toc-container toc-menu"><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#" class="sbo-toc-thumb"><span class="sbo-title ss-list"><h1><div class="visuallyhidden">Table of Contents for </div>
      
      Building Applications on Mesos
      
    </h1></span></a><div class="toc-contents"></div></section></div>

    

    <div class="interface-controls interface-controls-top">
      <ul class="interface-control-btns js-bitlist js-reader">
        <li class="js-search-in-archive search-in-archive t-search-in-archive"><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#" title="Search in archive" class="js-search-controls search-controls"><span class="icon">Search in book...</span></a><form class="search-archive-bar js-search-form"><input type="search" name="query" placeholder="Search inside this book..." autocomplete="off"></form><div class="search-archive-results"><div class="js-sitb-results-region"></div></div></li><li class="queue-control"><button type="button" class="rec-fav ss-queue js-queue js-current-chapter-queue" data-queue-endpoint="/api/v1/book/9781491926543/chapter/ch05.html" data-for-analytics="9781491926543:ch05.html"><span>Add to Queue</span></button></li><li class="js-font-control-panel font-control-activator"><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#" data-push-state="false" id="font-controls" title="Change font size" aria-label="Change font size"><span class="icon">Toggle Font Controls</span></a></li><li class="dropdown sharing-controls"><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#" class="trigger" data-push-state="false" title="Share" aria-label="Share"><i class="fa fa-share"></i></a><ul class="social-sharing dropdown-menu"><li><a class="twitter share-button t-twitter" target="_blank" aria-label="Share this section on Twitter" title="Share this section on Twitter" href="https://twitter.com/share?url=https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/ch05.html&amp;text=Building%20Applications%20on%20Mesos&amp;via=safari"><span>Twitter</span></a></li><li><a class="facebook share-button t-facebook" target="_blank" aria-label="Share this section on Facebook" title="Share this section on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/ch05.html"><span>Facebook</span></a></li><li><a class="googleplus share-button t-googleplus" target="_blank" aria-label="Share this secton on Google Plus" title="Share this secton on Google Plus" href="https://plus.google.com/share?url=https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/ch05.html"><span>Google Plus</span></a></li><li><a class="email share-button t-email" aria-label="Share this section via email" title="Share this section via email" href="mailto:?subject=Safari:%205.%20Building%20a%20Mesos%20Executor&amp;body=https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/ch05.html%0D%0Afrom%20Building%20Applications%20on%20Mesos%0D%0A"><span>Email</span></a></li></ul></li>
      </ul>
    </div>

    <section role="document">
      
	  <div class="t-sbo-prev sbo-prev sbo-nav-top">
  
    
      
        <a href="/safari-books-archive/site/library/view/building-applications-on/9781491926543/ch04.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">4. Creating a New Framework for Mesos</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-top">
  
    
      
        <a href="/safari-books-archive/site/library/view/building-applications-on/9781491926543/ch06.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">6. Advanced Topics in Mesos</div>
        </a>
    
  
  </div>



<div id="sbo-rt-content"><div class="annotator-wrapper"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 5. Building a Mesos Executor"><div class="chapter" id="ch_mesos_executor">
<h1><span class="label">Chapter 5. </span>Building a Mesos Executor</h1>


<p>Now <a data-type="indexterm" data-primary="executors" data-seealso="CommandExecutor" id="ex5"></a>you’ve seen how to build a scheduler for Mesos.
However, there are some things that can’t be done with the scheduler API alone.
For instance, perhaps you’d like to run several tasks in the same container.
Maybe your application has lifecycle messages for the scheduler, reporting on its progress or application-specific statistics.
Or perhaps you’d like to layer additional functionality into the executed task.
In order to accomplish these things, you need to write a custom Mesos executor.</p>

<p>This is what we’ll learn how to do in this chapter.
Initially, we’ll simply provide the functionality of the built-in <code>CommandExecutor</code>, which we learned about at the end of the last chapter.
Then, we’ll add support for heartbeats to enable faster failure detection.
Finally, we’ll discuss potential designs for progress reporting, improved logging, and running multiple tasks in the same container.</p>






<section data-type="sect1" data-pdf-bookmark="The Executor"><div class="sect1" id="idp14478096">
<h1>The Executor</h1>

<p>We’ve <a data-type="indexterm" data-primary="schedulers" data-secondary="defined" id="idp14479664"></a>already learned what a scheduler is: it’s the component that interacts with the Mesos masters and the framework’s clients, manages the running tasks, and handles failovers.
But what is an executor?
An executor has three <a data-type="indexterm" data-primary="executors" data-secondary="responsibilities" id="idp14481040"></a><a data-type="indexterm" data-primary="custom executors" data-see="executors" id="idp14481984"></a>responsibilities:</p>

<ul>
<li>
<p>Executing tasks as requested by the scheduler</p>
</li>
<li>
<p>Keeping the scheduler informed of the status of those tasks</p>
</li>
<li>
<p>Handling other requests from the scheduler</p>
</li>
</ul>
<div data-type="warning" epub:type="warning"><h1>You Probably Don’t Want to Do This</h1>
<p>Writing executors is very tedious.
Unfortunately, the only way to test whether the communication between your scheduler and executors is working is to start a new instance of your framework on a Mesos cluster.
Furthermore, correctly implementing health checks, process management, and concurrency is very tricky.
I strongly encourage you to think about how you could leverage the <code>CommandExecutor</code> rather than building your own executor.
Nevertheless, there are many problems that can only be solved by writing an executor.</p>
</div>








<section data-type="sect2" data-pdf-bookmark="Building a Work Queue’s Worker"><div class="sect2" id="idp14237456">
<h2>Building a Work Queue’s Worker</h2>

<p>Recall <a data-type="indexterm" data-primary="schedulers" data-secondary="work queue design" id="idp14238752"></a><a data-type="indexterm" data-primary="executors" data-secondary="versus work queue scheduler" id="idp14239760"></a><a data-type="indexterm" data-primary="executors" data-secondary="custom-built, reasons for" id="ex5rfcb"></a>that the <a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch04.html#work_queue_scheduler_example">work queue scheduler</a> needs individual workers to execute the work items.
When we discussed it earlier, I suggested using an external queuing system, like Redis or RabbitMQ, that your worker processes could connect with directly, but that’s not the only way to build it.
Using a custom executor, you could instead send tasks directly to the executor.
If you’re using RabbitMQ or Redis, there’s not much advantage to doing this;
however, if you chose to store your state in a database like Postgres, you might not be able to easily scale to thousands of connections from every worker.
As a result, you could instead simply have the scheduler send multiple tasks to the same executor.</p>

<p>This has upsides and downsides. On the one hand, it could allow you to avoid adding yet another piece of infrastructure (a queuing layer) to solve your scaling problems.
On the other hand, it’s now your responsibility to implement the queuing semantics you want in your scheduler, which is much more challenging than relying on battle-tested queues.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Running Pickled Tasks"><div class="sect2" id="ex_running_pickled_tasks">
<h2>Running Pickled Tasks</h2>
<div data-type="tip"><h1>What Is a Pickled Task?</h1>
<p>Serialized <a data-type="indexterm" data-primary="pickled tasks" id="pt5"></a><a data-type="indexterm" data-primary="tasks" data-secondary="pickled" id="t5p"></a>code or configuration data that represents a task is known as a pickled task.
For example, sending RPCs requires a way to serialize a task’s parameters so that it can be transmitted across the network.
Many languages support sending bytecode, executable source code, or other data.
The term “pickle” comes from Python’s serialization library.</p>
</div>

<p>Many of us are using the <a data-type="indexterm" data-primary="Java Virtual Machine (JVM)" id="idp14250224"></a><a data-type="indexterm" data-primary="Docker" id="idp14250896"></a>Java Virtual Machine (JVM) or Docker to run our code.
Due to their potentially long initialize time, we may want to provide generated code to an executor.
For example, it might take 45 seconds to start a JVM with all the classes we need:
this is not something we’d like to do thousands of times per second.
In order to avoid the 45-second overhead for each task, it’d be nice to reuse the JVMs for tasks on the same host.
With a custom executor, it is possible to read raw bytes from each task and deserialize them into executable code.
Then, the executor can simply run that code, reusing the whole JVM.
For short tasks, this could be the difference between a task taking 10 seconds or 55 seconds:
this is one of the tricks that enables Spark’s low latency.</p>

<p>This approach can also be used to partially mitigate the challenge of writing an executor: you need only write the “pickle executor” once.
After you’ve written it, you can benefit from the dynamic resizability of the executor (see <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#multiple_tasks">“Multiple Tasks”</a>), and you won’t need to debug the communications again.
Note that this doesn’t require building a custom executor—you could also communicate pickled tasks through an out-of-band mechanism;
the only downside is that you’d lose the ability to dynamically resize <a data-type="indexterm" data-primary="pickled tasks" data-startref="pt5" id="idp14254240"></a><a data-type="indexterm" data-primary="tasks" data-secondary="pickled" data-startref="t5p" id="idp14255184"></a>the container.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Sharing Resources"><div class="sect2" id="idp14256656">
<h2>Sharing Resources</h2>

<p>Imagine <a data-type="indexterm" data-primary="executors" data-secondary="sharing resources" id="idp14257984"></a><a data-type="indexterm" data-primary="resources" data-secondary="sharing" data-seealso="multitenancy" id="idp14258992"></a><a data-type="indexterm" data-primary="tasks" data-secondary="sharing work" data-see="resources, sharing" id="idp14260208"></a>writing an application where each task reads a large static dataset and a small user-provided dataset, crunches the numbers, and returns the result.
This could be used for running a series of simulations or training a machine learning model.
A custom executor could be used to easily share a large static dataset, and still benefit from Mesos’s resource accounting and automatic cleanup when the executor terminates.
To do this, you could configure the custom executor to initialize itself by downloading the large dataset into its sandbox and reserving enough memory for it to remain in the Filesystem’s in-memory block cache.
Then, the tasks you launch on that executor could memory map that dataset, so that they get in-memory, direct access.
This approach would reduce the bandwidth and disk costs of copying that dataset more times than necessary.</p>

<p>Another time that a custom executor could share resources is when building general purpose graphics processing unit (GPGPU) <a data-type="indexterm" data-primary="general purpose graphics processing unit (GPGPU) applications" id="idp14372960"></a>applications.
Frequently, you’ll only have one GPGPU in each slave.
If you used the <code>CommandExecutor</code> and made the GPGPU a custom resource (see <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch02.html#configuring_custom_resources">“Configuring Custom Resources”</a>), you’d only be able to run one task at a time on each slave;
however, you might want to manage the sharing of that GPGPU in an application-specific way.
To do that, you could use the pickled tasks pattern described in the previous section to ensure each task programmatically exposes when it needs to use the GPGPU.
Then, the custom executor could run all the tasks within the same container, so that it can broker and scheduler the tasks’ use of the GPGPU.</p>

<p>These are just a few examples of the ways in which you might want to try to share resources between tasks.
Of course, there are many other ways in which tasks can share their work, from common subproblems to shared caches.
Sometimes, the most efficient way to take advantage of these structures is to run them in the same container, which requires writing an executor.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Better Babysitting"><div class="sect2" id="idp14376448">
<h2>Better Babysitting</h2>

<p>Mesos <a data-type="indexterm" data-primary="executors" data-secondary="babysitting" id="idp14377280"></a>is engineered to maximize availability:
when a scheduler crashes, it can automatically fail over;
when a slave is upgraded, executors can automatically reconnect to the new version;
when a network link goes down, the slave and executors continue to run with their last known instructions.
For some applications, however, this isn’t actually the behavior you want.</p>

<p>At large scale, partial and unexpected failures can reveal subtle bugs that weren’t identified during testing and QA.
To reduce the impact of these unknown, unpredictable issues, you can require that every executor checks in with the scheduler periodically, and if some executor misses too many check-ins, it can be presumed <code>LOST</code> by the scheduler.</p>

<p>Suppose that a slave loses connectivity to the scheduler, but not to its databases.
An executor running on that slave might be able to continue uninterrupted, even though the scheduler can’t receive messages when its tasks finish.
This can cause the system to appear stuck to an administrator.</p>

<p>To solve this, we could add a <a data-type="indexterm" data-primary="heartbeats/heartbeating" id="idp14381104"></a><a data-type="indexterm" data-primary="executors" data-secondary="heartbeating" id="idp14381808"></a>heartbeating mechanism to the executor:
the executor will periodically let the scheduler know it’s still running, so that if an executor misses several heartbeats, the scheduler can presume the executor <code>LOST</code> and restart it on a healthy slave.
This is known as babysitting—constant, active supervision that helps to detect failures faster.
A custom executor can implement heartbeating functionality with the Mesos messaging APIs, ensuring that the overall system remains healthy.</p>
<div data-type="tip"><h1>Mesos-Native Heartbeating</h1>
<p>In an upcoming version after 0.25, Mesos will add native support for three types of health checks—HTTP requests, TCP connection checks, and running a command.
When these are enabled in the <code>TaskInfo</code>, they’ll send periodic <code>StatusUpdate</code>s. You might recognize these as the health checks that Marathon provides (see <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch03.html#health_checks">“Health Checks”</a>). The Mesos project often integrates useful functionality from frameworks back into the core.
See <a href="http://bit.ly/MESOS2533">MESOS-2533</a> and <a href="http://bit.ly/MESOS3567">MESOS-3567</a> for updates.</p>
</div>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Augmented Logging"><div class="sect2" id="idp14388752">
<h2>Augmented Logging</h2>

<p>The <a data-type="indexterm" data-primary="executors" data-secondary="augmented logging" id="idp14390000"></a><a data-type="indexterm" data-primary="logging, augmented" id="idp14391392"></a>final example of a custom executor’s usefulness is in augmenting the logging facilities of Mesos.
Mesos writes each process’s <code>stdout</code> and <code>stderr</code> to local files in the executor sandbox.
With a custom executor, the process’s <code>stdout</code> and <code>stderr</code> can <a data-type="indexterm" data-primary="stdout" id="idp14394032"></a><a data-type="indexterm" data-primary="stderr" id="idp14394768"></a>be forwarded to a centralized log repository or data storage location (such as HDFS, S3, or Logstash), allowing you to upgrade all <code>CommandExecutor</code>-based tasks to centrally store their logs.
However, this could also be accomplished by running a log redirector such as <a href="http://linux.die.net/man/1/logger"><code>logger</code></a>, which connects a process’s <code>stdout</code> to <code>syslog</code>, <a data-type="indexterm" data-primary="syslog" id="idp14397888"></a>thus avoiding the need to make a custom <a data-type="indexterm" data-primary="executors" data-secondary="custom-built, reasons for" data-startref="ex5rfcb" id="idp14398752"></a>executor.</p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Rewriting the CommandExecutor"><div class="sect1" id="idp14478368">
<h1>Rewriting the CommandExecutor</h1>

<p>Now <a data-type="indexterm" data-primary="CommandExecutor" id="idp14401920"></a><a data-type="indexterm" data-primary="executors" data-secondary="reimplementing the CommandExecutor" id="ex5rtce"></a>that we’ve seen some examples of when we’d want to write an executor, let’s take a look at how to actually do so.
We’re going to start by writing something very simple: an executor that is compatible with the built-in <code>CommandExecutor</code>.</p>

<p>We’ll start by looking at the skeleton of <code>MyExecutor</code>, our <code>CommandExecutor</code> clone. The imports and class declaration are <a data-type="indexterm" data-primary="executors" data-secondary="reimplementing the CommandExecutor" data-tertiary="imports and class declaration" id="idp14405904"></a>presented in <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#executor_class_skeleton">Example&nbsp;5-1</a>.</p>
<div id="executor_class_skeleton" data-type="example">
<h5><span class="label">Example 5-1. </span>Imports and class declaration of MyExecutor</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kn">package</code><code> </code><code class="n">com</code><code class="o">.</code><code class="na">example</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">org.apache.mesos.*</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">org.apache.mesos.Protos.*</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.util.*</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.io.File</code><code class="o">;</code><code>
</code><code class="kn">import</code><code> </code><code class="nn">org.json.*</code><code class="o">;</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO1-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO1-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a><code>
</code><code class="kn">import</code><code> </code><code class="nn">java.lang.ProcessBuilder.Redirect</code><code class="o">;</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO1-2" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO1-2"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a><code>
</code><code>
</code><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">MyExecutor</code><code> </code><code class="kd">implements</code><code> </code><code class="n">Executor</code><code class="o">,</code><code> </code><code class="n">Runnable</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO1-3" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO1-3"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a><code>
</code><code>    </code><code class="c1">// We'll discuss the inner bits as we go
</code><code class="o">}</code></pre></div>
<dl class="calloutlist">
<dt><a class="co" id="callout_building_a_mesos_executor_CO1-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO1-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a></dt>
<dd><p>We’ll use <a data-type="indexterm" data-primary="JSON" id="idp14794288"></a>JSON to encode the task we want to run. This JSON will be read from the <code>TaskInfo</code> so that we know what to invoke.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO1-2" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO1-2"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a></dt>
<dd><p>The <code>ProcessBuilder</code> is <a data-type="indexterm" data-primary="ProcessBuilder" id="idp14798368"></a>the most convenient way to start a process in Java; we’ll use it to launch our application, and we’ll redirect the application’s <code>stdout</code> and <code>stderr</code> to separate log files from our executor.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO1-3" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO1-3"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a></dt>
<dd><p>Since there’s no callback API for finding out when a process finishes, we’ll start a thread to wait for the process—that’s why we implement<a data-type="indexterm" data-primary="Runnable" id="idp14834096"></a> <code>Runnable</code>.</p></dd>
</dl>

<p>The <code>main</code> method is <a data-type="indexterm" data-primary="executors" data-secondary="reimplementing the CommandExecutor" data-tertiary="main method" id="idp14835984"></a>shown in <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#main_of_myexecutor">Example&nbsp;5-2</a>.</p>
<div id="main_of_myexecutor" data-type="example" class="pagebreak-before">
<h5><span class="label">Example 5-2. </span>main of MyExecutor</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code> <code class="kd">static</code> <code class="kt">void</code> <code class="nf">main</code><code class="o">(</code><code class="n">String</code> <code class="o">...</code> <code class="n">args</code><code class="o">)</code> <code class="kd">throws</code> <code class="n">Exception</code> <code class="o">{</code>
    <code class="n">Executor</code> <code class="n">executor</code> <code class="o">=</code> <code class="k">new</code> <code class="n">MyExecutor</code><code class="o">();</code>
    <code class="n">ExecutorDriver</code> <code class="n">driver</code> <code class="o">=</code> <code class="k">new</code> <code class="n">MesosExecutorDriver</code><code class="o">(</code><code class="n">executor</code><code class="o">);</code>
    <code class="n">driver</code><code class="o">.</code><code class="na">run</code><code class="o">();</code>
<code class="o">}</code></pre></div>

<p>Although it’s tempting to try to configure some things via the command line passed in to <code>main</code>, you’ll be thankful that all executor configuration comes from the Mesos APIs—this will simplify development in the long run by ensuring all configuration comes from a single source.
When the scheduler has total control over the executors, this simplifies development:
global (scheduler) changes and local (executor) changes are now managed from a single codebase, the scheduler’s.
This makes developing new features easier, and it simplifies operations, since the administrators need only to modify and reload the scheduler to make framework-wide changes.</p>

<p>As with the scheduler, in the <code>main</code> of our executor we create a corresponding driver to communicate with Mesos.
Unfortunately, this driver turns out to be a major annoyance.
When the framework calls <code>MesosExecutorDriver.start()</code>, it needs to have been started by a slave.
The slave injects an environment variable, <code>MESOS_SLAVE_PID</code>, <a data-type="indexterm" data-primary="MESOS_SLAVE_PID" id="idp14875168"></a>which is used to allow the executor to connect to the slave that started it and begin participating in the Mesos protocols.
As a result, if you want to test your executor, you need to implement a mock <code>ExecutorDriver</code>.
If you forget to do this, you’ll see a weird stack trace like this, regardless of what language you’re developing your executor in:</p>

<pre data-type="programlisting">F0605 21:32:01.538770 18480 os.hpp:173] Expecting 'MESOS_SLAVE_PID' in
environment variables
*** Check failure stack trace: ***
    @     0x7fc535912dfd  google::LogMessage::Fail()
    @     0x7fc535914c3d  google::LogMessage::SendToLog()
    @     0x7fc5359129ec  google::LogMessage::Flush()
    @     0x7fc535915539  google::LogMessageFatal::~LogMessageFatal()
    @     0x7fc5352c9ff0  os::getenv()
    @     0x7fc53534139b  mesos::MesosExecutorDriver::start()
    @     0x7fc5359068ee  Java_org_apache_mesos_MesosExecutorDriver_start
    @     0x7fc5390127f8  (unknown)</pre>

<p>We’ll block the main thread until our driver completes—when the task is finished, we’ll call <code>driver.stop()</code> elsewhere <a data-type="indexterm" data-primary="driver.stop()" id="idp14879120"></a>to ensure the executor exits correctly.
Since executors decouple the notion of tasks from the containers and processes that run them, it’s easy to forget that sending a <code>TASK_FINISHED</code> <a data-type="indexterm" data-primary="TASK_FINISHED" id="idp14880560"></a>doesn’t terminate the executor.
You should always have executors shut themselves down once they’ve finished their work, or have the scheduler explicitly manage their lifetime by killing their <a data-type="indexterm" data-primary="canary tasks" id="idp14881632"></a><a data-type="indexterm" data-primary="tasks" data-secondary="canary" id="idp14882304"></a>canary tasks (see <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#canary_tasks">“Canary tasks”</a>).</p>

<p>Just like for schedulers, many of the <a data-type="indexterm" data-primary="callbacks, ignoring" id="cb5i"></a>executor callbacks aren’t important to handle. <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#ignoring_bunches_of_callbacks">Example&nbsp;5-3</a> lists the callbacks we can ignore for <a data-type="indexterm" data-primary="executors" data-secondary="reimplementing the CommandExecutor" data-tertiary="ignoring callbacks" id="ex5rtceicb"></a>now.</p>
<div id="ignoring_bunches_of_callbacks" data-type="example">
<h5><span class="label">Example 5-3. </span>Ignoring callbacks</h5>

<pre data-type="programlisting" data-code-language="java"><code>    </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">frameworkMessage</code><code class="o">(</code><code class="n">ExecutorDriver</code><code> </code><code class="n">driver</code><code class="o">,</code><code> </code><code class="kt">byte</code><code class="o">[</code><code class="o">]</code><code> </code><code class="n">data</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><code class="o">}</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO2-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO2-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">registered</code><code class="o">(</code><code class="n">ExecutorDriver</code><code> </code><code class="n">driver</code><code class="o">,</code><code> </code><code class="n">ExecutorInfo</code><code> </code><code class="n">executorInfo</code><code class="o">,</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO2-2" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO2-2"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a><code>
</code><code>                           </code><code class="n">FrameworkInfo</code><code> </code><code class="n">frameworkInfo</code><code class="o">,</code><code> </code><code class="n">SlaveInfo</code><code> </code><code class="n">slaveInfo</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"registered executor "</code><code> </code><code class="o">+</code><code> </code><code class="n">executorInfo</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">disconnected</code><code class="o">(</code><code class="n">ExecutorDriver</code><code> </code><code class="n">driver</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><code class="o">}</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO2-3" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO2-3"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">shutdown</code><code class="o">(</code><code class="n">ExecutorDriver</code><code> </code><code class="n">driver</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><code class="o">}</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO2-4" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO2-4"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/4.png" alt="4" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/4.png"></a><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">reregistered</code><code class="o">(</code><code class="n">ExecutorDriver</code><code> </code><code class="n">driver</code><code class="o">,</code><code> </code><code class="n">SlaveInfo</code><code> </code><code class="n">slaveInfo</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><code class="o">}</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO2-5" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO2-5"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/5.png" alt="5" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/5.png"></a><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">error</code><code class="o">(</code><code class="n">ExecutorDriver</code><code> </code><code class="n">driver</code><code class="o">,</code><code> </code><code class="n">java</code><code class="o">.</code><code class="na">lang</code><code class="o">.</code><code class="na">String</code><code> </code><code class="n">message</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><code class="o">}</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO2-6" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO2-6"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/6.png" alt="6" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/6.png"></a></pre></div>
<dl class="calloutlist">
<dt><a class="co" id="callout_building_a_mesos_executor_CO2-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO2-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a></dt>
<dd><p>Framework messages <a data-type="indexterm" data-primary="framework messages" id="fm5"></a>are a simple (but not guaranteed, as we’ll see in the upcoming sidebar) way to communicate between the scheduler and its executors by sending arbitrary data serialized as bytes. Note that framework messages aren’t routed to particular tasks.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO2-2" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO2-2"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a></dt>
<dd><p>This is invoked the first time that an executor connects to the slave. The most common thing to do is get data from the <code>ExecutorInfo</code>, since that can carry executor configuration information in its <code>data</code> field, which contains arbitrary bytes.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO2-3" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO2-3"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a></dt>
<dd><p>This is invoked when the slave disconnects from the executor, which typically indicates a slave restart. Rarely should an executor need to do anything special here.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO2-4" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO2-4"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/4.png" alt="4" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/4.png"></a></dt>
<dd><p>This callback informs the executor to gracefully shut down. It is called when a slave restart fails to complete within the grace period, or when the executor’s framework completes. The executor will be forcibly killed if shutdown doesn’t complete within 5 seconds (the default, configurable on the slave command line with <code>--executor_shutdown_grace_period</code>).</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO2-5" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO2-5"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/5.png" alt="5" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/5.png"></a></dt>
<dd><p>This callback is invoked after a successful slave restart; it contains the new slave’s information.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO2-6" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO2-6"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/6.png" alt="6" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/6.png"></a></dt>
<dd><p>This callback is invoked after a fatal error occurs. When this callback is invoked, the driver is no longer running.</p></dd>
</dl>

<p>As you can see, the executor can actually be a full participant in the slave checkpointing and recovery system; however, you can ignore this for almost all executors.
We’ll make use of some of these callbacks later, but for now, let’s continue by looking at how to actually <a data-type="indexterm" data-primary="executors" data-secondary="callbacks, ignoring" data-startref="ex5ci" id="idp15105296"></a><a data-type="indexterm" data-primary="callbacks, ignoring" data-startref="cb5i" id="idp15106384"></a>launch a task.</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="framework_message">
<h5>Framework Messages Are Unreliable</h5>
<p><code>sendFrameworkMessage</code> <a data-type="indexterm" data-primary="sendFrameworkMessage" id="idp15109520"></a>is just a thin wrapper around the libprocess semantics (see <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch06.html#libprocess_and_actor_model">“Libprocess and the Actor Model”</a> for details), so delivery isn’t guaranteed.
This means that if you use <code>sendFrameworkMessage</code>, your framework must not rely on any guaranteed delivery of messages—you need to handle retries yourself.
But what’s an unreliable delivery useful for, anyway?
In spite of the lack of guarantees, the messages actually will be delivered in all but the most extreme failure conditions of the cluster.
This means that <code>sendFrameworkMessage</code> is great for all sorts of <a data-type="indexterm" data-primary="advisory messages" id="idp15112096"></a>advisory messages.</p>

<p>One such advisory message is <a data-type="indexterm" data-primary="heartbeats/heartbeating" id="idp15113088"></a>a task heartbeat. Your scheduler wants to know whether its tasks are continuing to make progress, or whether they’ve stalled or become deadlocked for whatever reason.
To detect this, simply send a framework message once per minute to the scheduler, and have the scheduler track which executors it hasn’t heard from for 5 or 10 minutes.
If a message is not delivered for some transient reason, we can assume the next one will probably succeed; however, if no messages are delivered over an extended period, that implies that there is a real issue with the executor (or that the network’s having other problems).
We’ll learn how to implement this in <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#executor_adding_heartbeats">“Adding Heartbeats”</a>.</p>

<p>Another use for framework messages is for providing <a data-type="indexterm" data-primary="updates" id="idp15115616"></a><a data-type="indexterm" data-primary="progress updates" id="idp15116224"></a>progress updates that will be consumed by users in the UI.
There are many communication strategies that ensure that it’s not problematic if one update is missed.
For instance, if each update is a completion percentage, the latest update will always subsume earlier updates (since it should always be greater than or equal to the previous value).
Generally, framework messages are good for progress reporting when newer updates supersede earlier ones, and the updates are being used for human, rather than programmatic, consumption.</p>
</div></aside>

<p>We’ll <a data-type="indexterm" data-primary="framework messages" data-startref="fm5" id="idp15117888"></a>start by looking at what data we’ll need to access throughout the executor’s implementation.
These are global variables that are defined in the <code>MyExecutor</code> class (see <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#executor_class_skeleton">Example&nbsp;5-1</a>):</p>
<dl>
<dt><code>Process proc</code></dt>
<dd>
<p>We’ll need to store a reference to the process we launched so that we can wait for it to complete.</p>
</dd>
<dt><code>TaskID taskId</code></dt>
<dd>
<p>We also need to communicate the task’s status to Mesos: the driver API to communicate with our scheduler requires the <code>TaskID</code> as an argument.</p>
</dd>
<dt><code>ExecutorDriver driver</code></dt>
<dd>
<p>Of course, we’ll want to be able to use the driver, so we’ll store a reference to it as well.</p>
</dd>
</dl>

<p>Well-behaved executors should keep Mesos up-to-date with the status of their tasks.
Since sending <a data-type="indexterm" data-primary="executors" data-secondary="reimplementing the CommandExecutor" data-tertiary="ignoring callbacks" data-startref="ex5rtceicb" id="idp15125712"></a><a data-type="indexterm" data-primary="status updates" id="idp15127040"></a><a data-type="indexterm" data-primary="updates" id="idp15127648"></a>status updates has some boilerplate, we’ll write a convenience method, shown <a data-type="indexterm" data-primary="executors" data-secondary="reimplementing the CommandExecutor" data-tertiary="status update helper" id="idp15128384"></a>in <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#status_update_convenience_method">Example&nbsp;5-4</a>.</p>
<div id="status_update_convenience_method" data-type="example">
<h5><span class="label">Example 5-4. </span>Status update helper</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">private</code> <code class="kt">void</code> <code class="nf">statusUpdate</code><code class="o">(</code><code class="n">TaskState</code> <code class="n">state</code><code class="o">)</code> <code class="o">{</code>
    <code class="n">TaskStatus</code> <code class="n">status</code> <code class="o">=</code> <code class="n">TaskStatus</code><code class="o">.</code><code class="na">newBuilder</code><code class="o">()</code>
        <code class="o">.</code><code class="na">setTaskId</code><code class="o">(</code><code class="n">taskId</code><code class="o">)</code>
        <code class="o">.</code><code class="na">setState</code><code class="o">(</code><code class="n">state</code><code class="o">)</code>
        <code class="o">.</code><code class="na">build</code><code class="o">()</code>
    <code class="n">driver</code><code class="o">.</code><code class="na">sendStatusUpdate</code><code class="o">(</code><code class="n">status</code><code class="o">);</code>
<code class="o">}</code></pre></div>

<p>Here, we simply construct a bare-bones task status and send it via the driver.
Sometimes, you’ll want to communicate additional information.
Like most Mesos protobufs, <code>TaskStatus</code> <a data-type="indexterm" data-primary="TaskStatus" id="idp15170416"></a>supports arbitrary data, as well as a human-readable message.</p>

<p>In order to keep this example simple, our executor will only support running a single task, after which it will exit.
We’ll enforce this invariant with a helper function, <a data-type="indexterm" data-primary="executors" data-secondary="reimplementing the CommandExecutor" data-tertiary="ensuring a single task" id="idp15171760"></a>as seen in <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#ensure_one_launch_method">Example&nbsp;5-5</a>.</p>
<div id="ensure_one_launch_method" data-type="example">
<h5><span class="label">Example 5-5. </span>Ensuring a single task</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">private</code><code> </code><code class="kt">boolean</code><code> </code><code class="nf">ensureOneLaunch</code><code class="o">(</code><code class="n">ExecutorDriver</code><code> </code><code class="n">driver</code><code class="o">,</code><code> </code><code class="n">TaskID</code><code> </code><code class="n">id</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO3-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO3-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a><code>
</code><code>    </code><code class="k">if</code><code> </code><code class="o">(</code><code class="k">this</code><code class="o">.</code><code class="na">taskId</code><code> </code><code class="o">!</code><code class="o">=</code><code> </code><code class="kc">null</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO3-2" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO3-2"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a><code>
</code><code>        </code><code class="n">TaskStatus</code><code> </code><code class="n">status</code><code> </code><code class="o">=</code><code> </code><code class="n">TaskStatus</code><code class="o">.</code><code class="na">newBuilder</code><code class="o">(</code><code class="o">)</code><code>
</code><code>            </code><code class="o">.</code><code class="na">setTaskId</code><code class="o">(</code><code class="n">id</code><code class="o">)</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO3-3" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO3-3"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a><code>
</code><code>            </code><code class="o">.</code><code class="na">setState</code><code class="o">(</code><code class="n">TaskState</code><code class="o">.</code><code class="na">TASK_ERROR</code><code class="o">)</code><code>
</code><code>            </code><code class="o">.</code><code class="na">setMessage</code><code class="o">(</code><code class="s">"this executor only can run a single task"</code><code class="o">)</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO3-4" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO3-4"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/4.png" alt="4" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/4.png"></a><code>
</code><code>            </code><code class="o">.</code><code class="na">build</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">sendStatusUpdate</code><code class="o">(</code><code class="n">status</code><code class="o">)</code><code class="o">;</code><code>
</code><code>        </code><code class="k">return</code><code> </code><code class="kc">false</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code> </code><code class="k">else</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="k">return</code><code> </code><code class="kc">true</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code class="o">}</code></pre></div>
<dl class="calloutlist">
<dt><a class="co" id="callout_building_a_mesos_executor_CO3-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO3-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a></dt>
<dd><p>We’ll return <code>true</code> if this is the first task, and <code>false</code> if it should be ignored.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO3-2" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO3-2"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a></dt>
<dd><p>The code that launches our task will set the value of <code>this.taskId</code>. Thus, we can assume that if <code>this.taskId</code> was already set, we’ve already launched a task, so this one is invalid.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO3-3" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO3-3"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a></dt>
<dd><p>Note that we use the <code>TaskID</code> <a data-type="indexterm" data-primary="TaskID" id="idp15336176"></a>of the newly requested task, not the running task.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO3-4" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO3-4"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/4.png" alt="4" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/4.png"></a></dt>
<dd><p>We’ll take advantage of the human-readable message in the status update to help the user diagnose why the task launch resulted in an error.</p></dd>
</dl>

<p><a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#start_process_defn">Example&nbsp;5-6</a> illustrates how we actually launch a process.
We’ll take the configuration JSON object as an input, and we’ll return the newly started process.
To help separate our logs, we’ll redirect the task process’s <code>stdout</code> and <code>stderr</code> to different files than the executor’s <code>stdout</code> and <code>stderr</code>.
For now, the task JSON will have only a single key: <code>"cmd"</code>, which is the command line to run the task.
We’ll invoke the task with a shell for <a data-type="indexterm" data-primary="executors" data-secondary="reimplementing the CommandExecutor" data-tertiary="starting a process" id="idp15322720"></a>simplicity.</p>
<div id="start_process_defn" data-type="example">
<h5><span class="label">Example 5-6. </span>Starting a process</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">private</code><code> </code><code class="n">Process</code><code> </code><code class="nf">startProcess</code><code class="o">(</code><code class="n">JSONObject</code><code> </code><code class="n">cfg</code><code class="o">)</code><code> </code><code class="kd">throws</code><code> </code><code class="n">Exception</code><code class="o">{</code><code>
</code><code>    </code><code class="n">List</code><code class="o">&lt;</code><code class="n">String</code><code class="o">&gt;</code><code> </code><code class="n">cmdArgs</code><code> </code><code class="o">=</code><code> </code><code class="n">Arrays</code><code class="o">.</code><code class="na">asList</code><code class="o">(</code><code class="s">"bash"</code><code class="o">,</code><code> </code><code class="s">"-c"</code><code class="o">,</code><code> </code><code class="n">cfg</code><code class="o">.</code><code class="na">getString</code><code class="o">(</code><code class="s">"cmd"</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO4-1a" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO4-1a"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a><code>
</code><code>    </code><code class="n">ProcessBuilder</code><code> </code><code class="n">pb</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">ProcessBuilder</code><code class="o">(</code><code class="n">cmdArgs</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO4-2a" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO4-2a"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a><code>
</code><code>    </code><code class="n">File</code><code> </code><code class="n">stdoutFile</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">File</code><code class="o">(</code><code class="n">System</code><code class="o">.</code><code class="na">getenv</code><code class="o">(</code><code class="s">"MESOS_DIRECTORY"</code><code class="o">)</code><code class="o">,</code><code> </code><code class="s">"child_stdout"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO4-3a" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO4-3a"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a><code>
</code><code>    </code><code class="n">File</code><code> </code><code class="n">stderrFile</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">File</code><code class="o">(</code><code class="n">System</code><code class="o">.</code><code class="na">getenv</code><code class="o">(</code><code class="s">"MESOS_DIRECTORY"</code><code class="o">)</code><code class="o">,</code><code> </code><code class="s">"child_stderr"</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO4-3a"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a><code>
</code><code>    </code><code class="n">pb</code><code class="o">.</code><code class="na">redirectOutput</code><code class="o">(</code><code class="n">Redirect</code><code class="o">.</code><code class="na">to</code><code class="o">(</code><code class="n">stdoutFile</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO4-4a" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO4-4a"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/4.png" alt="4" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/4.png"></a><code>
</code><code>    </code><code class="n">pb</code><code class="o">.</code><code class="na">redirectError</code><code class="o">(</code><code class="n">Redirect</code><code class="o">.</code><code class="na">to</code><code class="o">(</code><code class="n">stderrFile</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO4-4a"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/4.png" alt="4" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/4.png"></a><code>
</code><code>    </code><code class="k">return</code><code> </code><code class="n">pb</code><code class="o">.</code><code class="na">start</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_building_a_mesos_executor_CO4-1a" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO4-1a"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a></dt>
<dd><p>We build the argument vector for the process we will launch.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO4-2a" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO4-2a"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a></dt>
<dd><p>The <code>ProcessBuilder</code> API is a simple way to launch a process in Java.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO4-3a" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO4-3a"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a></dt>
<dd><p>The path to the executor’s scratch space is placed into the environment variable <code>MESOS_DIRECTORY</code> by the slave. It’s best to write any output into this directory, since it’s automatically garbage collected when the slave needs to reclaim disk space after the executor exits.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO4-4a" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO4-4a"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/4.png" alt="4" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/4.png"></a></dt>
<dd><p>We redirect the task process’s output.</p></dd>
</dl></div>

<p>At this point, we’re finally ready to handle launching a task.
To do so, we must implement the <code>launchTask</code> callback <a data-type="indexterm" data-primary="launchTasks" id="idp15502880"></a><a data-type="indexterm" data-primary="executors" data-secondary="reimplementing the CommandExecutor" data-tertiary="implementing launchTask" id="ex5rtceilt"></a>of the <code>Executor</code> interface (see <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#launch_task_executor_impl">Example&nbsp;5-7</a>).</p>
<div id="launch_task_executor_impl" data-type="example">
<h5><span class="label">Example 5-7. </span>Implementing launchTask</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">launchTask</code><code class="o">(</code><code class="n">ExecutorDriver</code><code> </code><code class="n">driver</code><code class="o">,</code><code> </code><code class="n">TaskInfo</code><code> </code><code class="n">task</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="kd">synchronized</code><code> </code><code class="o">(</code><code class="k">this</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO4-1c" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO4-1c"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a><code>
</code><code>        </code><code class="k">try</code><code> </code><code class="o">{</code><code>
</code><code>            </code><code class="k">if</code><code> </code><code class="o">(</code><code class="o">!</code><code class="n">ensureOneLaunch</code><code class="o">(</code><code class="n">driver</code><code class="o">,</code><code> </code><code class="n">task</code><code class="o">.</code><code class="na">getTaskId</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO4-2c" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO4-2c"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a><code>
</code><code>                </code><code class="k">return</code><code class="o">;</code><code>
</code><code>            </code><code class="o">}</code><code>
</code><code>
</code><code>            </code><code class="k">this</code><code class="o">.</code><code class="na">taskId</code><code> </code><code class="o">=</code><code> </code><code class="n">task</code><code class="o">.</code><code class="na">getTaskId</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO4-3c" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO4-3c"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a><code>
</code><code>            </code><code class="k">this</code><code class="o">.</code><code class="na">driver</code><code> </code><code class="o">=</code><code> </code><code class="n">driver</code><code class="o">;</code><code> </code><a class="co" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO4-3c"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a><code>
</code><code>
</code><code>            </code><code class="n">statusUpdate</code><code class="o">(</code><code class="n">TaskState</code><code class="o">.</code><code class="na">TASK_STARTING</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO4-4c" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO4-4c"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/4.png" alt="4" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/4.png"></a><code>
</code><code>
</code><code>            </code><code class="kt">byte</code><code class="o">[</code><code class="o">]</code><code> </code><code class="n">taskData</code><code> </code><code class="o">=</code><code> </code><code class="n">task</code><code class="o">.</code><code class="na">getData</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">toByteArray</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO4-5c" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO4-5c"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/5.png" alt="5" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/5.png"></a><code>
</code><code>            </code><code class="n">JSONObject</code><code> </code><code class="n">cfg</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">JSONObject</code><code class="o">(</code><code class="k">new</code><code> </code><code class="n">String</code><code class="o">(</code><code class="n">taskData</code><code class="o">,</code><code> </code><code class="s">"UTF-8"</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>
</code><code>            </code><code class="k">this</code><code class="o">.</code><code class="na">proc</code><code> </code><code class="o">=</code><code> </code><code class="n">startProcess</code><code class="o">(</code><code class="n">cfg</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO4-3c"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a><code> </code><a class="co" id="co_building_a_mesos_executor_CO4-6c" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO4-6c"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/6.png" alt="6" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/6.png"></a><code>
</code><code>
</code><code>            </code><code class="n">statusUpdate</code><code class="o">(</code><code class="n">TaskState</code><code class="o">.</code><code class="na">TASK_RUNNING</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO4-4c"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/4.png" alt="4" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/4.png"></a><code>
</code><code>
</code><code>            </code><code class="n">Thread</code><code> </code><code class="n">t</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">Thread</code><code class="o">(</code><code class="k">this</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO4-7c" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO4-7c"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/7.png" alt="7" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/7.png"></a><code>
</code><code>            </code><code class="n">t</code><code class="o">.</code><code class="na">setDaemon</code><code class="o">(</code><code class="kc">true</code><code class="o">)</code><code class="o">;</code><code>
</code><code>            </code><code class="n">t</code><code class="o">.</code><code class="na">start</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>
</code><code>        </code><code class="o">}</code><code> </code><code class="k">catch</code><code> </code><code class="o">(</code><code class="n">Exception</code><code> </code><code class="n">e</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>            </code><code class="n">e</code><code class="o">.</code><code class="na">printStackTrace</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO4-8c" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO4-8c"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/8.png" alt="8" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/8.png"></a><code>
</code><code>        </code><code class="o">}</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_building_a_mesos_executor_CO4-1c" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO4-1c"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a></dt>
<dd><p>To protect access to all global variables, we put a mutex around all the concurrent code in the executor.<sup><a data-type="noteref" id="idp15583072-marker" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#idp15583072" class="totri-footnote">1</a></sup></p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO4-2c" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO4-2c"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a></dt>
<dd><p>We check that this is the first task we’ve received. If it isn’t, we’ll do nothing and just <code>return</code>.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO4-3c" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO4-3c"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a></dt>
<dd><p>We store a few things to which we have access in this callback into global variables: the <code>TaskID</code>, the <code>ExecutorDriver</code>, and the <code>Process</code>, as explained earlier.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO4-4c" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO4-4c"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/4.png" alt="4" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/4.png"></a></dt>
<dd><p>As we process the task, we keep Mesos informed of our progress.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO4-5c" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO4-5c"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/5.png" alt="5" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/5.png"></a></dt>
<dd><p>The details of the task must be extracted and parsed.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO4-6c" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO4-6c"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/6.png" alt="6" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/6.png"></a></dt>
<dd><p>Finally, we can start the process.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO4-7c" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO4-7c"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/7.png" alt="7" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/7.png"></a></dt>
<dd><p>We’ll need to watch the process to know when it completes, and whether it completes successfully. We’ll look at the implementation of this completion monitoring thread next.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO4-8c" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO4-8c"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/8.png" alt="8" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/8.png"></a></dt>
<dd><p>In real production code, you should try to make it easier to diagnose what goes wrong in executor code. This is easiest to do by also transmitting exceptions via <code>StatusUpdate</code> if they’re fatal.</p></dd>
</dl></div>

<p>At <a data-type="indexterm" data-primary="executors" data-secondary="reimplementing the CommandExecutor" data-tertiary="implementing launchTask" data-startref="ex5rtceilt" id="idp15821792"></a>this point, we nearly know the entirety of how our executor goes about managing the lifecycle of its task.
<a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#executor_basic_thread_impl">Example&nbsp;5-8</a> illustrates how we track the completion of the <a data-type="indexterm" data-primary="executors" data-secondary="reimplementing the CommandExecutor" data-tertiary="waiting for process to finish" id="idp15824112"></a>task.</p>
<div id="executor_basic_thread_impl" data-type="example">
<h5><span class="label">Example 5-8. </span>Waiting for the process to finish</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">run</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="kt">int</code><code> </code><code class="n">exitCode</code><code class="o">;</code><code>
</code><code>    </code><code class="k">try</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="n">exitCode</code><code> </code><code class="o">=</code><code> </code><code class="n">proc</code><code class="o">.</code><code class="na">waitFor</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO4-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO4-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a><code>
</code><code>    </code><code class="o">}</code><code> </code><code class="k">catch</code><code> </code><code class="o">(</code><code class="n">Exception</code><code> </code><code class="n">e</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="n">exitCode</code><code> </code><code class="o">=</code><code> </code><code class="o">-</code><code class="mi">99</code><code class="o">;</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO4-2" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO4-2"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>    </code><code class="kd">synchronized</code><code> </code><code class="o">(</code><code class="k">this</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO4-3" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO4-3"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a><code>
</code><code>        </code><code class="k">if</code><code> </code><code class="o">(</code><code class="n">proc</code><code> </code><code class="o">=</code><code class="o">=</code><code> </code><code class="kc">null</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO4-4" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO4-4"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/4.png" alt="4" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/4.png"></a><code>
</code><code>            </code><code class="k">return</code><code class="o">;</code><code>
</code><code>        </code><code class="o">}</code><code>
</code><code>        </code><code class="n">proc</code><code> </code><code class="o">=</code><code> </code><code class="kc">null</code><code class="o">;</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO4-5" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO4-5"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/5.png" alt="5" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/5.png"></a><code>
</code><code>        </code><code class="k">if</code><code> </code><code class="o">(</code><code class="n">exitCode</code><code> </code><code class="o">=</code><code class="o">=</code><code> </code><code class="mi">0</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO4-6" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO4-6"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/6.png" alt="6" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/6.png"></a><code>
</code><code>            </code><code class="n">statusUpdate</code><code class="o">(</code><code class="n">TaskState</code><code class="o">.</code><code class="na">TASK_FINISHED</code><code class="o">)</code><code class="o">;</code><code>
</code><code>        </code><code class="o">}</code><code> </code><code class="k">else</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO4-7" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO4-7"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/7.png" alt="7" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/7.png"></a><code>
</code><code>            </code><code class="n">driver</code><code class="o">.</code><code class="na">sendStatusUpdate</code><code class="o">(</code><code class="n">TaskStatus</code><code class="o">.</code><code class="na">newBuilder</code><code class="o">(</code><code class="o">)</code><code>
</code><code>                    </code><code class="o">.</code><code class="na">setTaskId</code><code class="o">(</code><code class="n">taskId</code><code class="o">)</code><code>
</code><code>                    </code><code class="o">.</code><code class="na">setState</code><code class="o">(</code><code class="n">TaskState</code><code class="o">.</code><code class="na">TASK_FAILED</code><code class="o">)</code><code>
</code><code>                    </code><code class="o">.</code><code class="na">setMessage</code><code class="o">(</code><code class="s">"Process exited with code "</code><code> </code><code class="o">+</code><code> </code><code class="n">exitCode</code><code class="o">)</code><code>
</code><code>                    </code><code class="o">.</code><code class="na">build</code><code class="o">(</code><code class="o">)</code><code class="o">)</code><code class="o">;</code><code>
</code><code>        </code><code class="o">}</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>    </code><code class="n">driver</code><code class="o">.</code><code class="na">stop</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO4-8" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO4-8"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/8.png" alt="8" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/8.png"></a><code>
</code><code class="o">}</code></pre></div>
<dl class="calloutlist">
<dt><a class="co" id="callout_building_a_mesos_executor_CO4-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO4-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a></dt>
<dd><p><code>waitFor()</code> will block until the process terminates, and it returns the process’s exit code.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO4-2" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO4-2"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a></dt>
<dd><p>If <code>waitFor()</code> throws an exception for some reason, we’ll assume something went terribly wrong and use a distinctive exit code to signal that.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO4-3" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO4-3"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a></dt>
<dd><p>As mentioned before, the mutex on <code>this</code> protects access to the global variables.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO4-4" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO4-4"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/4.png" alt="4" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/4.png"></a></dt>
<dd><p>If we reach this point and <code>proc</code> is <code>null</code>, this is a special signal that means that process was killed by <code>killTask</code> (which we haven’t seen yet). In that case, our work’s already done.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO4-5" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO4-5"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/5.png" alt="5" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/5.png"></a></dt>
<dd><p>By setting <code>proc</code> to <code>null</code>, we set that special signal from above.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO4-6" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO4-6"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/6.png" alt="6" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/6.png"></a></dt>
<dd><p>When the process exits with a successful status, we report that the task finished (remember, <code>FINISHED</code> is a successful status in Mesos).</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO4-7" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO4-7"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/7.png" alt="7" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/7.png"></a></dt>
<dd><p>Otherwise, we know that the task failed, and so we send a <code>FAILED</code> status.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO4-8" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO4-8"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/8.png" alt="8" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/8.png"></a></dt>
<dd><p>We <code>stop()</code> the executor driver at this point, so that our <code>main</code> function can return and the executor will gracefully shut down.</p></dd>
</dl>

<p>We’ve seen how our new executor handles accepting a task, starting a process, and sending the appropriate status updates when that process finishes.
All we have left is to handle requests from the scheduler to kill the task early.
<a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#executor_killtask_impl">Example&nbsp;5-9</a> shows how to handle <a data-type="indexterm" data-primary="killTask" id="idp15980688"></a><a data-type="indexterm" data-primary="executors" data-secondary="reimplementing the CommandExecutor" data-tertiary="implementing killTask" id="idp15981360"></a>a <code>killTask</code> message.</p>
<div id="executor_killtask_impl" data-type="example">
<h5><span class="label">Example 5-9. </span>Implementation of killTask</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">killTask</code><code class="o">(</code><code class="n">ExecutorDriver</code><code> </code><code class="n">driver</code><code class="o">,</code><code> </code><code class="n">TaskID</code><code> </code><code class="n">taskId</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="kd">synchronized</code><code> </code><code class="o">(</code><code class="k">this</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO5-1e" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO5-1e"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a><code>
</code><code>        </code><code class="k">if</code><code> </code><code class="o">(</code><code class="n">proc</code><code> </code><code class="o">!</code><code class="o">=</code><code> </code><code class="kc">null</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO5-2e" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO5-2e"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a><code>
</code><code>                </code><code class="o">&amp;</code><code class="o">&amp;</code><code> </code><code class="n">taskId</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="k">this</code><code class="o">.</code><code class="na">taskId</code><code class="o">)</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO5-3e" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO5-3e"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a><code>
</code><code>            </code><code class="n">proc</code><code class="o">.</code><code class="na">destroy</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO5-4e" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO5-4e"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/4.png" alt="4" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/4.png"></a><code>
</code><code>            </code><code class="n">statusUpdate</code><code class="o">(</code><code class="n">TaskState</code><code class="o">.</code><code class="na">TASK_KILLED</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO5-5e" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO5-5e"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/5.png" alt="5" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/5.png"></a><code>
</code><code>            </code><code class="n">proc</code><code> </code><code class="o">=</code><code> </code><code class="kc">null</code><code class="o">;</code><code>
</code><code>        </code><code class="o">}</code><code>
</code><code>        </code><code class="n">driver</code><code class="o">.</code><code class="na">stop</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code class="o">}</code></pre>
<dl class="calloutlist">
<dt><a class="co" id="callout_building_a_mesos_executor_CO5-1e" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO5-1e"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a></dt>
<dd><p>As mentioned before, we must protect all access to global variables with a mutex.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO5-2e" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO5-2e"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a></dt>
<dd><p>If <code>proc</code> is <code>null</code>, then the process has already died, either because it finished or because of an earlier <code>killTask</code>.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO5-3e" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO5-3e"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a></dt>
<dd><p>We should also ensure that the task we’re running is the task we’re supposed to kill. This isn’t strictly necessary for our one-task executor, but it protects us from programming errors in the scheduler, in which we send kill messages to the wrong executor.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO5-4e" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO5-4e"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/4.png" alt="4" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/4.png"></a></dt>
<dd><p>We kill the process.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO5-5e" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO5-5e"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/5.png" alt="5" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/5.png"></a></dt>
<dd><p>We inform Mesos that the task was killed as per the user’s request. Note the possible race condition if the thread crashes after calling <code>destroy()</code> but before sending the status update: Mesos might believe the task is still running. This is why we set <code>proc</code> to <code>null</code> afterward—it will ensure that a second kill message from the scheduler will cause the <code>TASK_KILLED</code> message to be resent.</p></dd>
</dl>
</div>

<p>We have now seen the entirety of how to implement a basic executor with functionality similar to the <code>CommandExecutor</code>.
Of course, you might be wondering how to actually use this executor from your scheduler.
To integrate this executor with our example scheduler from <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch04.html#chapter_creating_new_scheduler">Chapter&nbsp;4</a>, we’ll simply need to update the <code>makeTask</code> method of the <code>Job</code> object, as <a data-type="indexterm" data-primary="makeTask" id="idp16209872"></a><a data-type="indexterm" data-primary="executors" data-secondary="reimplementing the CommandExecutor" data-tertiary="makeTask updating" id="ex5rtceilt2"></a>shown in <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#custom_executor_maketask">Example&nbsp;5-10</a>.</p>
<div id="custom_executor_maketask" data-type="example">
<h5><span class="label">Example 5-10. </span>Enhanced makeTask for our new executor</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code><code> </code><code class="n">TaskInfo</code><code> </code><code class="nf">makeTask</code><code class="o">(</code><code class="n">SlaveID</code><code> </code><code class="n">targetSlave</code><code class="o">,</code><code> </code><code class="n">FrameworkID</code><code> </code><code class="n">fid</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="n">TaskID</code><code> </code><code class="n">id</code><code> </code><code class="o">=</code><code> </code><code class="n">TaskID</code><code class="o">.</code><code class="na">newBuilder</code><code class="o">(</code><code class="o">)</code><code>
</code><code>        </code><code class="o">.</code><code class="na">setValue</code><code class="o">(</code><code class="k">this</code><code class="o">.</code><code class="na">id</code><code class="o">)</code><code>
</code><code>        </code><code class="o">.</code><code class="na">build</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="n">ExecutorID</code><code> </code><code class="n">eid</code><code> </code><code class="o">=</code><code> </code><code class="n">ExecutorID</code><code class="o">.</code><code class="na">newBuilder</code><code class="o">(</code><code class="o">)</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO5-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO5-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a><code>
</code><code>        </code><code class="o">.</code><code class="na">setValue</code><code class="o">(</code><code class="k">this</code><code class="o">.</code><code class="na">id</code><code class="o">)</code><code>
</code><code>        </code><code class="o">.</code><code class="na">build</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="n">CommandInfo</code><code> </code><code class="n">ci</code><code> </code><code class="o">=</code><code> </code><code class="n">CommandInfo</code><code class="o">.</code><code class="na">newBuilder</code><code class="o">(</code><code class="o">)</code><code>
</code><code>        </code><code class="o">.</code><code class="na">setValue</code><code class="o">(</code><code class="s">"java -jar /path/to/custom/executor.jar"</code><code class="o">)</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO5-2" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO5-2"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a><code>
</code><code>        </code><code class="o">.</code><code class="na">build</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="n">ExecutorInfo</code><code> </code><code class="n">executor</code><code> </code><code class="o">=</code><code> </code><code class="n">ExecutorInfo</code><code class="o">.</code><code class="na">newBuilder</code><code class="o">(</code><code class="o">)</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO5-3" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO5-3"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a><code>
</code><code>        </code><code class="o">.</code><code class="na">setExecutorId</code><code class="o">(</code><code class="n">eid</code><code class="o">)</code><code>
</code><code>        </code><code class="o">.</code><code class="na">setFrameworkId</code><code class="o">(</code><code class="n">fid</code><code class="o">)</code><code>
</code><code>        </code><code class="o">.</code><code class="na">setCommand</code><code class="o">(</code><code class="n">ci</code><code class="o">)</code><code>
</code><code>        </code><code class="o">.</code><code class="na">build</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="n">JSONObject</code><code> </code><code class="n">cfg</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">JSONObject</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="k">try</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="n">cfg</code><code class="o">.</code><code class="na">put</code><code class="o">(</code><code class="s">"cmd"</code><code class="o">,</code><code> </code><code class="k">this</code><code class="o">.</code><code class="na">command</code><code class="o">)</code><code class="o">;</code><code>
</code><code>        </code><code class="k">return</code><code> </code><code class="n">TaskInfo</code><code class="o">.</code><code class="na">newBuilder</code><code class="o">(</code><code class="o">)</code><code>
</code><code>            </code><code class="c1">// ... Elided unchanged code ... </code><a class="co" id="co_building_a_mesos_executor_CO5-4" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO5-4"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/4.png" alt="4" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/4.png"></a><code class="c1">
</code><code>            </code><code class="o">.</code><code class="na">setExecutor</code><code class="o">(</code><code class="n">executor</code><code class="o">)</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO5-5" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO5-5"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/5.png" alt="5" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/5.png"></a><code>
</code><code>            </code><code class="o">.</code><code class="na">setData</code><code class="o">(</code><code class="n">ByteString</code><code class="o">.</code><code class="na">copyFrom</code><code class="o">(</code><code class="n">cfg</code><code class="o">.</code><code class="na">toString</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">getBytes</code><code class="o">(</code><code class="s">"UTF-8"</code><code class="o">)</code><code class="o">)</code><code class="o">)</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO5-6" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO5-6"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/6.png" alt="6" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/6.png"></a><code>
</code><code>            </code><code class="o">.</code><code class="na">build</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code> </code><code class="k">catch</code><code> </code><code class="o">(</code><code class="n">Exception</code><code> </code><code class="n">e</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="n">e</code><code class="o">.</code><code class="na">printStackTrace</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>
</code><code>        </code><code class="k">throw</code><code> </code><code class="k">new</code><code> </code><code class="nf">RuntimeException</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code class="o">}</code></pre></div>
<dl class="calloutlist">
<dt><a class="co" id="callout_building_a_mesos_executor_CO5-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO5-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a></dt>
<dd><p>We need to explicitly assign our executor an ID. The <code>CommandExecutor</code> uses the same ID for the task and executor, so we’ll do that too.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO5-2" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO5-2"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a></dt>
<dd><p>You’ll need to build the custom executor’s <em>.jar</em> and distribute it to your slaves. In the next section, we’ll look at some approaches to this.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO5-3" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO5-3"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a></dt>
<dd><p>The <code>ExecutorInfo</code> requires several pieces of information, including the <code>FrameworkID</code>. The scheduler was trivially modified to pass it to <code>makeTask</code>.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO5-4" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO5-4"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/4.png" alt="4" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/4.png"></a></dt>
<dd><p>The unchanged configuration to the <code>TaskInfo</code> is not repeated here (refer back to <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch04.html#maketask_urb">Example&nbsp;4-3</a>). We did, however, drop the <code>.setCommand(...)</code>, since now we’re setting the executor.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO5-5" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO5-5"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/5.png" alt="5" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/5.png"></a></dt>
<dd><p><code>TaskInfo</code> must have exactly one of the command or executor set, but never both—that’s an error.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO5-6" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO5-6"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/6.png" alt="6" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/6.png"></a></dt>
<dd><p>Finally, we include the JSON configuration of the task.</p></dd>
</dl>

<p>That’s all there is to it!
Now we’ve enhanced our scheduler from <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch04.html#chapter_creating_new_scheduler">Chapter&nbsp;4</a> to support our new, custom <a data-type="indexterm" data-primary="executors" data-secondary="reimplementing the CommandExecutor" data-startref="ex5rtce" id="idp16388176"></a>executor.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Bootstrapping Executor Installation"><div class="sect1" id="idp14400848">
<h1>Bootstrapping Executor Installation</h1>

<p>One <a data-type="indexterm" data-primary="executors" data-secondary="deployment solutions" id="ex5ds"></a><a data-type="indexterm" data-primary="executors" data-secondary="scalability issues" id="ex5si"></a>challenge in creating your own executor is deploying the binaries everywhere.
We’ll look at four solutions to this problem, and weigh their pros and cons:</p>
<dl>
<dt>Use HDFS, S3, or another non-POSIX store</dt>
<dd>
<p>Any Mesos executor can list a set of URIs that will be downloaded and optionally unzipped into the local working directory before the executor is launched.
Mesos has built-in support for HTTP, FTP, and HDFS stores to download files (see <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch04.html#configuring_process_environment">“Configuring the process’s environment”</a>).
As a result, you can easily host your applications on a local <a data-type="indexterm" data-primary="HDFS storage" id="idp16257552"></a>HDFS cluster, <a data-type="indexterm" data-primary="Amazon S3 storage" id="idp16258352"></a>Amazon S3, or another data store to avoid the need to deploy any new technologies, as the other strategies might require.
The challenge is that this data store must be sufficiently scalable to be able to deliver the container to every concurrently launching task.
A common reason that a newly developed framework falls over during scalability testing is that it launches hundreds of executors simultaneously;
these executors all simultaneously request their binaries from a single server, which kills the server.
This is commonly known as <a data-type="indexterm" data-primary="thundering herd problem" id="idp16259744"></a>the <a href="http://bit.ly/thunderingherdwiki">thundering herd problem</a>.
Make sure that you sufficiently replicate the server that offers the binaries, or use a system with proven scalability, like S3.</p>

<p>The “next-level” version of this approach is to actually host the binaries in the scheduler process itself, by having the scheduler run an embedded HTTP server.
Of course, this will exacerbate the thundering herd problem.
The solution is to have the scheduler stagger the launch times of tasks, to ensure that the server is never overwhelmed.
This is done by waiting for a random duration before submitting the launch to Mesos.</p>
</dd>
<dt>Use a <a data-type="indexterm" data-primary="configuration management systems" id="idp16526464"></a>configuration management system</dt>
<dd>
<p>Many Mesos clusters will be deployed using a configuration management system like <a data-type="indexterm" data-primary="Chef" id="idp16527888"></a><a data-type="indexterm" data-primary="Puppet" id="idp16528592"></a><a data-type="indexterm" data-primary="Ansible" id="idp16529264"></a>Chef, Puppet, or Ansible.
If this applies to your cluster, then you can also use that system to push your executor binaries out to every slave in your Mesos cluster.
The benefit to this is that you can ensure that the binaries are always immediately available to launch tasks—you don’t need to wait for them to download or run the risk of an untimely network failure that causes your tasks to become <code>LOST</code>.
The downside, however, is that deploying and upgrading to a new version of the executor is more difficult.
Of course, you’ll want to version every deployed executor (to ensure that multiple versions can be running concurrently, during upgrades);
nevertheless, it can be extremely tedious during development to wait for the executor to be pushed out to all slaves.</p>
</dd>
<dt>Use a shared POSIX filesystem</dt>
<dd>
<p>Often, <a data-type="indexterm" data-primary="POSIX shared filesystems" id="idp16532528"></a><a data-type="indexterm" data-primary="shared filesystems" id="idp16533232"></a>a compute cluster already has a shared POSIX-compatible filesystem.
Some popular choices here are <a href="http://bit.ly/NFSwiki">NFS</a> and <a href="http://www.gluster.org/">GlusterFS</a>.
The shared filesystem approach is similar to the configuration management approach: in both cases, your executor exists at a known path.
The benefit of having that path be on a shared filesystem is that you don’t need to wait for the configuration management system to actually push the binaries out to every slave;
instead, you can immediately launch the executor as soon as it has been copied onto the shared filesystem.
The downside is that it can be difficult to scale the shared filesystem, and if it fails, your entire cluster goes down.</p>
</dd>
<dt>Use Docker</dt>
<dd>
<p>Mesos has first-class support for <a data-type="indexterm" data-primary="Docker" data-secondary="for executor deployment" id="idp16244624"></a>Docker containers (see <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch06.html#docker_support">“Using Docker”</a>), which are themselves a way to ship around complete binary images.
Once you Dockerize your executor, you can start that container on any slave in the cluster.
The challenge here is the Docker repository:
you must find a Docker repository (be it <a href="https://hub.docker.com/">Docker Hub</a> or a self-hosted one) that can host your Docker containers
with sufficient scalability and security.
The most common pitfall with this approach is the time to download a Docker <a data-type="indexterm" data-primary="executors" data-secondary="scalability issues" data-startref="ex5si" id="idp16247664"></a>container:
when a Docker container takes 10 minutes to download, the executor launch might time out.
This has the symptom of unpredictable, transient <code>LOST</code> tasks.</p>
</dd>
</dl>

<p>Now that we’ve reviewed several options, how do you choose the right one?
If you are already heavily using Docker, then I recommend continuing with Docker to host your Mesos executors.
Otherwise, if you have a shared POSIX filesystem, that option offers the fastest and easiest development.
If you would rather avoid the challenge of setting up a shared POSIX filesystem for this purpose, then serving the binaries from HDFS or S3 still offers rapid deployment, and nearly everyone has this capability.
Using a configuration management system does centralize deployment, but it dramatically slows down your ability to redeploy a newer or older version of an executor, and so it is an option of last resort.</p>
<div data-type="tip"><h1>Fetcher Cache</h1>
<p>In Mesos 0.23, a <a data-type="indexterm" data-primary="fetcher cache" id="idp16252048"></a>new feature called the <em>fetcher cache</em> was released.
The fetcher cache seeks to reduce the load on S3, HDFS, or other filesystems by caching executor downloads on every slave, so that they’re downloaded only once per slave.
Although this doesn’t eliminate the scalability challenges with shared filesystems, it should help a lot.
To fully take advantage of the fetcher cache and improve scalability, ensure that your scheduler staggers the launch of executors.
That way, there will never be too many simultaneous requests to the shared filesystem, and the fetcher cache will further reduce the load.
The fetcher cache guarantees that each artifact will be fetched once per slave; even if multiple executors request an artifact, they’ll all wait for the single download.</p>

<p>To use the fetcher cache, you simply set <code>cache</code> to <code>true</code> in your <code>URI</code> protobuf in the <code>TaskInfo</code>.
The fetcher cache is isolated by user, since it simply uses the URI as the key.
In the future, there will be a way to bypass or purge the cache, but in the meantime, each URI should be unique for each different version of the resource’s content.</p>
</div>

<p>In any case, remember that your scheduler specifies exactly from where and how to fetch and launch the executor.
Consequently, each version of a scheduler can choose to launch different forwards- and/or backwards-compatible versions of the executor.
By ensuring that your scheduler always launches a compatible executor, you can generally avoid internal version mismatches in your <a data-type="indexterm" data-primary="executors" data-secondary="deployment solutions" data-startref="ex5ds" id="idp16551568"></a><a data-type="indexterm" data-primary="executors" data-secondary="scalability issues" data-startref="ex5si" id="idp16552656"></a>frameworks.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Adding Heartbeats"><div class="sect1" id="executor_adding_heartbeats">
<h1>Adding Heartbeats</h1>

<p>One <a data-type="indexterm" data-primary="heartbeats/heartbeating" id="hh5"></a><a data-type="indexterm" data-primary="executors" data-secondary="adding heartbeats" id="ex5ah"></a>of the advantages of the Mesos architecture is that temporary communication disruptions don’t affect the operation of the running executors.
We often leverage this functionality when designing for high availability, since each executor can continue to process its work or service client requests in spite of other failures.
When building a pool of servers scheduler, for example (see <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch04.html#pool_of_servers">“Pool of Servers Scheduler”</a>), this is exactly the behavior we want.
On the other hand, sometimes we want to ensure that every executor is running so that we can react quickly to failures—after all, there’s no way to distinguish a temporary and permanent network blip.<sup><a data-type="noteref" id="idp16559136-marker" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#idp16559136" class="totri-footnote">2</a></sup></p>

<p>We’ll ensure that every executor is functioning by requiring them to heartbeat every so often (the period will depend on how quickly we want to react to failures).
To heartbeat, we’ll use <a data-type="indexterm" data-primary="framework messages" id="idp16560848"></a>framework messages, which have several interesting features and caveats:</p>

<ul>
<li>
<p>Framework messages are unreliable: there’s no guarantee they’re ever delivered.</p>
</li>
<li>
<p>Framework messages are scalable: they usually use an optimized transmission mechanism directly from the executor to the scheduler, thus avoiding bottlenecking at the master.</p>
</li>
<li>
<p>Framework messages can carry an arbitrary binary payload: you can serialize any data you’d like into them, such as progress updates.</p>
</li>
<li>
<p>Framework messages are between executors and schedulers: it’s up to you to include the task ID in the binary payload if you want to send messages about a particular task on an executor.</p>
</li>
</ul>

<p>First, let’s add heartbeats to our executor, as shown in <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#heartbeats_on_the_executor">Example&nbsp;5-11</a>.</p>
<div id="heartbeats_on_the_executor" data-type="example">
<h5><span class="label">Example 5-11. </span>Heartbeats on the executor</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code><code> </code><code class="kd">static</code><code> </code><code class="kt">void</code><code> </code><code class="nf">main</code><code class="o">(</code><code class="n">String</code><code> </code><code class="o">.</code><code class="o">.</code><code class="o">.</code><code> </code><code class="n">args</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="c1">// ... snip ...
</code><code>    </code><code class="n">Timer</code><code> </code><code class="n">timer</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">Timer</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO6-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO6-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a><code>
</code><code>    </code><code class="n">timer</code><code class="o">.</code><code class="na">schedule</code><code class="o">(</code><code class="k">new</code><code> </code><code class="n">TimerTask</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">run</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>            </code><code class="n">driver</code><code class="o">.</code><code class="na">sendFrameworkMessage</code><code class="o">(</code><code class="k">new</code><code> </code><code class="kt">byte</code><code class="o">[</code><code class="mi">1</code><code class="o">]</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO6-2" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO6-2"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a><code>
</code><code>        </code><code class="o">}</code><code>
</code><code>    </code><code class="o">}</code><code class="o">,</code><code> </code><code class="mi">0</code><code class="o">,</code><code> </code><code class="mi">5000</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO6-3" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO6-3"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a><code>
</code><code>    </code><code class="c1">// ... snip ...
</code><code class="o">}</code></pre></div>
<dl class="calloutlist">
<dt><a class="co" id="callout_building_a_mesos_executor_CO6-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO6-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a></dt>
<dd><p>We create a new <code>Timer</code> when our executor starts up to manage the heartbeats.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO6-2" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO6-2"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a></dt>
<dd><p>The task we create will simply send a framework message without any interesting data. In a production framework, you could include useful information here, such as when the message was sent (to track the message delivery delay) or what the completion percentage of each of the executor’s tasks is.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO6-3" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO6-3"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a></dt>
<dd><p>We start this task immediately, sending a heartbeat every 5 seconds. To increase scalability, heartbeats are often sent every 30 seconds or every few minutes.</p></dd>
</dl>

<p>Although it’s easy to send heartbeats on the executor, we also need to augment the scheduler.
First, we enhance the <code>Job</code> to <a data-type="indexterm" data-primary="jobs, automatically self-destructing" id="idp16657952"></a>automatically fail itself when it doesn’t receive a heartbeat in time, as seen in <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#automatically_sd_job">Example&nbsp;5-12</a>.</p>
<div id="automatically_sd_job" data-type="example">
<h5><span class="label">Example 5-12. </span>Automatically self-destructing Job</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code><code> </code><code class="kd">class</code><code> </code><code class="nc">Job</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="kd">private</code><code> </code><code class="n">Timer</code><code> </code><code class="n">timer</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">Timer</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO7-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO7-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a><code>
</code><code>    </code><code class="kd">private</code><code> </code><code class="n">TimerTask</code><code> </code><code class="n">missedHeartbeatTask</code><code class="o">;</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO7-2" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO7-2"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a><code>
</code><code>    </code><code class="c1">// ... snip ...
</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">heartbeat</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO7-3" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO7-3"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a><code>
</code><code>        </code><code class="k">if</code><code> </code><code class="o">(</code><code class="n">missedHeartbeatTask</code><code> </code><code class="o">!</code><code class="o">=</code><code> </code><code class="kc">null</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO7-4" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO7-4"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/4.png" alt="4" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/4.png"></a><code>
</code><code>            </code><code class="n">missedHeartbeatTask</code><code class="o">.</code><code class="na">cancel</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>
</code><code>        </code><code class="o">}</code><code>
</code><code>        </code><code class="n">missedHeartbeatTask</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">HeartbeatTask</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>
</code><code>        </code><code class="n">timer</code><code class="o">.</code><code class="na">schedule</code><code class="o">(</code><code class="n">missedHeartbeatTask</code><code class="o">,</code><code> </code><code class="mi">20000</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO7-5" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO7-5"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/5.png" alt="5" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/5.png"></a><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="kd">static</code><code> </code><code class="n">Job</code><code> </code><code class="nf">fromJSON</code><code class="o">(</code><code class="n">JSONObject</code><code> </code><code class="n">obj</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="n">Job</code><code> </code><code class="n">job</code><code> </code><code class="o">=</code><code> </code><code class="k">new</code><code> </code><code class="n">Job</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>
</code><code>        </code><code class="c1">// ... snip ...
</code><code>        </code><code class="n">job</code><code class="o">.</code><code class="na">heartbeat</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO7-6" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO7-6"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/6.png" alt="6" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/6.png"></a><code>
</code><code>        </code><code class="k">return</code><code> </code><code class="n">job</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">succeed</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="c1">// ... snip ...
</code><code>        </code><code class="n">missedHeartbeatTask</code><code class="o">.</code><code class="na">cancel</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO7-7" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO7-7"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/7.png" alt="7" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/7.png"></a><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code>    </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">fail</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="c1">// ... snip ...
</code><code>        </code><code class="n">missedHeartbeatTask</code><code class="o">.</code><code class="na">cancel</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code>
</code><code>    </code><code class="kd">private</code><code> </code><code class="kd">class</code><code> </code><code class="nc">HeartbeatTask</code><code> </code><code class="kd">extends</code><code> </code><code class="n">TimerTask</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO7-8" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO7-8"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/8.png" alt="8" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/8.png"></a><code>
</code><code>        </code><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">run</code><code class="o">(</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>            </code><code class="n">System</code><code class="o">.</code><code class="na">out</code><code class="o">.</code><code class="na">println</code><code class="o">(</code><code class="s">"Heartbeat missed; failing"</code><code class="o">)</code><code class="o">;</code><code>
</code><code>            </code><code class="n">fail</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO7-9" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO7-9"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/9.png" alt="9" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/9.png"></a><code>
</code><code>        </code><code class="o">}</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code class="o">}</code></pre></div>
<dl class="calloutlist">
<dt><a class="co" id="callout_building_a_mesos_executor_CO7-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO7-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a></dt>
<dd><p>Each <code>Job</code> will now have a <code>Timer</code> to manage the expiration of its latest heartbeat.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO7-2" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO7-2"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a></dt>
<dd><p>We must store the <code>TimerTask</code> that will cause the current instance of the <code>Job</code> to fail, so that we can cancel it when we receive a heartbeat.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO7-3" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO7-3"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a></dt>
<dd><p>The <code>heartbeat()</code> method will get called every time we receive a heartbeat from the executor.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO7-4" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO7-4"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/4.png" alt="4" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/4.png"></a></dt>
<dd><p>Every time we receive a heartbeat, we must cancel the current task, since if that task ran we’d fail the <code>Job</code>.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO7-5" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO7-5"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/5.png" alt="5" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/5.png"></a></dt>
<dd><p>When we receive the heartbeat, we schedule the next failure due to lack of heartbeat in 20 seconds. Since we expect a heartbeat every 5 seconds, this should only run if we miss several heartbeats in a row.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO7-6" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO7-6"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/6.png" alt="6" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/6.png"></a></dt>
<dd><p>When we first create the <code>Job</code>, we heartbeat it once to ensure that it fails if the executor never starts running.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO7-7" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO7-7"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/7.png" alt="7" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/7.png"></a></dt>
<dd><p>When the task finishes, we cancel the pending failure task, since it’s no longer relevant.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO7-8" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO7-8"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/8.png" alt="8" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/8.png"></a></dt>
<dd><p>A <code>HeartbeatTask</code> <a data-type="indexterm" data-primary="HeartbeatTask" id="idp16977872"></a>is a subclass of <code>TimerTask</code>. We only need to implement the <code>run()</code> method, which is only called if the task isn’t canceled before its time is up.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO7-9" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO7-9"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/9.png" alt="9" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/9.png"></a></dt>
<dd><p>If our task does get to run, we just <code>fail()</code> the <code>Job</code>, which will cause the <code>Job</code> to get rescheduled later.</p></dd>
</dl>

<p>Now that our <code>Job</code> has been enhanced to track heartbeats, all we need to do is pass along <a data-type="indexterm" data-primary="framework messages" id="idp16983616"></a>framework messages from the scheduler to the proper <code>Job</code>.
To do this, we’ll implement the <code>frameworkMessage</code> <a data-type="indexterm" data-primary="frameworkMessage" id="idp16985120"></a>callback in the scheduler, as shown in <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#implementing_frameworkmessage_for_heartbeats">Example&nbsp;5-13</a>.</p>
<div id="implementing_frameworkmessage_for_heartbeats" data-type="example">
<h5><span class="label">Example 5-13. </span>Implementing frameworkMessage for heartbeats</h5>

<pre data-type="programlisting" data-code-language="java"><code class="kd">public</code><code> </code><code class="kt">void</code><code> </code><code class="nf">frameworkMessage</code><code class="o">(</code><code class="n">SchedulerDriver</code><code> </code><code class="n">driver</code><code class="o">,</code><code> </code><code class="n">ExecutorID</code><code> </code><code class="n">executorId</code><code class="o">,</code><code>
</code><code>                             </code><code class="n">SlaveID</code><code> </code><code class="n">slaveId</code><code class="o">,</code><code> </code><code class="kt">byte</code><code class="o">[</code><code class="o">]</code><code> </code><code class="n">data</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>    </code><code class="n">String</code><code> </code><code class="n">id</code><code> </code><code class="o">=</code><code> </code><code class="n">executorId</code><code class="o">.</code><code class="na">getValue</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO8-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO8-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a><code>
</code><code>    </code><code class="kd">synchronized</code><code> </code><code class="o">(</code><code class="n">jobs</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>        </code><code class="k">for</code><code> </code><code class="o">(</code><code class="n">Job</code><code> </code><code class="n">j</code><code> </code><code class="o">:</code><code> </code><code class="n">jobs</code><code class="o">)</code><code> </code><code class="o">{</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO8-2" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO8-2"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a><code>
</code><code>            </code><code class="k">if</code><code> </code><code class="o">(</code><code class="n">j</code><code class="o">.</code><code class="na">getId</code><code class="o">(</code><code class="o">)</code><code class="o">.</code><code class="na">equals</code><code class="o">(</code><code class="n">id</code><code class="o">)</code><code class="o">)</code><code> </code><code class="o">{</code><code>
</code><code>                </code><code class="n">j</code><code class="o">.</code><code class="na">heartbeat</code><code class="o">(</code><code class="o">)</code><code class="o">;</code><code> </code><a class="co" id="co_building_a_mesos_executor_CO8-3" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#callout_building_a_mesos_executor_CO8-3"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a><code>
</code><code>            </code><code class="o">}</code><code>
</code><code>        </code><code class="o">}</code><code>
</code><code>    </code><code class="o">}</code><code>
</code><code class="o">}</code></pre></div>
<dl class="calloutlist">
<dt><a class="co" id="callout_building_a_mesos_executor_CO8-1" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO8-1"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/1.png" alt="1" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/1.png"></a></dt>
<dd><p>For the example executor in this chapter (and for the <code>CommandExecutor</code>), we set the executor ID to be equal to the job ID and the task ID.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO8-2" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO8-2"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/2.png" alt="2" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/2.png"></a></dt>
<dd><p>Since we don’t care about the data in the framework message, we simply scan through all the current jobs to find if one of them has the same ID as the executor that just sent the heartbeat.</p></dd>
<dt><a class="co" id="callout_building_a_mesos_executor_CO8-3" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#co_building_a_mesos_executor_CO8-3"><img src="https://www.safaribooksonline.com/library/view/building-applications-on/9781491926543/assets/3.png" alt="3" width="12" height="12" data-mfp-src="/library/view/building-applications-on/9781491926543/assets/3.png"></a></dt>
<dd><p>Once we find a match, we call the <code>heartbeat()</code> method on that <code>Job</code>, so that the <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#automatically_sd_job">Example&nbsp;5-12</a> code can do its thing.</p></dd>
</dl>

<p>This is all it takes to add basic heartbeating functionality to your framework.
Of course, there are several enhancements that should be made in a production-quality system.
Firstly, the heartbeat mechanism shown here creates one timer for every <code>Job</code>’s heartbeat; for a system with hundreds of <code>Job</code>s, every <code>Job</code> can share the same <code>Timer</code> to ensure scalability since each <code>Timer</code> creates a new thread.
Secondly, this heartbeat system doesn’t actually kill the non-heartbeating <code>Job</code>s; it just treats them as dead.
We should always kill the executors that aren’t heartbeating by using the <code>killTask</code> <a data-type="indexterm" data-primary="killTask" id="idp17124448"></a>API, or else we could end up with orphaned or zombie executors, which will consume resources indefinitely on the cluster without doing any useful work.
Finally, when we’re not sure if an executor was properly killed, we should be careful not to start an executor with a duplicate ID on a slave.
We should actually track all the executor IDs we’ve used, and generate a new, unique ID for each executor.
With the preceding code, you can encounter undefined behavior when you try to relaunch a <code>Job</code> on the same slave when the earlier executor is still running but believed dead due to lack of heartbeats.</p>

<p>Now, we’ve seen how to build a simple executor by leveraging the task-level and executor-level APIs.
We’ve even added an additional functionality, heartbeats, that wasn’t possible with the built-in executor.
In the next few sections, we’ll look at other advanced features that we can add to our <a data-type="indexterm" data-primary="heartbeats/heartbeating" data-startref="hh5" id="idp17126784"></a><a data-type="indexterm" data-primary="executors" data-secondary="adding heartbeats" data-startref="ex5ah" id="idp17127632"></a>executors.</p>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Advanced Executor Features"><div class="sect1" id="idp16554368">
<h1>Advanced Executor Features</h1>

<p>As <a data-type="indexterm" data-primary="executors" data-secondary="advanced features" id="ex5af"></a>you’ve probably discovered by now, it’s difficult to write an executor.
Unlike most software that we write, the executor is particularly challenging to test, since we need to build it, package it, and ship it across our cluster, at which point we must wait to see whether it correctly interacts with our scheduler.</p>

<p>Before we start looking at additional features we can add to our executor, keep in mind that an executor doesn’t have to make its task a subprocess.
In fact, it’s quite common to have tasks run in the same process as the executor—this can lead to greater efficiency and a simpler design.
The only reason we split our executor and task into different processes was simply so that we could imitate the behavior of the built-in <code>CommandExecutor</code> in Mesos.</p>








<section data-type="sect2" data-pdf-bookmark="Progress Reporting"><div class="sect2" id="executor_adv_progress_reporting">
<h2>Progress Reporting</h2>

<p>In <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#executor_adding_heartbeats">“Adding Heartbeats”</a>, <a data-type="indexterm" data-primary="progress reporting" id="pr5"></a><a data-type="indexterm" data-primary="executors" data-secondary="progress reporting" id="ex5pr"></a>we briefly touched on the idea that, in addition to using periodic framework messages to detect whether an executor is still running and accessible, we could include periodic status updates in those messages.
However, we don’t only have to use framework messages for this: the <code>TaskStatus</code> <a data-type="indexterm" data-primary="TaskStatus" id="idp17138496"></a>message also has a <code>data</code> field, and it too can be used to send updates about a task.
Furthermore, it is possible to send multiple <code>TaskStatus</code> updates for the same status (i.e., <code>TASK_RUNNING</code>, <code>TASK_STARTING</code>, etc.) but with different values in the <code>data</code> field to reliably send a task’s internal status changes.
For instance, we may want to have our tasks report that they’re <code>RUNNING</code> with the <code>data</code> value “initializing” when they start to initialize themselves, and then send a new status update that they’re <code>RUNNING</code> with the <code>data</code> value “ready” when they’re ready to begin processing requests.
Let’s look at the reasons we might consider to choose whether to communicate progress updates with status messages or framework updates.</p>

<p>Framework messages <a data-type="indexterm" data-primary="framework messages" id="idp17143440"></a>are highly scalable, because they are transmitted directly from the executors to the scheduler.
Since the Mesos master typically doesn’t process or forward framework messages,<sup><a data-type="noteref" id="idp17144368-marker" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#idp17144368" class="totri-footnote">3</a></sup> the throughput of these messages is limited by the scheduler’s ability to consume them.
Furthermore, since framework messages aren’t guaranteed to be reliable, during periods of high load, Mesos can choose to drop some messages in order ensure that higher-priority messages can proceed.
These features make framework messages a great choice when <a data-type="indexterm" data-primary="scalability" id="idp17145552"></a>scalability is the primary concern.</p>

<p>Of course, that scalability comes at a price: as mentioned, sometimes framework messages get dropped.
Status updates, <a data-type="indexterm" data-primary="status updates" id="idp17146800"></a>on the other hand, are guaranteed to be delivered.
But this guarantee comes at a steep performance cost: every status update must be checkpointed to disk on the slave before it’s sent, and then a second disk write must take place to mark the update as having been successfully sent.
Furthermore, the slaves must keep track of all outstanding status updates, so that if a scheduler is temporarily offline when the status update would have been delivered, the slave can retransmit it later.
This checkpointing and tracking, along with the periodic retransmissions of unacknowledged status updates, gives status updates their reliability, making them suitable for notifying the scheduler of important lifecycle events in tasks, at the cost of far greater resource usage and susceptibility to bottlenecks at the master’s and the slave’s disks.</p>

<p>Thus, the main criterion for whether framework messages or status updates are more suitable is whether every update completely subsumes all earlier updates.
For example, if the goal was to report on the percent completed of a task, then missing the 49% update is irrelevant once the 50% update has been received (since the 50% update implies that 49% has already passed).
For this purpose, framework messages are a good choice.
On the other hand, if a task is reporting when various subtasks have been completed, each update is unique and they all should be delivered to the scheduler.
For this purpose, status updates are more <a data-type="indexterm" data-primary="progress reporting" data-startref="pr5" id="idp17149424"></a><a data-type="indexterm" data-primary="executors" data-secondary="progress reporting" data-startref="ex5pr" id="idp17150272"></a>appropriate.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Adding Remote Logging"><div class="sect2" id="idp17151616">
<h2>Adding Remote Logging</h2>

<p>One <a data-type="indexterm" data-primary="remote logging" id="idp17152864"></a><a data-type="indexterm" data-primary="executors" data-secondary="remote logging" id="idp17153472"></a>often-encountered problem in building distributed systems is figuring out “<em>What the hell happened</em>?”
This is so challenging because logs tend to be scattered across the cluster; this makes searching the logs for an error message much harder, since now we also need to search the cluster for the log.
Furthermore, we often need to correlate several logs to identify how the interaction between multiple programs in our cluster resulted in failure.
The most common way to mitigate this issue is to send all logs to a central repository, which then assists us in analyzing, searching, and correlating these logs.
Some popular technologies for doing this are <a href="http://www.splunk.com/">Splunk</a>, <a href="https://www.elastic.co/products/logstash">Logstash</a>, and <a href="https://papertrailapp.com/">Papertrail</a>.<sup><a data-type="noteref" id="idp17157280-marker" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#idp17157280" class="totri-footnote">4</a></sup></p>

<p>Recall how we used <code>ProcessBuilder.redirectOutput()</code> to send the <code>stdout</code> and <code>stderr</code> of our process to a file—we could instead get the <code>InputStream</code>s directly from the resultant process so that we can send the outputs anywhere.
Once you’re writing your own executor, you have complete control over where your executor’s logs get sent, and where your tasks’ logs get sent.
For many applications, since there’s only one task per executor, we want to send the executor and task logs to the same place.
For other applications, however, we can actually send the task and executor logs to different places.
This is useful when you want to be able to debug tasks separately from one another, and don’t want to see all of an executor’s tasks’ logs intermingled.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Multiple Tasks"><div class="sect2" id="multiple_tasks">
<h2>Multiple Tasks</h2>

<p>Mesos executors are <a data-type="indexterm" data-primary="multiple tasks, running" id="mtr5"></a><a data-type="indexterm" data-primary="executors" data-secondary="running multiple tasks" id="ex5rmt"></a>designed to run multiple tasks.
To run a task on an existing executor, you can launch that task the same as normal, except that you’ll use an identical <code>ExecutorInfo</code> as the executor that’s already running on that slave.
To help you reuse executors, every offer has a field called <code>executor_ids</code>, <a data-type="indexterm" data-primary="executor_ids" id="idp17166064"></a>which contains all of the <code>ExecutorID</code>s of the executors currently running on that slave; however, it’s still up to you to store all the <code>ExecutorInfo</code>s and include them in your task descriptors.
The master will validate the <code>TaskInfo</code>, so if you provide an <code>ExecutorInfo</code> that doesn’t match the executor you want to launch on, the task will fail immediately with a <code>TASK_ERROR</code>.</p>
<div data-type="tip" id="executors_can_resize_containers"><h1>Resizing Containers</h1>
<p>A <a data-type="indexterm" data-primary="containerizers" id="idp17170192"></a><a data-type="indexterm" data-primary="executors" data-secondary="resizing containers" id="idp17170800"></a>powerful feature of executors is that their size is always the sum of all the tasks they’re running and the executor’s resources.
A custom executor is the only way to easily dynamically resize containers depending on what work they’re performing.
Of course, there’s no free lunch: you’ll need to keep track of which slave each executor is running on, and you’ll need to use an offer from the existing executor’s slave when you want to scale its container up.</p>
</div>










<section data-type="sect3" data-pdf-bookmark="Executors with expensive state"><div class="sect3" id="idp17172528">
<h3>Executors with expensive state</h3>

<p>Typically, <a data-type="indexterm" data-primary="executors" data-secondary="with expensive states" data-secondary-sortas="expensive" id="idp17173664"></a>reusing executors is done when the executor contains some sort of expensive-to-construct state.
For instance, the executors can be maintaining a local cache of a large amount of data that’s stored in a slow external filesystem, like S3.
In this case, the executor can be responsible for downloading that data, and then each task can access that data as a local file, which will be much faster than reading it over the network.
Of course, there’s always a trade-off: if you run multiple tasks at the same time on that executor, those tasks will run in the same container—you’ll be giving up the strong isolation guarantee between tasks that Mesos usually provides!
If you are confident that the tasks won’t accidentally consume more of the container’s resources than they should, this is a workable solution.
If, however, you’re like most developers and occasionally write bugs, this is a risky proposition, in that it opens up your framework to unanticipated interference and potential nondeterminism.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Multistage initialization"><div class="sect3" id="idp17176160">
<h3>Multistage initialization</h3>

<p>A less <a data-type="indexterm" data-primary="executors" data-secondary="multistage initialization" id="idp17177296"></a><a data-type="indexterm" data-primary="multistage initialization" id="idp17178144"></a><a data-type="indexterm" data-primary="initialization, multistage" id="idp17178752"></a>common situation in which multiple tasks are used on the same executor is when the executor has a complex initialization process.
Rather than sending status updates as the initialization occurs, as suggested in <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#executor_adv_progress_reporting">“Progress Reporting”</a>, the scheduler can treat each step of the initialization as a separate task.
This way, the initialization logic can be managed on the scheduler, rather than on the executor.
Although you’ll occasionally see this technique used, I recommend against it.
It is easier to implement the initialization state machine in the executor itself.
This has the additional benefits of removing the need to implement parts of the state machine in the executor and other parts in the scheduler, and it reduces the dependency of the framework on a reliable network during executor initialization.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Canary tasks"><div class="sect3" id="canary_tasks">
<h3>Canary tasks</h3>

<p>There is, <a data-type="indexterm" data-primary="canary tasks" id="idp17182896"></a><a data-type="indexterm" data-primary="executors" data-secondary="canary tasks" id="idp17183504"></a><a data-type="indexterm" data-primary="tasks" data-secondary="canary" id="idp17184352"></a>however, one situation in which an additional task on the executor is absolutely necessary: when we need to receive prompt notification that an executor that may not be presently running any tasks (but is waiting for new ones) has shut down or crashed.
As mentioned in our discussion of <code>Scheduler</code> callbacks (see <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch04.html#noop_cb_urb">Example&nbsp;4-6</a>), the callback you might think would tell you when an executor is lost is never actually called.
Therefore, to detect when an executor disappears, we instead run a canary task on it.
That way, when an executor shuts down or crashes or its slave deactivates, we’ll receive a <code>TASK_LOST</code> from the canary task, which tells us that the executor is lost.
Of course, if you don’t need to promptly detect that the executor has been lost, you could always just assume executors are gone if you don’t see an offer from them within some timeout.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="When should we use them?"><div class="sect3" id="idp17187824">
<h3>When should we use them?</h3>

<p>The capability for executors to launch multiple tasks is a lesser-used feature, for good reason.
The APIs can be challenging to use, due to the need to store the <code>ExecutorInfo</code>s for reuse.
Ultimately, multiple tasks should only be used in the following situations:</p>

<ul>
<li>
<p>When it’s necessary to dynamically change the amount of resources used by an executor as its workload varies</p>
</li>
<li>
<p>When the executor’s state is so expensive to construct that it’s acceptable to throw away the Mesos isolation functionality to save on reinitialization costs</p>
</li>
<li>
<p>When the failure of an executor that might not be running any tasks must be detected rapidly</p>
</li>
</ul>

<p>Use this feature carefully, as it can make debugging very <a data-type="indexterm" data-primary="multiple tasks, running" data-startref="mtr5" id="idp17193120"></a><a data-type="indexterm" data-primary="executors" data-secondary="running multiple tasks" data-startref="ex5rmt" id="idp17193968"></a><a data-type="indexterm" data-primary="executors" data-secondary="advanced features" data-startref="ex5af" id="idp17195056"></a>difficult.</p>
</div></section>



</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Summary"><div class="sect1" id="idp17196528">
<h1>Summary</h1>

<p>Executors are the Mesos abstraction for a framework’s workers.
They should be used when a framework requires richer interaction between its scheduler and workers.
Building an executor is usually very challenging, because of the need to frequently deploy new builds to the cluster during development.
By surmounting these challenges, you can build custom executors to enable frameworks to dynamically scale the containers in which their tasks are running, to efficiently share expensive resources, and to provide an easy API to send messages between the scheduler and workers.</p>

<p>In this chapter, after reviewing some of the reasons one might build an executor, we implemented an executor that was mostly compatible with the built-in Mesos <code>CommandExecutor</code> and which we integrated with the job scheduler from <a data-type="xref" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch04.html#chapter_creating_new_scheduler">Chapter&nbsp;4</a>.
Then, we added heartbeats, which allowed us to more rapidly detect certain types of partial failures on the cluster, resulting in a better experience for the humans that must wait for their jobs to complete.</p>

<p>Finally, we looked at some advanced uses of custom executors: how to choose between framework messages and status updates, considerations when integrating with centralized distributed logging systems, and how and why to develop executors that support <a data-type="indexterm" data-primary="executors" data-seealso="CommandExecutor" data-startref="ex5" id="idp17201056"></a>multiple tasks.</p>

<p>Now that we’ve looked across the entire spectrum of building applications on Mesos—utilizing existing frameworks, building application-specific schedulers, creating rich executors—we’ll move on to more advanced topics, such as Mesos internals, Docker integration, and exotic, cutting-edge APIs.</p>
</div></section>







<div data-type="footnotes"><p data-type="footnote" id="idp15583072"><sup><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#idp15583072-marker" class="totri-footnote">1</a></sup> Java concurrency is beyond the scope of this book, so you’ll just have to trust me that this works.</p><p data-type="footnote" id="idp16559136"><sup><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#idp16559136-marker" class="totri-footnote">2</a></sup> This is known as the <a href="http://the-paper-trail.org/blog/a-brief-tour-of-flp-impossibility/">FLP impossibility result</a>.</p><p data-type="footnote" id="idp17144368"><sup><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#idp17144368-marker" class="totri-footnote">3</a></sup> Technically, the Mesos master will sometimes process framework messages. This can lead to a bottleneck in rare cases, but the optimized bypass of the master is almost always used.</p><p data-type="footnote" id="idp17157280"><sup><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#idp17157280-marker" class="totri-footnote">4</a></sup> You can read a summary and comparison of centralized logging solutions at <a href="http://bit.ly/centralizedlogging">Jason Wilder’s blog</a>.</p></div></div></section><div class="annotator-outer annotator-viewer viewer annotator-hide">
  <ul class="annotator-widget annotator-listing"></ul>
</div><div class="annotator-modal-wrapper annotator-editor-modal annotator-editor annotator-hide">
	<div class="annotator-outer editor">
		<h2 class="title">Highlight</h2>
		<form class="annotator-widget">
			<ul class="annotator-listing">
			<li class="annotator-item"><textarea id="annotator-field-0" placeholder="Add a note using markdown (optional)" class="js-editor" maxlength="750"></textarea></li></ul>
			<div class="annotator-controls">
				<a class="link-to-markdown" href="https://daringfireball.net/projects/markdown/basics" target="_blank">?</a>
				<ul>
					<li class="delete annotator-hide"><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#delete" class="annotator-delete-note button positive">Delete Note</a></li>
					<li class="save"><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#save" class="annotator-save annotator-focus button positive">Save Note</a></li>
					<li class="cancel"><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#cancel" class="annotator-cancel button">Cancel</a></li>
				</ul>
			</div>
		</form>
	</div>
</div><div class="annotator-modal-wrapper annotator-delete-confirm-modal" style="display: none;">
  <div class="annotator-outer">
    <h2 class="title">Highlight</h2>
      <a class="js-close-delete-confirm annotator-cancel close" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#close">Close</a>
      <div class="annotator-widget">
         <div class="delete-confirm">
            Are you sure you want to permanently delete this note?
         </div>
         <div class="annotator-controls">
            <a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#cancel" class="annotator-cancel button js-cancel-delete-confirm">No, I changed my mind</a>
            <a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#delete" class="annotator-delete button positive js-delete-confirm">Yes, delete it</a>
         </div>
       </div>
   </div>
</div><div class="annotator-adder" style="display: none;">
	<ul class="adders ">
		
		<li class="copy"><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#">Copy</a></li>
		
		<li class="add-highlight"><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#">Add Highlight</a></li>
		<li class="add-note"><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#">
			
				Add Note
			
		</a></li>
	</ul>
</div></div></div>



  <div class="t-sbo-prev sbo-prev sbo-nav-bottom">
  
    
      
        <a href="/safari-books-archive/site/library/view/building-applications-on/9781491926543/ch04.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">4. Creating a New Framework for Mesos</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-bottom">
  
    
      
        <a href="/safari-books-archive/site/library/view/building-applications-on/9781491926543/ch06.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">6. Advanced Topics in Mesos</div>
        </a>
    
  
  </div>


      
    </section>
    <div class="reading-controls-bottom">
      <ul class="interface-controls js-bitlist">
        <li class="queue-control">
            <button type="button" class="rec-fav ss-queue js-queue js-current-chapter-queue" data-queue-endpoint="/api/v1/book/9781491926543/chapter/ch05.html" data-for-analytics="9781491926543:ch05.html">
      <span>Add to Queue</span>
  </button>
        </li>
      </ul>
    </div>
  </div>
<section class="sbo-saved-archives"></section>



          
          
  





    
    



        
      </div>
      



  <footer class="pagefoot t-pagefoot">
    <a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#" class="icon-up"><div class="visuallyhidden">Back to top</div></a>
    <ul class="js-footer-nav">
      
        <li><a class="t-recommendations-footer" href="https://www.safaribooksonline.com/r/">Recommended</a></li>
      
      <li><a class="t-queue-footer" href="https://www.safaribooksonline.com/s/">Queue</a></li>
      
        <li><a class="t-recent-footer" href="https://www.safaribooksonline.com/history/">History</a></li>
        <li><a class="t-topics-footer" href="https://www.safaribooksonline.com/topics?q=*&amp;limit=21">Topics</a></li>
      
      
        <li><a class="t-tutorials-footer" href="https://www.safaribooksonline.com/tutorials/">Tutorials</a></li>
      
      <li><a class="t-settings-footer js-settings" href="https://www.safaribooksonline.com/u/">Settings</a></li>
      <li><a href="https://www.safaribooksonline.com/blog/">Blog</a></li>
      <li class="full-support"><a href="https://www.safaribooksonline.com/public/support">Support</a></li>
      <li><a href="https://community.safaribooksonline.com/">Feedback</a></li>
      <li><a href="https://www.safaribooksonline.com/apps/">Get the App</a></li>
      <li><a href="https://www.safaribooksonline.com/accounts/logout/">Sign Out</a></li>
    </ul>
    <span class="copyright">© 2016 <a href="https://www.safaribooksonline.com/" target="_blank">Safari</a>.</span>
    <a href="https://www.safaribooksonline.com/terms/">Terms of Service</a> /
    <a href="https://www.safaribooksonline.com/privacy/">Privacy Policy</a>
  </footer>




    

    
    
  

<div class="annotator-notice"></div><div class="font-flyout"><div class="font-controls-panel">
	<div class="nightmodes">
		<ul>
			<li class="day"><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#" id="day-mode" title="Day Mode">
				<i class="fa fa-sun-o"></i>
				<span>Day Mode</span></a></li>
			<li class="cloudy"><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#" id="cloudy-mode" title="Cloudy Mode">
				<i class="fa fa-cloud"></i>
				<span>Cloud Mode</span>
			</a></li>
			<li class="night"><a href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#" id="night-mode" title="Night Mode">
				<i class="fa fa-moon-o"></i>
				<span>Night Mode</span>
			</a></li>
		</ul>
	</div>

	<div class="font-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-font left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-font-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-font right"></i>
		</div>
	</div>

	<div class="column-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-compress left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-column-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-expand right"></i>
		</div>
	</div>

	<a id="reset" class="button" href="https://www.safaribooksonline.com//library/view/building-applications-on/9781491926543/ch05.html#">Reset</a>
</div>
</div></body><span class="gr__tooltip"><span class="gr__tooltip-content"></span><i class="gr__tooltip-logo"></i><span class="gr__triangle"></span></span></html>