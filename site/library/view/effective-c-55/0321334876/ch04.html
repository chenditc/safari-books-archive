<!--[if IE]><![endif]--><!DOCTYPE html><!--[if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage"" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/effective-c-55/0321334876/ch04.html"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="859452"
  data-user-uuid="4d373bec-fada-4717-9823-769db3ed3a36"
  data-username="dchen267"
  data-account-type="B2B"
  
  data-activated-trial-date="04/25/2016"


  data-archive="0321334876"
  data-publishers="Addison-Wesley Professional"



  data-htmlfile-name="ch04.html"
  data-epub-title="Effective C++: 55 Specific Ways to Improve Your Programs and Designs, Third Edition" data-debug=0 data-testing=0><![endif]--><!--[if gt IE 8]><!--><html class=" js flexbox flexboxlegacy no-touch websqldatabase indexeddb history csscolumns csstransforms localstorage sessionstorage applicationcache svg inlinesvg zoom" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#" itemscope="" itemtype="http://schema.org/Book http://schema.org/ItemPage" "="" data-login-url="/accounts/login/" data-offline-url="/" data-url="/library/view/effective-c-55/0321334876/ch04.html" data-csrf-cookie="csrfsafari" data-highlight-privacy="" data-user-id="859452" data-user-uuid="4d373bec-fada-4717-9823-769db3ed3a36" data-username="dchen267" data-account-type="B2B" data-activated-trial-date="04/25/2016" data-archive="0321334876" data-publishers="Addison-Wesley Professional" data-htmlfile-name="ch04.html" data-epub-title="Effective C++: 55 Specific Ways to Improve Your Programs and Designs, Third Edition" data-debug="0" data-testing="0"><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="Safari Books Online"><meta name="format-detection" content="telephone=no"><meta http-equiv="cleartype" content="on"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="apple-itunes-app" content="app-id=881697395, app-argument=safaridetail://0321334876"><meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0"><meta property="twitter:account_id" content="4503599627559754"><link rel="apple-touch-icon" href="https://www.safaribooksonline.com/static/images/apple-touch-icon.8cc2fd27400e.png"><link rel="shortcut icon" href="https://www.safaribooksonline.com/favicon.ico" type="image/x-icon"><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700,900,200italic,300italic,400italic,600italic,700italic,900italic" rel="stylesheet" type="text/css"><title>4. Designs and Declarations - Effective C++: 55 Specific Ways to Improve Your Programs and Designs, Third Edition</title><link rel="stylesheet" href="https://www.safaribooksonline.com/static/CACHE/css/e4b0fef39b55.css" type="text/css"><link rel="stylesheet" type="text/css" href="https://www.safaribooksonline.com/static/css/annotator.min.fd58f69f4908.css"><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css"><style type="text/css" title="ibis-book">
    #sbo-rt-content div{margin-top:5pt;margin-bottom:5pt;margin-right:15pt}#sbo-rt-content .cover{margin-top:2pt;margin-bottom:2pt;text-align:center}#sbo-rt-content h1{page-break-before:right;margin-top:5pt;text-align:center;margin-bottom:12pt;font-weight:bold}#sbo-rt-content .subtitle{font-size:large;margin-top:30pt;margin-bottom:55pt;font-weight:bold;text-align:center}#sbo-rt-content .publisher{text-align:center;margin-top:64pt;margin-bottom:4pt}#sbo-rt-content .copyright{margin-top:5pt;margin-bottom:5pt;text-indent:.12pt}#sbo-rt-content h2{page-break-before:right;margin-top:7pt;margin-bottom:25pt;font-weight:bold}#sbo-rt-content h3{margin-top:9pt;margin-bottom:8pt;text-indent:.12pt;font-weight:bold}#sbo-rt-content h4{margin-top:9pt;margin-bottom:6pt;font-weight:bold}#sbo-rt-content h5{margin-top:9pt;margin-bottom:6pt;font-weight:bold}#sbo-rt-content h6{margin-top:8pt;margin-bottom:6pt;font-weight:bold}#sbo-rt-content .author{text-align:center;font-weight:bold;margin-top:66pt;margin-bottom:24pt}#sbo-rt-content .bolditalic{font-weight:bold;font-style:italic}#sbo-rt-content .toc-chapter{margin-top:12pt;margin-bottom:5pt;text-indent:.12pt;font-weight:bold}#sbo-rt-content .emphasis{font-style:italic}#sbo-rt-content .mediaobject{margin-top:12pt;margin-bottom:12pt;text-align:center}#sbo-rt-content .tabimage{margin-top:12pt;margin-bottom:12pt;text-align:center}#sbo-rt-content .smaller{font-size:small}#sbo-rt-content .center{margin-top:50pt;margin-bottom:5pt;text-align:center}#sbo-rt-content .note{margin-top:6pt;margin-bottom:12pt;margin-left:.12pt;text-indent:.12pt;margin-right:24pt}#sbo-rt-content .toc-preface{margin-top:5pt;margin-bottom:5pt;margin-left:1pt;text-indent:.12pt;font-weight:bold}#sbo-rt-content .programlisting{font-family:"Courier New";font-size:small;margin-top:8pt;margin-bottom:8pt;text-indent:.12pt}#sbo-rt-content .programlisting1{font-family:"Courier New";font-size:small;margin-top:5pt;margin-bottom:4pt;margin-left:36pt;text-indent:.12pt}#sbo-rt-content code{font-size:x-small}#sbo-rt-content .toc-section{margin-top:4pt;margin-bottom:4pt;margin-left:12pt;text-indent:.12pt}#sbo-rt-content .toc-index{margin-top:12pt;margin-bottom:4pt;text-indent:.12pt;font-weight:bold}#sbo-rt-content .toc-appendix{margin-top:12pt;margin-bottom:4pt;text-indent:.12pt;font-weight:bold}#sbo-rt-content .strong{font-weight:bold}#sbo-rt-content .italic{font-style:italic}#sbo-rt-content .title{margin-top:12pt;margin-bottom:6pt;font-size:medium;font-weight:bold;text-align:center}#sbo-rt-content .attribution{margin-top:4pt;margin-bottom:12pt;margin-right:15pt;text-align:right}#sbo-rt-content .indexmain{margin-top:2pt;margin-bottom:2pt;text-indent:.12pt}#sbo-rt-content .indexsub{margin-top:2pt;margin-bottom:2pt;margin-left:24pt;text-indent:.12pt}#sbo-rt-content .indexsubsub{margin-top:2pt;margin-bottom:2pt;margin-left:40pt;text-indent:.12pt}#sbo-rt-content .paraindent{margin-top:4pt;margin-bottom:4pt;margin-left:25pt;text-indent:.12pt}#sbo-rt-content .indenthanding{margin-top:4pt;margin-bottom:4pt;padding-left:25pt;text-indent:-15pt}#sbo-rt-content .indenthanding1{margin-top:4pt;margin-bottom:4pt;padding-left:48pt;text-indent:-8pt}#sbo-rt-content .underline{text-decoration:underline}#sbo-rt-content .footnotes{font-size:small;margin-top:5pt;margin-bottom:4pt;padding-left:20pt;text-indent:-8pt}#sbo-rt-content .courierb{font-family:"Courier New Bold"}#sbo-rt-content .courieri{font-family:"Courier New Italic"}#sbo-rt-content .center1{margin-top:4pt;margin-bottom:4pt;margin-left:80pt;text-align:center}#sbo-rt-content .noindent{margin-top:6pt;margin-bottom:5pt;text-indent:.12pt}#sbo-rt-content .noindent1{margin-top:12pt;margin-bottom:2pt;text-indent:.12pt}#sbo-rt-content .edition{font-size:1.2em;margin-top:2pt;margin-bottom:2pt;text-align:center}#sbo-rt-content .image1{page-break-before:always;page-break-after:always}#sbo-rt-content .codelink{margin-top:6pt;margin-bottom:6pt;text-indent:.12pt;font-weight:bold;page-break-after:avoid;font-size:small}
    </style><link rel="canonical" href="/library/view/effective-c-55/0321334876/ch04.html"><meta name="description" content="4. Designs and Declarations Software designs — approaches to getting the software to do what you want it to do — typically begin as fairly general ideas, but they eventually become detailed ... "><meta property="og:title" content="4. Designs and Declarations"><meta itemprop="isPartOf" content="/library/view/effective-c-55/0321334876/"><meta itemprop="name" content="4. Designs and Declarations"><meta property="og:url" itemprop="url" content="https://www.safaribooksonline.com/library/view/effective-c-55/0321334876/ch04.html"><meta property="og:site_name" content="Safari"><meta property="og:image" itemprop="thumbnailUrl" content="https://www.safaribooksonline.com/library/cover/0321334876/"><meta property="og:description" itemprop="description" content="4. Designs and Declarations Software designs — approaches to getting the software to do what you want it to do — typically begin as fairly general ideas, but they eventually become detailed ... "><meta itemprop="inLanguage" content="en"><meta itemprop="publisher" content="Addison-Wesley Professional"><meta property="og:type" content="book"><meta property="og:book:isbn" itemprop="isbn" content="0321334876"><meta property="og:book:author" itemprop="author" content="Scott Meyers"><meta property="og:book:tag" itemprop="about" content="C++"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@safari"><style type="text/css" id="font-styles" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-size: <%= font_size %> !important; }"></style><style type="text/css" id="font-family" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-family: <%= font_family %> !important; }"></style><style type="text/css" id="column-width" data-template="#sbo-rt-content { max-width: <%= column_width %>% !important; margin: 0 auto !important; }"></style><!--[if lt IE 9]><script src="/static/js/src/respond.min.cf5c9b7980e5.js"></script><![endif]--><style id="annotator-dynamic-style">.annotator-adder, .annotator-outer, .annotator-notice {
  z-index: 100019;
}
.annotator-filter {
  z-index: 100009;
}</style></head>


<body class="reading sidenav nav-collapsed  scalefonts library" data-gr-c-s-loaded="true">

    
      <div class="hide working" role="status">
        <div class="working-image"></div>
      </div>
      <div class="sbo-site-nav">
        




<a href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch04.html#container" class="skip">Skip to content</a><header class="topbar t-topbar"><nav role="navigation" class="js-site-nav"><ul class="topnav"><li class="t-logo"><a href="https://www.safaribooksonline.com/home/" class="l0 None safari-home nav-icn js-keyboard-nav-home"><svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" version="1.1" fill="#4A3C31"><desc>Safari Home Icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M4 9.9L4 9.9 4 18 16 18 16 9.9 10 4 4 9.9ZM2.6 8.1L2.6 8.1 8.7 1.9 10 0.5 11.3 1.9 17.4 8.1 18 8.7 18 9.5 18 18.1 18 20 16.1 20 3.9 20 2 20 2 18.1 2 9.5 2 8.7 2.6 8.1Z"></path><rect x="10" y="12" width="3" height="7"></rect><rect transform="translate(18.121320, 10.121320) rotate(-315.000000) translate(-18.121320, -10.121320) " x="16.1" y="9.1" width="4" height="2"></rect><rect transform="translate(2.121320, 10.121320) scale(-1, 1) rotate(-315.000000) translate(-2.121320, -10.121320) " x="0.1" y="9.1" width="4" height="2"></rect></g></svg><span>Safari Home</span></a></li><li><a href="https://www.safaribooksonline.com/r/" class="t-recommendations-nav l0 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" version="1.1" fill="#4A3C31"><desc>recommendations icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M50 25C50 18.2 44.9 12.5 38.3 11.7 37.5 5.1 31.8 0 25 0 18.2 0 12.5 5.1 11.7 11.7 5.1 12.5 0 18.2 0 25 0 31.8 5.1 37.5 11.7 38.3 12.5 44.9 18.2 50 25 50 31.8 50 37.5 44.9 38.3 38.3 44.9 37.5 50 31.8 50 25ZM25 3.1C29.7 3.1 33.6 6.9 34.4 11.8 30.4 12.4 26.9 15.1 25 18.8 23.1 15.1 19.6 12.4 15.6 11.8 16.4 6.9 20.3 3.1 25 3.1ZM34.4 15.6C33.6 19.3 30.7 22.2 27.1 22.9 27.8 19.2 30.7 16.3 34.4 15.6ZM22.9 22.9C19.2 22.2 16.3 19.3 15.6 15.6 19.3 16.3 22.2 19.2 22.9 22.9ZM3.1 25C3.1 20.3 6.9 16.4 11.8 15.6 12.4 19.6 15.1 23.1 18.8 25 15.1 26.9 12.4 30.4 11.8 34.4 6.9 33.6 3.1 29.7 3.1 25ZM22.9 27.1C22.2 30.7 19.3 33.6 15.6 34.4 16.3 30.7 19.2 27.8 22.9 27.1ZM25 46.9C20.3 46.9 16.4 43.1 15.6 38.2 19.6 37.6 23.1 34.9 25 31.3 26.9 34.9 30.4 37.6 34.4 38.2 33.6 43.1 29.7 46.9 25 46.9ZM27.1 27.1C30.7 27.8 33.6 30.7 34.4 34.4 30.7 33.6 27.8 30.7 27.1 27.1ZM38.2 34.4C37.6 30.4 34.9 26.9 31.3 25 34.9 23.1 37.6 19.6 38.2 15.6 43.1 16.4 46.9 20.3 46.9 25 46.9 29.7 43.1 33.6 38.2 34.4Z" fill="currentColor"></path></g></svg><span>Recommended</span></a></li><li><a href="https://www.safaribooksonline.com/s/" class="t-queue-nav l0 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" version="1.1" fill="#4A3C31"><desc>queue icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 29.2C25.4 29.2 25.8 29.1 26.1 28.9L48.7 16.8C49.5 16.4 50 15.5 50 14.6 50 13.7 49.5 12.8 48.7 12.4L26.1 0.3C25.4-0.1 24.6-0.1 23.9 0.3L1.3 12.4C0.5 12.8 0 13.7 0 14.6 0 15.5 0.5 16.4 1.3 16.8L23.9 28.9C24.2 29.1 24.6 29.2 25 29.2ZM7.3 14.6L25 5.2 42.7 14.6 25 24 7.3 14.6ZM48.7 22.4L47.7 21.9 25 34.2 2.3 21.9 1.3 22.4C0.5 22.9 0 23.7 0 24.7 0 25.6 0.5 26.5 1.3 26.9L23.9 39.3C24.2 39.5 24.6 39.6 25 39.6 25.4 39.6 25.8 39.5 26.1 39.3L48.7 26.9C49.5 26.5 50 25.6 50 24.7 50 23.7 49.5 22.9 48.7 22.4ZM48.7 32.8L47.7 32.3 25 44.6 2.3 32.3 1.3 32.8C0.5 33.3 0 34.1 0 35.1 0 36 0.5 36.9 1.3 37.3L23.9 49.7C24.2 49.9 24.6 50 25 50 25.4 50 25.8 49.9 26.1 49.7L48.7 37.3C49.5 36.9 50 36 50 35.1 50 34.1 49.5 33.3 48.7 32.8Z" fill="currentColor"></path></g></svg><span>Queue</span></a></li><li class="search"><a href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch04.html#" class="t-search-nav trigger nav-icn l0" data-dropdown-selector=".searchbox"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" version="1.1" fill="#4A3C31"><desc>search icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M31.3 0C20.9 0 12.5 8.4 12.5 18.8 12.5 22.5 13.6 25.9 15.4 28.8L1.2 42.9C-0.4 44.5-0.4 47.2 1.2 48.8 2 49.6 3.1 50 4.2 50 5.2 50 6.3 49.6 7.1 48.8L21.2 34.6C24.1 36.5 27.5 37.5 31.3 37.5 41.6 37.5 50 29.1 50 18.8 50 8.4 41.6 0 31.3 0ZM31.3 31.3C24.4 31.3 18.8 25.6 18.8 18.8 18.8 11.9 24.4 6.3 31.3 6.3 38.1 6.3 43.8 11.9 43.8 18.8 43.8 25.6 38.1 31.3 31.3 31.3Z" fill="currentColor"></path></g></svg><span>Search</span></a></li><li class="usermenu dropdown"><a href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch04.html#" class="trigger l0 nav-icn nav-dropdown"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" version="1.1" fill="#4A3C31"><desc>navigation arrow</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M0.1 12.5L9.7 3.1C9.8 3 9.9 3 10 3 10.1 3 10.2 3 10.3 3.1L19.9 12.5C20 12.5 20 12.6 20 12.8 20 12.9 20 13 19.9 13L17 15.9C16.9 16 16.8 16 16.7 16 16.5 16 16.4 16 16.4 15.9L10 9.7 3.6 15.9C3.6 16 3.5 16 3.3 16 3.2 16 3.1 16 3 15.9L0.1 13C0 12.9 0 12.8 0 12.7 0 12.7 0 12.6 0.1 12.5Z"></path></g></svg><span>Expand Nav</span></a><div class="drop-content"><ul><li><a href="https://www.safaribooksonline.com/history/" class="t-recent-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" version="1.1" fill="#4A3C31"><desc>recent items icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 0C11.2 0 0 11.2 0 25 0 38.8 11.2 50 25 50 38.8 50 50 38.8 50 25 50 11.2 38.8 0 25 0ZM6.3 25C6.3 14.6 14.6 6.3 25 6.3 35.4 6.3 43.8 14.6 43.8 25 43.8 35.4 35.4 43.8 25 43.8 14.6 43.8 6.3 35.4 6.3 25ZM31.8 31.5C32.5 30.5 32.4 29.2 31.6 28.3L27.1 23.8 27.1 12.8C27.1 11.5 26.2 10.4 25 10.4 23.9 10.4 22.9 11.5 22.9 12.8L22.9 25.7 28.8 31.7C29.2 32.1 29.7 32.3 30.2 32.3 30.8 32.3 31.3 32 31.8 31.5Z" fill="currentColor"></path></g></svg><span>History</span></a></li><li><a href="https://www.safaribooksonline.com/topics" class="t-topics-link l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 55" version="1.1" fill="#4A3C31"><desc>topics icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 55L50 41.262 50 13.762 25 0 0 13.762 0 41.262 25 55ZM8.333 37.032L8.333 17.968 25 8.462 41.667 17.968 41.667 37.032 25 46.538 8.333 37.032Z" fill="currentColor"></path></g></svg><span>Topics</span></a></li><li><a href="https://www.safaribooksonline.com/tutorials/" class="l1 nav-icn t-tutorials-nav js-toggle-menu-item None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" version="1.1" fill="#4A3C31"><desc>tutorials icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M15.8 18.2C15.8 18.2 15.9 18.2 16 18.2 16.1 18.2 16.2 18.2 16.4 18.2 16.5 18.2 16.7 18.1 16.9 18 17 17.9 17.1 17.8 17.2 17.7 17.3 17.6 17.4 17.5 17.4 17.4 17.5 17.2 17.6 16.9 17.6 16.7 17.6 16.6 17.6 16.5 17.6 16.4 17.5 16.2 17.5 16.1 17.4 15.9 17.3 15.8 17.2 15.6 17 15.5 16.8 15.3 16.6 15.3 16.4 15.2 16.2 15.2 16 15.2 15.8 15.2 15.7 15.2 15.5 15.3 15.3 15.4 15.2 15.4 15.1 15.5 15 15.7 14.9 15.8 14.8 15.9 14.7 16 14.7 16.1 14.6 16.3 14.6 16.4 14.6 16.5 14.6 16.6 14.6 16.6 14.6 16.7 14.6 16.9 14.6 17 14.6 17.1 14.7 17.3 14.7 17.4 14.8 17.6 15 17.7 15.1 17.9 15.2 18 15.3 18 15.5 18.1 15.5 18.1 15.6 18.2 15.7 18.2 15.7 18.2 15.7 18.2 15.8 18.2L15.8 18.2ZM9.4 11.5C9.5 11.5 9.5 11.5 9.6 11.5 9.7 11.5 9.9 11.5 10 11.5 10.2 11.5 10.3 11.4 10.5 11.3 10.6 11.2 10.8 11.1 10.9 11 10.9 10.9 11 10.8 11.1 10.7 11.2 10.5 11.2 10.2 11.2 10 11.2 9.9 11.2 9.8 11.2 9.7 11.2 9.5 11.1 9.4 11 9.2 10.9 9.1 10.8 8.9 10.6 8.8 10.5 8.7 10.3 8.6 10 8.5 9.9 8.5 9.7 8.5 9.5 8.5 9.3 8.5 9.1 8.6 9 8.7 8.8 8.7 8.7 8.8 8.6 9 8.5 9.1 8.4 9.2 8.4 9.3 8.2 9.5 8.2 9.8 8.2 10 8.2 10.1 8.2 10.2 8.2 10.3 8.2 10.5 8.3 10.6 8.4 10.7 8.5 10.9 8.6 11.1 8.7 11.2 8.9 11.3 9 11.4 9.1 11.4 9.2 11.4 9.3 11.5 9.3 11.5 9.3 11.5 9.4 11.5 9.4 11.5L9.4 11.5ZM3 4.8C3.1 4.8 3.1 4.8 3.2 4.8 3.4 4.8 3.5 4.8 3.7 4.8 3.8 4.8 4 4.7 4.1 4.6 4.3 4.5 4.4 4.4 4.5 4.3 4.6 4.2 4.6 4.1 4.7 4 4.8 3.8 4.8 3.5 4.8 3.3 4.8 3.1 4.8 3 4.8 2.9 4.7 2.8 4.7 2.6 4.6 2.5 4.5 2.3 4.4 2.2 4.2 2.1 4 1.9 3.8 1.9 3.6 1.8 3.5 1.8 3.3 1.8 3.1 1.8 2.9 1.8 2.7 1.9 2.6 2 2.4 2.1 2.3 2.2 2.2 2.3 2.1 2.4 2 2.5 2 2.6 1.8 2.8 1.8 3 1.8 3.3 1.8 3.4 1.8 3.5 1.8 3.6 1.8 3.8 1.9 3.9 2 4 2.1 4.2 2.2 4.4 2.4 4.5 2.5 4.6 2.6 4.7 2.7 4.7 2.8 4.7 2.9 4.8 2.9 4.8 3 4.8 3 4.8 3 4.8L3 4.8ZM13.1 15.2C13.2 15.1 13.2 15.1 13.2 15.1 13.3 14.9 13.4 14.7 13.6 14.5 13.8 14.2 14.1 14 14.4 13.8 14.7 13.6 15.1 13.5 15.5 13.4 15.9 13.4 16.3 13.4 16.7 13.5 17.2 13.5 17.6 13.7 17.9 13.9 18.2 14.1 18.5 14.4 18.7 14.7 18.9 15 19.1 15.3 19.2 15.6 19.3 15.9 19.4 16.1 19.4 16.4 19.4 17 19.3 17.5 19.1 18.1 19 18.3 18.9 18.5 18.7 18.7 18.5 19 18.3 19.2 18 19.4 17.7 19.6 17.3 19.8 16.9 19.9 16.6 20 16.3 20 16 20 15.8 20 15.6 20 15.4 19.9 15.4 19.9 15.4 19.9 15.4 19.9 15.2 19.9 15 19.8 14.9 19.8 14.8 19.7 14.7 19.7 14.6 19.7 14.4 19.6 14.3 19.5 14.1 19.3 13.7 19.1 13.4 18.7 13.2 18.4 13.1 18.1 12.9 17.8 12.9 17.5 12.8 17.3 12.8 17.1 12.8 16.9L3.5 14.9C3.3 14.9 3.1 14.8 3 14.8 2.7 14.7 2.4 14.5 2.1 14.3 1.7 14 1.4 13.7 1.2 13.3 1 13 0.9 12.6 0.8 12.3 0.7 12 0.7 11.7 0.7 11.4 0.7 11 0.8 10.5 1 10.1 1.1 9.8 1.3 9.5 1.6 9.2 1.8 8.9 2.1 8.7 2.4 8.5 2.8 8.3 3.2 8.1 3.6 8.1 3.9 8 4.2 8 4.5 8 4.6 8 4.8 8 4.9 8.1L6.8 8.5C6.8 8.4 6.8 8.4 6.8 8.4 6.9 8.2 7.1 8 7.2 7.8 7.5 7.5 7.7 7.3 8 7.1 8.4 6.9 8.7 6.8 9.1 6.7 9.5 6.7 10 6.7 10.4 6.8 10.8 6.8 11.2 7 11.5 7.2 11.8 7.5 12.1 7.7 12.4 8 12.6 8.3 12.7 8.6 12.8 8.9 12.9 9.2 13 9.4 13 9.7 13 9.7 13 9.8 13 9.8 13.6 9.9 14.2 10.1 14.9 10.2 15 10.2 15 10.2 15.1 10.2 15.3 10.2 15.4 10.2 15.6 10.2 15.8 10.1 16 10 16.2 9.9 16.4 9.8 16.5 9.6 16.6 9.5 16.8 9.2 16.9 8.8 16.9 8.5 16.9 8.3 16.9 8.2 16.8 8 16.8 7.8 16.7 7.7 16.6 7.5 16.5 7.3 16.3 7.2 16.2 7.1 16 7 15.9 6.9 15.8 6.9 15.7 6.9 15.6 6.8 15.5 6.8L6.2 4.8C6.2 5 6 5.2 5.9 5.3 5.7 5.6 5.5 5.8 5.3 6 4.9 6.2 4.5 6.4 4.1 6.5 3.8 6.6 3.5 6.6 3.2 6.6 3 6.6 2.8 6.6 2.7 6.6 2.6 6.6 2.6 6.5 2.6 6.5 2.5 6.5 2.3 6.5 2.1 6.4 1.8 6.3 1.6 6.1 1.3 6 1 5.7 0.7 5.4 0.5 5 0.3 4.7 0.2 4.4 0.1 4.1 0 3.8 0 3.6 0 3.3 0 2.8 0.1 2.2 0.4 1.7 0.5 1.5 0.7 1.3 0.8 1.1 1.1 0.8 1.3 0.6 1.6 0.5 2 0.3 2.3 0.1 2.7 0.1 3.1 0 3.6 0 4 0.1 4.4 0.2 4.8 0.3 5.1 0.5 5.5 0.8 5.7 1 6 1.3 6.2 1.6 6.3 1.9 6.4 2.3 6.5 2.5 6.6 2.7 6.6 3 6.6 3 6.6 3.1 6.6 3.1 9.7 3.8 12.8 4.4 15.9 5.1 16.1 5.1 16.2 5.2 16.4 5.2 16.7 5.3 16.9 5.5 17.2 5.6 17.5 5.9 17.8 6.2 18.1 6.5 18.3 6.8 18.4 7.2 18.6 7.5 18.6 7.9 18.7 8.2 18.7 8.6 18.7 9 18.6 9.4 18.4 9.8 18.3 10.1 18.2 10.3 18 10.6 17.8 10.9 17.5 11.1 17.3 11.3 16.9 11.6 16.5 11.8 16 11.9 15.7 12 15.3 12 15 12 14.8 12 14.7 12 14.5 11.9 13.9 11.8 13.3 11.7 12.6 11.5 12.5 11.7 12.4 11.9 12.3 12 12.1 12.3 11.9 12.5 11.7 12.7 11.3 12.9 10.9 13.1 10.5 13.2 10.2 13.3 9.9 13.3 9.6 13.3 9.4 13.3 9.2 13.3 9 13.2 9 13.2 9 13.2 9 13.2 8.8 13.2 8.7 13.2 8.5 13.1 8.2 13 8 12.8 7.7 12.6 7.4 12.4 7.1 12 6.8 11.7 6.7 11.4 6.6 11.1 6.5 10.8 6.4 10.6 6.4 10.4 6.4 10.2 5.8 10.1 5.2 9.9 4.5 9.8 4.4 9.8 4.4 9.8 4.3 9.8 4.1 9.8 4 9.8 3.8 9.8 3.6 9.9 3.4 10 3.2 10.1 3 10.2 2.9 10.4 2.8 10.5 2.6 10.8 2.5 11.1 2.5 11.5 2.5 11.6 2.5 11.8 2.6 12 2.6 12.1 2.7 12.3 2.8 12.5 2.9 12.6 3.1 12.8 3.2 12.9 3.3 13 3.5 13.1 3.6 13.1 3.7 13.1 3.8 13.2 3.9 13.2L13.1 15.2 13.1 15.2Z" fill="currentColor"></path></g></svg><span>Tutorials</span></a></li><li class="nav-offers flyout-parent"><a href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch04.html#" class="l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 50 50" version="1.1" fill="#4A3C31"><desc>offers icon</desc><path d="M10.8 43.7L0 39 0 10.2 13.6 4.6 23.3 8.7 11.5 13.5C11 13.6 10.8 13.9 10.8 14.3L10.8 43.7 10.8 43.7Z"></path><polygon points="12.3 44.4 25 50 38 44.3 38 14.7 25.2 9.4 12.3 14.7 12.3 44.4"></polygon><path d="M36.6 4.7L50 10.2 50 39 39.5 43.6 39.5 14.3C39.5 13.8 39.2 13.6 38.8 13.5L27 8.7 36.6 4.7 36.6 4.7Z"></path><polygon points="34.8 4 25 0 15.4 3.9 25.2 7.9 34.8 4"></polygon></svg><span>Offers</span></a><ul class="flyout"><li><a href="https://www.safaribooksonline.com/oreilly-conferences/" class="l2 nav-icn"><span>Conferences</span></a></li><li><a href="https://www.safaribooksonline.com/oreilly-newsletters/" class="l2 nav-icn"><span>Newsletter</span></a></li></ul></li><li class="nav-highlights"><a href="https://www.safaribooksonline.com/u/003o000000t5q9fAAA/" class="t-highlights-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 35" version="1.1" fill="#4A3C31"><desc>highlights icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M13.325 18.071L8.036 18.071C8.036 11.335 12.36 7.146 22.5 5.594L22.5 0C6.37 1.113 0 10.632 0 22.113 0 29.406 3.477 35 10.403 35 15.545 35 19.578 31.485 19.578 26.184 19.578 21.556 17.211 18.891 13.325 18.071L13.325 18.071ZM40.825 18.071L35.565 18.071C35.565 11.335 39.86 7.146 50 5.594L50 0C33.899 1.113 27.5 10.632 27.5 22.113 27.5 29.406 30.977 35 37.932 35 43.045 35 47.078 31.485 47.078 26.184 47.078 21.556 44.74 18.891 40.825 18.071L40.825 18.071Z" fill="currentColor"></path></g></svg><span>Highlights</span></a></li><li><a href="https://www.safaribooksonline.com/u/" class="t-settings-nav l1 js-settings nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z" fill="currentColor"></path></g></svg><span>Settings</span></a></li><li><a href="https://community.safaribooksonline.com/" class="l1 no-icon">Feedback</a></li><li><a href="https://www.safaribooksonline.com/accounts/logout/" class="l1 no-icon">Sign Out</a></li></ul><ul class="profile"><li><a href="https://www.safaribooksonline.com/u/" class="l2 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z" fill="currentColor"></path></g></svg><span>Settings</span></a></li><li><a href="https://community.safaribooksonline.com/" class="l2">Feedback</a></li><li><a href="https://www.safaribooksonline.com/accounts/logout/" class="l2">Sign Out</a></li></ul></div></li></ul></nav></header>


      </div>
      <div id="container" class="application">
        
          <div class="nav-container clearfix">
            


            
            
          </div>

          

  <div class="js-toc">
    
      <div class="sbo-reading-menu sbo-menu-top"><section class="sbo-toc-container toc-menu"><a href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch04.html#" class="sbo-toc-thumb"><span class="sbo-title ss-list"><h1><div class="visuallyhidden">Table of Contents for </div>
      
      Effective C++: 55 Specific Ways to Improve Your Programs and Designs, Third Edition
      
    </h1></span></a><div class="toc-contents"></div></section></div>

    

    <div class="interface-controls interface-controls-top">
      <ul class="interface-control-btns js-bitlist js-reader">
        <li class="js-search-in-archive search-in-archive t-search-in-archive"><a href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch04.html#" title="Search in archive" class="js-search-controls search-controls"><span class="icon">Search in book...</span></a><form class="search-archive-bar js-search-form"><input type="search" name="query" placeholder="Search inside this book..." autocomplete="off"></form><div class="search-archive-results"><div class="js-sitb-results-region"></div></div></li><li class="queue-control"><button type="button" class="rec-fav ss-queue js-queue js-current-chapter-queue" data-queue-endpoint="/api/v1/book/0321334876/chapter/ch04.html" data-for-analytics="0321334876:ch04.html"><span>Add to Queue</span></button></li><li class="js-font-control-panel font-control-activator"><a href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch04.html#" data-push-state="false" id="font-controls" title="Change font size" aria-label="Change font size"><span class="icon">Toggle Font Controls</span></a></li><li class="dropdown sharing-controls"><a href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch04.html#" class="trigger" data-push-state="false" title="Share" aria-label="Share"><i class="fa fa-share"></i></a><ul class="social-sharing dropdown-menu"><li><a class="twitter share-button t-twitter" target="_blank" aria-label="Share this section on Twitter" title="Share this section on Twitter" href="https://twitter.com/share?url=https://www.safaribooksonline.com/library/view/effective-c-55/0321334876/ch04.html&amp;text=Effective%20C%2B%2B%3A%2055%20Specific%20Ways%20to%20Improve%20Your%20Programs%20and%20Designs%2C%20Third%20Edition&amp;via=safari"><span>Twitter</span></a></li><li><a class="facebook share-button t-facebook" target="_blank" aria-label="Share this section on Facebook" title="Share this section on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://www.safaribooksonline.com/library/view/effective-c-55/0321334876/ch04.html"><span>Facebook</span></a></li><li><a class="googleplus share-button t-googleplus" target="_blank" aria-label="Share this secton on Google Plus" title="Share this secton on Google Plus" href="https://plus.google.com/share?url=https://www.safaribooksonline.com/library/view/effective-c-55/0321334876/ch04.html"><span>Google Plus</span></a></li><li><a class="email share-button t-email" aria-label="Share this section via email" title="Share this section via email" href="mailto:?subject=Safari:%204.%20Designs%20and%20Declarations&amp;body=https://www.safaribooksonline.com/library/view/effective-c-55/0321334876/ch04.html%0D%0Afrom%20Effective%20C%2B%2B%3A%2055%20Specific%20Ways%20to%20Improve%20Your%20Programs%20and%20Designs%2C%20Third%20Edition%0D%0A"><span>Email</span></a></li></ul></li>
      </ul>
    </div>

    <section role="document">
      
	  <div class="t-sbo-prev sbo-prev sbo-nav-top">
  
    
      
        <a href="/library/view/effective-c-55/0321334876/ch03.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">3. Resource Management</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-top">
  
    
      
        <a href="/library/view/effective-c-55/0321334876/ch05.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">5. Implementations</div>
        </a>
    
  
  </div>



<div id="sbo-rt-content"><div class="annotator-wrapper"><h2 id="ch04">4. Designs and Declarations</h2>
<p class="noindent"><a id="page_78"></a>Software designs — approaches to getting the software to do what you want it to do — typically begin as fairly general ideas, but they eventually become detailed enough to allow for the development of specific interfaces. These interfaces must then be translated into C++ declarations. In this chapter, we attack the problem of designing and declaring good C++ interfaces. We begin with perhaps the most important guideline about designing interfaces of any kind: that they should be easy to use correctly and hard to use incorrectly. That sets the stage for a number of more specific guidelines addressing a wide range of topics, including correctness, efficiency, encapsulation, maintainability, extensibility, and conformance to convention.</p>
<p class="noindent">The material that follows isn't everything you need to know about good interface design, but it highlights some of the most important considerations, warns about some of the most frequent errors, and provides solutions to problems often encountered by class, function, and template designers.</p>
<h3 id="ch04lev1sec1">Item 18: Make interfaces easy to use correctly and hard to use incorrectly</h3>
<p class="noindent">C++ is awash in interfaces. Function interfaces. Class interfaces. Template interfaces. Each interface is a means by which clients interact with your code. Assuming you're dealing with reasonable people, those clients are trying to do a good job. They <em>want</em> to use your interfaces correctly. That being the case, if they use one incorrectly, your interface is at least partially to blame. Ideally, if an attempted use of an interface won't do what the client expects, the code won't compile; and if the code does compile, it will do what the client wants.</p>
<p class="noindent">Developing interfaces that are easy to use correctly and hard to use incorrectly requires that you consider the kinds of mistakes that clients <a id="page_79"></a>might make. For example, suppose you're designing the constructor for a class representing dates in time:</p>
<p class="programlisting"><br>class Date {<br>public:<br>&nbsp;&nbsp;<span class="courierb">Date(int month, int day, int year);</span><br>&nbsp;&nbsp;...<br>};<br></p>
<p class="noindent">At first glance, this interface may seem reasonable (at least in the USA), but there are at least two errors that clients might easily make. First, they might pass parameters in the wrong order:</p>
<p class="codelink"><a id="procode121"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode121">Click here to view code image</a></p>
<p class="programlisting"><br>Date d(<span class="courierb">30, 3</span>, 1995);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Oops! Should be "3, 30", not "30, 3"<br></p>
<p class="noindent">Second, they might pass an invalid month or day number:</p>
<p class="codelink"><a id="procode122"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode122">Click here to view code image</a></p>
<p class="programlisting"><br>Date d(<span class="courierb">2, 20</span>, 1995);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Oops! Should be "3, 30", not "2, 20"<br></p>
<p class="noindent">(This last example may look silly, but remember that on a keyboard, 2 is next to 3. Such “off by one” typing errors are not uncommon.)</p>
<p class="noindent">Many client errors can be prevented by the introduction of new types. Indeed, the type system is your primary ally in preventing undesirable code from compiling. In this case, we can introduce simple wrapper types to distinguish days, months, and years, then use these types in the <code>Date</code> constructor:</p>
<p class="codelink"><a id="procode123"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode123">Click here to view code image</a></p>
<p class="programlisting"><br><span class="courierb">struct Day</span> {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="courierb">struct Month</span> {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="courierb">struct Year</span> {<br>&nbsp;&nbsp;explicit Day(int d)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;explicit Month(int m)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;explicit Year(int y)<br>&nbsp;&nbsp;:val(d) {}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:val(m) {}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:val(y){}<br><br>&nbsp;&nbsp;int val;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int val;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int val;<br>};&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;};<br>class Date {<br>public:<br>Date(<span class="courierb">const Month&amp; m, const Day&amp; d, const Year&amp; y</span>);<br>...<br>};<br>Date d(30, 3, 1995);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// error! wrong types<br><br>Date d(Day(30), Month(3), Year(1995));&nbsp;&nbsp;&nbsp;&nbsp;// error! wrong types<br><br>Date d(Month(3), Day(30), Year(1995));&nbsp;&nbsp;&nbsp;&nbsp;// okay, types are correct<br></p>
<p class="noindent">Making <code>Day</code>, <code>Month</code>, and <code>Year</code> full-fledged classes with encapsulated data would be better than the simple use of structs above (see <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch04.html#ch04lev1sec5">Item 22</a>), but even structs suffice to demonstrate that the judicious introduction of new types can work wonders for the prevention of interface usage errors.</p>
<p class="noindent"><a id="page_80"></a>Once the right types are in place, it can sometimes be reasonable to restrict the values of those types. For example, there are only 12 valid month values, so the <code>Month</code> type should reflect that. One way to do this would be to use an enum to represent the month, but enums are not as type-safe as we might like. For example, enums can be used like <code>int</code>s (see <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch01.html#ch01lev1sec2">Item 2</a>). A safer solution is to predefine the set of all valid <code>Month</code>s:</p>
<p class="codelink"><a id="procode124"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode124">Click here to view code image</a></p>
<p class="programlisting"><br>class Month {<br>public:<br>&nbsp;&nbsp;static Month Jan() { return Month(1); }&nbsp;&nbsp;&nbsp;// functions returning all valid<br>&nbsp;&nbsp;static Month Feb() { return Month(2); }&nbsp;&nbsp;&nbsp;// Month values; see below for<br>&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// why these are functions, not<br>&nbsp;&nbsp;static Month Dec() { return Month(12); }&nbsp;&nbsp;// objects<br>&nbsp;&nbsp;<br>&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// other member functions<br><br>private:<br>&nbsp;&nbsp;explicit Month(int m);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// prevent creation of new<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Month values<br><br>&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// month-specific data<br>};<br>Date d(<span class="courierb">Month::Mar()</span>, Day(30), Year(1995));<br></p>
<p class="noindent">If the idea of using functions instead of objects to represent specific months strikes you as odd, it may be because you have forgotten that reliable initialization of non-local static objects can be problematic. <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch01.html#ch01lev1sec4">Item 4</a> can refresh your memory.</p>
<p class="noindent">Another way to prevent likely client errors is to restrict what can be done with a type. A common way to impose restrictions is to add <code>const</code>. For example, <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch01.html#ch01lev1sec3">Item 3</a> explains how <code>const</code>-qualifying the return type from <code>operator*</code> can prevent clients from making this error for user-defined types:</p>
<p class="codelink"><a id="procode125"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode125">Click here to view code image</a></p>
<p class="programlisting"><br>if (a * b = c) ...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// oops, meant to do a comparison!<br></p>
<p class="noindent">In fact, this is just a manifestation of another general guideline for making types easy to use correctly and hard to use incorrectly: unless there's a good reason not to, have your types behave consistently with the built-in types. Clients already know how types like <code>int</code> behave, so you should strive to have your types behave the same way whenever reasonable. For example, assignment to <code>a*b</code> isn't legal if <code>a</code> and <code>b</code> are <code>int</code>s, so unless there's a good reason to diverge from this behavior, it should be illegal for your types, too. When in doubt, do as the <code>int</code>s do.</p>
<p class="noindent">The real reason for avoiding gratuitous incompatibilities with the built-in types is to offer interfaces that behave consistently. Few characteristics lead to interfaces that are easy to use correctly as much as consistency, and few characteristics lead to aggravating interfaces as <a id="page_81"></a>much as inconsistency. The interfaces to STL containers are largely (though not perfectly) consistent, and this helps make them fairly easy to use. For example, every STL container has a member function named <code>size</code> that tells how many objects are in the container. Contrast this with Java, where you use the <code>length</code> <em>property</em> for arrays, the <code>length</code> <em>method</em> for <code>String</code>s, and the <code>size</code> <em>method</em> for <code>List</code>s; and with .NET, where <code>Array</code>s have a property named <code>Length</code>, while <code>ArrayList</code>s have a property named <code>Count</code>. Some developers think that integrated development environments (IDEs) render such inconsistencies unimportant, but they are mistaken. Inconsistency imposes mental friction into a developer's work that no IDE can fully remove.</p>
<p class="noindent">Any interface that requires that clients remember to do something is prone to incorrect use, because clients can forget to do it. For example, <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch03.html#ch03lev1sec1">Item 13</a> introduces a factory function that returns pointers to dynamically allocated objects in an <code>Investment</code> hierarchy:</p>
<p class="codelink"><a id="procode126"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode126">Click here to view code image</a></p>
<p class="programlisting"><br>Investment* createInvestment();&nbsp;&nbsp;&nbsp;// from Item 13; parameters omitted<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// for simplicity<br></p>
<p class="noindent">To avoid resource leaks, the pointers returned from <code>createInvestment</code> must eventually be deleted, but that creates an opportunity for at least two types of client errors: failure to delete a pointer, and deletion of the same pointer more than once.</p>
<p class="noindent"><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch03.html#ch03lev1sec1">Item 13</a> shows how clients can store <code>createInvestment</code>'s return value in a smart pointer like <code>auto_ptr</code> or <code>tr1::shared_ptr</code>, thus turning over to the smart pointer the responsibility for using <code>delete</code>. But what if clients forget to use the smart pointer? In many cases, a better interface decision would be to preempt the problem by having the factory function return a smart pointer in the first place:</p>
<p class="codelink"><a id="procode127"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode127">Click here to view code image</a></p>
<p class="programlisting"><br><span class="courierb">std::tr1::shared_ptr&lt;Investment&gt;</span> createInvestment();<br></p>
<p class="noindent">This essentially forces clients to store the return value in a <code>tr1::shared_ptr</code>, all but eliminating the possibility of forgetting to delete the underlying <code>Investment</code> object when it's no longer being used.</p>
<p class="noindent">In fact, returning a <code>tr1::shared_ptr</code> makes it possible for an interface designer to prevent a host of other client errors regarding resource release, because, as <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch03.html#ch03lev1sec2">Item 14</a> explains, <code>tr1::shared_ptr</code> allows a resource-release function — a “deleter” — to be bound to the smart pointer when the smart pointer is created. (<code>auto_ptr</code> has no such capability.)</p>
<p class="noindent">Suppose clients who get an <code>Investment*</code> pointer from <code>createInvestment</code> are expected to pass that pointer to a function called <code>getRidOfInvestment</code> instead of using delete on it. Such an interface would open the door to a new kind of client error, one where clients use the wrong <a id="page_82"></a>resource-destruction mechanism (i.e., <code>delete</code> instead of <code>getRidOfInvestment</code>). The implementer of <code>createInvestment</code> can forestall such problems by returning a <code>tr1::shared_ptr</code> with <code>getRidOfInvestment</code> bound to it as its deleter.</p>
<p class="noindent"><code>tr1::shared_ptr</code> offers a constructor taking two arguments: the pointer to be managed and the deleter to be called when the reference count goes to zero. This suggests that the way to create a null <code>tr1::shared_ptr</code> with <code>getRidOfInvestment</code> as its deleter is this:</p>
<p class="codelink"><a id="procode128"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode128">Click here to view code image</a></p>
<p class="programlisting"><br>std::tr1::shared_ptr&lt;Investment&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// attempt to create a null<br>&nbsp;&nbsp;pInv(<span class="courierb">0, getRidOfInvestment</span>);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// shared_ptr with a custom deleter;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// <span class="courieri">this won't compile</span><br></p>
<p class="noindent">Alas, this isn't valid C++. The <code>tr1::shared_ptr</code> constructor insists on its first parameter being a <em>pointer</em>, and 0 isn't a pointer, it's an <code>int</code>. Yes, it's <em>convertible</em> to a pointer, but that's not good enough in this case; <code>tr1::shared_ptr</code> insists on an actual pointer. A cast solves the problem:</p>
<p class="codelink"><a id="procode129"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode129">Click here to view code image</a></p>
<p class="programlisting"><br>std::tr1::shared_ptr&lt;Investment&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// create a null shared_ptr with<br>&nbsp;&nbsp;pInv(<span class="courierb">static_cast&lt;Investment*&gt;(</span>0<span class="courierb">)</span>,&nbsp;&nbsp;&nbsp;// getRidOfInvestment as its<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getRidOfInvestment);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// deleter; see Item 27 for info on<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// static_cast<br></p>
<p class="noindent">This means that the code for implementing <code>createInvestment</code> to return a <code>tr1::shared_ptr</code> with <code>getRidOfInvestment</code> as its deleter would look something like this:</p>
<p class="codelink"><a id="procode130"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode130">Click here to view code image</a></p>
<p class="programlisting"><br>std::tr1::shared_ptr&lt;Investment&gt; createInvestment()<br>{<br>&nbsp;&nbsp;std::tr1::shared_ptr&lt;Investment&gt; retVal(static_cast&lt;Investment*&gt;(0),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getRidOfInvestment);<br><br>&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// make retVal point to the<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// correct object<br><br>&nbsp;&nbsp;return retVal;<br>}<br></p>
<p class="noindent">Of course, if the raw pointer to be managed by <code>retVal</code> could be determined prior to creating <code>retVal</code>, it would be better to pass the raw pointer to <code>retVal</code>'s constructor instead of initializing <code>retVal</code> to null and then making an assignment to it. For details on why, consult <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch05.html#ch05lev1sec1">Item 26</a>.</p>
<p class="noindent">An especially nice feature of <code>tr1::shared_ptr</code> is that it automatically uses its per-pointer deleter to eliminate another potential client error, the “cross-DLL problem.” This problem crops up when an object is created using <code>new</code> in one dynamically linked library (DLL) but is <code>delete</code>d in a different DLL. On many platforms, such cross-DLL <code>new</code>/<code>delete</code> pairs lead to runtime errors. <code>tr1::shared_ptr</code> avoids the problem, because its default deleter uses <code>delete</code> from the same DLL where the <a id="page_83"></a><code>tr1::shared_ptr</code> is created. This means, for example, that if <code>Stock</code> is a class derived from <code>Investment</code> and <code>createInvestment</code> is implemented like this,</p>
<p class="codelink"><a id="procode131"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode131">Click here to view code image</a></p>
<p class="programlisting"><br>std::tr1::shared_ptr&lt;Investment&gt; createInvestment()<br>{<br>&nbsp;&nbsp;return std::tr1::shared_ptr&lt;Investment&gt;(new Stock);<br>}<br></p>
<p class="noindent">the returned <code>tr1::shared_ptr</code> can be passed among DLLs without concern for the cross-DLL problem. The <code>tr1::shared_ptr</code>s pointing to the <code>Stock</code> keep track of which DLL's <code>delete</code> should be used when the reference count for the <code>Stock</code> becomes zero.</p>
<p class="noindent">This Item isn't about <code>tr1::shared_ptr</code> — it's about making interfaces easy to use correctly and hard to use incorrectly — but <code>tr1::shared_ptr</code> is such an easy way to eliminate some client errors, it's worth an overview of the cost of using it. The most common implementation of <code>tr1::shared_ptr</code> comes from Boost (see <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch09.html#ch09lev1sec3">Item 55</a>). Boost's <code>shared_ptr</code> is twice the size of a raw pointer, uses dynamically allocated memory for bookkeeping and deleter-specific data, uses a virtual function call when invoking its deleter, and incurs thread synchronization overhead when modifying the reference count in an application it believes is multithreaded. (You can disable multithreading support by defining a preprocessor symbol.) In short, it's bigger than a raw pointer, slower than a raw pointer, and uses auxiliary dynamic memory. In many applications, these additional runtime costs will be unnoticeable, but the reduction in client errors will be apparent to everyone.</p>
<div class="note">
<h3 id="ch04note01">Things to Remember</h3>
<p class="indenthanding">• Good interfaces are easy to use correctly and hard to use incorrectly. Your should strive for these characteristics in all your interfaces.</p>
<p class="indenthanding">• Ways to facilitate correct use include consistency in interfaces and behavioral compatibility with built-in types.</p>
<p class="indenthanding">• Ways to prevent errors include creating new types, restricting operations on types, constraining object values, and eliminating client resource management responsibilities.</p>
<p class="indenthanding">• <code>tr1::shared_ptr</code> supports custom deleters. This prevents the cross-DLL problem, can be used to automatically unlock mutexes (see <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch03.html#ch03lev1sec2">Item 14</a>), etc.</p>
</div>
<h3 id="ch04lev1sec2">Item 19: Treat class design as type design</h3>
<p class="noindent"><a id="page_84"></a>In C++, as in other object-oriented programming languages, defining a new class defines a new type. Much of your time as a C++ developer will thus be spent augmenting your type system. This means you're not just a class designer, you're a <em>type</em> designer. Overloading functions and operators, controlling memory allocation and deallocation, defining object initialization and finalization — it's all in your hands. You should therefore approach class design with the same care that language designers lavish on the design of the language's built-in types.</p>
<p class="noindent">Designing good classes is challenging because designing good types is challenging. Good types have a natural syntax, intuitive semantics, and one or more efficient implementations. In C++, a poorly planned class definition can make it impossible to achieve any of these goals. Even the performance characteristics of a class's member functions may be affected by how they are declared.</p>
<p class="noindent">How, then, do you design effective classes? First, you must understand the issues you face. Virtually every class requires that you confront the following questions, the answers to which often lead to constraints on your design:</p>
<p class="indenthanding">• <strong>How should objects of your new type be created and destroyed?</strong> How this is done influences the design of your class's constructors and destructor, as well as its memory allocation and deallocation functions (<code>operator new</code>, <code>operator new[]</code>, <code>operator delete</code>, and <code>operator delete[]</code> — see <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch08.html">Chapter 8</a>), if you write them.</p>
<p class="indenthanding">• <strong>How should object initialization differ from object assignment?</strong> The answer to this question determines the behavior of and the differences between your constructors and your assignment operators. It's important not to confuse initialization with assignment, because they correspond to different function calls (see <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch01.html#ch01lev1sec4">Item 4</a>).</p>
<p class="indenthanding">• <strong>What does it mean for objects of your new type to be passed by value?</strong> Remember, the copy constructor defines how pass-by-value is implemented for a type.</p>
<p class="indenthanding">• <strong>What are the restrictions on legal values for your new type?</strong> Usually, only some combinations of values for a class's data members are valid. Those combinations determine the invariants your class will have to maintain. The invariants determine the error checking you'll have to do inside your member functions, especially your constructors, assignment operators, and “setter” functions. It may also affect the exceptions your functions throw and, <a id="page_85"></a>on the off chance you use them, your functions' exception specifications.</p>
<p class="indenthanding">• <strong>Does your new type fit into an inheritance graph?</strong> If you inherit from existing classes, you are constrained by the design of those classes, particularly by whether their functions are virtual or non-virtual (see <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch06.html#ch06lev1sec3">Items 34</a> and <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch06.html#ch06lev1sec5">36</a>). If you wish to allow other classes to inherit from your class, that affects whether the functions you declare are virtual, especially your destructor (see <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch02.html#ch02lev1sec3">Item 7</a>).</p>
<p class="indenthanding">• <strong>What kind of type conversions are allowed for your new type?</strong> Your type exists in a sea of other types, so should there be conversions between your type and other types? If you wish to allow objects of type <code>T1</code> to be <em>implicitly</em> converted into objects of type <code>T2</code>, you will want to write either a type conversion function in class <code>T1</code> (e.g., <code>operator T2</code>) or a non-<code>explicit</code> constructor in class <code>T2</code> that can be called with a single argument. If you wish to allow <em>explicit</em> conversions only, you'll want to write functions to perform the conversions, but you'll need to avoid making them type conversion operators or non-<code>explicit</code> constructors that can be called with one argument. (For an example of both implicit and explicit conversion functions, see <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch03.html#ch03lev1sec3">Item 15</a>.)</p>
<p class="indenthanding">• <strong>What operators and functions make sense for the new type?</strong> The answer to this question determines which functions you'll declare for your class. Some functions will be member functions, but some will not (see <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch04.html#ch04lev1sec6">Items 23</a>, <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch04.html#ch04lev1sec7">24</a>, and <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch07.html#ch07lev1sec6">46</a>).</p>
<p class="indenthanding">• <strong>What standard functions should be disallowed?</strong> Those are the ones you'll need to declare <code>private</code> (see <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch02.html#ch02lev1sec2">Item 6</a>).</p>
<p class="indenthanding">• <strong>Who should have access to the members of your new type?</strong> This question helps you determine which members are public, which are protected, and which are private. It also helps you determine which classes and/or functions should be friends, as well as whether it makes sense to nest one class inside another.</p>
<p class="indenthanding">• <strong>What is the “undeclared interface” of your new type?</strong> What kind of guarantees does it offer with respect to performance, exception safety (see <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch05.html#ch05lev1sec4">Item 29</a>), and resource usage (e.g., locks and dynamic memory)? The guarantees you offer in these areas will impose constraints on your class implementation.</p>
<p class="indenthanding">• <strong>How general is your new type?</strong> Perhaps you're not really defining a new type. Perhaps you're defining a whole <em>family</em> of types. If so, you don't want to define a new class, you want to define a new class <em>template</em>.</p>
<p class="indenthanding">• <a id="page_86"></a><strong>Is a new type really what you need?</strong> If you're defining a new derived class only so you can add functionality to an existing class, perhaps you'd better achieve your goals by simply defining one or more non-member functions or templates.</p>
<p class="noindent">These questions are difficult to answer, so defining effective classes can be challenging. Done well, however, user-defined classes in C++ yield types that are at least as good as the built-in types, and that makes all the effort worthwhile.</p>
<div class="note">
<h3 id="ch04note02">Things to Remember</h3>
<p class="indenthanding">• Class design is type design. Before defining a new type, be sure to consider all the issues discussed in this Item.</p>
</div>
<h3 id="ch04lev1sec3">Item 20: Prefer pass-by-reference-to-<code>const</code> to pass-by-value</h3>
<p class="noindent">By default, C++ passes objects to and from functions by value (a characteristic it inherits from C). Unless you specify otherwise, function parameters are initialized with <em>copies</em> of the actual arguments, and function callers get back a <em>copy</em> of the value returned by the function. These copies are produced by the objects' copy constructors. This can make pass-by-value an expensive operation. For example, consider the following class hierarchy:</p>
<p class="codelink"><a id="procode132"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode132">Click here to view code image</a></p>
<p class="programlisting"><br>class Person {<br>public:<br>&nbsp;&nbsp;Person();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// parameters omitted for simplicity<br>&nbsp;&nbsp;virtual ~Person();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// see Item 7 for why this is virtual<br>&nbsp;&nbsp;...<br><br>private:<br>&nbsp;&nbsp;std::string name;<br>&nbsp;&nbsp;std::string address;<br>};<br>class Student: public Person {<br>public:<br>&nbsp;&nbsp;Student();&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// parameters again omitted<br>&nbsp;&nbsp;~Student();<br>&nbsp;&nbsp;...<br><br>private:<br>&nbsp;&nbsp;std::string schoolName;<br>&nbsp;&nbsp;std::string schoolAddress;<br>};<br></p>
<p class="noindent"><a id="page_87"></a>Now consider the following code, in which we call a function, <code>validateStudent</code>, that takes a <code>Student</code> argument (by value) and returns whether it has been validated:</p>
<p class="codelink"><a id="procode133"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode133">Click here to view code image</a></p>
<p class="programlisting"><br>bool validateStudent(<span class="courierb">Student</span> s);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// function taking a Student<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// by value<br><br>Student plato;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Plato studied under Socrates<br><br>bool platoIsOK = validateStudent(plato);&nbsp;&nbsp;&nbsp;// call the function<br></p>
<p class="noindent">What happens when this function is called?</p>
<p class="noindent">Clearly, the <code>Student</code> copy constructor is called to initialize the parameter <code>s</code> from <code>plato</code>. Equally clearly, <code>s</code> is destroyed when <code>validateStudent</code> returns. So the parameter-passing cost of this function is one call to the <code>Student</code> copy constructor and one call to the <code>Student</code> destructor.</p>
<p class="noindent">But that's not the whole story. A <code>Student</code> object has two <code>string</code> objects within it, so every time you construct a <code>Student</code> object you must also construct two <code>string</code> objects. A <code>Student</code> object also inherits from a <code>Person</code> object, so every time you construct a <code>Student</code> object you must also construct a <code>Person</code> object. A <code>Person</code> object has two additional <code>string</code> objects inside it, so each <code>Person</code> construction also entails two more <code>string</code> constructions. The end result is that passing a <code>Student</code> object by value leads to one call to the <code>Student</code> copy constructor, one call to the <code>Person</code> copy constructor, and four calls to the <code>string</code> copy constructor. When the copy of the <code>Student</code> object is destroyed, each constructor call is matched by a destructor call, so the overall cost of passing a <code>Student</code> by value is six constructors and six destructors!</p>
<p class="noindent">Now, this is correct and desirable behavior. After all, you <em>want</em> all your objects to be reliably initialized and destroyed. Still, it would be nice if there were a way to bypass all those constructions and destructions. There is: pass by reference-to-<code>const</code>:</p>
<p class="programlisting"><br>bool validateStudent(<span class="courierb">const</span> Student<span class="courierb">&amp;</span> s);<br></p>
<p class="noindent">This is much more efficient: no constructors or destructors are called, because no new objects are being created. The <code>const</code> in the revised parameter declaration is important. The original version of <code>validateStudent</code> took a <code>Student</code> parameter by value, so callers knew that they were shielded from any changes the function might make to the <code>Student</code> they passed in; <code>validateStudent</code> would be able to modify only a <em>copy</em> of it. Now that the <code>Student</code> is being passed by reference, it's necessary to also declare it <code>const</code>, because otherwise callers would have to worry about <code>validateStudent</code> making changes to the <code>Student</code> they passed in.</p>
<p class="noindent">Passing parameters by reference also avoids the <em>slicing problem</em>. When a derived class object is passed (by value) as a base class object, the <a id="page_88"></a>base class copy constructor is called, and the specialized features that make the object behave like a derived class object are “sliced” off. You're left with a simple base class object — little surprise, since a base class constructor created it. This is almost never what you want. For example, suppose you're working on a set of classes for implementing a graphical window system:</p>
<p class="codelink"><a id="procode134"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode134">Click here to view code image</a></p>
<p class="programlisting"><br>class Window {<br>public:<br>&nbsp;&nbsp;...<br>&nbsp;&nbsp;std::string name() const;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// return name of window<br>&nbsp;&nbsp;virtual void display() const;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// draw window and contents<br>};<br><br>class WindowWithScrollBars: public Window {<br>public:<br>&nbsp;&nbsp;...<br>&nbsp;&nbsp;virtual void display() const;<br>};<br></p>
<p class="noindent">All <code>Window</code> objects have a name, which you can get at through the <code>name</code> function, and all windows can be displayed, which you can bring about by invoking the <code>display</code> function. The fact that <code>display</code> is virtual tells you that the way in which simple base class <code>Window</code> objects are displayed is apt to differ from the way in which the fancier <code>WindowWithScrollBars</code> objects are displayed (see <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch06.html#ch06lev1sec3">Items 34</a> and <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch06.html#ch06lev1sec5">36</a>).</p>
<p class="noindent">Now suppose you'd like to write a function to print out a window's name and then display the window. Here's the <em>wrong</em> way to write such a function:</p>
<p class="codelink"><a id="procode135"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode135">Click here to view code image</a></p>
<p class="programlisting"><br>void printNameAndDisplay(<span class="courierb">Window</span> w)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// incorrect! parameter<br>{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// may be sliced!<br>&nbsp;&nbsp;std::cout &lt;&lt; w.name();<br>&nbsp;&nbsp;w.display();<br>}<br></p>
<p class="noindent">Consider what happens when you call this function with a <code>WindowWithScrollBars</code> object:</p>
<p class="programlisting"><br>WindowWithScrollBars wwsb;<br><br>printNameAndDisplay(wwsb);<br></p>
<p class="noindent">The parameter <code>w</code> will be constructed — it's passed by value, remember? — as a <em><code>Window</code></em> object, and all the specialized information that made <code>wwsb</code> act like a <code>WindowWithScrollBars</code> object will be sliced off. Inside <code>printNameAndDisplay</code>, <code>w</code> will always act like an object of class <code>Window</code> (because it <em>is</em> an object of class <code>Window</code>), regardless of the type of object passed to the function. In particular, the call to <code>display</code> inside <a id="page_89"></a><code>printNameAndDisplay</code> will <em>always</em> call <code>Window::display</code>, never <code>WindowWithScrollBars::display</code>.</p>
<p class="noindent">The way around the slicing problem is to pass <code>w</code> by reference-to-<code>const</code>:</p>
<p class="codelink"><a id="procode136"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode136">Click here to view code image</a></p>
<p class="programlisting"><br>void printNameAndDisplay(<span class="courierb">const</span> Window<span class="courierb">&amp;</span> w)&nbsp;&nbsp;&nbsp;// fine, parameter won't<br>{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// be sliced<br>&nbsp;&nbsp;std::cout &lt;&lt; w.name();<br>&nbsp;&nbsp;w.display();<br>}<br></p>
<p class="noindent">Now <code>w</code> will act like whatever kind of window is actually passed in.</p>
<p class="noindent">If you peek under the hood of a C++ compiler, you'll find that references are typically implemented as pointers, so passing something by reference usually means really passing a pointer. As a result, if you have an object of a built-in type (e.g., an <code>int</code>), it's often more efficient to pass it by value than by reference. For built-in types, then, when you have a choice between pass-by-value and pass-by-reference-to-<code>const</code>, it's not unreasonable to choose pass-by-value. This same advice applies to iterators and function objects in the STL, because, by convention, they are designed to be passed by value. Implementers of iterators and function objects are responsible for seeing to it that they are efficient to copy and are not subject to the slicing problem. (This is an example of how the rules change, depending on the part of C++ you are using — see <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch01.html#ch01lev1sec1">Item 1</a>.)</p>
<p class="noindent">Built-in types are small, so some people conclude that all small types are good candidates for pass-by-value, even if they're user-defined. This is shaky reasoning. Just because an object is small doesn't mean that calling its copy constructor is inexpensive. Many objects — most STL containers among them — contain little more than a pointer, but copying such objects entails copying everything they point to. That can be <em>very</em> expensive.</p>
<p class="noindent">Even when small objects have inexpensive copy constructors, there can be performance issues. Some compilers treat built-in and user-defined types differently, even if they have the same underlying representation. For example, some compilers refuse to put objects consisting of only a <code>double</code> into a register, even though they happily place naked <code>double</code>s there on a regular basis. When that kind of thing happens, you can be better off passing such objects by reference, because compilers will certainly put pointers (the implementation of references) into registers.</p>
<p class="noindent">Another reason why small user-defined types are not necessarily good pass-by-value candidates is that, being user-defined, their size is subject to change. A type that's small now may be bigger in a future <a id="page_90"></a>release, because its internal implementation may change. Things can even change when you switch to a different C++ implementation. As I write this, for example, some implementations of the standard library's <code>string</code> type are <em>seven times</em> as big as others.</p>
<p class="noindent">In general, the only types for which you can reasonably assume that pass-by-value is inexpensive are built-in types and STL iterator and function object types. For everything else, follow the advice of this Item and prefer pass-by-reference-to-<code>const</code> over pass-by-value.</p>
<div class="note">
<h3 id="ch04note03">Things to Remember</h3>
<p class="indenthanding">• Prefer pass-by-reference-to-<code>const</code> over pass-by-value. It's typically more efficient and it avoids the slicing problem.</p>
<p class="indenthanding">• The rule doesn't apply to built-in types and STL iterator and function object types. For them, pass-by-value is usually appropriate.</p>
</div>
<h3 id="ch04lev1sec4">Item 21: Don't try to return a reference when you must return an object</h3>
<p class="noindent">Once programmers grasp the efficiency implications of pass-by-value for objects (see <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch04.html#ch04lev1sec3">Item 20</a>), many become crusaders, determined to root out the evil of pass-by-value wherever it may hide. Unrelenting in their pursuit of pass-by-reference purity, they invariably make a fatal mistake: they start to pass references to objects that don't exist. This is not a good thing.</p>
<p class="noindent">Consider a class for representing rational numbers, including a function for multiplying two rationals together:</p>
<p class="codelink"><a id="procode137"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode137">Click here to view code image</a></p>
<p class="programlisting"><br>class Rational {<br>public:<br>&nbsp;&nbsp;Rational(int numerator = 0,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// see Item 24 for why this<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int denominator = 1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// ctor isn't declared explicit<br><br>&nbsp;&nbsp;...<br><br>private:<br>&nbsp;&nbsp;int n, d;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// numerator and denominator<br><br>friend<br>&nbsp;&nbsp;&nbsp;const Rational&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// see Item 3 for why the<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;operator*(const Rational&amp; lhs,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// return type is const<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const Rational&amp; rhs);<br>};<br></p>
<p class="noindent">This version of <code>operator*</code> is returning its result object by value, and you'd be shirking your professional duties if you failed to worry about the cost of that object's construction and destruction. You don't want <a id="page_91"></a>to pay for such an object if you don't have to. So the question is this: do you have to pay?</p>
<p class="noindent">Well, you don't have to if you can return a reference instead. But remember that a reference is just a <em>name</em>, a name for some <em>existing</em> object. Whenever you see the declaration for a reference, you should immediately ask yourself what it is another name for, because it must be another name for <em>something</em>. In the case of <code>operator*</code>, if the function is to return a reference, it must return a reference to some <code>Rational</code> object that already exists and that contains the product of the two objects that are to be multiplied together.</p>
<p class="noindent">There is certainly no reason to expect that such an object exists prior to the call to <code>operator*</code>. That is, if you have</p>
<p class="codelink"><a id="procode138"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode138">Click here to view code image</a></p>
<p class="programlisting"><br>Rational a(1, 2);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// a = 1/2<br>Rational b(3, 5);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// b = 3/5<br><br>Rational c = a * b;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// c should be 3/10<br></p>
<p class="noindent">it seems unreasonable to expect that there already happens to exist a rational number with the value three-tenths. No, if <code>operator*</code> is to return a reference to such a number, it must create that number object itself.</p>
<p class="noindent">A function can create a new object in only two ways: on the stack or on the heap. Creation on the stack is accomplished by defining a local variable. Using that strategy, you might try to write <code>operator*</code> this way:</p>
<p class="codelink"><a id="procode139"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode139">Click here to view code image</a></p>
<p class="programlisting"><br>const Rational&amp; operator*(const Rational&amp; lhs,&nbsp;&nbsp;&nbsp;// warning! bad code!<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const Rational&amp; rhs)<br>{<br>&nbsp;&nbsp;Rational result(lhs.n * rhs.n, lhs.d * rhs.d);<br>&nbsp;&nbsp;return result;<br>}<br></p>
<p class="noindent">You can reject this approach out of hand, because your goal was to avoid a constructor call, and <code>result</code> will have to be constructed just like any other object. A more serious problem is that this function returns a reference to <code>result</code>, but <code>result</code> is a local object, and local objects are destroyed when the function exits. This version of <code>operator*</code>, then, doesn't return a reference to a <code>Rational —</code> it returns a reference to an <em>ex</em>-<code>Rational</code>; a <em>former</em> <code>Rational</code>; the empty, stinking, rotting carcass of what <em>used</em> to be a <code>Rational</code> but is no longer, because it has been destroyed. Any caller so much as <em>glancing</em> at this function's return value would instantly enter the realm of undefined behavior. The fact is, any function returning a reference to a local object is broken. (The same is true for any function returning a pointer to a local object.)</p>
<p class="noindent"><a id="page_92"></a>Let us consider, then, the possibility of constructing an object on the heap and returning a reference to it. Heap-based objects come into being through the use of <code>new</code>, so you might write a heap-based <code>operator*</code> like this:</p>
<p class="codelink"><a id="procode140"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode140">Click here to view code image</a></p>
<p class="programlisting"><br>const Rational&amp; operator*(const Rational&amp; lhs,&nbsp;&nbsp;&nbsp;// warning! more bad<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const Rational&amp; rhs)&nbsp;&nbsp;&nbsp;// code!<br>{<br>&nbsp;&nbsp;Rational *result = new Rational(lhs.n * rhs.n, lhs.d * rhs.d);<br>&nbsp;&nbsp;return *result;<br>}<br></p>
<p class="noindent">Well, you <em>still</em> have to pay for a constructor call, because the memory allocated by <code>new</code> is initialized by calling an appropriate constructor, but now you have a different problem: who will apply <code>delete</code> to the object conjured up by your use of <code>new</code>?</p>
<p class="noindent">Even if callers are conscientious and well intentioned, there's not much they can do to prevent leaks in reasonable usage scenarios like this:</p>
<p class="codelink"><a id="procode141"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode141">Click here to view code image</a></p>
<p class="programlisting"><br>Rational w, x, y, z;<br><br>w = x * y * z;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// same as operator*(operator*(x, y), z)<br></p>
<p class="noindent">Here, there are two calls to <code>operator*</code> in the same statement, hence two uses of <code>new</code> that need to be undone with uses of <code>delete</code>. Yet there is no reasonable way for clients of <code>operator*</code> to make those calls, because there's no reasonable way for them to get at the pointers hidden behind the references being returned from the calls to <code>operator*</code>. This is a guaranteed resource leak.</p>
<p class="noindent">But perhaps you notice that both the on-the-stack and on-the-heap approaches suffer from having to call a constructor for each result returned from <code>operator*</code>. Perhaps you recall that our initial goal was to avoid such constructor invocations. Perhaps you think you know a way to avoid all but one constructor call. Perhaps the following implementation occurs to you, an implementation based on <code>operator*</code> returning a reference to a <em>static</em> <code>Rational</code> object, one defined <em>inside</em> the function:</p>
<p class="codelink"><a id="procode142"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode142">Click here to view code image</a></p>
<p class="programlisting"><br>const Rational&amp; operator*(const Rational&amp; lhs,&nbsp;&nbsp;&nbsp;&nbsp;// warning! yet more<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const Rational&amp; rhs)&nbsp;&nbsp;&nbsp;&nbsp;// bad code!<br>{<br>&nbsp;&nbsp;static Rational result;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// static object to which a<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// reference will be returned<br><br>&nbsp;&nbsp;result = ...;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// multiply lhs by rhs and put the<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// product inside result<br>&nbsp;&nbsp;return result;<br>}<br></p>
<p class="noindent"><a id="page_93"></a>Like all designs employing the use of static objects, this one immediately raises our thread-safety hackles, but that's its more obvious weakness. To see its deeper flaw, consider this perfectly reasonable client code:</p>
<p class="codelink"><a id="procode143"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode143">Click here to view code image</a></p>
<p class="programlisting"><br>bool operator==(const Rational&amp; lhs,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// an operator==<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const Rational&amp; rhs);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// for Rationals<br><br>Rational a, b, c, d;<br><br>...<br>if ((a * b) == (c * d))&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="courieri">do whatever's appropriate when the products are equal;</span><br>} else&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;<span class="courieri">do whatever's appropriate when they're not;</span><br>}<br></p>
<p class="noindent">Guess what? The expression <code>((a*b) == (c*d))</code> will <em>always</em> evaluate to <code>true</code>, regardless of the values of <code>a</code>, <code>b</code>, <code>c</code>, and <code>d</code>!</p>
<p class="noindent">This revelation is easiest to understand when the code is rewritten in its equivalent functional form:</p>
<p class="codelink"><a id="procode144"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode144">Click here to view code image</a></p>
<p class="programlisting"><br>if (operator==(<span class="courierb">operator*(a, b), operator*(c, d)</span>))<br></p>
<p class="noindent">Notice that when <code>operator==</code> is called, there will already be <em>two</em> active calls to <code>operator*</code>, each of which will return a reference to the static <code>Rational</code> object inside <code>operator*</code>. Thus, <code>operator==</code> will be asked to compare the value of the static <code>Rational</code> object inside <code>operator*</code> with the value of the static <code>Rational</code> object inside <code>operator*</code>. It would be surprising indeed if they did not compare equal. Always.</p>
<p class="noindent">This should be enough to convince you that returning a reference from a function like <code>operator*</code> is a waste of time, but some of you are now thinking, “Well, if <em>one</em> static isn't enough, maybe a static <em>array</em> will do the trick....”</p>
<p class="noindent">I can't bring myself to dignify this design with example code, but I can sketch why the notion should cause you to blush in shame. First, you must choose <em>n</em>, the size of the array. If <em>n</em> is too small, you may run out of places to store function return values, in which case you'll have gained nothing over the single-static design we just discredited. But if <em>n</em> is too big, you'll decrease the performance of your program, because <em>every</em> object in the array will be constructed the first time the function is called. That will cost you <em>n</em> constructors and <em>n</em> destructors, even if the function in question is called only once. If “optimization” is the process of improving software performance, this kind of thing should be called “pessimization.” Finally, think about how you'd put the values <a id="page_94"></a>you need into the array's objects and what it would cost you to do it. The most direct way to move a value between objects is via assignment, but what is the cost of an assignment? For many types, it's about the same as a call to a destructor (to destroy the old value) plus a call to a constructor (to copy over the new value). But your goal is to avoid the costs of construction and destruction! Face it: this approach just isn't going to pan out. (No, using a <code>vector</code> instead of an array won't improve matters much.)</p>
<p class="noindent">The right way to write a function that must return a new object is to have that function return a new object. For <code>Rational</code>'s <code>operator*</code>, that means either the following code or something essentially equivalent:</p>
<p class="codelink"><a id="procode145"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode145">Click here to view code image</a></p>
<p class="programlisting"><br>inline const Rational operator*(const Rational&amp; lhs, const Rational&amp; rhs)<br>{<br>&nbsp;&nbsp;return Rational(lhs.n * rhs.n, lhs.d * rhs.d);<br>}<br></p>
<p class="noindent">Sure, you may incur the cost of constructing and destructing <code>operator*</code>'s return value, but in the long run, that's a small price to pay for correct behavior. Besides, the bill that so terrifies you may never arrive. Like all programming languages, C++ allows compiler implementers to apply optimizations to improve the performance of the generated code without changing its observable behavior, and it turns out that in some cases, construction and destruction of <code>operator*</code>'s return value can be safely eliminated. When compilers take advantage of that fact (and compilers often do), your program continues to behave the way it's supposed to, just faster than you expected.</p>
<p class="noindent">It all boils down to this: when deciding between returning a reference and returning an object, your job is to make the choice that offers correct behavior. Let your compiler vendors wrestle with figuring out how to make that choice as inexpensive as possible.</p>
<div class="note">
<h3 id="ch04note04">Things to Remember</h3>
<p class="indenthanding">• Never return a pointer or reference to a local stack object, a reference to a heap-allocated object, or a pointer or reference to a local static object if there is a chance that more than one such object will be needed. (<a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch01.html#ch01lev1sec4">Item 4</a> provides an example of a design where returning a reference to a local static is reasonable, at least in single-threaded environments.)</p>
</div>
<h3 id="ch04lev1sec5">Item 22: Declare data members <code>private</code></h3>
<p class="noindent">Okay, here's the plan. First, we're going to see why data members shouldn't be public. Then we'll see that all the arguments against <a id="page_95"></a>public data members apply equally to protected ones. That will lead to the conclusion that data members should be private, and at that point, we'll be done.</p>
<p class="noindent">So, public data members. Why not?</p>
<p class="noindent">Let's begin with syntactic consistency (see also <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch04.html#ch04lev1sec1">Item 18</a>). If data members aren't public, the only way for clients to access an object is via member functions. If everything in the public interface is a function, clients won't have to scratch their heads trying to remember whether to use parentheses when they want to access a member of the class. They'll just do it, because everything is a function. Over the course of a lifetime, that can save a lot of head scratching.</p>
<p class="noindent">But maybe you don't find the consistency argument compelling. How about the fact that using functions gives you much more precise control over the accessibility of data members? If you make a data member public, everybody has read-write access to it, but if you use functions to get or set its value, you can implement no access, read-only access, and read-write access. Heck, you can even implement write-only access if you want to:</p>
<p class="codelink"><a id="procode146"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode146">Click here to view code image</a></p>
<p class="programlisting"><br>class AccessLevels {<br>public:<br>&nbsp;&nbsp;...<br>&nbsp;&nbsp;int getReadOnly() const&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ return readOnly; }<br><br>&nbsp;&nbsp;void setReadWrite(int value)&nbsp;&nbsp;&nbsp;{ readWrite = value; }<br>&nbsp;&nbsp;int getReadWrite() const&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ return readWrite; }<br><br>&nbsp;&nbsp;void setWriteOnly(int value)&nbsp;&nbsp;&nbsp;{ writeOnly = value; }<br><br>private:<br>&nbsp;&nbsp;int noAccess;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// no access to this int<br><br>&nbsp;&nbsp;int readOnly;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// read-only access to this int<br><br>&nbsp;&nbsp;int readWrite;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// read-write access to this int<br><br>&nbsp;&nbsp;int writeOnly;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// write-only access to this int<br>};<br></p>
<p class="noindent">Such fine-grained access control is important, because many data members <em>should</em> be hidden. Rarely does every data member need a getter and setter.</p>
<p class="noindent">Still not convinced? Then it's time to bring out the big gun: encapsulation. If you implement access to a data member through a function, you can later replace the data member with a computation, and nobody using your class will be any the wiser.</p>
<p class="noindent"><a id="page_96"></a>For example, suppose you are writing an application in which automated equipment is monitoring the speed of passing cars. As each car passes, its speed is computed and the value added to a collection of all the speed data collected so far:</p>
<p class="codelink"><a id="procode147"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode147">Click here to view code image</a></p>
<p class="programlisting"><br>class SpeedDataCollection {<br>&nbsp;&nbsp;...<br>public:<br>&nbsp;&nbsp;void addValue(int speed);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// add a new data value<br><br>&nbsp;&nbsp;double averageSoFar() const;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// return average speed<br><br>&nbsp;&nbsp;...<br>};<br></p>
<p class="noindent">Now consider the implementation of the member function <code>averageSoFar</code>. One way to implement it is to have a data member in the class that is a running average of all the speed data so far collected. Whenever <code>averageSoFar</code> is called, it just returns the value of that data member. A different approach is to have <code>averageSoFar</code> compute its value anew each time it's called, something it could do by examining each data value in the collection.</p>
<p class="noindent">The first approach (keeping a running average) makes each <code>SpeedDataCollection</code> object bigger, because you have to allocate space for the data members holding the running average, the accumulated total, and the number of data points. However, <code>averageSoFar</code> can be implemented very efficiently; it's just an inline function (see <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch05.html#ch05lev1sec5">Item 30</a>) that returns the value of the running average. Conversely, computing the average whenever it's requested will make <code>averageSoFar</code> run slower, but each <code>SpeedDataCollection</code> object will be smaller.</p>
<p class="noindent">Who's to say which is best? On a machine where memory is tight (e.g., an embedded roadside device), and in an application where averages are needed only infrequently, computing the average each time is probably a better solution. In an application where averages are needed frequently, speed is of the essence, and memory is not an issue, keeping a running average will typically be preferable. The important point is that by accessing the average through a member function (i.e., by encapsulating it), you can interchange these different implementations (as well as any others you might think of), and clients will, at most, only have to recompile. (You can eliminate even that inconvenience by following the techniques described in <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch05.html#ch05lev1sec6">Item 31</a>.)</p>
<p class="noindent">Hiding data members behind functional interfaces can offer all kinds of implementation flexibility. For example, it makes it easy to notify other objects when data members are read or written, to verify class invariants and function pre-and postconditions, to perform synchronization <a id="page_97"></a>in threaded environments, etc. Programmers coming to C++ from languages like Delphi and C# will recognize such capabilities as the equivalent of “properties” in these other languages, albeit with the need to type an extra set of parentheses.</p>
<p class="noindent">The point about encapsulation is more important than it might initially appear. If you hide your data members from your clients (i.e., encapsulate them), you can ensure that class invariants are always maintained, because only member functions can affect them. Furthermore, you reserve the right to change your implementation decisions later. If you don't hide such decisions, you'll soon find that even if you own the source code to a class, your ability to change anything public is extremely restricted, because too much client code will be broken. Public means unencapsulated, and practically speaking, unencapsulated means unchangeable, especially for classes that are widely used. Yet widely used classes are most in need of encapsulation, because they are the ones that can most benefit from the ability to replace one implementation with a better one.</p>
<p class="noindent">The argument against protected data members is similar. In fact, it's identical, though it may not seem that way at first. The reasoning about syntactic consistency and fine-grained access control is clearly as applicable to protected data as to public, but what about encapsulation? Aren't protected data members more encapsulated than public ones? Practically speaking, the surprising answer is that they are not.</p>
<p class="noindent"><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch04.html#ch04lev1sec6">Item 23</a> explains that something's encapsulation is inversely proportional to the amount of code that might be broken if that something changes. The encapsulatedness of a data member, then, is inversely proportional to the amount of code that might be broken if that data member changes, e.g., if it's removed from the class (possibly in favor of a computation, as in <code>averageSoFar</code>, above).</p>
<p class="noindent">Suppose we have a public data member, and we eliminate it. How much code might be broken? All the client code that uses it, which is generally an <em>unknowably large</em> amount. Public data members are thus completely unencapsulated. But suppose we have a protected data member, and we eliminate it. How much code might be broken now? All the derived classes that use it, which is, again, typically an <em>unknowably large</em> amount of code. Protected data members are thus as unencapsulated as public ones, because in both cases, if the data members are changed, an unknowably large amount of client code is broken. This is unintuitive, but as experienced library implementers will tell you, it's still true. Once you've declared a data member public or protected and clients have started using it, it's very hard to change anything about that data member. Too much code has to be rewritten, <a id="page_98"></a>retested, redocumented, or recompiled. From an encapsulation point of view, there are really only two access levels: <code>private</code> (which offers encapsulation) and everything else (which doesn't).</p>
<div class="note">
<h3 id="ch04note05">Things to Remember</h3>
<p class="indenthanding">• Declare data members <code>private</code>. It gives clients syntactically uniform access to data, affords fine-grained access control, allows invariants to be enforced, and offers class authors implementation flexibility.</p>
<p class="indenthanding">• <code>protected</code> is no more encapsulated than <code>public</code>.</p>
</div>
<h3 id="ch04lev1sec6">Item 23: Prefer non-member non-friend functions to member functions</h3>
<p class="noindent">Imagine a class for representing web browsers. Among the many functions such a class might offer are those to clear the cache of downloaded elements, clear the history of visited URLs, and remove all cookies from the system:</p>
<p class="programlisting"><br>class WebBrowser {<br>public:<br>&nbsp;&nbsp;...<br>&nbsp;&nbsp;void clearCache();<br>&nbsp;&nbsp;void clearHistory();<br>&nbsp;&nbsp;void removeCookies();<br>&nbsp;&nbsp;...<br>};<br></p>
<p class="noindent">Many users will want to perform all these actions together, so <code>WebBrowser</code> might also offer a function to do just that:</p>
<p class="codelink"><a id="procode148"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode148">Click here to view code image</a></p>
<p class="programlisting"><br>class WebBrowser {<br>public:<br>&nbsp;&nbsp;...<br>&nbsp;&nbsp;<span class="courierb">void clearEverything();</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// calls clearCache, clearHistory,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// and removeCookies<br>&nbsp;&nbsp;...<br>};<br></p>
<p class="noindent">Of course, this functionality could also be provided by a non-member function that calls the appropriate member functions:</p>
<p class="programlisting"><br><span class="courierb">void clearBrowser(WebBrowser&amp; wb)</span><br>{<br>&nbsp;&nbsp;wb.clearCache();<br>&nbsp;&nbsp;wb.clearHistory();<br>&nbsp;&nbsp;wb.removeCookies();<br>}<br></p>
<p class="noindent"><a id="page_99"></a>So which is better, the member function <code>clearEverything</code> or the non-member function <code>clearBrowser</code>?</p>
<p class="noindent">Object-oriented principles dictate that data and the functions that operate on them should be bundled together, and that suggests that the member function is the better choice. Unfortunately, this suggestion is incorrect. It's based on a misunderstanding of what being object-oriented means. Object-oriented principles dictate that data should be as <em>encapsulated</em> as possible. Counterintuitively, the member function <code>clearEverything</code> actually yields <em>less</em> encapsulation than the non-member <code>clearBrowser</code>. Furthermore, offering the non-member function allows for greater packaging flexibility for <code>WebBrowser</code>-related functionality, and that, in turn, yields fewer compilation dependencies and an increase in <code>WebBrowser</code> extensibility. The non-member approach is thus better than a member function in many ways. It's important to understand why.</p>
<p class="noindent">We'll begin with encapsulation. If something is encapsulated, it's hidden from view. The more something is encapsulated, the fewer things can see it. The fewer things can see it, the greater flexibility we have to change it, because our changes directly affect only those things that can see what we change. The greater something is encapsulated, then, the greater our ability to change it. That's the reason we value encapsulation in the first place: it affords us the flexibility to change things in a way that affects only a limited number of clients.</p>
<p class="noindent">Consider the data associated with an object. The less code that can see the data (i.e., access it), the more the data is encapsulated, and the more freely we can change characteristics of an object's data, such as the number of data members, their types, etc. As a coarse-grained measure of how much code can see a piece of data, we can count the number of functions that can access that data: the more functions that can access it, the less encapsulated the data.</p>
<p class="noindent"><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch04.html#ch04lev1sec5">Item 22</a> explains that data members should be private, because if they're not, an unlimited number of functions can access them. They have no encapsulation at all. For data members that <em>are</em> private, the number of functions that can access them is the number of member functions of the class plus the number of friend functions, because only members and friends have access to private members. Given a choice between a member function (which can access not only the private data of a class, but also private functions, enums, typedefs, etc.) and a non-member non-friend function (which can access none of these things) providing the same functionality, the choice yielding greater encapsulation is the non-member non-friend function, because it doesn't increase the number of functions that can access <a id="page_100"></a>the private parts of the class. This explains why <code>clearBrowser</code> (the non-member non-friend function) is preferable to <code>clearEverything</code> (the member function): it yields greater encapsulation in the <code>WebBrowser</code> class.</p>
<p class="noindent">At this point, two things are worth noting. First, this reasoning applies only to non-member <em>non-friend</em> functions. Friends have the same access to a class's private members that member functions have, hence the same impact on encapsulation. From an encapsulation point of view, the choice isn't between member and non-member functions, it's between member functions and non-member non-friend functions. (Encapsulation isn't the only point of view, of course. <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch04.html#ch04lev1sec7">Item 24</a> explains that when it comes to implicit type conversions, the choice <em>is</em> between member and non-member functions.)</p>
<p class="noindent">The second thing to note is that just because concerns about encapsulation dictate that a function be a non-member of one class doesn't mean it can't be a member of another class. This may prove a mild salve to programmers accustomed to languages where all functions <em>must</em> be in classes (e.g., Eiffel, Java, C#, etc.). For example, we could make <code>clearBrowser</code> a static member function of some utility class. As long as it's not part of (or a friend of) <code>WebBrowser</code>, it doesn't affect the encapsulation of <code>WebBrowser</code>'s private members.</p>
<p class="noindent">In C++, a more natural approach would be to make <code>clearBrowser</code> a non-member function in the same namespace as <code>WebBrowser</code>:</p>
<p class="codelink"><a id="procode149"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode149">Click here to view code image</a></p>
<p class="programlisting"><br><span class="courierb">namespace WebBrowserStuff {</span><br><br>class WebBrowser { ... };<br><br>void clearBrowser(WebBrowser&amp; wb);<br><br>&nbsp;&nbsp;...<br><span class="courierb">}</span><br></p>
<p class="noindent">This has more going for it than naturalness, however, because namespaces, unlike classes, can be spread across multiple source files. That's important, because functions like <code>clearBrowser</code> are <em>convenience functions</em>. Being neither members nor friends, they have no special access to <code>WebBrowser</code>, so they can't offer any functionality a <code>WebBrowser</code> client couldn't already get in some other way. For example, if <code>clearBrowser</code> didn't exist, clients could just call <code>clearCache</code>, <code>clearHistory</code>, and <code>removeCookies</code> themselves.</p>
<p class="noindent">A class like <code>WebBrowser</code> might have a large number of convenience functions, some related to bookmarks, others related to printing, still others related to cookie management, etc. As a general rule, most clients will be interested in only some of these sets of convenience functions. There's no reason for a client interested only in bookmark-related <a id="page_101"></a>convenience functions to be compilation dependent on, e.g., cookie-related convenience functions. The straightforward way to separate them is to declare bookmark-related convenience functions in one header file, cookie-related convenience functions in a different header file, printing-related convenience functions in a third, etc.:</p>
<p class="codelink"><a id="procode150"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode150">Click here to view code image</a></p>
<p class="programlisting"><br>// <span class="courierb">header "webbrowser.h"</span> — header for class WebBrowser itself<br>// as well as "core" WebBrowser-related functionality<br>namespace WebBrowserStuff {<br><br>&nbsp;&nbsp;&nbsp;class WebBrowser { ... };<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// "core" related functionality, e.g.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// non-member functions almost<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// all clients need<br>}<br>// <span class="courierb">header "webbrowserbookmarks.h"</span><br>namespace WebBrowserStuff {<br>&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// bookmark-related convenience<br>}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// functions<br>// <span class="courierb">header "webbrowsercookies.h"</span><br>namespace WebBrowserStuff {<br>&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// cookie-related convenience<br>}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// functions<br><br>...<br></p>
<p class="noindent">Note that this is exactly how the standard C++ library is organized. Rather than having a single monolithic <code>&lt;C++StandardLibrary&gt;</code> header containing everything in the <code>std</code> namespace, there are dozens of headers (e.g., <code>&lt;vector&gt;</code>, <code>&lt;algorithm&gt;</code>, <code>&lt;memory&gt;</code>, etc.), each declaring <em>some</em> of the functionality in <code>std</code>. Clients who use only <code>vector</code>-related functionality aren't required to <code>#include &lt;memory&gt;</code>; clients who don't use <code>list</code> don't have to <code>#include &lt;list&gt;</code>. This allows clients to be compilation dependent only on the parts of the system they actually use. (See <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch05.html#ch05lev1sec6">Item 31</a> for a discussion of other ways to reduce compilation dependencies.) Partitioning functionality in this way is not possible when it comes from a class's member functions, because a class must be defined in its entirety; it can't be split into pieces.</p>
<p class="noindent">Putting all convenience functions in multiple header files — but one namespace — also means that clients can easily <em>extend</em> the set of convenience functions. All they have to do is add more non-member non-friend functions to the namespace. For example, if a <code>WebBrowser</code> client decides to write convenience functions related to downloading images, he or she just needs to create a new header file containing the declarations of those functions in the <code>WebBrowserStuff</code> namespace. The new functions are now as available and as integrated as all other convenience <a id="page_102"></a>functions. This is another feature classes can't offer, because class definitions are closed to extension by clients. Sure, clients can derive new classes, but derived classes have no access to encapsulated (i.e., private) members in the base class, so such “extended functionality” has second-class status. Besides, as <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch02.html#ch02lev1sec3">Item 7</a> explains, not all classes are designed to be base classes.</p>
<div class="note">
<h3 id="ch04note06">Things to Remember</h3>
<p class="indenthanding">• Prefer non-member non-friend functions to member functions. Doing so increases encapsulation, packaging flexibility, and functional extensibility.</p>
</div>
<h3 id="ch04lev1sec7">Item 24: Declare non-member functions when type conversions should apply to all parameters</h3>
<p class="noindent">I noted in the Introduction to this book that having classes support implicit type conversions is generally a bad idea. Of course, there are exceptions to this rule, and one of the most common is when creating numerical types. For example, if you're designing a class to represent rational numbers, allowing implicit conversions from integers to rationals doesn't seem unreasonable. It's certainly no less reasonable than C++'s built-in conversion from <code>int</code> to <code>double</code> (and it's a lot more reasonable than C++'s built-in conversion from <code>double</code> to <code>int</code>). That being the case, you might start your <code>Rational</code> class this way:</p>
<p class="codelink"><a id="procode151"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode151">Click here to view code image</a></p>
<p class="programlisting"><br>class Rational {<br>public:<br>&nbsp;&nbsp;Rational(int numerator = 0,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// ctor is deliberately not explicit;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int denominator = 1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// allows implicit int-to-Rational<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// conversions<br><br>&nbsp;&nbsp;int numerator() const;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// accessors for numerator and<br>&nbsp;&nbsp;int denominator() const;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// denominator — see Item 22<br><br>private:<br>&nbsp;&nbsp;...<br>};<br></p>
<p class="noindent">You know you'd like to support arithmetic operations like addition, multiplication, etc., but you're unsure whether you should implement them via member functions, non-member functions, or, possibly, non-member functions that are friends. Your instincts tell you that when you're in doubt, you should be object-oriented. You know that, say, multiplication of rational numbers is related to the <code>Rational</code> class, so it seems natural to implement <code>operator*</code> for rational numbers inside the <code>Rational</code> class. Counterintuitively, <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch04.html#ch04lev1sec6">Item 23</a> argues that the idea of putting functions inside the class they are associated with is sometimes <a id="page_103"></a><em>contrary</em> to object-oriented principles, but let's set that aside and investigate the idea of making <code>operator*</code> a member function of <code>Rational</code>:</p>
<p class="codelink"><a id="procode152"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode152">Click here to view code image</a></p>
<p class="programlisting"><br>class Rational {<br>public:<br>...<br><br>const Rational operator*(const Rational&amp; rhs) const;<br>};<br></p>
<p class="noindent">(If you're unsure why this function is declared the way it is — returning a <code>const</code> by-value result, but taking a reference-to-<code>const</code> as its argument — consult <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch01.html#ch01lev1sec3">Items 3</a>, <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch04.html#ch04lev1sec3">20</a>, and <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch04.html#ch04lev1sec4">21</a>.)</p>
<p class="noindent">This design lets you multiply rationals with the greatest of ease:</p>
<p class="codelink"><a id="procode153"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode153">Click here to view code image</a></p>
<p class="programlisting"><br>Rational oneEighth(1, 8);<br>Rational oneHalf(1, 2);<br><br>Rational result = oneHalf * oneEighth;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// fine<br><br>result = result * oneEighth;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// fine<br></p>
<p class="noindent">But you're not satisfied. You'd also like to support mixed-mode operations, where <code>Rational</code>s can be multiplied with, for example, <code>int</code>s. After all, few things are as natural as multiplying two numbers together, even if they happen to be different types of numbers.</p>
<p class="noindent">When you try to do mixed-mode arithmetic, however, you find that it works only half the time:</p>
<p class="codelink"><a id="procode154"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode154">Click here to view code image</a></p>
<p class="programlisting"><br>result = oneHalf * 2;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// fine<br><br>result = 2 * oneHalf;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// error!<br></p>
<p class="noindent">This is a bad omen. Multiplication is supposed to be commutative, remember?</p>
<p class="noindent">The source of the problem becomes apparent when you rewrite the last two examples in their equivalent functional form:</p>
<p class="codelink"><a id="procode155"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode155">Click here to view code image</a></p>
<p class="programlisting"><br>result = oneHalf.operator*(2);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// fine<br><br>result = 2.operator*(oneHalf);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// error!<br></p>
<p class="noindent">The object <code>oneHalf</code> is an instance of a class that contains an <code>operator*</code>, so compilers call that function. However, the integer 2 has no associated class, hence no <code>operator*</code> member function. Compilers will also look for non-member <code>operator*</code>s (i.e., ones at namespace or global scope) that can be called like this:</p>
<p class="codelink"><a id="procode156"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode156">Click here to view code image</a></p>
<p class="programlisting"><br>result = operator*(2, oneHalf);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// error!<br></p>
<p class="noindent">But in this example, there is no non-member <code>operator*</code> taking an <code>int</code> and a <code>Rational</code>, so the search fails.</p>
<p class="noindent"><a id="page_104"></a>Look again at the call that succeeds. You'll see that its second parameter is the integer 2, yet <code>Rational::operator*</code> takes a <code>Rational</code> object as its argument. What's going on here? Why does 2 work in one position and not in the other?</p>
<p class="noindent">What's going on is implicit type conversion. Compilers know you're passing an <code>int</code> and that the function requires a <code>Rational</code>, but they also know they can conjure up a suitable <code>Rational</code> by calling the <code>Rational</code> constructor with the <code>int</code> you provided, so that's what they do. That is, they treat the call as if it had been written more or less like this:</p>
<p class="codelink"><a id="procode157"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode157">Click here to view code image</a></p>
<p class="programlisting"><br>const Rational temp(2);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// create a temporary<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Rational object from 2<br><br>result = oneHalf * temp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// same as oneHalf.operator*(temp);<br></p>
<p class="noindent">Of course, compilers do this only because a non-<code>explicit</code> constructor is involved. If <code>Rational</code>'s constructor were <code>explicit</code>, neither of these statements would compile:</p>
<p class="codelink"><a id="procode158"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode158">Click here to view code image</a></p>
<p class="programlisting"><br>result = oneHalf * 2;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// error! (with explicit ctor);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// can't convert 2 to Rational<br><br>result = 2 * oneHalf;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// same error, same problem<br></p>
<p class="noindent">That would fail to support mixed-mode arithmetic, but at least the behavior of the two statements would be consistent.</p>
<p class="noindent">Your goal, however, is both consistency and support for mixed-mode arithmetic, i.e., a design where both of the above statements will compile. That brings us back to these two statements and why, even when <code>Rational</code>'s constructor is not <code>explicit</code>, one compiles and one does not:</p>
<p class="codelink"><a id="procode159"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode159">Click here to view code image</a></p>
<p class="programlisting"><br>result = oneHalf * 2;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// fine (with non-explicit ctor)<br><br>result = 2 * oneHalf;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// error! (even with non-explicit ctor)<br></p>
<p class="noindent">It turns out that parameters are eligible for implicit type conversion <em>only if they are listed in the parameter list</em>. The implicit parameter corresponding to the object on which the member function is invoked — the one <code>this</code> points to — is <em>never</em> eligible for implicit conversions. That's why the first call compiles and the second one does not. The first case involves a parameter listed in the parameter list, but the second one doesn't.</p>
<p class="noindent">You'd still like to support mixed-mode arithmetic, however, and the way to do it is by now perhaps clear: make <code>operator*</code> a non-member function, thus allowing compilers to perform implicit type conversions on <em>all</em> arguments:</p>
<p class="codelink"><a id="procode160"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode160">Click here to view code image</a></p>
<p class="programlisting"><br><br><a id="page_105"></a>class Rational {<br><br>&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// contains no operator*<br>};<br><span class="courierb">const Rational operator*(const Rational&amp; lhs,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// now a non-member<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="courierb">const Rational&amp; rhs)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// function<br>{<br>&nbsp;&nbsp;return Rational(lhs.numerator() * rhs.numerator(),<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lhs.denominator() * rhs.denominator());<br>}<br>Rational oneFourth(1, 4);<br>Rational result;<br><br>result = oneFourth * 2;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// fine<br>result = 2 * oneFourth;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// hooray, it works!<br></p>
<p class="noindent">This is certainly a happy ending to the tale, but there is a nagging worry. Should <code>operator*</code> be made a friend of the <code>Rational</code> class?</p>
<p class="noindent">In this case, the answer is no, because <code>operator*</code> can be implemented entirely in terms of <code>Rational</code>'s public interface. The code above shows one way to do it. That leads to an important observation: the opposite of a member function is a <em>non-member</em> function, not a friend function. Too many C++ programmers assume that if a function is related to a class and should not be a member (due, for example, to a need for type conversions on all arguments), it should be a friend. This example demonstrates that such reasoning is flawed. Whenever you can avoid friend functions, you should, because, much as in real life, friends are often more trouble than they're worth. Sometimes friendship is warranted, of course, but the fact remains that just because a function shouldn't be a member doesn't automatically mean it should be a friend.</p>
<p class="noindent">This Item contains the truth and nothing but the truth, but it's not the whole truth. When you cross the line from Object-Oriented C++ into Template C++ (see <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch01.html#ch01lev1sec1">Item 1</a>) and make <code>Rational</code> a class <em>template</em> instead of a class, there are new issues to consider, new ways to resolve them, and some surprising design implications. Such issues, resolutions, and implications are the topic of <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch07.html#ch07lev1sec6">Item 46</a>.</p>
<div class="note">
<h3 id="ch04note07">Things to Remember</h3>
<p class="indenthanding">• If you need type conversions on all parameters to a function (including the one pointed to by the <code>this</code> pointer), the function must be a non-member.</p>
</div>
<h3 id="ch04lev1sec8">Item 25: Consider support for a non-throwing <code>swap</code></h3>
<p class="noindent"><a id="page_106"></a><code>swap</code> is an interesting function. Originally introduced as part of the STL, it's since become a mainstay of exception-safe programming (see <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch05.html#ch05lev1sec4">Item 29</a>) and a common mechanism for coping with the possibility of assignment to self (see <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch02.html#ch02lev1sec7">Item 11</a>). Because <code>swap</code> is so useful, it's important to implement it properly, but along with its singular importance comes a set of singular complications. In this Item, we explore what they are and how to deal with them.</p>
<p class="noindent">To <em>swap</em> the values of two objects is to give each the other's value. By default, swapping is accomplished via the standard <code>swap</code> algorithm. Its typical implementation is exactly what you'd expect:</p>
<p class="codelink"><a id="procode161"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode161">Click here to view code image</a></p>
<p class="programlisting"><br>namespace std {<br><br>&nbsp;&nbsp;template&lt;typename T&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// typical implementation of std::swap;<br>&nbsp;&nbsp;void swap(T&amp; a, T&amp; b)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// swaps a's and b's values<br>&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;T temp(a);<br>&nbsp;&nbsp;&nbsp;&nbsp;a = b;<br>&nbsp;&nbsp;&nbsp;&nbsp;b = temp;<br>&nbsp;&nbsp;}<br>}<br></p>
<p class="noindent">As long as your types support copying (via copy constructor and copy assignment operator), the default <code>swap</code> implementation will let objects of your types be swapped without your having to do any special work to support it.</p>
<p class="noindent">However, the default <code>swap</code> implementation may not thrill you. It involves copying three objects: <code>a</code> to <code>temp</code>, <code>b</code> to <code>a</code>, and <code>temp</code> to <code>b</code>. For some types, none of these copies are really necessary. For such types, the default <code>swap</code> puts you on the fast track to the slow lane.</p>
<p class="noindent">Foremost among such types are those consisting primarily of a pointer to another type that contains the real data. A common manifestation of this design approach is the “pimpl idiom” (“pointer to implementation” — see <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch05.html#ch05lev1sec6">Item 31</a>). A <code>Widget</code> class employing such a design might look like this:</p>
<p class="codelink"><a id="procode162"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode162">Click here to view code image</a></p>
<p class="programlisting"><br>class WidgetImpl {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// class for Widget data;<br>public:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// details are unimportant<br>&nbsp;&nbsp;...<br><br>private:<br>&nbsp;&nbsp;int a, b, c;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// possibly lots of data —<br>&nbsp;&nbsp;std::vector&lt;double&gt; v;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// expensive to copy!<br>&nbsp;&nbsp;...<br>};<br><br><a id="page_107"></a>class Widget {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// class using the pimpl idiom<br>public:<br>&nbsp;&nbsp;Widget(const Widget&amp; rhs);<br><br>&nbsp;&nbsp;Widget&amp; operator=(const Widget&amp; rhs)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// to copy a Widget, copy its<br>&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// WidgetImpl object. For<br>&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// details on implementing<br>&nbsp;&nbsp;&nbsp;*pImpl = *(rhs.pImpl);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// operator= in general,<br>&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// see Items 10, 11, and 12.<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;...<br><br>private:<br>&nbsp;&nbsp;<span class="courierb">WidgetImpl *pImpl;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// ptr to object with this<br>};&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Widget's data<br></p>
<p class="noindent">To swap the value of two <code>Widget</code> objects, all we really need to do is swap their <code>pImpl</code> pointers, but the default <code>swap</code> algorithm has no way to know that. Instead, it would copy not only three <code>Widget</code>s, but also three <code>WidgetImpl</code> objects. Very inefficient. Not a thrill.</p>
<p class="noindent">What we'd like to do is tell <code>std::swap</code> that when <code>Widget</code>s are being swapped, the way to perform the swap is to <code>swap</code> their internal <code>pImpl</code> pointers. There is a way to say exactly that: specialize <code>std::swap</code> for <code>Widget</code>. Here's the basic idea, though it won't compile in this form:</p>
<p class="codelink"><a id="procode163"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode163">Click here to view code image</a></p>
<p class="programlisting"><br>namespace std {<br><br>&nbsp;&nbsp;<span class="courierb">template&lt;&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// this is a specialized version<br>&nbsp;&nbsp;void swap<span class="courierb">&lt;Widget&gt;</span>(Widget&amp; a,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// of std::swap for when T is<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Widget&amp; b)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Widget; <span class="courieri">this won't compile</span><br>&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;swap(a.pImpl, b.pImpl);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// to swap Widgets, just swap<br>&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// their pImpl pointers<br>}<br></p>
<p class="noindent">The “<code>template&lt;&gt;</code>” at the beginning of this function says that this is a <em>total template specialization</em> for <code>std::swap</code>, and the “<code>&lt;Widget&gt;</code>” after the name of the function says that the specialization is for when <code>T</code> is <code>Widget</code>. In other words, when the general <code>swap</code> template is applied to <code>Widget</code>s, this is the implementation that should be used. In general, we're not permitted to alter the contents of the <code>std</code> namespace, but we are allowed to totally specialize standard templates (like <code>swap</code>) for types of our own creation (such as <code>Widget</code>). That's what we're doing here.</p>
<p class="noindent">As I said, though, this function won't compile. That's because it's trying to access the <code>pImpl</code> pointers inside <code>a</code> and <code>b</code>, and they're private. We could declare our specialization a friend, but the convention is different: it's to have <code>Widget</code> declare a public member function called <code>swap</code> <a id="page_108"></a>that does the actual swapping, then specialize <code>std::swap</code> to call the member function:</p>
<p class="codelink"><a id="procode164"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode164">Click here to view code image</a></p>
<p class="programlisting"><br>class Widget {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// same as above, except for the<br>public:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// addition of the swap mem func<br>&nbsp;&nbsp;...<br>&nbsp;&nbsp;<span class="courierb">void swap(Widget&amp; other)</span><br>&nbsp;&nbsp;<span class="courierb">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="courierb">using std::swap;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// the need for this declaration</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="courierb">// is explained later in this Item</span><br><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="courierb">swap(pImpl, other.pImpl);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// to swap Widgets, swap their</span><br>&nbsp;&nbsp;<span class="courierb">}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// pImpl pointers</span><br>&nbsp;&nbsp;...<br>};<br><br>namespace std {<br><br>&nbsp;&nbsp;template&lt;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// revised specialization of<br>&nbsp;&nbsp;void swap&lt;Widget&gt;(Widget&amp; a,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// std::swap<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Widget&amp; b)<br>&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="courierb">a.swap(b);</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// to swap Widgets, call their<br>&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// swap member function<br>}<br></p>
<p class="noindent">Not only does this compile, it's also consistent with the STL containers, all of which provide both public <code>swap</code> member functions and specializations of <code>std::swap</code> that call these member functions.</p>
<p class="noindent">Suppose, however, that <code>Widget</code> and <code>WidgetImpl</code> were class <em>templates</em> instead of classes, possibly so we could parameterize the type of the data stored in <code>WidgetImpl</code>:</p>
<p class="codelink"><a id="procode165"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode165">Click here to view code image</a></p>
<p class="programlisting"><br><span class="courierb">template&lt;typename T&gt;</span><br>class WidgetImpl { ... };<br><br><span class="courierb">template&lt;typename T&gt;</span><br>class Widget { ... };<br></p>
<p class="noindent">Putting a <code>swap</code> member function in <code>Widget</code> (and, if we need to, in <code>WidgetImpl</code>) is as easy as before, but we run into trouble with the specialization for <code>std::swap</code>. This is what we want to write:</p>
<p class="codelink"><a id="procode166"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode166">Click here to view code image</a></p>
<p class="programlisting"><br>namespace std {<br>&nbsp;&nbsp;<span class="courierb">template&lt;typename T&gt;</span><br>&nbsp;&nbsp;<span class="courierb">void swap&lt;Widget&lt;T&gt; &gt;</span>(Widget&lt;T&gt;&amp; a,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// error! illegal code!<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Widget&lt;T&gt;&amp; b)<br>&nbsp;&nbsp;{ a.swap(b); }<br>}<br></p>
<p class="noindent"><a id="page_109"></a>This looks perfectly reasonable, but it's not legal. We're trying to partially specialize a function template (<code>std::swap</code>), but though C++ allows partial specialization of class templates, it doesn't allow it for function templates. This code should not compile (though some compilers erroneously accept it).</p>
<p class="noindent">When you want to “partially specialize” a function template, the usual approach is to simply add an overload. That would look like this:</p>
<p class="codelink"><a id="procode167"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode167">Click here to view code image</a></p>
<p class="programlisting"><br>namespace std {<br><br>&nbsp;&nbsp;template&lt;typename T&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// an overloading of std::swap<br>&nbsp;&nbsp;void <span class="courierb">swap</span>(Widget&lt;T&gt;&amp; a,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// (note the lack of "&lt;...&gt;" after<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Widget&lt;T&gt;&amp; b)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// "swap"), but see below for<br>&nbsp;&nbsp;{ a.swap(b); }&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// why this isn't valid code<br>}<br></p>
<p class="noindent">In general, overloading function templates is fine, but <code>std</code> is a special namespace, and the rules governing it are special, too. It's okay to totally specialize templates in <code>std</code>, but it's not okay to add <em>new</em> templates (or classes or functions or anything else) to <code>std</code>. The contents of <code>std</code> are determined solely by the C++ standardization committee, and we're prohibited from augmenting what they've decided should go there. Alas, the form of the prohibition may dismay you. Programs that cross this line will almost certainly compile and run, but their behavior is undefined. If you want your software to have predictable behavior, you'll not add new things to <code>std</code>.</p>
<p class="noindent">So what to do? We still need a way to let other people call <code>swap</code> and get our more efficient template-specific version. The answer is simple. We still declare a non-member <code>swap</code> that calls the member <code>swap</code>, we just don't declare the non-member to be a specialization or overloading of <code>std::swap</code>. For example, if all our <code>Widget</code>-related functionality is in the namespace <code>WidgetStuff</code>, it would look like this:</p>
<p class="codelink"><a id="procode168"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode168">Click here to view code image</a></p>
<p class="programlisting"><br>namespace WidgetStuff {<br>&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// templatized WidgetImpl, etc.<br><br>&nbsp;&nbsp;template&lt;typename T&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// as before, including the swap<br>&nbsp;&nbsp;class Widget { ... };&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// member function<br><br>&nbsp;&nbsp;...<br><br>&nbsp;&nbsp;<span class="courierb">template&lt;typename T&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// non-member swap function;<br>&nbsp;&nbsp;<span class="courierb">void swap(Widget&lt;T&gt;&amp; a,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// not part of the std namespace<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="courierb">Widget&lt;T&gt;&amp; b)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;<span class="courierb">{</span><br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="courierb">a.swap(b);</span><br>&nbsp;&nbsp;<span class="courierb">}</span><br>}<br></p>
<p class="noindent"><a id="page_110"></a>Now, if any code anywhere calls <code>swap</code> on two <code>Widget</code> objects, the name lookup rules in C++ (specifically the rules known as <em>argument-dependent lookup</em> or <em>Koenig lookup</em>) will find the <code>Widget</code>-specific version in <code>WidgetStuff</code>. Which is exactly what we want.</p>
<p class="noindent">This approach works as well for classes as for class templates, so it seems like we should use it all the time. Unfortunately, there is a reason for specializing <code>std::swap</code> for classes (I'll describe it shortly), so if you want to have your class-specific version of <code>swap</code> called in as many contexts as possible (and you do), you need to write both a non-member version in the same namespace as your class and a specialization of <code>std::swap</code>.</p>
<p class="noindent">By the way, if you're not using namespaces, everything above continues to apply (i.e., you still need a non-member <code>swap</code> that calls the member <code>swap</code>), but why are you clogging the global namespace with all your class, template, function, enum, enumerant, and typedef names? Have you no sense of propriety?</p>
<p class="noindent">Everything I've written so far pertains to authors of <code>swap</code>, but it's worth looking at one situation from a client's point of view. Suppose you're writing a function template where you need to swap the values of two objects:</p>
<p class="codelink"><a id="procode169"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode169">Click here to view code image</a></p>
<p class="programlisting"><br>template&lt;typename T&gt;<br>void doSomething(T&amp; obj1, T&amp; obj2)<br>{<br>&nbsp;&nbsp;...<br>&nbsp;&nbsp;<span class="courierb">swap(obj1, obj2);</span><br>&nbsp;&nbsp;...<br>}<br></p>
<p class="noindent">Which <code>swap</code> should this call? The general one in <code>std</code>, which you know exists; a specialization of the general one in <code>std</code>, which may or may not exist; or a <code>T</code>-specific one, which may or may not exist and which may or may not be in a namespace (but should certainly not be in <code>std</code>)? What you desire is to call a <code>T</code>-specific version if there is one, but to fall back on the general version in <code>std</code> if there's not. Here's how you fulfill your desire:</p>
<p class="codelink"><a id="procode170"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode170">Click here to view code image</a></p>
<p class="programlisting"><br>template&lt;typename T&gt;<br>void doSomething(T&amp; obj1, T&amp; obj2)<br>{<br>&nbsp;&nbsp;<span class="courierb">using std::swap;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// make std::swap available in this function<br>&nbsp;&nbsp;...<br>&nbsp;&nbsp;swap(obj1, obj2);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// call the best swap for objects of type T<br>&nbsp;&nbsp;...<br>}<br></p>
<p class="noindent"><a id="page_111"></a>When compilers see the call to <code>swap</code>, they search for the right <code>swap</code> to invoke. C++'s name lookup rules ensure that this will find any <code>T</code>-specific <code>swap</code> at global scope or in the same namespace as the type <code>T</code>. (For example, if <code>T</code> is <code>Widget</code> in the namespace <code>WidgetStuff</code>, compilers will use argument-dependent lookup to find <code>swap</code> in <code>WidgetStuff</code>.) If no <code>T</code>-specific <code>swap</code> exists, compilers will use <code>swap</code> in <code>std</code>, thanks to the <code>using</code> declaration that makes <code>std::swap</code> visible in this function. Even then, however, compilers will prefer a <code>T</code>-specific specialization of <code>std::swap</code> over the general template, so if <code>std::swap</code> has been specialized for <code>T</code>, the specialized version will be used.</p>
<p class="noindent">Getting the right <code>swap</code> called is therefore easy. The one thing you want to be careful of is to not qualify the call, because that will affect how C++ determines the function to invoke. For example, if you were to write the call to <code>swap</code> this way,</p>
<p class="codelink"><a id="procode171"></a><a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/images.html#iprocode171">Click here to view code image</a></p>
<p class="programlisting"><br><span class="courierb">std::</span>swap(obj1, obj2);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// the wrong way to call swap<br></p>
<p class="noindent">you'd force compilers to consider only the <code>swap</code> in <code>std</code> (including any template specializations), thus eliminating the possibility of getting a more appropriate <code>T</code>-specific version defined elsewhere. Alas, some misguided programmers <em>do</em> qualify calls to <code>swap</code> in this way, and that's why it's important to totally specialize <code>std::swap</code> for your classes: it makes type-specific <code>swap</code> implementations available to code written in this misguided fashion. (Such code is present in some standard library implementations, so it's in your interest to help such code work as efficiently as possible.)</p>
<p class="noindent">At this point, we've discussed the default <code>swap</code>, member <code>swap</code>s, non-member <code>swap</code>s, specializations of <code>std::swap</code>, and calls to <code>swap</code>, so let's summarize the situation.</p>
<p class="noindent">First, if the default implementation of <code>swap</code> offers acceptable efficiency for your class or class template, you don't need to do anything. Anybody trying to <code>swap</code> objects of your type will get the default version, and that will work fine.</p>
<p class="noindent">Second, if the default implementation of <code>swap</code> isn't efficient enough (which almost always means that your class or template is using some variation of the pimpl idiom), do the following:</p><ol>
<li>Offer a public <code>swap</code> member function that efficiently swaps the value of two objects of your type. For reasons I'll explain in a moment, this function should never throw an exception.</li>
<li>Offer a non-member <code>swap</code> in the same namespace as your class or template. Have it call your <code>swap</code> member function.</li>
<li><a id="page_112"></a>If you're writing a class (not a class template), specialize <code>std::swap</code> for your class. Have it also call your <code>swap</code> member function.</li>
</ol>
<p class="noindent">Finally, if you're calling <code>swap</code>, be sure to include a <code>using</code> declaration to make <code>std::swap</code> visible in your function, then call <code>swap</code> without any namespace qualification.</p>
<p class="noindent">The only loose end is my admonition to have the member version of <code>swap</code> never throw exceptions. That's because one of the most useful applications of <code>swap</code> is to help classes (and class templates) offer the strong exception-safety guarantee. <a class="nounder" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch05.html#ch05lev1sec4">Item 29</a> provides all the details, but the technique is predicated on the assumption that the member version of <code>swap</code> never throws. This constraint applies only to the member version! It can't apply to the non-member version, because the default version of <code>swap</code> is based on copy construction and copy assignment, and, in general, both of those functions are allowed to throw exceptions. When you write a custom version of <code>swap</code>, then, you are typically offering more than just an efficient way to swap values; you're also offering one that doesn't throw exceptions. As a general rule, these two <code>swap</code> characteristics go hand in hand, because highly efficient <code>swap</code>s are almost always based on operations on built-in types (such as the pointers underlying the pimpl idiom), and operations on built-in types never throw exceptions.</p>
<div class="note">
<h3 id="ch04note08">Things to Remember</h3>
<p class="indenthanding">• Provide a <code>swap</code> member function when <code>std::swap</code> would be inefficient for your type. Make sure your <code>swap</code> doesn't throw exceptions.</p>
<p class="indenthanding">• If you offer a member <code>swap</code>, also offer a non-member <code>swap</code> that calls the member. For classes (not templates), specialize <code>std::swap</code>, too.</p>
<p class="indenthanding">• When calling <code>swap</code>, employ a <code>using</code> declaration for <code>std::swap</code>, then call <code>swap</code> without namespace qualification.</p>
<p class="indenthanding">• It's fine to totally specialize <code>std</code> templates for user-defined types, but never try to add something completely new to <code>std</code>.</p>
</div>
<div class="annotator-outer annotator-viewer viewer annotator-hide">
  <ul class="annotator-widget annotator-listing"></ul>
</div><div class="annotator-modal-wrapper annotator-editor-modal annotator-editor annotator-hide">
	<div class="annotator-outer editor">
		<h2 class="title">Highlight</h2>
		<form class="annotator-widget">
			<ul class="annotator-listing">
			<li class="annotator-item"><textarea id="annotator-field-0" placeholder="Add a note using markdown (optional)" class="js-editor" maxlength="750"></textarea></li></ul>
			<div class="annotator-controls">
				<a class="link-to-markdown" href="https://daringfireball.net/projects/markdown/basics" target="_blank">?</a>
				<ul>
					<li class="delete annotator-hide"><a href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch04.html#delete" class="annotator-delete-note button positive">Delete Note</a></li>
					<li class="save"><a href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch04.html#save" class="annotator-save annotator-focus button positive">Save Note</a></li>
					<li class="cancel"><a href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch04.html#cancel" class="annotator-cancel button">Cancel</a></li>
				</ul>
			</div>
		</form>
	</div>
</div><div class="annotator-modal-wrapper annotator-delete-confirm-modal" style="display: none;">
  <div class="annotator-outer">
    <h2 class="title">Highlight</h2>
      <a class="js-close-delete-confirm annotator-cancel close" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch04.html#close">Close</a>
      <div class="annotator-widget">
         <div class="delete-confirm">
            Are you sure you want to permanently delete this note?
         </div>
         <div class="annotator-controls">
            <a href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch04.html#cancel" class="annotator-cancel button js-cancel-delete-confirm">No, I changed my mind</a>
            <a href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch04.html#delete" class="annotator-delete button positive js-delete-confirm">Yes, delete it</a>
         </div>
       </div>
   </div>
</div><div class="annotator-adder" style="display: none;">
	<ul class="adders ">
		
		<li class="copy"><a href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch04.html#">Copy</a></li>
		
		<li class="add-highlight"><a href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch04.html#">Add Highlight</a></li>
		<li class="add-note"><a href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch04.html#">
			
				Add Note
			
		</a></li>
	</ul>
</div></div></div>



  <div class="t-sbo-prev sbo-prev sbo-nav-bottom">
  
    
      
        <a href="/library/view/effective-c-55/0321334876/ch03.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">3. Resource Management</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-bottom">
  
    
      
        <a href="/library/view/effective-c-55/0321334876/ch05.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">5. Implementations</div>
        </a>
    
  
  </div>


      
    </section>
    <div class="reading-controls-bottom">
      <ul class="interface-controls js-bitlist">
        <li class="queue-control">
            <button type="button" class="rec-fav ss-queue js-queue js-current-chapter-queue" data-queue-endpoint="/api/v1/book/0321334876/chapter/ch04.html" data-for-analytics="0321334876:ch04.html">
      <span>Add to Queue</span>
  </button>
        </li>
      </ul>
    </div>
  </div>
<section class="sbo-saved-archives"></section>



          
          
  





    
    



        
      </div>
      



  <footer class="pagefoot t-pagefoot">
    <a href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch04.html#" class="icon-up"><div class="visuallyhidden">Back to top</div></a>
    <ul class="js-footer-nav">
      
        <li><a class="t-recommendations-footer" href="https://www.safaribooksonline.com/r/">Recommended</a></li>
      
      <li><a class="t-queue-footer" href="https://www.safaribooksonline.com/s/">Queue</a></li>
      
        <li><a class="t-recent-footer" href="https://www.safaribooksonline.com/history/">History</a></li>
        <li><a class="t-topics-footer" href="https://www.safaribooksonline.com/topics?q=*&amp;limit=21">Topics</a></li>
      
      
        <li><a class="t-tutorials-footer" href="https://www.safaribooksonline.com/tutorials/">Tutorials</a></li>
      
      <li><a class="t-settings-footer js-settings" href="https://www.safaribooksonline.com/u/">Settings</a></li>
      <li><a href="https://www.safaribooksonline.com/blog/">Blog</a></li>
      <li class="full-support"><a href="https://www.safaribooksonline.com/public/support">Support</a></li>
      <li><a href="https://community.safaribooksonline.com/">Feedback</a></li>
      <li><a href="https://www.safaribooksonline.com/apps/">Get the App</a></li>
      <li><a href="https://www.safaribooksonline.com/accounts/logout/">Sign Out</a></li>
    </ul>
    <span class="copyright">© 2016 <a href="https://www.safaribooksonline.com/" target="_blank">Safari</a>.</span>
    <a href="https://www.safaribooksonline.com/terms/">Terms of Service</a> /
    <a href="https://www.safaribooksonline.com/privacy/">Privacy Policy</a>
  </footer>




    

    
    
  

<div class="annotator-notice"></div><div class="font-flyout"><div class="font-controls-panel">
	<div class="nightmodes">
		<ul>
			<li class="day"><a href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch04.html#" id="day-mode" title="Day Mode">
				<i class="fa fa-sun-o"></i>
				<span>Day Mode</span></a></li>
			<li class="cloudy"><a href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch04.html#" id="cloudy-mode" title="Cloudy Mode">
				<i class="fa fa-cloud"></i>
				<span>Cloud Mode</span>
			</a></li>
			<li class="night"><a href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch04.html#" id="night-mode" title="Night Mode">
				<i class="fa fa-moon-o"></i>
				<span>Night Mode</span>
			</a></li>
		</ul>
	</div>

	<div class="font-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-font left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-font-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-font right"></i>
		</div>
	</div>

	<div class="column-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-compress left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-column-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-expand right"></i>
		</div>
	</div>

	<a id="reset" class="button" href="https://www.safaribooksonline.com//library/view/effective-c-55/0321334876/ch04.html#">Reset</a>
</div>
</div></body></html>