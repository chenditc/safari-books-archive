<!--[if IE]><![endif]--><!DOCTYPE html><!--[if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/designing-data-intensive-applications/9781491903063/ch06.html"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="3905629"
  data-user-uuid="f04af719-1c84-4fc3-9be3-1f1b4622ab99"
  data-username="safaribooksonline122"
  data-account-type="Trial"
  
  data-activated-trial-date="12/09/2018"


  data-archive="9781491903063"
  data-publishers="O&#39;Reilly Media, Inc."



  data-htmlfile-name="ch06.html"
  data-epub-title="Designing Data-Intensive Applications" data-debug=0 data-testing=0><![endif]--><!--[if gt IE 8]><!--><html class="js flexbox flexboxlegacy no-touch websqldatabase indexeddb history csscolumns csstransforms localstorage sessionstorage applicationcache svg inlinesvg zoom gr__safaribooksonline_com" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#" itemscope="" itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/" data-offline-url="/" data-url="/library/view/designing-data-intensive-applications/9781491903063/ch06.html" data-csrf-cookie="csrfsafari" data-highlight-privacy="" data-user-id="3905629" data-user-uuid="f04af719-1c84-4fc3-9be3-1f1b4622ab99" data-username="safaribooksonline122" data-account-type="Trial" data-activated-trial-date="12/09/2018" data-archive="9781491903063" data-publishers="O'Reilly Media, Inc." data-htmlfile-name="ch06.html" data-epub-title="Designing Data-Intensive Applications" data-debug="0" data-testing="0" style=""><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="Safari Books Online"><meta name="format-detection" content="telephone=no"><meta http-equiv="cleartype" content="on"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="apple-itunes-app" content="app-id=881697395, app-argument=safaridetail://9781491903063"><meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0"><meta property="twitter:account_id" content="4503599627559754"><link rel="apple-touch-icon" href="https://www.safaribooksonline.com/static/images/apple-touch-icon.0c29511d2d72.png"><link rel="shortcut icon" href="https://www.safaribooksonline.com/favicon.ico" type="image/x-icon"><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700,900,200italic,300italic,400italic,600italic,700italic,900italic" rel="stylesheet" type="text/css"><title>6. Partitioning - Designing Data-Intensive Applications</title><link rel="stylesheet" href="https://www.safaribooksonline.com/static/CACHE/css/5e586a47a3b7.css" type="text/css"><link rel="stylesheet" type="text/css" href="https://www.safaribooksonline.com/static/css/annotator.e3b0c44298fc.css"><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css"><style type="text/css" title="ibis-book">
    @charset "utf-8";#sbo-rt-content html,#sbo-rt-content div,#sbo-rt-content div,#sbo-rt-content span,#sbo-rt-content applet,#sbo-rt-content object,#sbo-rt-content iframe,#sbo-rt-content h1,#sbo-rt-content h2,#sbo-rt-content h3,#sbo-rt-content h4,#sbo-rt-content h5,#sbo-rt-content h6,#sbo-rt-content p,#sbo-rt-content blockquote,#sbo-rt-content pre,#sbo-rt-content a,#sbo-rt-content abbr,#sbo-rt-content acronym,#sbo-rt-content address,#sbo-rt-content big,#sbo-rt-content cite,#sbo-rt-content code,#sbo-rt-content del,#sbo-rt-content dfn,#sbo-rt-content em,#sbo-rt-content img,#sbo-rt-content ins,#sbo-rt-content kbd,#sbo-rt-content q,#sbo-rt-content s,#sbo-rt-content samp,#sbo-rt-content small,#sbo-rt-content strike,#sbo-rt-content strong,#sbo-rt-content sub,#sbo-rt-content sup,#sbo-rt-content tt,#sbo-rt-content var,#sbo-rt-content b,#sbo-rt-content u,#sbo-rt-content i,#sbo-rt-content center,#sbo-rt-content dl,#sbo-rt-content dt,#sbo-rt-content dd,#sbo-rt-content ol,#sbo-rt-content ul,#sbo-rt-content li,#sbo-rt-content fieldset,#sbo-rt-content form,#sbo-rt-content label,#sbo-rt-content legend,#sbo-rt-content table,#sbo-rt-content caption,#sbo-rt-content tdiv,#sbo-rt-content tfoot,#sbo-rt-content thead,#sbo-rt-content tr,#sbo-rt-content th,#sbo-rt-content td,#sbo-rt-content article,#sbo-rt-content aside,#sbo-rt-content canvas,#sbo-rt-content details,#sbo-rt-content embed,#sbo-rt-content figure,#sbo-rt-content figcaption,#sbo-rt-content footer,#sbo-rt-content header,#sbo-rt-content hgroup,#sbo-rt-content menu,#sbo-rt-content nav,#sbo-rt-content output,#sbo-rt-content ruby,#sbo-rt-content section,#sbo-rt-content summary,#sbo-rt-content time,#sbo-rt-content mark,#sbo-rt-content audio,#sbo-rt-content video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}#sbo-rt-content article,#sbo-rt-content aside,#sbo-rt-content details,#sbo-rt-content figcaption,#sbo-rt-content figure,#sbo-rt-content footer,#sbo-rt-content header,#sbo-rt-content hgroup,#sbo-rt-content menu,#sbo-rt-content nav,#sbo-rt-content section{display:block}#sbo-rt-content div{line-height:1}#sbo-rt-content ol,#sbo-rt-content ul{list-style:none}#sbo-rt-content blockquote,#sbo-rt-content q{quotes:none}#sbo-rt-content blockquote:before,#sbo-rt-content blockquote:after,#sbo-rt-content q:before,#sbo-rt-content q:after{content:none}#sbo-rt-content table{border-collapse:collapse;border-spacing:0}@page{margin:5px !important}#sbo-rt-content p{margin:10px 0 0;line-height:125%;text-align:left}#sbo-rt-content p.byline{text-align:left;margin:-33px auto 35px;font-style:italic;font-weight:bold}#sbo-rt-content div.preface p+p.byline{margin:1em 0 0 !important}#sbo-rt-content div.preface p.byline+p.byline{margin:0 !important}#sbo-rt-content div.sect1>p.byline{margin:-.25em 0 1em}#sbo-rt-content div.sect1>p.byline+p.byline{margin-top:-1em}#sbo-rt-content em{font-style:italic;font-family:inherit}#sbo-rt-content em strong,#sbo-rt-content strong em{font-weight:bold;font-style:italic;font-family:inherit}#sbo-rt-content strong,#sbo-rt-content span.bold{font-weight:bold}#sbo-rt-content em.replaceable{font-style:italic}#sbo-rt-content strong.userinput{font-weight:bold;font-style:normal}#sbo-rt-content span.bolditalic{font-weight:bold;font-style:italic}#sbo-rt-content a.ulink,#sbo-rt-content a.xref,#sbo-rt-content a.email,#sbo-rt-content a.link,#sbo-rt-content a{text-decoration:none;color:#8e0012}#sbo-rt-content span.lineannotation{font-style:italic;color:#a62a2a;font-family:serif}#sbo-rt-content span.underline{text-decoration:underline}#sbo-rt-content span.strikethrough{text-decoration:line-through}#sbo-rt-content span.smallcaps{font-variant:small-caps}#sbo-rt-content span.cursor{background:#000;color:#fff}#sbo-rt-content span.smaller{font-size:75%}#sbo-rt-content .boxedtext,#sbo-rt-content .keycap{border-style:solid;border-width:1px;border-color:#000;padding:1px}#sbo-rt-content span.gray50{color:#7F7F7F;}#sbo-rt-content h1,#sbo-rt-content div.toc-title,#sbo-rt-content h2,#sbo-rt-content h3,#sbo-rt-content h4,#sbo-rt-content h5{-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;font-weight:bold;text-align:left;page-break-after:avoid !important;font-family:sans-serif,"DejaVuSans"}#sbo-rt-content div.toc-title{font-size:1.5em;margin-top:20px !important;margin-bottom:30px !important}#sbo-rt-content section[data-type="sect1"] h1{font-size:1.3em;color:#8e0012;margin:40px 0 8px 0}#sbo-rt-content section[data-type="sect2"] h2{font-size:1.1em;margin:30px 0 8px 0 !important}#sbo-rt-content section[data-type="sect3"] h3{font-size:1em;color:#555;margin:20px 0 8px 0 !important}#sbo-rt-content section[data-type="sect4"] h4{font-size:1em;font-weight:normal;font-style:italic;margin:15px 0 6px 0 !important}#sbo-rt-content section[data-type="chapter"]>div>h1,#sbo-rt-content section[data-type="preface"]>div>h1,#sbo-rt-content section[data-type="appendix"]>div>h1,#sbo-rt-content section[data-type="glossary"]>div>h1,#sbo-rt-content section[data-type="bibliography"]>div>h1,#sbo-rt-content section[data-type="index"]>div>h1{font-size:2em;line-height:1;margin-bottom:50px;color:#000;padding-bottom:10px;border-bottom:1px solid #000}#sbo-rt-content span.label,#sbo-rt-content span.keep-together{font-size:inherit;font-weight:inherit}#sbo-rt-content div[data-type="part"] h1{font-size:2em;text-align:center;margin-top:0 !important;margin-bottom:50px;padding:50px 0 10px 0;border-bottom:1px solid #000}#sbo-rt-content img.width-ninety{width:90%}#sbo-rt-content img{max-width:95%;margin:0 auto;padding:0}#sbo-rt-content div.figure{background-color:transparent;text-align:center !important;margin:15px 0 15px 0 !important;page-break-inside:avoid}#sbo-rt-content figure{margin:15px 0 15px 0 !important;page-break-inside:avoid}#sbo-rt-content div.figure h6,#sbo-rt-content figure h6,#sbo-rt-content figure figcaption{font-size:.9rem !important;text-align:center;font-weight:normal !important;font-style:italic;font-family:serif !important;text-transform:none !important;letter-spacing:normal !important;color:#000 !important;padding-top:10px !important;page-break-before:avoid}#sbo-rt-content div.informalfigure{text-align:center !important;padding:5px 0 !important}#sbo-rt-content div.sidebar{margin:15px 0 10px 0 !important;border:1px solid #DCDCDC;background-color:#F7F7F7;padding:15px !important;page-break-inside:avoid}#sbo-rt-content aside[data-type="sidebar"]{margin:15px 0 10px 0 !important;page-break-inside:avoid}#sbo-rt-content div.sidebar-title,#sbo-rt-content aside[data-type="sidebar"] h5{font-weight:bold;font-size:1em;font-family:sans-serif;text-transform:uppercase;letter-spacing:1px;text-align:center;margin:4px 0 6px 0 !important;page-break-inside:avoid}#sbo-rt-content div.sidebar ol,#sbo-rt-content div.sidebar ul,#sbo-rt-content aside[data-type="sidebar"] ol,#sbo-rt-content aside[data-type="sidebar"] ul{margin-left:1.25em !important}#sbo-rt-content div.sidebar div.figure p.title,#sbo-rt-content aside[data-type="sidebar"] figcaption,#sbo-rt-content div.sidebar div.informalfigure div.caption{font-size:90%;text-align:center;font-weight:normal;font-style:italic;font-family:serif !important;color:#000;padding:5px !important;page-break-before:avoid;page-break-after:avoid}#sbo-rt-content div.sidebar div.tip,#sbo-rt-content div.sidebar div[data-type="tip"],#sbo-rt-content div.sidebar div.note,#sbo-rt-content div.sidebar div[data-type="note"],#sbo-rt-content div.sidebar div.warning,#sbo-rt-content div.sidebar div[data-type="warning"],#sbo-rt-content div.sidebar div[data-type="caution"],#sbo-rt-content div.sidebar div[data-type="important"]{margin:20px auto 20px auto !important;font-size:90%;width:85%}#sbo-rt-content aside[data-type="sidebar"] p.byline{font-size:90%;font-weight:bold;font-style:italic;text-align:center;text-indent:0;margin:5px auto 6px;page-break-after:avoid}#sbo-rt-content pre{white-space:pre-wrap;font-family:"Ubuntu Mono",monospace;margin:25px 0 25px 20px;font-size:85%;display:block;-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;overflow-wrap:break-word}#sbo-rt-content div.note pre.programlisting,#sbo-rt-content div.tip pre.programlisting,#sbo-rt-content div.warning pre.programlisting,#sbo-rt-content div.caution pre.programlisting,#sbo-rt-content div.important pre.programlisting{margin-bottom:0}#sbo-rt-content code{font-family:"Ubuntu Mono",monospace;-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;overflow-wrap:break-word}#sbo-rt-content code strong em,#sbo-rt-content code em strong,#sbo-rt-content pre em strong,#sbo-rt-content pre strong em,#sbo-rt-content strong code em code,#sbo-rt-content em code strong code,#sbo-rt-content span.bolditalic code{font-weight:bold;font-style:italic;font-family:"Ubuntu Mono BoldItal",monospace}#sbo-rt-content code em,#sbo-rt-content em code,#sbo-rt-content pre em,#sbo-rt-content em.replaceable{font-family:"Ubuntu Mono Ital",monospace;font-style:italic}#sbo-rt-content code strong,#sbo-rt-content strong code,#sbo-rt-content pre strong,#sbo-rt-content strong.userinput{font-family:"Ubuntu Mono Bold",monospace;font-weight:bold}#sbo-rt-content div[data-type="example"]{margin:10px 0 15px 0 !important}#sbo-rt-content div[data-type="example"] h1,#sbo-rt-content div[data-type="example"] h2,#sbo-rt-content div[data-type="example"] h3,#sbo-rt-content div[data-type="example"] h4,#sbo-rt-content div[data-type="example"] h5,#sbo-rt-content div[data-type="example"] h6{font-style:italic;font-weight:normal;text-align:left !important;text-transform:none !important;font-family:serif !important;margin:10px 0 5px 0 !important;border-bottom:1px solid #000}#sbo-rt-content li pre.example{padding:10px 0 !important}#sbo-rt-content div[data-type="example"] pre[data-type="programlisting"],#sbo-rt-content div[data-type="example"] pre[data-type="screen"]{margin:0}#sbo-rt-content section[data-type="titlepage"]>div>h1{font-size:2em;margin:50px 0 10px 0 !important;line-height:1;text-align:center}#sbo-rt-content section[data-type="titlepage"] h2,#sbo-rt-content section[data-type="titlepage"] p.subtitle,#sbo-rt-content section[data-type="titlepage"] p[data-type="subtitle"]{font-size:1.3em;font-weight:normal;text-align:center;margin-top:.5em;color:#555}#sbo-rt-content section[data-type="titlepage"]>div>h2[data-type="author"],#sbo-rt-content section[data-type="titlepage"] p.author{font-size:1.3em;font-family:serif !important;font-weight:bold;margin:50px 0 !important;text-align:center}#sbo-rt-content section[data-type="titlepage"] p.edition{text-align:center;text-transform:uppercase;margin-top:2em}#sbo-rt-content section[data-type="titlepage"]{text-align:center}#sbo-rt-content section[data-type="titlepage"]:after{content:url(css_assets/titlepage_footer_ebook.png);margin:0 auto;max-width:80%}#sbo-rt-content div.book div.titlepage div.publishername{margin-top:60%;margin-bottom:20px;text-align:center;font-size:1.25em}#sbo-rt-content div.book div.titlepage div.locations p{margin:0;text-align:center}#sbo-rt-content div.book div.titlepage div.locations p.cities{font-size:80%;text-align:center;margin-top:5px}#sbo-rt-content section.preface[title="Dedication"]>div.titlepage h2.title{text-align:center;text-transform:uppercase;font-size:1.5em;margin-top:50px;margin-bottom:50px}#sbo-rt-content ul.stafflist{margin:15px 0 15px 20px !important}#sbo-rt-content ul.stafflist li{list-style-type:none;padding:5px 0}#sbo-rt-content ul.printings li{list-style-type:none}#sbo-rt-content section.preface[title="Dedication"] p{font-style:italic;text-align:center}#sbo-rt-content div.colophon h1.title{font-size:1.3em;margin:0 !important;font-family:serif !important;font-weight:normal}#sbo-rt-content div.colophon h2.subtitle{margin:0 !important;color:#000;font-family:serif !important;font-size:1em;font-weight:normal}#sbo-rt-content div.colophon div.author h3.author{font-size:1.1em;font-family:serif !important;margin:10px 0 0 !important;font-weight:normal}#sbo-rt-content div.colophon div.editor h4,#sbo-rt-content div.colophon div.editor h3.editor{color:#000;font-size:.8em;margin:15px 0 0 !important;font-family:serif !important;font-weight:normal}#sbo-rt-content div.colophon div.editor h3.editor{font-size:.8em;margin:0 !important;font-family:serif !important;font-weight:normal}#sbo-rt-content div.colophon div.publisher{margin-top:10px}#sbo-rt-content div.colophon div.publisher p,#sbo-rt-content div.colophon div.publisher span.publishername{margin:0;font-size:.8em}#sbo-rt-content div.legalnotice p,#sbo-rt-content div.timestamp p{font-size:.8em}#sbo-rt-content div.timestamp p{margin-top:10px}#sbo-rt-content div.colophon[title="About the Author"] h1.title,#sbo-rt-content div.colophon[title="Colophon"] h1.title{font-size:1.5em;margin:0 !important;font-family:sans-serif !important}#sbo-rt-content section.chapter div.titlepage div.author{margin:10px 0 10px 0}#sbo-rt-content section.chapter div.titlepage div.author div.affiliation{font-style:italic}#sbo-rt-content div.attribution{margin:5px 0 0 50px !important}#sbo-rt-content h3.author span.orgname{display:none}#sbo-rt-content div.epigraph{margin:10px 0 10px 20px !important;page-break-inside:avoid;font-size:90%}#sbo-rt-content div.epigraph p{font-style:italic}#sbo-rt-content blockquote,#sbo-rt-content div.blockquote{margin:10px !important;page-break-inside:avoid;font-size:95%}#sbo-rt-content blockquote p,#sbo-rt-content div.blockquote p{font-style:italic;margin:.75em 0 0 !important}#sbo-rt-content blockquote div.attribution,#sbo-rt-content blockquote p[data-type="attribution"]{margin:5px 0 10px 30px !important;text-align:right;width:80%}#sbo-rt-content blockquote div.attribution p,#sbo-rt-content blockquote p[data-type="attribution"]{font-style:normal;margin-top:5px}#sbo-rt-content blockquote div.attribution p:before,#sbo-rt-content blockquote p[data-type="attribution"]:before{font-style:normal;content:"—";-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none}#sbo-rt-content p.right{text-align:right;margin:0}#sbo-rt-content div[data-type="footnotes"]{border-top:1px solid black;margin-top:1.5em}#sbo-rt-content sub,#sbo-rt-content sup{font-size:75%;line-height:0;position:relative}#sbo-rt-content sup{top:-.5em}#sbo-rt-content sub{bottom:-.25em}#sbo-rt-content div.refentry p.refname{font-size:1em;font-family:sans-serif,"DejaVuSans";font-weight:bold;margin-bottom:5px;overflow:auto;width:100%}#sbo-rt-content div.refentry{width:100%;display:block;margin-top:2em}#sbo-rt-content div.refsynopsisdiv{display:block;clear:both}#sbo-rt-content div.refentry header{page-break-inside:avoid !important;display:block;break-inside:avoid !important;padding-top:0;border-bottom:1px solid #000}#sbo-rt-content div.refsect1 h6{font-size:.9em;font-family:sans-serif,"DejaVuSans";font-weight:bold}#sbo-rt-content div.refsect1{margin-top:3em}#sbo-rt-content dt{padding-top:10px !important;padding-bottom:0 !important}#sbo-rt-content dd{margin-left:1.5em !important;margin-bottom:.25em}#sbo-rt-content dd ol,#sbo-rt-content dd ul{padding-left:1em}#sbo-rt-content dd li{margin-top:0;margin-bottom:0}#sbo-rt-content dd,#sbo-rt-content li{text-align:left}#sbo-rt-content ul,#sbo-rt-content ul>li,#sbo-rt-content ol ul,#sbo-rt-content ol ul>li,#sbo-rt-content ul ol ul,#sbo-rt-content ul ol ul>li{list-style-type:disc}#sbo-rt-content ul ul,#sbo-rt-content ul ul>li{list-style-type:square}#sbo-rt-content ul ul ul,#sbo-rt-content ul ul ul>li{list-style-type:circle}#sbo-rt-content ol,#sbo-rt-content ol>li,#sbo-rt-content ol ul ol,#sbo-rt-content ol ul ol>li,#sbo-rt-content ul ol,#sbo-rt-content ul ol>li{list-style-type:decimal}#sbo-rt-content ol ol,#sbo-rt-content ol ol>li{list-style-type:lower-alpha}#sbo-rt-content ol ol ol,#sbo-rt-content ol ol ol>li{list-style-type:lower-roman}#sbo-rt-content ol,#sbo-rt-content ul{list-style-position:outside;margin:15px 0 15px 1.25em;padding-left:2.25em}#sbo-rt-content ol li,#sbo-rt-content ul li{margin:.5em 0 .65em;line-height:125%}#sbo-rt-content div.orderedlistalpha{list-style-type:upper-alpha}#sbo-rt-content table.simplelist,#sbo-rt-content ul.simplelist{margin:15px 0 15px 20px !important}#sbo-rt-content ul.simplelist li{list-style-type:none;padding:5px 0}#sbo-rt-content table.simplelist td{border:none}#sbo-rt-content table.simplelist tr{border-bottom:none}#sbo-rt-content table.simplelist tr:nth-of-type(even){background-color:transparent}#sbo-rt-content dl.calloutlist p:first-child{margin-top:-25px !important}#sbo-rt-content dl.calloutlist dd{padding-left:0;margin-top:-25px}#sbo-rt-content dl.calloutlist img,#sbo-rt-content a.co img{padding:0}#sbo-rt-content div.toc ol{margin-top:8px !important;margin-bottom:8px !important;margin-left:0 !important;padding-left:0 !important}#sbo-rt-content div.toc ol ol{margin-left:30px !important;padding-left:0 !important}#sbo-rt-content div.toc ol li{list-style-type:none}#sbo-rt-content div.toc a{color:#8e0012}#sbo-rt-content div.toc ol a{font-size:1em;font-weight:bold}#sbo-rt-content div.toc ol>li>ol a{font-weight:bold;font-size:1em}#sbo-rt-content div.toc ol>li>ol>li>ol a{text-decoration:none;font-weight:normal;font-size:1em}#sbo-rt-content div.tip,#sbo-rt-content div[data-type="tip"],#sbo-rt-content div.note,#sbo-rt-content div[data-type="note"],#sbo-rt-content div.warning,#sbo-rt-content div[data-type="warning"],#sbo-rt-content div[data-type="caution"],#sbo-rt-content div[data-type="important"]{margin:30px !important;font-size:90%;padding:10px 8px 20px 8px !important;page-break-inside:avoid}#sbo-rt-content div.tip ol,#sbo-rt-content div.tip ul,#sbo-rt-content div[data-type="tip"] ol,#sbo-rt-content div[data-type="tip"] ul,#sbo-rt-content div.note ol,#sbo-rt-content div.note ul,#sbo-rt-content div[data-type="note"] ol,#sbo-rt-content div[data-type="note"] ul,#sbo-rt-content div.warning ol,#sbo-rt-content div.warning ul,#sbo-rt-content div[data-type="warning"] ol,#sbo-rt-content div[data-type="warning"] ul,#sbo-rt-content div[data-type="caution"] ol,#sbo-rt-content div[data-type="caution"] ul,#sbo-rt-content div[data-type="important"] ol,#sbo-rt-content div[data-type="important"] ul{margin-left:1.5em !important}#sbo-rt-content div.tip,#sbo-rt-content div[data-type="tip"],#sbo-rt-content div.note,#sbo-rt-content div[data-type="note"]{border:1px solid #BEBEBE;background-color:transparent}#sbo-rt-content div.warning,#sbo-rt-content div[data-type="warning"],#sbo-rt-content div[data-type="caution"],#sbo-rt-content div[data-type="important"]{border:1px solid #BC8F8F}#sbo-rt-content div.tip h3,#sbo-rt-content div[data-type="tip"] h6,#sbo-rt-content div[data-type="tip"] h1,#sbo-rt-content div.note h3,#sbo-rt-content div[data-type="note"] h6,#sbo-rt-content div[data-type="note"] h1,#sbo-rt-content div.warning h3,#sbo-rt-content div[data-type="warning"] h6,#sbo-rt-content div[data-type="warning"] h1,#sbo-rt-content div[data-type="caution"] h6,#sbo-rt-content div[data-type="caution"] h1,#sbo-rt-content div[data-type="important"] h1,#sbo-rt-content div[data-type="important"] h6{font-weight:bold;font-size:110%;font-family:sans-serif !important;text-transform:uppercase;letter-spacing:1px;text-align:center;margin:4px 0 6px !important}#sbo-rt-content div[data-type="tip"] figure h6,#sbo-rt-content div[data-type="note"] figure h6,#sbo-rt-content div[data-type="warning"] figure h6,#sbo-rt-content div[data-type="caution"] figure h6,#sbo-rt-content div[data-type="important"] figure h6{font-family:serif !important}#sbo-rt-content div.tip h3,#sbo-rt-content div[data-type="tip"] h6,#sbo-rt-content div.note h3,#sbo-rt-content div[data-type="note"] h6,#sbo-rt-content div[data-type="tip"] h1,#sbo-rt-content div[data-type="note"] h1{color:#737373}#sbo-rt-content div.warning h3,#sbo-rt-content div[data-type="warning"] h6,#sbo-rt-content div[data-type="caution"] h6,#sbo-rt-content div[data-type="important"] h6,#sbo-rt-content div[data-type="warning"] h1,#sbo-rt-content div[data-type="caution"] h1,#sbo-rt-content div[data-type="important"] h1{color:#C67171}#sbo-rt-content div.sect1[title="Safari® Books Online"] div.note,#sbo-rt-content div.safarienabled{background-color:transparent;margin:8px 0 0 !important;border:0 solid #BEBEBE;font-size:100%;padding:0 !important;page-break-inside:avoid}#sbo-rt-content div.sect1[title="Safari® Books Online"] div.note h3,#sbo-rt-content div.safarienabled h6{display:none}#sbo-rt-content div.table,#sbo-rt-content table{margin:15px 0 30px 0 !important;max-width:95%;border:none !important;background:none;display:table !important}#sbo-rt-content div.table,#sbo-rt-content div.informaltable,#sbo-rt-content table{page-break-inside:avoid}#sbo-rt-content tr,#sbo-rt-content tr td{border-bottom:1px solid #c3c3c3}#sbo-rt-content thead td,#sbo-rt-content thead th{border-bottom:#9d9d9d 1px solid !important;border-top:#9d9d9d 1px solid !important}#sbo-rt-content tr:nth-of-type(even){background-color:#f1f6fc}#sbo-rt-content thead{font-family:sans-serif;font-weight:bold}#sbo-rt-content td,#sbo-rt-content th{display:table-cell;padding:.3em;text-align:left;vertical-align:middle;font-size:80%}#sbo-rt-content div.informaltable table{margin:10px auto !important}#sbo-rt-content div.informaltable table tr{border-bottom:none}#sbo-rt-content div.informaltable table tr:nth-of-type(even){background-color:transparent}#sbo-rt-content div.informaltable td,#sbo-rt-content div.informaltable th{border:#9d9d9d 1px solid}#sbo-rt-content div.table-title,#sbo-rt-content table caption{font-weight:normal;font-style:italic;font-family:serif;font-size:1em;margin:10px 0 10px 0 !important;padding:0;page-break-after:avoid;text-align:left !important}#sbo-rt-content table code{font-size:smaller}#sbo-rt-content div.equation,#sbo-rt-content div[data-type="equation"]{margin:10px 0 15px 0 !important}#sbo-rt-content div.equation-title,#sbo-rt-content div[data-type="equation"] h5{font-style:italic;font-weight:normal;font-family:serif !important;font-size:90%;margin:20px 0 10px 0 !important;page-break-after:avoid}#sbo-rt-content div.equation-contents{margin-left:20px}#sbo-rt-content div[data-type="equation"] math{font-size:calc(.35em + 1vw)}#sbo-rt-content span.inlinemediaobject{height:.85em;display:inline-block;margin-bottom:.2em}#sbo-rt-content span.inlinemediaobject img{margin:0;height:.85em}#sbo-rt-content div.informalequation{margin:20px 0 20px 20px;width:75%}#sbo-rt-content div.informalequation img{width:75%}#sbo-rt-content div.index{text-indent:0}#sbo-rt-content div.index h3{padding:.25em;margin-top:1em !important;background-color:#F0F0F0}#sbo-rt-content div.index li{line-height:130%;list-style-type:none}#sbo-rt-content div.index a.indexterm{color:#8e0012 !important}#sbo-rt-content div.index ul{margin-left:0 !important;padding-left:0 !important}#sbo-rt-content div.index ul ul{margin-left:1em !important;margin-top:0 !important}#sbo-rt-content code.boolean,#sbo-rt-content .navy{color:rgb(0,0,128);}#sbo-rt-content code.character,#sbo-rt-content .olive{color:rgb(128,128,0);}#sbo-rt-content code.comment,#sbo-rt-content .blue{color:rgb(0,0,255);}#sbo-rt-content code.conditional,#sbo-rt-content .limegreen{color:rgb(50,205,50);}#sbo-rt-content code.constant,#sbo-rt-content .darkorange{color:rgb(255,140,0);}#sbo-rt-content code.debug,#sbo-rt-content .darkred{color:rgb(139,0,0);}#sbo-rt-content code.define,#sbo-rt-content .darkgoldenrod,#sbo-rt-content .gold{color:rgb(184,134,11);}#sbo-rt-content code.delimiter,#sbo-rt-content .dimgray{color:rgb(105,105,105);}#sbo-rt-content code.error,#sbo-rt-content .red{color:rgb(255,0,0);}#sbo-rt-content code.exception,#sbo-rt-content .salmon{color:rgb(250,128,11);}#sbo-rt-content code.float,#sbo-rt-content .steelblue{color:rgb(70,130,180);}#sbo-rt-content pre code.function,#sbo-rt-content .green{color:rgb(0,128,0);}#sbo-rt-content code.identifier,#sbo-rt-content .royalblue{color:rgb(65,105,225);}#sbo-rt-content code.ignore,#sbo-rt-content .gray{color:rgb(128,128,128);}#sbo-rt-content code.include,#sbo-rt-content .purple{color:rgb(128,0,128);}#sbo-rt-content code.keyword,#sbo-rt-content .sienna{color:rgb(160,82,45);}#sbo-rt-content code.label,#sbo-rt-content .deeppink{color:rgb(255,20,147);}#sbo-rt-content code.macro,#sbo-rt-content .orangered{color:rgb(255,69,0);}#sbo-rt-content code.number,#sbo-rt-content .brown{color:rgb(165,42,42);}#sbo-rt-content code.operator,#sbo-rt-content .black{color:#000;}#sbo-rt-content code.preCondit,#sbo-rt-content .teal{color:rgb(0,128,128);}#sbo-rt-content code.preProc,#sbo-rt-content .fuschia{color:rgb(255,0,255);}#sbo-rt-content code.repeat,#sbo-rt-content .indigo{color:rgb(75,0,130);}#sbo-rt-content code.special,#sbo-rt-content .saddlebrown{color:rgb(139,69,19);}#sbo-rt-content code.specialchar,#sbo-rt-content .magenta{color:rgb(255,0,255);}#sbo-rt-content code.specialcomment,#sbo-rt-content .seagreen{color:rgb(46,139,87);}#sbo-rt-content code.statement,#sbo-rt-content .forestgreen{color:rgb(34,139,34);}#sbo-rt-content code.storageclass,#sbo-rt-content .plum{color:rgb(221,160,221);}#sbo-rt-content code.string,#sbo-rt-content .darkred{color:rgb(139,0,0);}#sbo-rt-content code.structure,#sbo-rt-content .chocolate{color:rgb(210,106,30);}#sbo-rt-content code.tag,#sbo-rt-content .darkcyan{color:rgb(0,139,139);}#sbo-rt-content code.todo,#sbo-rt-content .black{color:#000;}#sbo-rt-content code.type,#sbo-rt-content .mediumslateblue{color:rgb(123,104,238);}#sbo-rt-content code.typedef,#sbo-rt-content .darkgreen{color:rgb(0,100,0);}#sbo-rt-content code.underlined{text-decoration:underline;}#sbo-rt-content pre code.hll{background-color:#ffc}#sbo-rt-content pre code.c{color:#09F;font-style:italic}#sbo-rt-content pre code.err{color:#A00}#sbo-rt-content pre code.k{color:#069;font-weight:bold}#sbo-rt-content pre code.o{color:#555}#sbo-rt-content pre code.cm{color:#35586C;font-style:italic}#sbo-rt-content pre code.cp{color:#099}#sbo-rt-content pre code.c1{color:#35586C;font-style:italic}#sbo-rt-content pre code.cs{color:#35586C;font-weight:bold;font-style:italic}#sbo-rt-content pre code.gd{background-color:#FCC}#sbo-rt-content pre code.ge{font-style:italic}#sbo-rt-content pre code.gr{color:#F00}#sbo-rt-content pre code.gh{color:#030;font-weight:bold}#sbo-rt-content pre code.gi{background-color:#CFC}#sbo-rt-content pre code.go{color:#000}#sbo-rt-content pre code.gp{color:#009;font-weight:bold}#sbo-rt-content pre code.gs{font-weight:bold}#sbo-rt-content pre code.gu{color:#030;font-weight:bold}#sbo-rt-content pre code.gt{color:#9C6}#sbo-rt-content pre code.kc{color:#069;font-weight:bold}#sbo-rt-content pre code.kd{color:#069;font-weight:bold}#sbo-rt-content pre code.kn{color:#069;font-weight:bold}#sbo-rt-content pre code.kp{color:#069}#sbo-rt-content pre code.kr{color:#069;font-weight:bold}#sbo-rt-content pre code.kt{color:#078;font-weight:bold}#sbo-rt-content pre code.m{color:#F60}#sbo-rt-content pre code.s{color:#C30}#sbo-rt-content pre code.na{color:#309}#sbo-rt-content pre code.nb{color:#366}#sbo-rt-content pre code.nc{color:#0A8;font-weight:bold}#sbo-rt-content pre code.no{color:#360}#sbo-rt-content pre code.nd{color:#99F}#sbo-rt-content pre code.ni{color:#999;font-weight:bold}#sbo-rt-content pre code.ne{color:#C00;font-weight:bold}#sbo-rt-content pre code.nf{color:#C0F}#sbo-rt-content pre code.nl{color:#99F}#sbo-rt-content pre code.nn{color:#0CF;font-weight:bold}#sbo-rt-content pre code.nt{color:#309;font-weight:bold}#sbo-rt-content pre code.nv{color:#033}#sbo-rt-content pre code.ow{color:#000;font-weight:bold}#sbo-rt-content pre code.w{color:#bbb}#sbo-rt-content pre code.mf{color:#F60}#sbo-rt-content pre code.mh{color:#F60}#sbo-rt-content pre code.mi{color:#F60}#sbo-rt-content pre code.mo{color:#F60}#sbo-rt-content pre code.sb{color:#C30}#sbo-rt-content pre code.sc{color:#C30}#sbo-rt-content pre code.sd{color:#C30;font-style:italic}#sbo-rt-content pre code.s2{color:#C30}#sbo-rt-content pre code.se{color:#C30;font-weight:bold}#sbo-rt-content pre code.sh{color:#C30}#sbo-rt-content pre code.si{color:#A00}#sbo-rt-content pre code.sx{color:#C30}#sbo-rt-content pre code.sr{color:#3AA}#sbo-rt-content pre code.s1{color:#C30}#sbo-rt-content pre code.ss{color:#A60}#sbo-rt-content pre code.bp{color:#366}#sbo-rt-content pre code.vc{color:#033}#sbo-rt-content pre code.vg{color:#033}#sbo-rt-content pre code.vi{color:#033}#sbo-rt-content pre code.il{color:#F60}#sbo-rt-content pre code.g{color:#050}#sbo-rt-content pre code.l{color:#C60}#sbo-rt-content pre code.l{color:#F90}#sbo-rt-content pre code.n{color:#008}#sbo-rt-content pre code.nx{color:#008}#sbo-rt-content pre code.py{color:#96F}#sbo-rt-content pre code.p{color:#000}#sbo-rt-content pre code.x{color:#F06}#sbo-rt-content div.blockquote_sampler_toc{width:95%;margin:5px 5px 5px 10px !important}#sbo-rt-content div{font-family:serif;text-align:left}#sbo-rt-content .gray-background,#sbo-rt-content .reverse-video{background:#2E2E2E;color:#FFF}#sbo-rt-content .light-gray-background{background:#A0A0A0}#sbo-rt-content .preserve-whitespace{white-space:pre-wrap}#sbo-rt-content span.gray{color:#4C4C4C}#sbo-rt-content div.map-ebook{page-break-after:always}
    </style><link rel="canonical" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html"><meta name="description" content=" Chapter 6. Partitioning Clearly, we must break away from the sequential and not limit the computers. We must state definitions and provide for priorities and descriptions of data. We must ... "><meta property="og:title" content="6. Partitioning"><meta itemprop="isPartOf" content="/library/view/designing-data-intensive-applications/9781491903063/"><meta itemprop="name" content="6. Partitioning"><meta property="og:url" itemprop="url" content="https://www.safaribooksonline.com/library/view/designing-data-intensive-applications/9781491903063/ch06.html"><meta property="og:site_name" content="Safari"><meta property="og:image" itemprop="thumbnailUrl" content="https://www.safaribooksonline.com/library/cover/9781491903063/"><meta property="og:description" itemprop="description" content=" Chapter 6. Partitioning Clearly, we must break away from the sequential and not limit the computers. We must state definitions and provide for priorities and descriptions of data. We must ... "><meta itemprop="inLanguage" content="en"><meta itemprop="publisher" content="O'Reilly Media, Inc."><meta property="og:type" content="book"><meta property="og:book:isbn" itemprop="isbn" content="9781449373320"><meta property="og:book:author" itemprop="author" content="Martin Kleppmann"><meta property="og:book:tag" itemprop="about" content="Core Programming"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@safari"><style type="text/css" id="font-styles" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-size: <%= font_size %> !important; }"></style><style type="text/css" id="font-family" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-family: <%= font_family %> !important; }"></style><style type="text/css" id="column-width" data-template="#sbo-rt-content { max-width: <%= column_width %>% !important; margin: 0 auto !important; }"></style><style id="annotator-dynamic-style">.annotator-adder, .annotator-outer, .annotator-notice {
  z-index: 100019;
}
.annotator-filter {
  z-index: 100009;
}</style></head>


<body class="reading sidenav nav-collapsed  scalefonts subscribe-panel library" data-gr-c-s-loaded="true">

    
  
  
  



    
      <div class="hide working" role="status">
        <div class="working-image"></div>
      </div>
      <div class="sbo-site-nav">
        





<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#container" class="skip">Skip to content</a><header class="topbar t-topbar" style="display:None"><nav role="navigation" class="js-site-nav"><ul class="topnav"><li class="t-logo"><a href="https://www.safaribooksonline.com/home/" class="l0 None safari-home nav-icn js-keyboard-nav-home"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>Safari Home Icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M4 9.9L4 9.9 4 18 16 18 16 9.9 10 4 4 9.9ZM2.6 8.1L2.6 8.1 8.7 1.9 10 0.5 11.3 1.9 17.4 8.1 18 8.7 18 9.5 18 18.1 18 20 16.1 20 3.9 20 2 20 2 18.1 2 9.5 2 8.7 2.6 8.1Z"></path><rect x="10" y="12" width="3" height="7"></rect><rect transform="translate(18.121320, 10.121320) rotate(-315.000000) translate(-18.121320, -10.121320) " x="16.1" y="9.1" width="4" height="2"></rect><rect transform="translate(2.121320, 10.121320) scale(-1, 1) rotate(-315.000000) translate(-2.121320, -10.121320) " x="0.1" y="9.1" width="4" height="2"></rect></g></svg><span>Safari Home</span></a></li><li><a href="https://www.safaribooksonline.com/r/" class="t-recommendations-nav l0 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>recommendations icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M50 25C50 18.2 44.9 12.5 38.3 11.7 37.5 5.1 31.8 0 25 0 18.2 0 12.5 5.1 11.7 11.7 5.1 12.5 0 18.2 0 25 0 31.8 5.1 37.5 11.7 38.3 12.5 44.9 18.2 50 25 50 31.8 50 37.5 44.9 38.3 38.3 44.9 37.5 50 31.8 50 25ZM25 3.1C29.7 3.1 33.6 6.9 34.4 11.8 30.4 12.4 26.9 15.1 25 18.8 23.1 15.1 19.6 12.4 15.6 11.8 16.4 6.9 20.3 3.1 25 3.1ZM34.4 15.6C33.6 19.3 30.7 22.2 27.1 22.9 27.8 19.2 30.7 16.3 34.4 15.6ZM22.9 22.9C19.2 22.2 16.3 19.3 15.6 15.6 19.3 16.3 22.2 19.2 22.9 22.9ZM3.1 25C3.1 20.3 6.9 16.4 11.8 15.6 12.4 19.6 15.1 23.1 18.8 25 15.1 26.9 12.4 30.4 11.8 34.4 6.9 33.6 3.1 29.7 3.1 25ZM22.9 27.1C22.2 30.7 19.3 33.6 15.6 34.4 16.3 30.7 19.2 27.8 22.9 27.1ZM25 46.9C20.3 46.9 16.4 43.1 15.6 38.2 19.6 37.6 23.1 34.9 25 31.3 26.9 34.9 30.4 37.6 34.4 38.2 33.6 43.1 29.7 46.9 25 46.9ZM27.1 27.1C30.7 27.8 33.6 30.7 34.4 34.4 30.7 33.6 27.8 30.7 27.1 27.1ZM38.2 34.4C37.6 30.4 34.9 26.9 31.3 25 34.9 23.1 37.6 19.6 38.2 15.6 43.1 16.4 46.9 20.3 46.9 25 46.9 29.7 43.1 33.6 38.2 34.4Z"></path></g></svg><span>Recommended</span></a></li><li><a href="https://www.safaribooksonline.com/playlists/" class="t-queue-nav l0 nav-icn None"><!--?xml version="1.0" encoding="UTF-8"?--><svg width="21px" height="17px" viewBox="0 0 21 17" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><!-- Generator: Sketch 46.2 (44496) - http://www.bohemiancoding.com/sketch --><title>icon_Playlist_sml</title><desc>Created with Sketch.</desc><defs></defs><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="icon_Playlist_sml" fill-rule="nonzero" fill="#000000"><g id="playlist-icon"><g id="Group-6"><rect id="Rectangle-path" x="5" y="0" width="16" height="3" rx="0.5"></rect><circle id="Oval" cx="1.5" cy="1.5" r="1.5"></circle></g><g id="Group-5" transform="translate(0.000000, 7.000000)"><circle id="Oval" cx="1.5" cy="1.5" r="1.5"></circle><rect id="Rectangle-path" x="5" y="0" width="16" height="3" rx="0.5"></rect></g><g id="Group-5-Copy" transform="translate(0.000000, 14.000000)"><circle id="Oval" cx="1.5" cy="1.5" r="1.5"></circle><rect id="Rectangle-path" x="5" y="0" width="16" height="3" rx="0.5"></rect></g></g></g></g></svg><span>
               Playlists
            </span></a></li><li class="search"><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#" class="t-search-nav trigger nav-icn l0" data-dropdown-selector=".searchbox"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>search icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M31.3 0C20.9 0 12.5 8.4 12.5 18.8 12.5 22.5 13.6 25.9 15.4 28.8L1.2 42.9C-0.4 44.5-0.4 47.2 1.2 48.8 2 49.6 3.1 50 4.2 50 5.2 50 6.3 49.6 7.1 48.8L21.2 34.6C24.1 36.5 27.5 37.5 31.3 37.5 41.6 37.5 50 29.1 50 18.8 50 8.4 41.6 0 31.3 0ZM31.3 31.3C24.4 31.3 18.8 25.6 18.8 18.8 18.8 11.9 24.4 6.3 31.3 6.3 38.1 6.3 43.8 11.9 43.8 18.8 43.8 25.6 38.1 31.3 31.3 31.3Z"></path></g></svg><span>Search</span></a></li><li class="usermenu dropdown"><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#" class="trigger l0 nav-icn nav-dropdown"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>navigation arrow</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M0.1 12.5L9.7 3.1C9.8 3 9.9 3 10 3 10.1 3 10.2 3 10.3 3.1L19.9 12.5C20 12.5 20 12.6 20 12.8 20 12.9 20 13 19.9 13L17 15.9C16.9 16 16.8 16 16.7 16 16.5 16 16.4 16 16.4 15.9L10 9.7 3.6 15.9C3.6 16 3.5 16 3.3 16 3.2 16 3.1 16 3 15.9L0.1 13C0 12.9 0 12.8 0 12.7 0 12.7 0 12.6 0.1 12.5Z"></path></g></svg><span>Expand Nav</span></a><div class="drop-content"><ul><li><a href="https://www.safaribooksonline.com/history/" class="t-recent-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>recent items icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 0C11.2 0 0 11.2 0 25 0 38.8 11.2 50 25 50 38.8 50 50 38.8 50 25 50 11.2 38.8 0 25 0ZM6.3 25C6.3 14.6 14.6 6.3 25 6.3 35.4 6.3 43.8 14.6 43.8 25 43.8 35.4 35.4 43.8 25 43.8 14.6 43.8 6.3 35.4 6.3 25ZM31.8 31.5C32.5 30.5 32.4 29.2 31.6 28.3L27.1 23.8 27.1 12.8C27.1 11.5 26.2 10.4 25 10.4 23.9 10.4 22.9 11.5 22.9 12.8L22.9 25.7 28.8 31.7C29.2 32.1 29.7 32.3 30.2 32.3 30.8 32.3 31.3 32 31.8 31.5Z"></path></g></svg><span>History</span></a></li><li><a href="https://www.safaribooksonline.com/topics" class="t-topics-link l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 55" width="20" height="20" version="1.1" fill="#4A3C31"><desc>topics icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 55L50 41.262 50 13.762 25 0 0 13.762 0 41.262 25 55ZM8.333 37.032L8.333 17.968 25 8.462 41.667 17.968 41.667 37.032 25 46.538 8.333 37.032Z"></path></g></svg><span>Topics</span></a></li><li><a href="https://www.safaribooksonline.com/tutorials/" class="l1 nav-icn t-tutorials-nav js-toggle-menu-item None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>tutorials icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M15.8 18.2C15.8 18.2 15.9 18.2 16 18.2 16.1 18.2 16.2 18.2 16.4 18.2 16.5 18.2 16.7 18.1 16.9 18 17 17.9 17.1 17.8 17.2 17.7 17.3 17.6 17.4 17.5 17.4 17.4 17.5 17.2 17.6 16.9 17.6 16.7 17.6 16.6 17.6 16.5 17.6 16.4 17.5 16.2 17.5 16.1 17.4 15.9 17.3 15.8 17.2 15.6 17 15.5 16.8 15.3 16.6 15.3 16.4 15.2 16.2 15.2 16 15.2 15.8 15.2 15.7 15.2 15.5 15.3 15.3 15.4 15.2 15.4 15.1 15.5 15 15.7 14.9 15.8 14.8 15.9 14.7 16 14.7 16.1 14.6 16.3 14.6 16.4 14.6 16.5 14.6 16.6 14.6 16.6 14.6 16.7 14.6 16.9 14.6 17 14.6 17.1 14.7 17.3 14.7 17.4 14.8 17.6 15 17.7 15.1 17.9 15.2 18 15.3 18 15.5 18.1 15.5 18.1 15.6 18.2 15.7 18.2 15.7 18.2 15.7 18.2 15.8 18.2L15.8 18.2ZM9.4 11.5C9.5 11.5 9.5 11.5 9.6 11.5 9.7 11.5 9.9 11.5 10 11.5 10.2 11.5 10.3 11.4 10.5 11.3 10.6 11.2 10.8 11.1 10.9 11 10.9 10.9 11 10.8 11.1 10.7 11.2 10.5 11.2 10.2 11.2 10 11.2 9.9 11.2 9.8 11.2 9.7 11.2 9.5 11.1 9.4 11 9.2 10.9 9.1 10.8 8.9 10.6 8.8 10.5 8.7 10.3 8.6 10 8.5 9.9 8.5 9.7 8.5 9.5 8.5 9.3 8.5 9.1 8.6 9 8.7 8.8 8.7 8.7 8.8 8.6 9 8.5 9.1 8.4 9.2 8.4 9.3 8.2 9.5 8.2 9.8 8.2 10 8.2 10.1 8.2 10.2 8.2 10.3 8.2 10.5 8.3 10.6 8.4 10.7 8.5 10.9 8.6 11.1 8.7 11.2 8.9 11.3 9 11.4 9.1 11.4 9.2 11.4 9.3 11.5 9.3 11.5 9.3 11.5 9.4 11.5 9.4 11.5L9.4 11.5ZM3 4.8C3.1 4.8 3.1 4.8 3.2 4.8 3.4 4.8 3.5 4.8 3.7 4.8 3.8 4.8 4 4.7 4.1 4.6 4.3 4.5 4.4 4.4 4.5 4.3 4.6 4.2 4.6 4.1 4.7 4 4.8 3.8 4.8 3.5 4.8 3.3 4.8 3.1 4.8 3 4.8 2.9 4.7 2.8 4.7 2.6 4.6 2.5 4.5 2.3 4.4 2.2 4.2 2.1 4 1.9 3.8 1.9 3.6 1.8 3.5 1.8 3.3 1.8 3.1 1.8 2.9 1.8 2.7 1.9 2.6 2 2.4 2.1 2.3 2.2 2.2 2.3 2.1 2.4 2 2.5 2 2.6 1.8 2.8 1.8 3 1.8 3.3 1.8 3.4 1.8 3.5 1.8 3.6 1.8 3.8 1.9 3.9 2 4 2.1 4.2 2.2 4.4 2.4 4.5 2.5 4.6 2.6 4.7 2.7 4.7 2.8 4.7 2.9 4.8 2.9 4.8 3 4.8 3 4.8 3 4.8L3 4.8ZM13.1 15.2C13.2 15.1 13.2 15.1 13.2 15.1 13.3 14.9 13.4 14.7 13.6 14.5 13.8 14.2 14.1 14 14.4 13.8 14.7 13.6 15.1 13.5 15.5 13.4 15.9 13.4 16.3 13.4 16.7 13.5 17.2 13.5 17.6 13.7 17.9 13.9 18.2 14.1 18.5 14.4 18.7 14.7 18.9 15 19.1 15.3 19.2 15.6 19.3 15.9 19.4 16.1 19.4 16.4 19.4 17 19.3 17.5 19.1 18.1 19 18.3 18.9 18.5 18.7 18.7 18.5 19 18.3 19.2 18 19.4 17.7 19.6 17.3 19.8 16.9 19.9 16.6 20 16.3 20 16 20 15.8 20 15.6 20 15.4 19.9 15.4 19.9 15.4 19.9 15.4 19.9 15.2 19.9 15 19.8 14.9 19.8 14.8 19.7 14.7 19.7 14.6 19.7 14.4 19.6 14.3 19.5 14.1 19.3 13.7 19.1 13.4 18.7 13.2 18.4 13.1 18.1 12.9 17.8 12.9 17.5 12.8 17.3 12.8 17.1 12.8 16.9L3.5 14.9C3.3 14.9 3.1 14.8 3 14.8 2.7 14.7 2.4 14.5 2.1 14.3 1.7 14 1.4 13.7 1.2 13.3 1 13 0.9 12.6 0.8 12.3 0.7 12 0.7 11.7 0.7 11.4 0.7 11 0.8 10.5 1 10.1 1.1 9.8 1.3 9.5 1.6 9.2 1.8 8.9 2.1 8.7 2.4 8.5 2.8 8.3 3.2 8.1 3.6 8.1 3.9 8 4.2 8 4.5 8 4.6 8 4.8 8 4.9 8.1L6.8 8.5C6.8 8.4 6.8 8.4 6.8 8.4 6.9 8.2 7.1 8 7.2 7.8 7.5 7.5 7.7 7.3 8 7.1 8.4 6.9 8.7 6.8 9.1 6.7 9.5 6.7 10 6.7 10.4 6.8 10.8 6.8 11.2 7 11.5 7.2 11.8 7.5 12.1 7.7 12.4 8 12.6 8.3 12.7 8.6 12.8 8.9 12.9 9.2 13 9.4 13 9.7 13 9.7 13 9.8 13 9.8 13.6 9.9 14.2 10.1 14.9 10.2 15 10.2 15 10.2 15.1 10.2 15.3 10.2 15.4 10.2 15.6 10.2 15.8 10.1 16 10 16.2 9.9 16.4 9.8 16.5 9.6 16.6 9.5 16.8 9.2 16.9 8.8 16.9 8.5 16.9 8.3 16.9 8.2 16.8 8 16.8 7.8 16.7 7.7 16.6 7.5 16.5 7.3 16.3 7.2 16.2 7.1 16 7 15.9 6.9 15.8 6.9 15.7 6.9 15.6 6.8 15.5 6.8L6.2 4.8C6.2 5 6 5.2 5.9 5.3 5.7 5.6 5.5 5.8 5.3 6 4.9 6.2 4.5 6.4 4.1 6.5 3.8 6.6 3.5 6.6 3.2 6.6 3 6.6 2.8 6.6 2.7 6.6 2.6 6.6 2.6 6.5 2.6 6.5 2.5 6.5 2.3 6.5 2.1 6.4 1.8 6.3 1.6 6.1 1.3 6 1 5.7 0.7 5.4 0.5 5 0.3 4.7 0.2 4.4 0.1 4.1 0 3.8 0 3.6 0 3.3 0 2.8 0.1 2.2 0.4 1.7 0.5 1.5 0.7 1.3 0.8 1.1 1.1 0.8 1.3 0.6 1.6 0.5 2 0.3 2.3 0.1 2.7 0.1 3.1 0 3.6 0 4 0.1 4.4 0.2 4.8 0.3 5.1 0.5 5.5 0.8 5.7 1 6 1.3 6.2 1.6 6.3 1.9 6.4 2.3 6.5 2.5 6.6 2.7 6.6 3 6.6 3 6.6 3.1 6.6 3.1 9.7 3.8 12.8 4.4 15.9 5.1 16.1 5.1 16.2 5.2 16.4 5.2 16.7 5.3 16.9 5.5 17.2 5.6 17.5 5.9 17.8 6.2 18.1 6.5 18.3 6.8 18.4 7.2 18.6 7.5 18.6 7.9 18.7 8.2 18.7 8.6 18.7 9 18.6 9.4 18.4 9.8 18.3 10.1 18.2 10.3 18 10.6 17.8 10.9 17.5 11.1 17.3 11.3 16.9 11.6 16.5 11.8 16 11.9 15.7 12 15.3 12 15 12 14.8 12 14.7 12 14.5 11.9 13.9 11.8 13.3 11.7 12.6 11.5 12.5 11.7 12.4 11.9 12.3 12 12.1 12.3 11.9 12.5 11.7 12.7 11.3 12.9 10.9 13.1 10.5 13.2 10.2 13.3 9.9 13.3 9.6 13.3 9.4 13.3 9.2 13.3 9 13.2 9 13.2 9 13.2 9 13.2 8.8 13.2 8.7 13.2 8.5 13.1 8.2 13 8 12.8 7.7 12.6 7.4 12.4 7.1 12 6.8 11.7 6.7 11.4 6.6 11.1 6.5 10.8 6.4 10.6 6.4 10.4 6.4 10.2 5.8 10.1 5.2 9.9 4.5 9.8 4.4 9.8 4.4 9.8 4.3 9.8 4.1 9.8 4 9.8 3.8 9.8 3.6 9.9 3.4 10 3.2 10.1 3 10.2 2.9 10.4 2.8 10.5 2.6 10.8 2.5 11.1 2.5 11.5 2.5 11.6 2.5 11.8 2.6 12 2.6 12.1 2.7 12.3 2.8 12.5 2.9 12.6 3.1 12.8 3.2 12.9 3.3 13 3.5 13.1 3.6 13.1 3.7 13.1 3.8 13.2 3.9 13.2L13.1 15.2 13.1 15.2Z"></path></g></svg><span>Tutorials</span></a></li><li class="nav-offers flyout-parent"><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#" class="l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>offers icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M35.9 20.6L27 15.5C26.1 15 24.7 15 23.7 15.5L14.9 20.6C13.9 21.1 13.2 22.4 13.2 23.4L13.2 41.4C13.2 42.4 13.9 43.7 14.9 44.2L23.3 49C24.2 49.5 25.6 49.5 26.6 49L35.9 43.6C36.8 43.1 37.6 41.8 37.6 40.8L37.6 23.4C37.6 22.4 36.8 21.1 35.9 20.6L35.9 20.6ZM40 8.2C39.1 7.6 37.6 7.6 36.7 8.2L30.2 11.9C29.3 12.4 29.3 13.2 30.2 13.8L39.1 18.8C40 19.4 40.7 20.6 40.7 21.7L40.7 39C40.7 40.1 41.4 40.5 42.4 40L48.2 36.6C49.1 36.1 49.8 34.9 49.8 33.8L49.8 15.6C49.8 14.6 49.1 13.3 48.2 12.8L40 8.2 40 8.2ZM27 10.1L33.6 6.4C34.5 5.9 34.5 5 33.6 4.5L26.6 0.5C25.6 0 24.2 0 23.3 0.5L16.7 4.2C15.8 4.7 15.8 5.6 16.7 6.1L23.7 10.1C24.7 10.6 26.1 10.6 27 10.1ZM10.1 21.7C10.1 20.6 10.8 19.4 11.7 18.8L20.6 13.8C21.5 13.2 21.5 12.4 20.6 11.9L13.6 7.9C12.7 7.4 11.2 7.4 10.3 7.9L1.6 12.8C0.7 13.3 0 14.6 0 15.6L0 33.8C0 34.9 0.7 36.1 1.6 36.6L8.4 40.5C9.3 41 10.1 40.6 10.1 39.6L10.1 21.7 10.1 21.7Z"></path></g></svg><span>Offers &amp; Deals</span></a><ul class="flyout"><li><a href="https://get.oreilly.com/email-signup.html" target="_blank" class="l2 nav-icn"><span>Newsletters</span></a></li></ul></li><li class="nav-highlights"><a href="https://www.safaribooksonline.com/u/f04af719-1c84-4fc3-9be3-1f1b4622ab99/" class="t-highlights-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 35" width="20" height="20" version="1.1" fill="#4A3C31"><desc>highlights icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M13.325 18.071L8.036 18.071C8.036 11.335 12.36 7.146 22.5 5.594L22.5 0C6.37 1.113 0 10.632 0 22.113 0 29.406 3.477 35 10.403 35 15.545 35 19.578 31.485 19.578 26.184 19.578 21.556 17.211 18.891 13.325 18.071L13.325 18.071ZM40.825 18.071L35.565 18.071C35.565 11.335 39.86 7.146 50 5.594L50 0C33.899 1.113 27.5 10.632 27.5 22.113 27.5 29.406 30.977 35 37.932 35 43.045 35 47.078 31.485 47.078 26.184 47.078 21.556 44.74 18.891 40.825 18.071L40.825 18.071Z"></path></g></svg><span>Highlights</span></a></li><li><a href="https://www.safaribooksonline.com/u/preferences/" class="t-settings-nav l1 js-settings nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"></path></g></svg><span>Settings</span></a></li><li><a href="https://www.oreilly.com/online-learning/support/" class="l1 no-icon">Support</a></li><li><a href="https://www.safaribooksonline.com/accounts/logout/" class="l1 no-icon">Sign Out</a></li></ul><ul class="profile"><li><a href="https://www.safaribooksonline.com/u/preferences/" class="l2 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"></path></g></svg><span>Settings</span></a><span class="l2 t-nag-notification" id="nav-nag"><strong class="trial-green">10</strong> days left in your trial.
  
  

  
    
      

<a class="" href="https://www.safaribooksonline.com/subscribe/">Subscribe</a>.


    
  

  

</span></li><li><a href="https://www.oreilly.com/online-learning/support/" class="l2">Support</a></li><li><a href="https://www.safaribooksonline.com/accounts/logout/" class="l2">Sign Out</a></li></ul></div></li></ul></nav></header>


      </div>
      <div id="container" class="application" style="height: auto;">
        
          <div class="nav-container clearfix">
            


            
            
          </div>

          

  <div class="js-toc">
    
      <div class="sbo-reading-menu sbo-menu-top"><section class="sbo-toc-container toc-menu"><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#" class="sbo-toc-thumb"><span class="sbo-title ss-list"><h1><div class="visuallyhidden">Table of Contents for </div>
      
      Designing Data-Intensive Applications
      
    </h1></span></a><div class="toc-contents"></div></section></div>

    

    <div class="interface-controls interface-controls-top">
      <ul class="interface-control-btns js-bitlist js-reader">
        <li class="js-search-in-archive search-in-archive t-search-in-archive"><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#" title="Search in archive" class="js-search-controls search-controls"><span class="icon">Search in book...</span></a><form class="search-archive-bar js-search-form"><input type="search" name="query" placeholder="Search inside this book..." autocomplete="off"></form><div class="search-archive-results"><div class="js-sitb-results-region"></div></div></li><li class="queue-control"><div class="js-content-uri" data-content-uri="/api/v1/book/9781491903063/chapter/ch06.html"><div class="js-collections-dropdown collections-dropdown menu-bit-cards"><div data-reactroot="" class="menu-dropdown-wrapper js-menu-dropdown-wrapper align-right"><img class="hidden" src="https://www.safaribooksonline.com/static/images/ajax-transp.gif" alt="loading spinner"><div class="menu-control"><div class="control "><div class="js-playlists-menu"><button class="js-playlist-icon"><svg class="icon-add-to-playlist-sml" viewBox="0 0 16 14" version="1.1" xmlns="http://www.w3.org/2000/svg"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g fill-rule="nonzero" fill="#000000"><g transform="translate(-1.000000, 0.000000)"><rect x="5" y="0" width="12" height="2"></rect><title>Playlists</title><path d="M4.5,14 C6.43299662,14 8,12.4329966 8,10.5 C8,8.56700338 6.43299662,7 4.5,7 C2.56700338,7 1,8.56700338 1,10.5 C1,12.4329966 2.56700338,14 4.5,14 Z M2.5,10 L4,10 L4,8.5 L5,8.5 L5,10 L6.5,10 L6.5,11 L5,11 L5,12.5 L4,12.5 L4,11 L2.5,11 L2.5,10 Z"></path><circle cx="2" cy="5" r="1"></circle><circle cx="1.94117647" cy="1" r="1"></circle><rect x="5" y="4" width="12" height="2"></rect><rect x="9" y="8" width="8" height="2"></rect><rect x="9" y="12" width="8" height="2"></rect></g></g></g></svg><div class="js-playlist-addto-label">Add&nbsp;To</div></button></div></div></div></div></div></div></li><li class="js-font-control-panel font-control-activator"><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#" data-push-state="false" id="font-controls" title="Change font size" aria-label="Change font size"><span class="icon">Toggle Font Controls</span></a></li><li class="dropdown sharing-controls"><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#" class="trigger" data-push-state="false" title="Share" aria-label="Share"><i class="fa fa-share"></i></a><ul class="social-sharing dropdown-menu"><li><a class="twitter share-button t-twitter" target="_blank" aria-label="Share this section on Twitter" title="Share this section on Twitter" href="https://twitter.com/share?url=https://www.safaribooksonline.com/library/view/designing-data-intensive-applications/9781491903063/ch06.html&amp;text=Designing%20Data-Intensive%20Applications&amp;via=safari"><span>Twitter</span></a></li><li><a class="facebook share-button t-facebook" target="_blank" aria-label="Share this section on Facebook" title="Share this section on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://www.safaribooksonline.com/library/view/designing-data-intensive-applications/9781491903063/ch06.html"><span>Facebook</span></a></li><li><a class="googleplus share-button t-googleplus" target="_blank" aria-label="Share this secton on Google Plus" title="Share this secton on Google Plus" href="https://plus.google.com/share?url=https://www.safaribooksonline.com/library/view/designing-data-intensive-applications/9781491903063/ch06.html"><span>Google Plus</span></a></li><li><a class="email share-button t-email" aria-label="Share this section via email" title="Share this section via email" href="mailto:?subject=Safari:%206.%20Partitioning&amp;body=https://www.safaribooksonline.com/library/view/designing-data-intensive-applications/9781491903063/ch06.html%0D%0Afrom%20Designing%20Data-Intensive%20Applications%0D%0A"><span>Email</span></a></li></ul></li>
      </ul>
    </div>

    <section role="document">
        
        



 <!--[if lt IE 9]>
  
<![endif]-->



  


        
	  <div class="t-sbo-prev sbo-prev sbo-nav-top">
  
    
      
        <a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch05.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">5. Replication</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-top">
  
    
      
        <a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch07.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">7. Transactions</div>
        </a>
    
  
  </div>



<div id="sbo-rt-content" style="transform: none;"><div class="annotator-wrapper"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 6. Partitioning"><div class="chapter" id="ch_partitioning">
<h1><span class="label">Chapter 6. </span>Partitioning</h1>

<blockquote data-type="epigraph" epub:type="epigraph">
  <p><em>Clearly, we must break away from the sequential and not limit the computers. We must state
definitions and provide for priorities and descriptions of data. We must state relationships, not
procedures.</em></p>
  <p data-type="attribution">Grace Murray Hopper, <em>Management and the Computer of the Future</em> (1962)</p>
</blockquote>

<div class="map-ebook">
 <img id="c272" src="https://www.safaribooksonline.com/library/view/designing-data-intensive-applications/9781491903063/assets/ch06-map-ebook.png" width="2756" height="2100" data-mfp-src="/library/view/designing-data-intensive-applications/9781491903063/assets/ch06-map-ebook.png">
</div>

<p><a data-type="indexterm" data-primary="partitioning" id="ix_partition"></a>
<a data-type="indexterm" data-primary="sharding" data-see="partitioning" id="idm140417568358096"></a>
In <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch05.html#ch_replication">Chapter&nbsp;5</a> we discussed replication—that is, having multiple copies of the same data
on different nodes. For very large datasets, or very high query throughput, that is not sufficient:
we need to break the data up into <em>partitions</em>, also known as
<em>sharding</em>.<sup xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook"><a data-type="noteref" id="idm140417568355104-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#idm140417568355104" class="totri-footnote">i</a></sup></p>
<div data-type="note" epub:type="note"><h1>Terminological confusion</h1>
<p><a data-type="indexterm" data-primary="vnodes (partitioning)" id="idm140417568351744"></a><a data-type="indexterm" data-primary="vBuckets (partitioning)" id="idm140417568350816"></a><a data-type="indexterm" data-primary="regions (partitioning)" id="idm140417568350144"></a>
<a data-type="indexterm" data-primary="Google" data-secondary="Bigtable (database)" data-tertiary="partitioning scheme" id="idm140417568349344"></a>
What we call a <em>partition</em> here is called a <em>shard</em> in MongoDB, Elasticsearch, and SolrCloud; it’s known as a
<em>region</em> in HBase, a <em>tablet</em> in Bigtable, a <em>vnode</em> in Cassandra and Riak, and a <em>vBucket</em> in
Couchbase. However, <em>partitioning</em> is the most established term, so we’ll stick with that.</p>
</div>

<p>Normally, partitions are defined in such a way that each piece of data (each record, row, or
document) belongs to exactly one partition. There are various ways of achieving this,
which we discuss in depth in this chapter. In effect, each partition is a small database of its own,
although the database may support operations that touch multiple partitions at the same time.</p>

<p><a data-type="indexterm" data-primary="scalability" data-secondary="partitioning and" id="idm140417568343792"></a>
<a data-type="indexterm" data-primary="shared-nothing architecture" data-secondary="partitioning" id="idm140417568342688"></a>
The main reason for wanting to partition data is <em>scalability</em>. Different partitions can be placed
on different nodes in a shared-nothing cluster (see the introduction to <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/part02.html#part_distributed_data">Part&nbsp;II</a>
for a definition of <em>shared nothing</em>). Thus, a large dataset can be distributed across many disks,
and the query load can be distributed across many processors.</p>

<p>For queries that operate on a single partition, each node can independently execute the
queries for its own partition, so query throughput can be scaled by adding more nodes. Large,
complex queries can potentially be parallelized across many nodes, although this gets significantly
harder.</p>

<p><a data-type="indexterm" data-primary="Teradata (database)" id="idm140417568338592"></a>
<a data-type="indexterm" data-primary="Tandem NonStop SQL (database)" id="idm140417568337760"></a>
Partitioned databases were pioneered in the 1980s by products such as Teradata and Tandem NonStop
SQL [<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="DeWitt1992fn_ch6-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#DeWitt1992fn_ch6" class="totri-footnote">1</a>],
and more recently rediscovered by NoSQL databases and Hadoop-based data warehouses. Some systems are
designed for transactional workloads, and others for analytics (see <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch03.html#sec_storage_analytics">“Transaction Processing or Analytics?”</a>): this
difference affects how the system is tuned, but the fundamentals of partitioning apply to both kinds
of workloads.</p>

<p>In this chapter we will first look at different approaches for partitioning large datasets and
observe how the indexing of data interacts with partitioning. We’ll then talk about rebalancing,
which is necessary if you want to add or remove nodes in your cluster. Finally, we’ll get an
overview of how databases route requests to the right partitions and execute queries.</p>






<section data-type="sect1" data-pdf-bookmark="Partitioning and Replication"><div class="sect1" id="idm140417568332080">
<h1>Partitioning and Replication</h1>

<p><a data-type="indexterm" data-primary="partitioning" data-secondary="and replication" id="idm140417568330624"></a>
<a data-type="indexterm" data-primary="replication" data-secondary="partitioning and" id="idm140417568329520"></a>
Partitioning is usually combined with replication so that copies of each partition are stored on
multiple nodes. This means that, even though each record belongs to exactly one partition, it may
still be stored on several different nodes for fault tolerance.</p>

<p>A node may store more than one partition. If a leader–follower replication model is used, the
combination of partitioning and replication can look like <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#fig_partitioning_replicas">Figure&nbsp;6-1</a>.
Each partition’s leader is assigned to one node, and its followers are assigned to other nodes. Each
node may be the leader for some partitions and a follower for other partitions.</p>

<p>Everything we discussed in <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch05.html#ch_replication">Chapter&nbsp;5</a> about replication of databases applies equally to
replication of partitions. The choice of partitioning scheme is mostly independent of the choice of
replication scheme, so we will keep things simple and ignore replication in this chapter.</p>

<figure><div id="fig_partitioning_replicas" class="figure">
<img src="https://www.safaribooksonline.com/library/view/designing-data-intensive-applications/9781491903063/assets/ddia_0601.png" alt="ddia 0601" width="2880" height="1496" data-mfp-src="/library/view/designing-data-intensive-applications/9781491903063/assets/ddia_0601.png">
<h6><span class="label">Figure 6-1. </span>Combining replication and partitioning: each node acts as leader for some partitions and follower for other partitions.</h6>
</div></figure>
</div></section>













<section data-type="sect1" data-pdf-bookmark="Partitioning of Key-Value Data"><div class="sect1" id="sec_partitioning_key_value">
<h1>Partitioning of Key-Value Data</h1>

<p><a data-type="indexterm" data-primary="key-value stores" data-secondary="partitioning" id="ix_keyvalpart"></a>
<a data-type="indexterm" data-primary="partitioning" data-secondary="of key-value data" id="ix_partitionkeyval"></a>
Say you have a large amount of data, and you want to partition it. How do you decide which records
to store on which nodes?</p>

<p>Our goal with partitioning is to spread the data and the query load evenly across nodes. If every
node takes a fair share, then—in theory—10 nodes should be able to handle 10 times as much
data and 10 times the read and write throughput of a single node (ignoring replication for now).</p>

<p><a data-type="indexterm" data-primary="skew" data-secondary="unbalanced workload" id="idm140417568317184"></a>
<a data-type="indexterm" data-primary="hot spots" id="idm140417568316080"></a>
If the partitioning is unfair, so that some partitions have more data or queries than others, we
call it <em>skewed</em>. The presence of skew makes partitioning much less effective. In an extreme case, all the load
could end up on one partition, so 9 out of 10 nodes are idle and your bottleneck is the
single busy node. A partition with disproportionately high load is called a <em>hot spot</em>.</p>

<p>The simplest approach for avoiding hot spots would be to assign records to nodes randomly. That would
distribute the data quite evenly across the nodes, but it has a big disadvantage: when you’re trying to
read a particular item, you have no way of knowing which node it is on, so you have to query
all nodes in parallel.</p>

<p>We can do better. Let’s assume for now that you have a simple key-value data model, in which you
always access a record by its primary key. For example, in an old-fashioned paper encyclopedia, you
look up an entry by its title; since all the entries are alphabetically sorted by title, you can
quickly find the one you’re looking for.</p>








<section data-type="sect2" data-pdf-bookmark="Partitioning by Key Range"><div class="sect2" id="sec_partitioning_key_range">
<h2>Partitioning by Key Range</h2>

<p><a data-type="indexterm" data-primary="partitioning" data-secondary="of key-value data" data-tertiary="by key range" id="idm140417568310624"></a>
<a data-type="indexterm" data-primary="key-value stores" data-secondary="partitioning" data-tertiary="by key range" id="idm140417568309248"></a>
One way of partitioning is to assign a continuous range of keys (from some minimum to some maximum)
to each partition, like the volumes of a paper encyclopedia (<a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#fig_partitioning_encyclopedia">Figure&nbsp;6-2</a>). If
you know the boundaries between the ranges, you can easily determine which partition contains a
given key. If you also know which partition is assigned to which node, then you can make your
request directly to the appropriate node (or, in the case of the encyclopedia, pick the correct book
off the shelf).</p>

<figure><div id="fig_partitioning_encyclopedia" class="figure">
<img src="https://www.safaribooksonline.com/library/view/designing-data-intensive-applications/9781491903063/assets/ddia_0602.png" alt="ddia 0602" width="2880" height="1023" data-mfp-src="/library/view/designing-data-intensive-applications/9781491903063/assets/ddia_0602.png">
<h6><span class="label">Figure 6-2. </span>A print encyclopedia is partitioned by key range.</h6>
</div></figure>

<p>The ranges of keys are not necessarily evenly spaced, because your data may not be evenly
distributed. For example, in <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#fig_partitioning_encyclopedia">Figure&nbsp;6-2</a>, volume 1 contains words starting with
A and B, but volume 12 contains words starting with T, U, V, W, X, Y, and Z. Simply having one volume
per two letters of the alphabet would lead to some volumes being much bigger than others. In order
to distribute the data evenly, the partition boundaries need to adapt to the data.</p>

<p><a data-type="indexterm" data-primary="Google" data-secondary="Bigtable (database)" data-tertiary="partitioning scheme" id="idm140417568302560"></a>
<a data-type="indexterm" data-primary="HBase (database)" data-secondary="key-range partitioning" id="idm140417568300992"></a>
<a data-type="indexterm" data-primary="MongoDB (database)" data-secondary="key-range partitioning" id="idm140417568299888"></a>
<a data-type="indexterm" data-primary="RethinkDB (database)" data-secondary="key-range partitioning" id="idm140417568298784"></a>
The partition boundaries might be chosen manually by an administrator, or the database can choose
them automatically (we will discuss choices of partition boundaries in more detail in <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#sec_partitioning_rebalancing">“Rebalancing Partitions”</a>).
This partitioning strategy is used by Bigtable, its open source equivalent HBase
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="George2009ti-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#George2009ti" class="totri-footnote">2</a>,
<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="HBase2014-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#HBase2014" class="totri-footnote">3</a>],
RethinkDB, and MongoDB before version 2.4 [<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="MongoDBInc2013uf-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#MongoDBInc2013uf" class="totri-footnote">4</a>].</p>

<p>Within each partition, we can keep keys in sorted order (see <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch03.html#sec_storage_lsm_trees">“SSTables and LSM-Trees”</a>). This has
the advantage that range scans are easy, and you can treat the key as a concatenated index in order
to fetch several related records in one query (see <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch03.html#sec_storage_index_multicolumn">“Multi-column indexes”</a>). For example,
consider an application that stores data from a network of sensors, where the key is the timestamp
of the measurement (<em>year-month-day-hour-minute-second</em>). Range scans are very useful in this case,
because they let you easily fetch, say, all the readings from a particular month.</p>

<p><a data-type="indexterm" data-primary="timestamps" data-secondary="key range partitioning by" id="idm140417568287104"></a>
<a data-type="indexterm" data-primary="skew" data-secondary="unbalanced workload" data-tertiary="for time-series data" id="idm140417568285936"></a>
<a data-type="indexterm" data-primary="hot spots" data-secondary="for time-series data" id="idm140417568284560"></a>
However, the downside of key range partitioning is that certain access patterns can lead to hot
spots. If the key is a timestamp, then the partitions correspond to ranges of time—e.g., one
partition per day. Unfortunately, because we write data from the sensors to the database as the
measurements happen, all the writes end up going to the same partition (the one for today), so that
partition can be overloaded with writes while others sit idle
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Lan2011tt-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Lan2011tt" class="totri-footnote">5</a>].</p>

<p>To avoid this problem in the sensor database, you need to use something other than the timestamp as
the first element of the key. For example, you could prefix each timestamp with the sensor name so
that the partitioning is first by sensor name and then by time. Assuming you have many sensors
active at the same time, the write load will end up more evenly spread across the partitions. Now,
when you want to fetch the values of multiple sensors within a time range, you need to perform a
separate range query for each sensor name.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Partitioning by Hash of Key"><div class="sect2" id="sec_partitioning_hash">
<h2>Partitioning by Hash of Key</h2>

<p><a data-type="indexterm" data-primary="key-value stores" data-secondary="partitioning" data-tertiary="by hash of key" id="idm140417568277712"></a>
<a data-type="indexterm" data-primary="hash partitioning" id="ix_hashpartition"></a>
Because of this risk of skew and hot spots, many distributed datastores use a hash function to
determine the partition for a given key.</p>

<p>A good hash function takes skewed data and makes it uniformly distributed. Say you have a 32-bit
hash function that takes a string. Whenever you give it a new string, it returns a seemingly random
number between 0 and 2<sup>32</sup>&nbsp;−&nbsp;1. Even if the input strings are very similar, their
hashes are evenly distributed across that range of numbers.</p>

<p><a data-type="indexterm" data-primary="Cassandra (database)" data-secondary="hash partitioning" id="ix_cassandrahash"></a>
<a data-type="indexterm" data-primary="Couchbase (database)" data-secondary="hash partitioning" id="ix_couchbasehash"></a>
<a data-type="indexterm" data-primary="MongoDB (database)" data-secondary="hash partitioning (sharding)" id="ix_mongohash"></a>
<a data-type="indexterm" data-primary="Riak (database)" data-secondary="hash partitioning" id="ix_riakhash"></a>
<a data-type="indexterm" data-primary="Voldemort (database)" data-secondary="hash partitioning" id="ix_voldemorthash"></a>
<a data-type="indexterm" data-primary="hash partitioning" data-secondary="suitable hash functions" id="idm140417568266544"></a>
For partitioning purposes, the hash function need not be cryptographically strong: for example,
MongoDB uses MD5, Cassandra uses Murmur3, and Voldemort uses the Fowler–Noll–Vo function. Many programming
languages have simple hash functions built in (as they are used for hash tables), but they may not
be suitable for partitioning: for example, in Java’s <code>Object.hashCode()</code> and Ruby’s <code>Object#hash</code>,
the same key may have a different hash value in different processes
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Kleppmann2012th-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Kleppmann2012th" class="totri-footnote">6</a>].</p>

<p>Once you have a suitable hash function for keys, you can assign each partition a range of hashes
(rather than a range of keys), and every key whose hash falls within a partition’s range will be
stored in that partition. This is illustrated in <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#fig_partitioning_hashing">Figure&nbsp;6-3</a>.</p>

<figure><div id="fig_partitioning_hashing" class="figure">
<img src="https://www.safaribooksonline.com/library/view/designing-data-intensive-applications/9781491903063/assets/ddia_0603.png" alt="ddia 0603" width="2880" height="901" data-mfp-src="/library/view/designing-data-intensive-applications/9781491903063/assets/ddia_0603.png">
<h6><span class="label">Figure 6-3. </span>Partitioning by hash of key.</h6>
</div></figure>

<p>This technique is good at distributing keys fairly among the partitions. The partition boundaries
can be evenly spaced, or they can be chosen pseudorandomly (in which case the technique is
sometimes known as <em>consistent hashing</em>).</p>
<aside data-type="sidebar" epub:type="sidebar"><div class="sidebar" id="sidebar_consistent_hashing">
<h5>Consistent Hashing</h5>
<p><a data-type="indexterm" data-primary="consistent hashing" id="idm140417568255856"></a>
<a data-type="indexterm" data-primary="hash partitioning" data-secondary="consistent hashing" id="idm140417568254832"></a>
Consistent hashing, as defined by Karger et al.
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Karger1997ko-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Karger1997ko" class="totri-footnote">7</a>],
is a way of evenly distributing load across an internet-wide system of caches such as a content
delivery network (CDN). It uses randomly chosen partition boundaries to avoid the need for central
control or distributed consensus. Note that <em>consistent</em> here has nothing to do with replica
consistency (see <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch05.html#ch_replication">Chapter&nbsp;5</a>) or ACID consistency (see <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch07.html#ch_transactions">Chapter&nbsp;7</a>), but rather
describes a particular approach to rebalancing.</p>

<p>As we shall see in <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#sec_partitioning_rebalancing">“Rebalancing Partitions”</a>,
this particular approach actually doesn’t work very well for databases
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Lamping2014-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Lamping2014" class="totri-footnote">8</a>],
so it is rarely used in practice (the documentation of some databases still refers to consistent
hashing, but it is often inaccurate). Because this is so confusing, it’s best to avoid the term
<em>consistent hashing</em> and just call it <em>hash partitioning</em> instead.</p>
</div></aside>

<p><a data-type="indexterm" data-primary="hash partitioning" data-secondary="range queries" id="idm140417568243232"></a>
Unfortunately however, by using the hash of the key for partitioning we lose a nice property of
key-range partitioning: the ability to do efficient range queries. Keys that were once adjacent are
now scattered across all the partitions, so their sort order is lost. In MongoDB, if you have
enabled hash-based sharding mode, any range query has to be sent to all partitions
[<a data-type="noteref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#MongoDBInc2013uf" class="totri-footnote">4</a>]. Range queries on the primary key are
not supported by Riak [<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Redmond2013ws-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Redmond2013ws" class="totri-footnote">9</a>], Couchbase
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="CouchbaseAdmin-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#CouchbaseAdmin">10</a>], or Voldemort.
<a data-type="indexterm" data-primary="Couchbase (database)" data-secondary="hash partitioning" data-startref="ix_couchbasehash" id="idm140417568237184"></a>
<a data-type="indexterm" data-primary="MongoDB (database)" data-secondary="hash partitioning (sharding)" data-startref="ix_mongohash" id="idm140417568235840"></a>
<a data-type="indexterm" data-primary="Riak (database)" data-secondary="hash partitioning" data-startref="ix_riakhash" id="idm140417568234400"></a>
<a data-type="indexterm" data-primary="Voldemort (database)" data-secondary="hash partitioning" data-startref="ix_voldemorthash" id="idm140417568233024"></a></p>

<p><a data-type="indexterm" data-primary="Cassandra (database)" data-secondary="compound primary key" id="idm140417568231648"></a>
<a data-type="indexterm" data-primary="primary keys" data-secondary="compound primary key (Cassandra)" id="idm140417568230320"></a>
<a data-type="indexterm" data-primary="concatenated indexes" data-secondary="in Cassandra" id="idm140417568229248"></a>
<a data-type="indexterm" data-primary="SSTables (storage format)" data-secondary="concatenated index" id="idm140417568228144"></a>
Cassandra achieves a compromise between the two partitioning strategies
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Lakshman2009tz-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Lakshman2009tz">11</a>,
<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Ellis2013vb-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Ellis2013vb">12</a>,
<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Cassandra2014vj-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Cassandra2014vj">13</a>].
A table in Cassandra can be declared with a <em>compound primary key</em> consisting of several columns.
Only the first part of that key is hashed to determine the partition, but the other columns are used
as a concatenated index for sorting the data in Cassandra’s SSTables. A query therefore cannot
search for a range of values within the first column of a compound key, but if it specifies a fixed
value for the first column, it can perform an efficient range scan over the other columns of the
key.
<a data-type="indexterm" data-primary="Cassandra (database)" data-secondary="hash partitioning" data-startref="ix_cassandrahash" id="idm140417568219872"></a></p>

<p>The concatenated index approach enables an elegant data model for one-to-many relationships. For
example, on a social media site, one user may post many updates. If the primary key for updates is
chosen to be <code>(user_id, update_timestamp)</code>, then you can efficiently retrieve all updates made by a
particular user within some time interval, sorted by timestamp. Different users may be stored on
different partitions, but within each user, the updates are stored ordered by timestamp on a single
partition.
<a data-type="indexterm" data-primary="hash partitioning" data-startref="ix_hashpartition" id="idm140417568217472"></a></p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Skewed Workloads and Relieving Hot Spots"><div class="sect2" id="sec_partitioning_skew">
<h2>Skewed Workloads and Relieving Hot Spots</h2>

<p><a data-type="indexterm" data-primary="hot spots" data-secondary="relieving" id="idm140417568214880"></a>
<a data-type="indexterm" data-primary="key-value stores" data-secondary="partitioning" data-tertiary="skew and hot spots" id="idm140417568213776"></a>
<a data-type="indexterm" data-primary="partitioning" data-secondary="of key-value data" data-tertiary="skew and hot spots" id="idm140417568212400"></a>
<a data-type="indexterm" data-primary="skew" data-secondary="unbalanced workload" data-tertiary="compensating for" id="idm140417568211024"></a>
As discussed, hashing a key to determine its partition can help reduce hot spots. However, it can’t
avoid them entirely: in the extreme case where all reads and writes are for the same key, you still
end up with all requests being routed to the same partition.</p>

<p><a data-type="indexterm" data-primary="hot spots" data-secondary="due to celebrities" id="idm140417568209120"></a>
<a data-type="indexterm" data-primary="skew" data-secondary="unbalanced workload" data-tertiary="due to celebrities" id="idm140417568208016"></a>
This kind of workload is perhaps unusual, but not unheard of: for example, on a social media site, a
celebrity user with millions of followers may cause a storm of activity when they do something
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Axon2010te-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Axon2010te">14</a>].
This event can result in a large volume of writes to the same key (where the key is perhaps the user ID of
the celebrity, or the ID of the action that people are commenting on). Hashing the key doesn’t
help, as the hash of two identical IDs is still the same.</p>

<p>Today, most data systems are not able to automatically compensate for such a highly skewed workload,
so it’s the responsibility of the application to reduce the skew. For example, if one key is known
to be very hot, a simple technique is to add a random number to the beginning or end of the key.
Just a two-digit decimal random number would split the writes to the key evenly across 100 different
keys, allowing those keys to be distributed to different partitions.</p>

<p>However, having split the writes across different keys, any reads now have to do additional work, as
they have to read the data from all 100 keys and combine it. This technique also requires additional
bookkeeping: it only makes sense to append the random number for the small number of hot keys; for
the vast majority of keys with low write throughput this would be unnecessary overhead. Thus, you
also need some way of keeping track of which keys are being split.</p>

<p>Perhaps in the future, data systems will be able to automatically detect and compensate for skewed
workloads; but for now, you need to think through the trade-offs for your own application.
<a data-type="indexterm" data-primary="key-value stores" data-secondary="partitioning" data-startref="ix_keyvalpart" id="idm140417568201472"></a>
<a data-type="indexterm" data-primary="partitioning" data-secondary="of key-value data" data-startref="ix_partitionkeyval" id="idm140417568200096"></a></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Partitioning and Secondary Indexes"><div class="sect1" id="sec_partitioning_secondary_indexes">
<h1>Partitioning and Secondary Indexes</h1>

<p><a data-type="indexterm" data-primary="indexes" data-secondary="partitioning and secondary indexes" id="ix_indexpartsec"></a>
<a data-type="indexterm" data-primary="secondary indexes" data-secondary="partitioning" id="ix_secindparti"></a>
<a data-type="indexterm" data-primary="partitioning" data-secondary="secondary indexes" id="ix_partitionsecind"></a>
The partitioning schemes we have discussed so far rely on a key-value data model. If records are
only ever accessed via their primary key, we can determine the partition from that key and use it
to route read and write requests to the partition responsible for that key.</p>

<p>The situation becomes more complicated if secondary indexes are involved (see also
<a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch03.html#sec_storage_other_indexing">“Other Indexing Structures”</a>). A secondary index usually doesn’t identify a record uniquely but
rather is a way of searching for occurrences of a particular value: find all actions by user
<code>123</code>, find all articles containing the word <code>hogwash</code>, find all cars whose color is <code>red</code>, and so
on.</p>

<p><a data-type="indexterm" data-primary="searches" data-secondary="partitioned secondary indexes" id="idm140417568189760"></a>
Secondary indexes are the bread and butter of relational databases, and they are common in document
databases too. Many key-value stores (such as HBase and Voldemort) have avoided secondary indexes
because of their added implementation complexity, but some (such as Riak) have started adding them
because they are so useful for data modeling. And finally, secondary indexes are the <em>raison d’être</em>
of search servers such as Solr and Elasticsearch.</p>

<p>The problem with secondary indexes is that they don’t map neatly to partitions. There are two main
approaches to partitioning a database with secondary indexes: document-based partitioning
and term-based partitioning.</p>








<section data-type="sect2" data-pdf-bookmark="Partitioning Secondary Indexes by Document"><div class="sect2" id="idm140417568186960">
<h2>Partitioning Secondary Indexes by Document</h2>

<p><a data-type="indexterm" data-primary="secondary indexes" data-secondary="partitioning" data-tertiary="document-partitioned" id="idm140417568185552"></a>
<a data-type="indexterm" data-primary="partitioning" data-secondary="secondary indexes" data-tertiary="document-based partitioning" id="idm140417568183984"></a>
<a data-type="indexterm" data-primary="document-partitioned indexes" id="idm140417568182640"></a>
<a data-type="indexterm" data-primary="local indexes" data-see="document-partitioned indexes" id="idm140417568181840"></a>
For example, imagine you are operating a website for selling used cars (illustrated in
<a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#fig_partitioning_secondary_by_doc">Figure&nbsp;6-4</a>). Each listing has a unique ID—call it the <em>document ID</em>—and
you partition the database by the document ID (for example, IDs 0 to 499 in partition 0, IDs 500 to 999
in partition 1, etc.).</p>

<p>You want to let users search for cars, allowing them to filter by color and by make, so you need
a secondary index on <code>color</code> and <code>make</code> (in a document database these would be fields; in a
relational database they would be columns). If you have declared the index, the database can perform
the indexing automatically.<sup xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook"><a data-type="noteref" id="idm140417568177728-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#idm140417568177728">ii</a></sup>
For example, whenever a red car is added to the database, the database partition automatically adds
it to the list of document IDs for the index entry <code>color:red</code>.</p>

<figure><div id="fig_partitioning_secondary_by_doc" class="figure">
<img src="https://www.safaribooksonline.com/library/view/designing-data-intensive-applications/9781491903063/assets/ddia_0604.png" alt="ddia 0604" width="2880" height="1365" data-mfp-src="/library/view/designing-data-intensive-applications/9781491903063/assets/ddia_0604.png">
<h6><span class="label">Figure 6-4. </span>Partitioning secondary indexes by document.</h6>
</div></figure>

<p>In this indexing approach, each partition is completely separate: each partition maintains its own
secondary indexes, covering only the documents in that partition. It doesn’t care what data is
stored in other partitions. Whenever you need to write to the database—to add, remove, or update a
document—you only need to deal with the partition that contains the document ID that you are
writing. For that reason, a document-partitioned index is also known as a <em>local index</em> (as opposed
to a <em>global index</em>, described in the next section).</p>

<p>However, reading from a document-partitioned index requires care: unless you have done something
special with the document IDs, there is no reason why all the cars with a particular color or a
particular make would be in the same partition. In <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#fig_partitioning_secondary_by_doc">Figure&nbsp;6-4</a>, red cars
appear in both partition 0 and partition 1. Thus, if you want to search for red cars, you need to
send the query to <em>all</em> partitions, and combine all the results you get back.</p>

<p><a data-type="indexterm" data-primary="scatter/gather approach, querying partitioned databases" id="idm140417568168656"></a>
<a data-type="indexterm" data-primary="latency" data-secondary="tail latency" id="idm140417568167392"></a>
<a data-type="indexterm" data-primary="amplification" data-secondary="of tail latency" id="idm140417568166288"></a>
<a data-type="indexterm" data-primary="MongoDB (database)" data-secondary="secondary indexes" id="idm140417568165184"></a>
<a data-type="indexterm" data-primary="Riak (database)" data-secondary="secondary indexes" id="idm140417568164080"></a>
<a data-type="indexterm" data-primary="Cassandra (database)" data-secondary="secondary indexes" id="idm140417568162976"></a>
<a data-type="indexterm" data-primary="VoltDB (database)" data-secondary="secondary indexes" id="idm140417568161872"></a>
<a data-type="indexterm" data-primary="Elasticsearch (search server)" data-secondary="document-partitioned indexes" id="idm140417568160768"></a>
<a data-type="indexterm" data-primary="Solr (search server)" data-secondary="document-partitioned indexes" id="idm140417568159632"></a>
This approach to querying a partitioned database is sometimes known as <em>scatter/gather</em>, and it can
make read queries on secondary indexes quite expensive. Even if you query the partitions in
parallel, scatter/gather is prone to tail latency amplification (see <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch01.html#sidebar_percentiles">“Percentiles in Practice”</a>).
Nevertheless, it is widely used: MongoDB,
Riak [<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Riak2014-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Riak2014">15</a>],
Cassandra [<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Low2013ud-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Low2013ud">16</a>],
Elasticsearch [<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Tong2013vh-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Tong2013vh">17</a>], SolrCloud
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Solr2014-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Solr2014">18</a>],
and VoltDB [<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Pavlo2013ug-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Pavlo2013ug">19</a>]
all use document-partitioned secondary indexes. Most database vendors recommend that you structure
your partitioning scheme so that secondary index queries can be served from a single partition, but
that is not always possible, especially when you’re using multiple secondary indexes in a single
query (such as filtering cars by color and by make at the same time).</p>

<figure><div id="fig_partitioning_secondary_by_term" class="figure">
<img src="https://www.safaribooksonline.com/library/view/designing-data-intensive-applications/9781491903063/assets/ddia_0605.png" alt="ddia 0605" width="2880" height="1223" data-mfp-src="/library/view/designing-data-intensive-applications/9781491903063/assets/ddia_0605.png">
<h6><span class="label">Figure 6-5. </span>Partitioning secondary indexes by term.</h6>
</div></figure>
</div></section>













<section data-type="sect2" data-pdf-bookmark="Partitioning Secondary Indexes by Term"><div class="sect2" id="idm140417568144736">
<h2>Partitioning Secondary Indexes by Term</h2>

<p><a data-type="indexterm" data-primary="secondary indexes" data-secondary="partitioning" data-tertiary="term-partitioned" id="idm140417568143328"></a>
<a data-type="indexterm" data-primary="partitioning" data-secondary="secondary indexes" data-tertiary="term-based partitioning" id="idm140417568141792"></a>
<a data-type="indexterm" data-primary="term-partitioned indexes" id="idm140417568140416"></a>
<a data-type="indexterm" data-primary="global indexes" data-see="term-partitioned indexes" id="idm140417568139568"></a>
Rather than each partition having its own secondary index (a <em>local index</em>), we can construct a
<em>global index</em> that covers data in all partitions. However, we can’t just store that index on one
node, since it would likely become a bottleneck and defeat the purpose of partitioning. A global
index must also be partitioned, but it can be partitioned differently from the primary key index.</p>

<p><a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#fig_partitioning_secondary_by_term">Figure&nbsp;6-5</a> illustrates what this could look like: red cars from all
partitions appear under <code>color:red</code> in the index, but the index is partitioned so that colors
starting with the letters <em>a</em> to <em>r</em> appear in partition 0 and colors starting with <em>s</em> to <em>z</em> appear
in partition 1. The index on the make of car is partitioned similarly (with the partition boundary
being between <em>f</em> and <em>h</em>).</p>

<p>We call this kind of index <em>term-partitioned</em>, because the term we’re looking for determines the partition
of the index. Here, a term would be <code>color:red</code>, for example. The name <em>term</em> comes from full-text
indexes (a particular kind of secondary index), where the terms are all the words that occur in a
document.</p>

<p>As before, we can partition the index by the term itself, or using a hash of the term. Partitioning
by the term itself can be useful for range scans (e.g., on a numeric property, such as the asking
price of the car), whereas partitioning on a hash of the term gives a more even distribution of
load.</p>

<p>The advantage of a global (term-partitioned) index over a document-partitioned index is that it can
make reads more efficient: rather than doing scatter/gather over all partitions, a client only needs
to make a request to the partition containing the term that it wants. However, the downside of a
global index is that writes are slower and more complicated, because a write to a single
document may now affect multiple partitions of the index (every term in the document might be on a
different partition, on a different node).</p>

<p>In an ideal world, the index would always be up to date, and every document written to the database
would immediately be reflected in the index. However, in a term-partitioned index, that would
require a distributed transaction across all partitions affected by a write, which is not supported
in all databases (see <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch07.html#ch_transactions">Chapter&nbsp;7</a> and <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch09.html#ch_consistency">Chapter&nbsp;9</a>).</p>

<p>In practice, updates to global secondary indexes are often asynchronous (that is, if you read the
index shortly after a write, the change you just made may not yet be reflected in the index). For
example, Amazon DynamoDB states that its global secondary indexes are updated within a fraction of a
second in normal circumstances, but may experience longer propagation delays in cases of faults in
the infrastructure
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="DynamoDB2014-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#DynamoDB2014">20</a>].</p>

<p><a data-type="indexterm" data-primary="Riak (database)" data-secondary="search feature" id="idm140417568123824"></a>
<a data-type="indexterm" data-primary="Oracle (database)" data-secondary="partitioned indexes" id="idm140417568122496"></a>
Other uses of global term-partitioned indexes include Riak’s search feature
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Klophaus2011tt-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Klophaus2011tt">21</a>]
and the Oracle data warehouse, which lets you choose between local and global indexing
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Burleson2000wb-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Burleson2000wb">22</a>].
We will return to the topic of implementing term-partitioned secondary indexes in <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch12.html#ch_future">Chapter&nbsp;12</a>.
<a data-type="indexterm" data-primary="indexes" data-secondary="partitioning and secondary indexes" data-startref="ix_indexpartsec" id="idm140417568115632"></a>
<a data-type="indexterm" data-primary="secondary indexes" data-secondary="partitioning" data-startref="ix_secindparti" id="idm140417568114192"></a>
<a data-type="indexterm" data-primary="partitioning" data-secondary="secondary indexes" data-startref="ix_partitionsecind" id="idm140417568112816"></a></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Rebalancing Partitions"><div class="sect1" id="sec_partitioning_rebalancing">
<h1>Rebalancing Partitions</h1>

<p><a data-type="indexterm" data-primary="partitioning" data-secondary="rebalancing partitions" id="ix_partitionrebal"></a>
<a data-type="indexterm" data-primary="rebalancing partitions" data-seealso="partitioning" id="ix_rebalpart"></a>
Over time, things change in a database:</p>

<ul>
<li>
<p>The query throughput increases, so you want to add more CPUs to handle the load.</p>
</li>
<li>
<p>The dataset size increases, so you want to add more disks and RAM to store it.</p>
</li>
<li>
<p>A machine fails, and other machines need to take over the failed machine’s responsibilities.</p>
</li>
</ul>

<p>All of these changes call for data and requests to be moved from one node to another. The process of
moving load from one node in the cluster to another is called <em>rebalancing</em>.</p>

<p>No matter which partitioning scheme is used, rebalancing is usually expected to meet some minimum
requirements:</p>

<ul>
<li>
<p>After rebalancing, the load (data storage, read and write requests) should be shared fairly
between the nodes in the cluster.</p>
</li>
<li>
<p>While rebalancing is happening, the database should continue accepting reads and writes.</p>
</li>
<li>
<p>No more data than necessary should be moved between nodes, to make rebalancing fast and to
minimize the network and disk I/O load.</p>
</li>
</ul>








<section data-type="sect2" data-pdf-bookmark="Strategies for Rebalancing"><div class="sect2" id="idm140417568098512">
<h2>Strategies for Rebalancing</h2>

<p>There are a few different ways of assigning partitions to nodes
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="RethinkingTopology2012th-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#RethinkingTopology2012th">23</a>].
Let’s briefly discuss each in turn.</p>










<section data-type="sect3" data-pdf-bookmark="How not to do it: hash mod N"><div class="sect3" id="idm140417568094640">
<h3>How not to do it: hash mod N</h3>

<p><a data-type="indexterm" data-primary="partitioning" data-secondary="rebalancing partitions" data-tertiary="problems with hash mod N" id="idm140417568093184"></a>
<a data-type="indexterm" data-primary="rebalancing partitions" data-secondary="problems with hash mod N" id="idm140417568091344"></a>
<a data-type="indexterm" data-primary="hash partitioning" data-secondary="problems with hash mod N" id="idm140417568090224"></a>
When partitioning by the hash of a key, we said earlier (<a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#fig_partitioning_hashing">Figure&nbsp;6-3</a>) that
it’s best to divide the possible hashes into ranges and assign each range to a partition (e.g.,
assign <em>key</em> to partition 0 if 0&nbsp;≤&nbsp;<em>hash</em>(<em>key</em>)&nbsp;&lt;&nbsp;<em>b</em><sub>0</sub>, to
partition 1 if <em>b</em><sub>0</sub>&nbsp;≤&nbsp;<em>hash</em>(<em>key</em>)&nbsp;&lt;&nbsp;<em>b</em><sub>1</sub>, etc.).</p>

<p><a data-type="indexterm" data-primary="modulus operator (%)" id="idm140417568083728"></a>
Perhaps you wondered why we don’t just use <em>mod</em> (the <code>%</code> operator in many programming languages).
For example, <em>hash</em>(<em>key</em>) <em>mod</em> 10 would return a number between 0 and 9 (if we write the hash
as a decimal number, the hash <em>mod</em> 10 would be the last digit). If we have 10 nodes, numbered 0 to
9, that seems like an easy way of assigning each key to a node.</p>

<p>The problem with the <em>mod N</em> approach is that if the number of nodes <em>N</em> changes, most of the keys
will need to be moved from one node to another. For example, say <em>hash</em>(<em>key</em>) = 123456.  If you
initially have 10 nodes, that key starts out on node 6
(because 123456&nbsp;<em>mod</em>&nbsp;10&nbsp;=&nbsp;6). When you grow to 11 nodes, the key needs to
move to node 3 (123456&nbsp;<em>mod</em>&nbsp;11&nbsp;=&nbsp;3), and when you grow to 12 nodes, it needs
to move to node 0 (123456&nbsp;<em>mod</em>&nbsp;12&nbsp;=&nbsp;0). Such frequent moves make rebalancing
excessively expensive.</p>

<p>We need an approach that doesn’t move data around more than necessary.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Fixed number of partitions"><div class="sect3" id="idm140417568075664">
<h3>Fixed number of partitions</h3>

<p><a data-type="indexterm" data-primary="partitioning" data-secondary="rebalancing partitions" data-tertiary="using fixed number of partitions" id="idm140417568074160"></a>
<a data-type="indexterm" data-primary="rebalancing partitions" data-secondary="fixed number of partitions" id="idm140417568072816"></a>
<a data-type="indexterm" data-primary="hash partitioning" data-secondary="with fixed number of partitions" id="idm140417568071696"></a>
Fortunately, there is a fairly simple solution: create many more partitions than there are nodes,
and assign several partitions to each node. For example, a database running on a cluster of 10 nodes
may be split into 1,000 partitions from the outset so that approximately 100 partitions are
assigned to each node.</p>

<p>Now, if a node is added to the cluster, the new node can <em>steal</em> a few partitions from every
existing node until partitions are fairly distributed once again. This process is illustrated in
<a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#fig_partitioning_rebalance_fixed">Figure&nbsp;6-6</a>. If a node is removed from the cluster, the same happens in
reverse.</p>

<p>Only entire partitions are moved between nodes. The number of partitions does not change, nor does
the assignment of keys to partitions. The only thing that changes is the assignment of
partitions to nodes. This change of assignment is not immediate—it takes some time to transfer a
large amount of data over the network—so the old assignment of partitions is used for any reads
and writes that happen while the transfer is in progress.</p>

<figure><div id="fig_partitioning_rebalance_fixed" class="figure">
<img src="https://www.safaribooksonline.com/library/view/designing-data-intensive-applications/9781491903063/assets/ddia_0606.png" alt="ddia 0606" width="2880" height="1557" data-mfp-src="/library/view/designing-data-intensive-applications/9781491903063/assets/ddia_0606.png">
<h6><span class="label">Figure 6-6. </span>Adding a new node to a database cluster with multiple partitions per node.</h6>
</div></figure>

<p>In principle, you can even account for mismatched hardware in your cluster: by assigning more
partitions to nodes that are more powerful, you can force those nodes to take a greater share of the
load.</p>

<p><a data-type="indexterm" data-primary="Couchbase (database)" data-secondary="hash partitioning" id="idm140417568064512"></a>
<a data-type="indexterm" data-primary="Riak (database)" data-secondary="hash partitioning" id="idm140417568063248"></a>
<a data-type="indexterm" data-primary="Voldemort (database)" data-secondary="hash partitioning" id="idm140417568062144"></a>
<a data-type="indexterm" data-primary="Elasticsearch (search server)" data-secondary="partition rebalancing" id="idm140417568061040"></a>
This approach to rebalancing is used in Riak [<a data-type="noteref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Riak2014">15</a>],
Elasticsearch [<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Kuc2013uc-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Kuc2013uc">24</a>],
Couchbase [<a data-type="noteref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#CouchbaseAdmin">10</a>], and Voldemort
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Voldemort2014-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Voldemort2014">25</a>].</p>

<p>In this configuration, the number of partitions is usually fixed when the database is first set up
and not changed afterward. Although in principle it’s possible to split and merge partitions (see the
next section), a fixed number of partitions is operationally simpler, and so many fixed-partition
databases choose not to implement partition splitting. Thus, the number of partitions configured at
the outset is the maximum number of nodes you can have, so you need to choose it high enough to
accommodate future growth. However, each partition also has management overhead, so it’s
counterproductive to choose too high a number.</p>

<p>Choosing the right number of partitions is difficult if the total size of the dataset is highly
variable (for example, if it starts small but may grow much larger over time). Since each partition
contains a fixed fraction of the total data, the size of each partition grows proportionally to the
total amount of data in the cluster. If partitions are very large, rebalancing and recovery from
node failures become expensive. But if partitions are too small, they incur too much overhead. The
best performance is achieved when the size of partitions is “just right,” neither too big nor too
small, which can be hard to achieve if the number of partitions is fixed but the dataset size
varies.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Dynamic partitioning"><div class="sect3" id="idm140417568051536">
<h3>Dynamic partitioning</h3>

<p><a data-type="indexterm" data-primary="partitioning" data-secondary="rebalancing partitions" data-tertiary="using dynamic partitioning" id="idm140417568050096"></a>
<a data-type="indexterm" data-primary="dynamic partitioning" id="idm140417568048752"></a>
<a data-type="indexterm" data-primary="rebalancing partitions" data-secondary="dynamic partitioning" id="idm140417568047920"></a>
<a data-type="indexterm" data-primary="key-value stores" data-secondary="partitioning" data-tertiary="dynamic partitioning" id="idm140417568046816"></a>
For databases that use key range partitioning (see <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#sec_partitioning_key_range">“Partitioning by Key Range”</a>), a fixed number
of partitions with fixed boundaries would be very inconvenient: if you got the boundaries wrong, you
could end up with all of the data in one partition and all of the other partitions empty.
Reconfiguring the partition boundaries manually would be very tedious.</p>

<p><a data-type="indexterm" data-primary="HBase (database)" data-secondary="dynamic partitioning" id="idm140417568044080"></a>
<a data-type="indexterm" data-primary="RethinkDB (database)" data-secondary="dynamic partitioning" id="idm140417568042976"></a>
For that reason, key range–partitioned databases such as HBase and RethinkDB create partitions
dynamically. When a partition grows to exceed a configured size (on HBase, the default is
10&nbsp;GB), it is split into two partitions so that approximately half of the data ends up on each
side of the split [<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Soztutar2013wv-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Soztutar2013wv">26</a>].
Conversely, if lots of data is deleted and a partition shrinks below some threshold, it can be
merged with an adjacent partition.
<a data-type="indexterm" data-primary="B-trees (indexes)" data-secondary="similarity to dynamic partitioning" id="idm140417568039200"></a>
This process is similar to what happens at the top level of a B-tree (see <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch03.html#sec_storage_b_trees">“B-Trees”</a>).</p>

<p><a data-type="indexterm" data-primary="HDFS (Hadoop Distributed File System)" data-secondary="use by HBase" id="idm140417568036992"></a>
Each partition is assigned to one node, and each node can handle multiple partitions, like in the
case of a fixed number of partitions. After a large partition has been split, one of its two halves
can be transferred to another node in order to balance the load. In the case of HBase, the transfer
of partition files happens through HDFS, the underlying distributed filesystem
[<a data-type="noteref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#HBase2014" class="totri-footnote">3</a>].</p>

<p>An advantage of dynamic partitioning is that the number of partitions adapts to the total data
volume. If there is only a small amount of data, a small number of partitions is sufficient, so
overheads are small; if there is a huge amount of data, the size of each individual partition is
limited to a configurable maximum
[<a data-type="noteref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#RethinkingTopology2012th">23</a>].</p>

<p><a data-type="indexterm" data-primary="MongoDB (database)" data-secondary="partition splitting" id="idm140417568032784"></a>
<a data-type="indexterm" data-primary="pre-splitting" id="idm140417568031456"></a>
However, a caveat is that an empty database starts off with a single partition, since there is no <em>a
priori</em> information about where to draw the partition boundaries. While the dataset is small—until
it hits the point at which the first partition is split—all writes have to be processed by a single
node while the other nodes sit idle. To mitigate this issue, HBase and MongoDB allow an initial set
of partitions to be configured on an empty database (this is called <em>pre-splitting</em>). In the case of
key-range partitioning, pre-splitting requires that you already know what the key distribution is
going to look like [<a data-type="noteref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#MongoDBInc2013uf" class="totri-footnote">4</a>,
<a data-type="noteref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Soztutar2013wv">26</a>].</p>

<p>Dynamic partitioning is not only suitable for key range–partitioned data, but can equally well be
used with hash-partitioned data. MongoDB since version 2.4 supports both key-range and hash
partitioning, and it splits partitions dynamically in either case.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Partitioning proportionally to nodes"><div class="sect3" id="idm140417568026816">
<h3>Partitioning proportionally to nodes</h3>

<p><a data-type="indexterm" data-primary="rebalancing partitions" data-secondary="fixed number of partitions per node" id="idm140417568025408"></a>
<a data-type="indexterm" data-primary="partitioning" data-secondary="rebalancing partitions" data-tertiary="using N partitions per node" id="idm140417568024336"></a>
With dynamic partitioning, the number of partitions is proportional to the size of the dataset,
since the splitting and merging processes keep the size of each partition between some fixed minimum
and maximum. On the other hand, with a fixed number of partitions, the size of each partition is
proportional to the size of the dataset. In both of these cases, the number of partitions is
independent of the number of nodes.</p>

<p><a data-type="indexterm" data-primary="Cassandra (database)" data-secondary="partitioning scheme" id="idm140417568022304"></a>
<a data-type="indexterm" data-primary="Ketama (partitioning library)" id="idm140417568021040"></a>
A third option, used by Cassandra and Ketama, is to make the number of partitions proportional to
the number of nodes—in other words, to have a fixed number of partitions <em>per node</em>
[<a data-type="noteref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#RethinkingTopology2012th">23</a>,
<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Williams2012wz-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Williams2012wz">27</a>,
<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Jones2007bl-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Jones2007bl">28</a>].
In this case, the size of each partition grows proportionally to the dataset size while the number
of nodes remains unchanged, but when you increase the number of nodes, the partitions become smaller
again. Since a larger data volume generally requires a larger number of nodes to store, this
approach also keeps the size of each partition fairly stable.</p>

<p>When a new node joins the cluster, it randomly chooses a fixed number of existing partitions to
split, and then takes ownership of one half of each of those split partitions while leaving the
other half of each partition in place. The randomization can produce unfair splits, but when
averaged over a larger number of partitions (in Cassandra, 256 partitions per node by default), the
new node ends up taking a fair share of the load from the existing nodes. Cassandra 3.0 introduced
an alternative rebalancing algorithm that avoids unfair splits
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Lambov2016wj-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Lambov2016wj">29</a>].</p>

<p>Picking partition boundaries randomly requires that hash-based partitioning is used (so the
boundaries can be picked from the range of numbers produced by the hash function). Indeed, this
approach corresponds most closely to the original definition of consistent hashing
[<a data-type="noteref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Karger1997ko" class="totri-footnote">7</a>] (see <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#sidebar_consistent_hashing">“Consistent Hashing”</a>).
Newer hash functions can achieve a similar effect with lower metadata overhead
[<a data-type="noteref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Lamping2014" class="totri-footnote">8</a>].</p>
</div></section>



</div></section>













<section data-type="sect2" data-pdf-bookmark="Operations: Automatic or Manual Rebalancing"><div class="sect2" id="idm140417568007504">
<h2>Operations: Automatic or Manual Rebalancing</h2>

<p><a data-type="indexterm" data-primary="rebalancing partitions" data-secondary="automatic or manual rebalancing" id="idm140417568006096"></a>
<a data-type="indexterm" data-primary="partitioning" data-secondary="rebalancing partitions" data-tertiary="automatic or manual rebalancing" id="idm140417568005024"></a>
There is one important question with regard to rebalancing that we have glossed over: does the
rebalancing happen automatically or manually?</p>

<p><a data-type="indexterm" data-primary="Couchbase (database)" data-secondary="rebalancing" id="idm140417568003264"></a>
<a data-type="indexterm" data-primary="Riak (database)" data-secondary="rebalancing" id="idm140417568002160"></a>
<a data-type="indexterm" data-primary="Voldemort (database)" data-secondary="rebalancing" id="idm140417568001056"></a>
There is a gradient between fully automatic rebalancing (the system decides automatically when to
move partitions from one node to another, without any administrator interaction) and fully manual
(the assignment of partitions to nodes is explicitly configured by an administrator, and only
changes when the administrator explicitly reconfigures it). For example, Couchbase, Riak, and
Voldemort generate a suggested partition assignment automatically, but require an administrator to
commit it before it takes effect.</p>

<p>Fully automated rebalancing can be convenient, because there is less operational work to do for
normal maintenance. However, it can be unpredictable. Rebalancing is an expensive operation, because
it requires rerouting requests and moving a large amount of data from one node to another. If it is
not done carefully, this process can overload the network or the nodes and harm the performance of
other requests while the rebalancing is in progress.</p>

<p><a data-type="indexterm" data-primary="cascading failures" id="idm140417567998288"></a>
<a data-type="indexterm" data-primary="failures" data-secondary="failure detection" data-tertiary="automatic rebalancing causing cascading failures" id="idm140417567997456"></a>
Such automation can be dangerous in combination with automatic failure detection. For example, say
one node is overloaded and is temporarily slow to respond to requests. The other nodes conclude that
the overloaded node is dead, and automatically rebalance the cluster to move load away from it. This
puts additional load on the overloaded node, other nodes, and the network—making the situation worse
and potentially causing a cascading failure.</p>

<p>For that reason, it can be a good thing to have a human in the loop for rebalancing. It’s slower
than a fully automatic process, but it can help prevent operational <span class="keep-together">surprises.</span><a data-type="indexterm" data-primary="rebalancing partitions" data-startref="ix_rebalpart" id="idm140417567994400"></a>
<a data-type="indexterm" data-primary="partitioning" data-secondary="rebalancing partitions" data-startref="ix_partitionrebal" id="idm140417567993296"></a></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Request Routing"><div class="sect1" id="sec_partitioning_routing">
<h1>Request Routing</h1>

<p><a data-type="indexterm" data-primary="routing" data-see="request routing" id="idm140417567990048"></a>
<a data-type="indexterm" data-primary="request routing" id="ix_reqroute"></a>
<a data-type="indexterm" data-primary="partitioning" data-secondary="request routing" id="ix_partitionreq"></a>
We have now partitioned our dataset across multiple nodes running on multiple machines. But there
remains an open question: when a client wants to make a request, how does it know which node to
connect to? As partitions are rebalanced, the assignment of partitions to nodes changes. Somebody
needs to stay on top of those changes in order to answer the question: if I want to read or write
the key “foo”, which IP address and port number do I need to connect to?</p>

<p><a data-type="indexterm" data-primary="service discovery" id="idm140417567985728"></a>
This is an instance of a more general problem called <em>service discovery</em>, which isn’t limited to
just databases. Any piece of software that is accessible over a network has this problem, especially
if it is aiming for high availability (running in a redundant configuration on multiple machines).
Many companies have written their own in-house service discovery tools, and many of these have been
released as open source [<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Wilder2014tw-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Wilder2014tw">30</a>].</p>

<p><a data-type="indexterm" data-primary="request routing" data-secondary="approaches to" id="idm140417567981584"></a>
On a high level, there are a few different approaches to this problem (illustrated in
<a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#fig_partitioning_routing">Figure&nbsp;6-7</a>):</p>
<ol>
<li>
<p>Allow clients to contact any node (e.g., via a round-robin load balancer). If that node
coincidentally owns the partition to which the request applies, it can handle the request
directly; otherwise, it forwards the request to the appropriate node, receives the reply, and
passes the reply along to the client.</p>
</li>
<li>
<p>Send all requests from clients to a routing tier first, which determines the node that should
handle each request and forwards it accordingly. This routing tier does not itself handle any
requests; it only acts as a partition-aware load balancer.</p>
</li>
<li>
<p>Require that clients be aware of the partitioning and the assignment of partitions to
nodes.<a data-type="indexterm" data-primary="clients" data-secondary="request routing" id="idm140417567976096"></a> In this case, a client can connect directly to the
appropriate node, without any intermediary.</p>
</li>

</ol>

<p>In all cases, the key problem is: how does the component making the routing decision (which may be
one of the nodes, or the routing tier, or the client) learn about changes in the assignment of
partitions to nodes?</p>

<figure><div id="fig_partitioning_routing" class="figure">
<img src="https://www.safaribooksonline.com/library/view/designing-data-intensive-applications/9781491903063/assets/ddia_0607.png" alt="ddia 0607" width="2880" height="1281" data-mfp-src="/library/view/designing-data-intensive-applications/9781491903063/assets/ddia_0607.png">
<h6><span class="label">Figure 6-7. </span>Three different ways of routing a request to the right node.</h6>
</div></figure>

<p>This is a challenging problem, because it is important that all participants agree—otherwise
requests would be sent to the wrong nodes and not handled correctly. There are protocols for
achieving consensus in a distributed system, but they are hard to implement correctly (see
<a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch09.html#ch_consistency">Chapter&nbsp;9</a>).</p>

<p><a data-type="indexterm" data-primary="ZooKeeper (coordination service)" data-secondary="use for partition assignment" id="idm140417567970128"></a>
<a data-type="indexterm" data-primary="Apache ZooKeeper" data-see="ZooKeeper" id="idm140417567968992"></a>
Many distributed data systems rely on a separate coordination service such as ZooKeeper to keep
track of this cluster metadata, as illustrated in <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#fig_partitioning_zookeeper">Figure&nbsp;6-8</a>. Each node registers
itself in ZooKeeper, and ZooKeeper maintains the authoritative mapping of partitions to nodes. Other
actors, such as the routing tier or the partitioning-aware client, can subscribe to this information
in ZooKeeper. Whenever a partition changes ownership, or a node is added or removed, ZooKeeper
notifies the routing tier so that it can keep its routing information up to date.</p>

<figure><div id="fig_partitioning_zookeeper" class="figure">
<img src="https://www.safaribooksonline.com/library/view/designing-data-intensive-applications/9781491903063/assets/ddia_0608.png" alt="ddia 0608" width="2880" height="1260" data-mfp-src="/library/view/designing-data-intensive-applications/9781491903063/assets/ddia_0608.png">
<h6><span class="label">Figure 6-8. </span>Using ZooKeeper to keep track of assignment of partitions to nodes.</h6>
</div></figure>

<p><a data-type="indexterm" data-primary="HBase (database)" data-secondary="request routing" id="idm140417567964256"></a>
<a data-type="indexterm" data-primary="Solr (search server)" data-secondary="request routing" id="idm140417567962752"></a>
<a data-type="indexterm" data-primary="Kafka (messaging)" data-secondary="request routing" id="idm140417567961568"></a>
<a data-type="indexterm" data-primary="MongoDB (database)" data-secondary="request routing" id="idm140417567960464"></a>
<a data-type="indexterm" data-primary="Helix (cluster manager)" id="idm140417567959360"></a><a data-type="indexterm" data-primary="Apache Helix" data-see="Helix" id="idm140417567958656"></a>
<a data-type="indexterm" data-primary="LinkedIn" data-secondary="Espresso (database)" id="idm140417567957584"></a>
<a data-type="indexterm" data-primary="LinkedIn" data-secondary="Helix (cluster manager)" data-see="Helix" id="idm140417567956480"></a>
For example, LinkedIn’s Espresso uses Helix
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Gopalakrishna2012fa-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Gopalakrishna2012fa">31</a>]
for cluster management (which in turn relies on ZooKeeper), implementing a routing tier as shown in
<a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#fig_partitioning_zookeeper">Figure&nbsp;6-8</a>. HBase, SolrCloud, and Kafka also use ZooKeeper to track partition
assignment. MongoDB has a similar architecture, but it relies on its own <em>config server</em>
implementation and <em>mongos</em> daemons as the routing tier.</p>

<p><a data-type="indexterm" data-primary="Cassandra (database)" data-secondary="gossip protocol" id="idm140417567950400"></a>
<a data-type="indexterm" data-primary="Riak (database)" data-secondary="gossip protocol" id="idm140417567949296"></a>
<a data-type="indexterm" data-primary="gossip protocol" id="idm140417567948192"></a>
Cassandra and Riak take a different approach: they use a <em>gossip protocol</em> among the nodes to
disseminate any changes in cluster state. Requests can be sent to any node, and that node forwards
them to the appropriate node for the requested partition (approach 1 in
<a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#fig_partitioning_routing">Figure&nbsp;6-7</a>). This model puts more complexity in the database nodes but avoids the
dependency on an external coordination service such as ZooKeeper.</p>

<p><a data-type="indexterm" data-primary="Couchbase (database)" data-secondary="request routing" id="idm140417567945424"></a>
Couchbase does not rebalance automatically, which simplifies the design. Normally it is configured
with a routing tier called <em>moxi</em>, which learns about routing changes from the cluster nodes
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="MoxiManual-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#MoxiManual">32</a>].</p>

<p><a data-type="indexterm" data-primary="service discovery" data-secondary="using DNS" id="idm140417567941712"></a>
<a data-type="indexterm" data-primary="DNS (Domain Name System)" id="idm140417567940608"></a>
When using a routing tier or when sending requests to a random node, clients still need to find the
IP addresses to connect to. These are not as fast-changing as the assignment of partitions to nodes,
so it is often sufficient to use DNS for this purpose.</p>








<section data-type="sect2" data-pdf-bookmark="Parallel Query Execution"><div class="sect2" id="idm140417567939312">
<h2>Parallel Query Execution</h2>

<p><a data-type="indexterm" data-primary="parallel execution" data-secondary="queries in MPP databases" id="idm140417567938176"></a>
<a data-type="indexterm" data-primary="request routing" data-secondary="parallel query execution" id="idm140417567937008"></a>
So far we have focused on very simple queries that read or write a single key (plus scatter/gather
queries in the case of document-partitioned secondary indexes). This is about the level of access
supported by most NoSQL distributed datastores.</p>

<p><a data-type="indexterm" data-primary="massively parallel processing (MPP)" id="idm140417567935376"></a>
However, <em>massively parallel processing</em> (MPP) relational database products, often used for
analytics, are much more sophisticated in the types of queries they support. A typical data
warehouse query contains several join, filtering, grouping, and aggregation operations. The MPP
query optimizer breaks this complex query into a number of execution stages and partitions, many of
which can be executed in parallel on different nodes of the database cluster. Queries that involve
scanning over large parts of the dataset particularly benefit from such parallel execution.</p>

<p>Fast parallel execution of data warehouse queries is a specialized topic, and given the business
importance of analytics, it receives a lot of commercial interest. We will discuss some techniques for
parallel query execution in <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch10.html#ch_batch">Chapter&nbsp;10</a>. For a more detailed overview of techniques used in
parallel databases, please see the references
[<a data-type="noteref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#DeWitt1992fn_ch6" class="totri-footnote">1</a>,
<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Babu2013gm_ch6-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Babu2013gm_ch6">33</a>].
<a data-type="indexterm" data-primary="request routing" data-startref="ix_reqroute" id="idm140417567928224"></a>
<a data-type="indexterm" data-primary="partitioning" data-secondary="request routing" data-startref="ix_partitionreq" id="idm140417567927120"></a></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Summary"><div class="sect1" id="idm140417567991328">
<h1>Summary</h1>

<p>In this chapter we explored different ways of partitioning a large dataset into smaller subsets.
Partitioning is necessary when you have so much data that storing and processing it on a single
machine is no longer feasible.</p>

<p>The goal of partitioning is to spread the data and query load evenly across multiple machines,
avoiding hot spots (nodes with disproportionately high load). This requires choosing a partitioning
scheme that is appropriate to your data, and rebalancing the partitions when nodes are added to or
removed from the cluster.</p>

<p>We discussed two main approaches to partitioning:</p>

<ul>
<li>
<p><a data-type="indexterm" data-primary="key-value stores" data-secondary="partitioning" data-tertiary="by key range" id="idm140417567921712"></a>
<em>Key range partitioning</em>, where keys are sorted, and a partition owns all the keys from some
minimum up to some maximum. Sorting has the advantage that efficient range queries are possible,
but there is a risk of hot spots if the application often accesses keys that are close together in
the sorted order.</p>

<p>In this approach, partitions are typically rebalanced dynamically by splitting the range into two
subranges when a partition gets too big.</p>
</li>
<li>
<p><a data-type="indexterm" data-primary="hash partitioning" id="idm140417567918304"></a>
<a data-type="indexterm" data-primary="key-value stores" data-secondary="partitioning" data-tertiary="by hash of key" id="idm140417567917472"></a>
<em>Hash partitioning</em>, where a hash function is applied to each key, and a partition owns a range of
hashes. This method destroys the ordering of keys, making range queries inefficient, but may distribute
load more evenly.</p>

<p>When partitioning by hash, it is common to create a fixed number of partitions in advance, to assign
several partitions to each node, and to move entire partitions from one node to another when nodes
are added or removed. Dynamic partitioning can also be used.</p>
</li>
</ul>

<p>Hybrid approaches are also possible, for example with a compound key: using one part of the key to
identify the partition and another part for the sort order.</p>

<p><a data-type="indexterm" data-primary="indexes" data-secondary="partitioning and secondary indexes" id="idm140417567913632"></a>
<a data-type="indexterm" data-primary="secondary indexes" data-secondary="partitioning" id="idm140417567912512"></a>
We also discussed the interaction between partitioning and secondary indexes. A secondary index also
needs to be partitioned, and there are two methods:</p>

<ul>
<li>
<p><a data-type="indexterm" data-primary="document-partitioned indexes" id="idm140417567910336"></a> <em>Document-partitioned indexes</em> (local indexes), where the
secondary indexes are stored in the same partition as the primary key and value. This means that
only a single partition needs to be updated on write, but a read of the secondary index requires a
scatter/gather across all partitions.</p>
</li>
<li>
<p><a data-type="indexterm" data-primary="term-partitioned indexes" id="idm140417567908096"></a> <em>Term-partitioned indexes</em> (global indexes), where the secondary
indexes are partitioned separately, using the indexed values. An entry in the secondary index may
include records from all partitions of the primary key. When a document is written, several
partitions of the secondary index need to be updated; however, a read can be served from a single
partition.</p>
</li>
</ul>

<p>Finally, we discussed techniques for routing queries to the appropriate partition, which range from
simple partition-aware load balancing to sophisticated parallel query execution engines.</p>

<p>By design, every partition operates mostly independently—that’s what allows a partitioned
database to scale to multiple machines. However, operations that need to write to several partitions
can be difficult to reason about: for example, what happens if the write to one partition succeeds,
but another fails? We will address that question in the following chapters.
<a data-type="indexterm" data-primary="partitioning" data-startref="ix_partition" id="idm140417567904784"></a></p>
</div></section>







<div data-type="footnotes"><h5>Footnotes</h5><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="idm140417568355104"><sup><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#idm140417568355104-marker" class="totri-footnote">i</a></sup> Partitioning, as discussed in this
chapter, is a way of intentionally breaking a large database down into smaller ones. It has nothing
to do with <em>network partitions</em> (netsplits), a type of fault in the network between nodes. We
will discuss such faults in <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch08.html#ch_distributed">Chapter&nbsp;8</a>.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="idm140417568177728"><sup><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#idm140417568177728-marker">ii</a></sup> If your database
only supports a key-value model, you might be tempted to implement a secondary index yourself by
creating a mapping from values to document IDs in application code. If you go down this route, you need to
take great care to ensure your indexes remain consistent with the underlying data. Race conditions
and intermittent write failures (where some changes were saved but others weren’t) can very easily
cause the data to go out of sync—see <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch07.html#sec_transactions_need">“The need for multi-object transactions”</a>.</p></div><div data-type="footnotes"><h5>References</h5><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="DeWitt1992fn_ch6">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#DeWitt1992fn_ch6-marker" class="totri-footnote">1</a>] David J. DeWitt and Jim N. Gray:
“<a href="http://www.cs.cmu.edu/~pavlo/courses/fall2013/static/papers/dewittgray92.pdf">Parallel
Database Systems: The Future of High Performance Database Systems</a>,”
<em>Communications of the ACM</em>, volume 35, number 6, pages 85–98, June 1992.
<a href="http://dx.doi.org/10.1145/129888.129894">doi:10.1145/129888.129894</a></p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="George2009ti">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#George2009ti-marker" class="totri-footnote">2</a>] Lars George:
“<a href="http://www.larsgeorge.com/2009/11/hbase-vs-bigtable-comparison.html">HBase vs. BigTable Comparison</a>,”
<em>larsgeorge.com</em>, November 2009.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="HBase2014">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#HBase2014-marker" class="totri-footnote">3</a>] “<a href="https://hbase.apache.org/book/book.html">The
Apache HBase Reference Guide</a>,” Apache Software Foundation, <em>hbase.apache.org</em>, 2014.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="MongoDBInc2013uf">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#MongoDBInc2013uf-marker" class="totri-footnote">4</a>] MongoDB, Inc.:
“<a href="http://blog.mongodb.org/post/47633823714/new-hash-based-sharding-feature-in-mongodb-24">New
Hash-Based Sharding Feature in MongoDB 2.4</a>,” <em>blog.mongodb.org</em>, April 10, 2013.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Lan2011tt">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Lan2011tt-marker" class="totri-footnote">5</a>] Ikai Lan:
“<a href="http://ikaisays.com/2011/01/25/app-engine-datastore-tip-monotonically-increasing-values-are-bad/">App
Engine Datastore Tip: Monotonically Increasing Values Are Bad</a>,” <em>ikaisays.com</em>,
January 25, 2011.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Kleppmann2012th">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Kleppmann2012th-marker" class="totri-footnote">6</a>] Martin Kleppmann:
“<a href="http://martin.kleppmann.com/2012/06/18/java-hashcode-unsafe-for-distributed-systems.html">Java’s
hashCode Is Not Safe for Distributed Systems</a>,” <em>martin.kleppmann.com</em>, June 18, 2012.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Karger1997ko">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Karger1997ko-marker" class="totri-footnote">7</a>] David Karger, Eric Lehman, Tom Leighton, et al.:
“<a href="http://www.akamai.com/dl/technical_publications/ConsistenHashingandRandomTreesDistributedCachingprotocolsforrelievingHotSpotsontheworldwideweb.pdf">Consistent
Hashing and Random Trees: Distributed Caching Protocols for Relieving Hot Spots on the World Wide Web</a>,”
at <em>29th Annual ACM Symposium on Theory of Computing</em> (STOC), pages 654–663, 1997.
<a href="http://dx.doi.org/10.1145/258533.258660">doi:10.1145/258533.258660</a></p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Lamping2014">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Lamping2014-marker" class="totri-footnote">8</a>] John Lamping and Eric Veach:
“<a href="http://arxiv.org/pdf/1406.2294v1.pdf">A Fast, Minimal Memory, Consistent Hash
Algorithm</a>,” <em>arxiv.org</em>, June 2014.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Redmond2013ws">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Redmond2013ws-marker" class="totri-footnote">9</a>] Eric Redmond:
“<a href="http://littleriakbook.com/">A Little Riak Book</a>,” Version 1.4.0,
Basho Technologies, September 2013.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="CouchbaseAdmin">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#CouchbaseAdmin-marker">10</a>] “<a href="http://docs.couchbase.com/couchbase-manual-2.5/cb-admin/">Couchbase
2.5 Administrator Guide</a>,” Couchbase, Inc., 2014.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Lakshman2009tz">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Lakshman2009tz-marker">11</a>] Avinash Lakshman and Prashant Malik:
“<a href="http://www.cs.cornell.edu/Projects/ladis2009/papers/Lakshman-ladis2009.PDF">Cassandra –
A Decentralized Structured Storage System</a>,” at <em>3rd ACM SIGOPS International Workshop on
Large Scale Distributed Systems and Middleware</em> (LADIS), October 2009.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Ellis2013vb">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Ellis2013vb-marker">12</a>] Jonathan Ellis:
“<a href="http://www.datastax.com/documentation/articles/cassandra/cassandrathenandnow.html">Facebook’s
Cassandra Paper, Annotated and Compared to Apache Cassandra 2.0</a>,”
<em>datastax.com</em>, September 12, 2013.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Cassandra2014vj">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Cassandra2014vj-marker">13</a>] “<a href="http://www.datastax.com/documentation/cql/3.1/cql/cql_intro_c.html">Introduction
to Cassandra Query Language</a>,” DataStax, Inc., 2014.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Axon2010te">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Axon2010te-marker">14</a>] Samuel Axon:
“<a href="http://mashable.com/2010/09/07/justin-bieber-twitter/">3% of Twitter’s Servers
Dedicated to Justin Bieber</a>,” <em>mashable.com</em>, September 7, 2010.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Riak2014">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Riak2014-marker">15</a>] “<a href="http://docs.basho.com/riak/1.4.8/">Riak 1.4.8
Docs</a>,” Basho Technologies, Inc., 2014.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Low2013ud">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Low2013ud-marker">16</a>] Richard Low:
“<a href="http://www.wentnet.com/blog/?p=77">The Sweet Spot for Cassandra Secondary
Indexing</a>,” <em>wentnet.com</em>, October 21, 2013.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Tong2013vh">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Tong2013vh-marker">17</a>] Zachary Tong:
“<a href="http://www.elasticsearch.org/blog/customizing-your-document-routing/">Customizing Your
Document Routing</a>,” <em>elasticsearch.org</em>, June 3, 2013.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Solr2014">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Solr2014-marker">18</a>] “<a href="https://cwiki.apache.org/confluence/display/solr/Apache+Solr+Reference+Guide">Apache
Solr Reference Guide</a>,” Apache Software Foundation, 2014.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Pavlo2013ug">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Pavlo2013ug-marker">19</a>] Andrew Pavlo:
“<a href="http://hstore.cs.brown.edu/documentation/faq/">H-Store Frequently Asked Questions</a>,”
<em>hstore.cs.brown.edu</em>, October 2013.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="DynamoDB2014">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#DynamoDB2014-marker">20</a>] “<a href="http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/">Amazon
DynamoDB Developer Guide</a>,” Amazon Web Services, Inc., 2014.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Klophaus2011tt">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Klophaus2011tt-marker">21</a>] Rusty Klophaus:
“<a href="http://lists.basho.com/pipermail/riak-users_lists.basho.com/2011-October/006220.html">Difference
Between 2I and Search</a>,” email to <em>riak-users</em> mailing list, <em>lists.basho.com</em>, October 25, 2011.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Burleson2000wb">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Burleson2000wb-marker">22</a>] Donald K. Burleson:
“<a href="http://www.dba-oracle.com/art_partit.htm">Object Partitioning in Oracle</a>,”
<em>dba-oracle.com</em>, November 8, 2000.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="RethinkingTopology2012th">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#RethinkingTopology2012th-marker">23</a>] Eric Evans:
“<a href="http://www.slideshare.net/jericevans/virtual-nodes-rethinking-topology-in-cassandra">Rethinking
Topology in Cassandra</a>,” at <em>ApacheCon Europe</em>, November 2012.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Kuc2013uc">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Kuc2013uc-marker">24</a>] Rafał Kuć:
“<a href="http://elasticsearchserverbook.com/reroute-api-explained/">Reroute API Explained</a>,”
<em>elasticsearchserverbook.com</em>, September 30, 2013.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Voldemort2014">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Voldemort2014-marker">25</a>] “<a href="http://www.project-voldemort.com/voldemort/">Project
Voldemort Documentation</a>,” <em>project-voldemort.com</em>.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Soztutar2013wv">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Soztutar2013wv-marker">26</a>] Enis Soztutar:
“<a href="http://hortonworks.com/blog/apache-hbase-region-splitting-and-merging/">Apache HBase
Region Splitting and Merging</a>,” <em>hortonworks.com</em>, February 1, 2013.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Williams2012wz">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Williams2012wz-marker">27</a>] Brandon Williams:
“<a href="http://www.datastax.com/dev/blog/virtual-nodes-in-cassandra-1-2">Virtual Nodes in
Cassandra 1.2</a>,” <em>datastax.com</em>, December 4, 2012.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Jones2007bl">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Jones2007bl-marker">28</a>] Richard Jones:
“<a href="https://www.metabrew.com/article/libketama-consistent-hashing-algo-memcached-clients">libketama:
Consistent Hashing Library for Memcached Clients</a>,” <em>metabrew.com</em>, April 10, 2007.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Lambov2016wj">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Lambov2016wj-marker">29</a>] Branimir Lambov:
“<a href="http://www.datastax.com/dev/blog/token-allocation-algorithm">New Token Allocation
Algorithm in Cassandra 3.0</a>,” <em>datastax.com</em>, January 28, 2016.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Wilder2014tw">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Wilder2014tw-marker">30</a>] Jason Wilder:
“<a href="http://jasonwilder.com/blog/2014/02/04/service-discovery-in-the-cloud/">Open-Source
Service Discovery</a>,” <em>jasonwilder.com</em>, February 2014.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Gopalakrishna2012fa">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Gopalakrishna2012fa-marker">31</a>] Kishore Gopalakrishna, Shi Lu, Zhen Zhang, et al.:
“<a href="http://www.socc2012.org/helix_onecol.pdf?attredirects=0">Untangling Cluster Management
with Helix</a>,” at <em>ACM Symposium on Cloud Computing</em> (SoCC), October 2012.
<a href="http://dx.doi.org/10.1145/2391229.2391248">doi:10.1145/2391229.2391248</a></p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="MoxiManual">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#MoxiManual-marker">32</a>] “<a href="http://docs.couchbase.com/moxi-manual-1.8/">Moxi
1.8 Manual</a>,” Couchbase, Inc., 2014.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Babu2013gm_ch6">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#Babu2013gm_ch6-marker">33</a>] Shivnath Babu and Herodotos Herodotou:
“<a href="http://research.microsoft.com/pubs/206464/db-mr-survey-final.pdf">Massively Parallel
Databases and MapReduce Systems</a>,” <em>Foundations and Trends in Databases</em>,
volume 5, number 1, pages 1–104, November 2013.
<a href="http://dx.doi.org/10.1561/1900000036">doi:10.1561/1900000036</a></p></div></div></section><div class="annotator-outer annotator-viewer viewer annotator-hide">
  <ul class="annotator-widget annotator-listing"></ul>
</div><div class="annotator-modal-wrapper annotator-editor-modal annotator-editor annotator-hide">
	<div class="annotator-outer editor">
		<h2 class="title">Highlight</h2>
		<form class="annotator-widget">
			<ul class="annotator-listing">
			<li class="annotator-item"><textarea id="annotator-field-0" placeholder="Add a note using markdown (optional)" class="js-editor" maxlength="750"></textarea></li></ul>
			<div class="annotator-controls">
				<a class="link-to-markdown" href="https://daringfireball.net/projects/markdown/basics" target="_blank">?</a>
				<ul>
					<li class="delete annotator-hide"><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#delete" class="annotator-delete-note button positive">Delete Note</a></li>
					<li class="save"><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#save" class="annotator-save annotator-focus button positive">Save Note</a></li>
					<li class="cancel"><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#cancel" class="annotator-cancel button">Cancel</a></li>
				</ul>
			</div>
		</form>
	</div>
</div><div class="annotator-modal-wrapper annotator-delete-confirm-modal" style="display: none;">
  <div class="annotator-outer">
    <h2 class="title">Highlight</h2>
      <a class="js-close-delete-confirm annotator-cancel close" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#close">Close</a>
      <div class="annotator-widget">
         <div class="delete-confirm">
            Are you sure you want to permanently delete this note?
         </div>
         <div class="annotator-controls">
            <a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#cancel" class="annotator-cancel button js-cancel-delete-confirm">No, I changed my mind</a>
            <a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#delete" class="annotator-delete button positive js-delete-confirm">Yes, delete it</a>
         </div>
       </div>
   </div>
</div><div class="annotator-adder" style="display: none;">
	<ul class="adders ">
		
		<li class="copy"><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#">Copy</a></li>
		
		<li class="add-highlight"><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#">Add Highlight</a></li>
		<li class="add-note"><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#">
			
				Add Note
			
		</a></li>
		
	</ul>
</div></div></div>



  <div class="t-sbo-prev sbo-prev sbo-nav-bottom">
  
    
      
        <a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch05.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">5. Replication</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-bottom">
  
    
      
        <a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch07.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">7. Transactions</div>
        </a>
    
  
  </div>


        
    </section>
  </div>
<section class="sbo-saved-archives"></section>



          
          
  




    
    
      <div id="js-subscribe-nag" class="subscribe-nag clearfix trial-panel t-subscribe-nag collapsed slideUp">
        
        
          
          
            <p class="usage-data">Find answers on the fly, or master something new. Subscribe today. <a href="https://www.safaribooksonline.com/subscribe/" class="ga-active-trial-subscribe-nag">See pricing options.</a></p>
          

          
        
        

      </div>

    
    



        
      </div>
      




  <footer class="pagefoot t-pagefoot" style="padding-bottom: 69px;">
    <a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#" class="icon-up"><div class="visuallyhidden">Back to top</div></a>
    <ul class="js-footer-nav">
      
        <li><a class="t-recommendations-footer" href="https://www.safaribooksonline.com/r/">Recommended</a></li>
      
      <li>
      <a class="t-queue-footer" href="https://www.safaribooksonline.com/playlists/">Playlists</a>
      </li>
      
        <li><a class="t-recent-footer" href="https://www.safaribooksonline.com/history/">History</a></li>
        <li><a class="t-topics-footer" href="https://www.safaribooksonline.com/topics?q=*&amp;limit=21">Topics</a></li>
      
      
        <li><a class="t-tutorials-footer" href="https://www.safaribooksonline.com/tutorials/">Tutorials</a></li>
      
      <li><a class="t-settings-footer js-settings" href="https://www.safaribooksonline.com/u/preferences/">Settings</a></li>
      <li class="full-support"><a href="https://www.oreilly.com/online-learning/support/">Support</a></li>
      <li><a href="https://www.safaribooksonline.com/apps/">Get the App</a></li>
      <li><a href="https://www.safaribooksonline.com/accounts/logout/">Sign Out</a></li>
    </ul>
    <span class="copyright">© 2018 <a href="https://www.safaribooksonline.com/" target="_blank">Safari</a>.</span>
    <a href="https://www.safaribooksonline.com/terms/">Terms of Service</a> /
    <a href="https://www.safaribooksonline.com/privacy/">Privacy Policy</a>
  </footer>




    
    
      <img src="https://www.oreilly.com/library/view/oreilly_set_cookie/" alt="" style="display:none;">
    
    
    
  

<div class="annotator-notice"></div><div class="font-flyout" style="top: 151.006px; left: 1356px;"><div class="font-controls-panel">
	<div class="nightmodes">
		<ul>
			<li class="day"><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#" id="day-mode" title="Day Mode">
				<i class="fa fa-sun-o"></i>
				<span>Day Mode</span></a></li>
			<li class="cloudy"><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#" id="cloudy-mode" title="Cloudy Mode">
				<i class="fa fa-cloud"></i>
				<span>Cloud Mode</span>
			</a></li>
			<li class="night"><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#" id="night-mode" title="Night Mode">
				<i class="fa fa-moon-o"></i>
				<span>Night Mode</span>
			</a></li>
		</ul>
	</div>

	<div class="font-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-font left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-font-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-font right"></i>
		</div>
	</div>

	<div class="column-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-compress left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-column-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-expand right"></i>
		</div>
	</div>

	<a id="reset" class="button" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#">Reset</a>
</div>
</div></body></html>