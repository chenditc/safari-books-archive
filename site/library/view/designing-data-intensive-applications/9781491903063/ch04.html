<!--[if IE]><![endif]--><!DOCTYPE html><!--[if IE 8]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

    
        itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/"
data-offline-url="/"
data-url="/library/view/designing-data-intensive-applications/9781491903063/ch04.html"
data-csrf-cookie="csrfsafari"
data-highlight-privacy=""


  data-user-id="3905629"
  data-user-uuid="f04af719-1c84-4fc3-9be3-1f1b4622ab99"
  data-username="safaribooksonline122"
  data-account-type="Trial"
  
  data-activated-trial-date="12/09/2018"


  data-archive="9781491903063"
  data-publishers="O&#39;Reilly Media, Inc."



  data-htmlfile-name="ch04.html"
  data-epub-title="Designing Data-Intensive Applications" data-debug=0 data-testing=0><![endif]--><!--[if gt IE 8]><!--><html class="js flexbox flexboxlegacy no-touch websqldatabase indexeddb history csscolumns csstransforms localstorage sessionstorage applicationcache svg inlinesvg zoom gr__safaribooksonline_com" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#" itemscope="" itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/" data-offline-url="/" data-url="/library/view/designing-data-intensive-applications/9781491903063/ch04.html" data-csrf-cookie="csrfsafari" data-highlight-privacy="" data-user-id="3905629" data-user-uuid="f04af719-1c84-4fc3-9be3-1f1b4622ab99" data-username="safaribooksonline122" data-account-type="Trial" data-activated-trial-date="12/09/2018" data-archive="9781491903063" data-publishers="O'Reilly Media, Inc." data-htmlfile-name="ch04.html" data-epub-title="Designing Data-Intensive Applications" data-debug="0" data-testing="0" style=""><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="Safari Books Online"><meta name="format-detection" content="telephone=no"><meta http-equiv="cleartype" content="on"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="apple-itunes-app" content="app-id=881697395, app-argument=safaridetail://9781491903063"><meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0"><meta property="twitter:account_id" content="4503599627559754"><link rel="apple-touch-icon" href="https://www.safaribooksonline.com/static/images/apple-touch-icon.0c29511d2d72.png"><link rel="shortcut icon" href="https://www.safaribooksonline.com/favicon.ico" type="image/x-icon"><link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700,900,200italic,300italic,400italic,600italic,700italic,900italic" rel="stylesheet" type="text/css"><title>4. Encoding and Evolution - Designing Data-Intensive Applications</title><link rel="stylesheet" href="https://www.safaribooksonline.com/static/CACHE/css/5e586a47a3b7.css" type="text/css"><link rel="stylesheet" type="text/css" href="https://www.safaribooksonline.com/static/css/annotator.e3b0c44298fc.css"><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css"><style type="text/css" title="ibis-book">
    @charset "utf-8";#sbo-rt-content html,#sbo-rt-content div,#sbo-rt-content div,#sbo-rt-content span,#sbo-rt-content applet,#sbo-rt-content object,#sbo-rt-content iframe,#sbo-rt-content h1,#sbo-rt-content h2,#sbo-rt-content h3,#sbo-rt-content h4,#sbo-rt-content h5,#sbo-rt-content h6,#sbo-rt-content p,#sbo-rt-content blockquote,#sbo-rt-content pre,#sbo-rt-content a,#sbo-rt-content abbr,#sbo-rt-content acronym,#sbo-rt-content address,#sbo-rt-content big,#sbo-rt-content cite,#sbo-rt-content code,#sbo-rt-content del,#sbo-rt-content dfn,#sbo-rt-content em,#sbo-rt-content img,#sbo-rt-content ins,#sbo-rt-content kbd,#sbo-rt-content q,#sbo-rt-content s,#sbo-rt-content samp,#sbo-rt-content small,#sbo-rt-content strike,#sbo-rt-content strong,#sbo-rt-content sub,#sbo-rt-content sup,#sbo-rt-content tt,#sbo-rt-content var,#sbo-rt-content b,#sbo-rt-content u,#sbo-rt-content i,#sbo-rt-content center,#sbo-rt-content dl,#sbo-rt-content dt,#sbo-rt-content dd,#sbo-rt-content ol,#sbo-rt-content ul,#sbo-rt-content li,#sbo-rt-content fieldset,#sbo-rt-content form,#sbo-rt-content label,#sbo-rt-content legend,#sbo-rt-content table,#sbo-rt-content caption,#sbo-rt-content tdiv,#sbo-rt-content tfoot,#sbo-rt-content thead,#sbo-rt-content tr,#sbo-rt-content th,#sbo-rt-content td,#sbo-rt-content article,#sbo-rt-content aside,#sbo-rt-content canvas,#sbo-rt-content details,#sbo-rt-content embed,#sbo-rt-content figure,#sbo-rt-content figcaption,#sbo-rt-content footer,#sbo-rt-content header,#sbo-rt-content hgroup,#sbo-rt-content menu,#sbo-rt-content nav,#sbo-rt-content output,#sbo-rt-content ruby,#sbo-rt-content section,#sbo-rt-content summary,#sbo-rt-content time,#sbo-rt-content mark,#sbo-rt-content audio,#sbo-rt-content video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}#sbo-rt-content article,#sbo-rt-content aside,#sbo-rt-content details,#sbo-rt-content figcaption,#sbo-rt-content figure,#sbo-rt-content footer,#sbo-rt-content header,#sbo-rt-content hgroup,#sbo-rt-content menu,#sbo-rt-content nav,#sbo-rt-content section{display:block}#sbo-rt-content div{line-height:1}#sbo-rt-content ol,#sbo-rt-content ul{list-style:none}#sbo-rt-content blockquote,#sbo-rt-content q{quotes:none}#sbo-rt-content blockquote:before,#sbo-rt-content blockquote:after,#sbo-rt-content q:before,#sbo-rt-content q:after{content:none}#sbo-rt-content table{border-collapse:collapse;border-spacing:0}@page{margin:5px !important}#sbo-rt-content p{margin:10px 0 0;line-height:125%;text-align:left}#sbo-rt-content p.byline{text-align:left;margin:-33px auto 35px;font-style:italic;font-weight:bold}#sbo-rt-content div.preface p+p.byline{margin:1em 0 0 !important}#sbo-rt-content div.preface p.byline+p.byline{margin:0 !important}#sbo-rt-content div.sect1>p.byline{margin:-.25em 0 1em}#sbo-rt-content div.sect1>p.byline+p.byline{margin-top:-1em}#sbo-rt-content em{font-style:italic;font-family:inherit}#sbo-rt-content em strong,#sbo-rt-content strong em{font-weight:bold;font-style:italic;font-family:inherit}#sbo-rt-content strong,#sbo-rt-content span.bold{font-weight:bold}#sbo-rt-content em.replaceable{font-style:italic}#sbo-rt-content strong.userinput{font-weight:bold;font-style:normal}#sbo-rt-content span.bolditalic{font-weight:bold;font-style:italic}#sbo-rt-content a.ulink,#sbo-rt-content a.xref,#sbo-rt-content a.email,#sbo-rt-content a.link,#sbo-rt-content a{text-decoration:none;color:#8e0012}#sbo-rt-content span.lineannotation{font-style:italic;color:#a62a2a;font-family:serif}#sbo-rt-content span.underline{text-decoration:underline}#sbo-rt-content span.strikethrough{text-decoration:line-through}#sbo-rt-content span.smallcaps{font-variant:small-caps}#sbo-rt-content span.cursor{background:#000;color:#fff}#sbo-rt-content span.smaller{font-size:75%}#sbo-rt-content .boxedtext,#sbo-rt-content .keycap{border-style:solid;border-width:1px;border-color:#000;padding:1px}#sbo-rt-content span.gray50{color:#7F7F7F;}#sbo-rt-content h1,#sbo-rt-content div.toc-title,#sbo-rt-content h2,#sbo-rt-content h3,#sbo-rt-content h4,#sbo-rt-content h5{-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;font-weight:bold;text-align:left;page-break-after:avoid !important;font-family:sans-serif,"DejaVuSans"}#sbo-rt-content div.toc-title{font-size:1.5em;margin-top:20px !important;margin-bottom:30px !important}#sbo-rt-content section[data-type="sect1"] h1{font-size:1.3em;color:#8e0012;margin:40px 0 8px 0}#sbo-rt-content section[data-type="sect2"] h2{font-size:1.1em;margin:30px 0 8px 0 !important}#sbo-rt-content section[data-type="sect3"] h3{font-size:1em;color:#555;margin:20px 0 8px 0 !important}#sbo-rt-content section[data-type="sect4"] h4{font-size:1em;font-weight:normal;font-style:italic;margin:15px 0 6px 0 !important}#sbo-rt-content section[data-type="chapter"]>div>h1,#sbo-rt-content section[data-type="preface"]>div>h1,#sbo-rt-content section[data-type="appendix"]>div>h1,#sbo-rt-content section[data-type="glossary"]>div>h1,#sbo-rt-content section[data-type="bibliography"]>div>h1,#sbo-rt-content section[data-type="index"]>div>h1{font-size:2em;line-height:1;margin-bottom:50px;color:#000;padding-bottom:10px;border-bottom:1px solid #000}#sbo-rt-content span.label,#sbo-rt-content span.keep-together{font-size:inherit;font-weight:inherit}#sbo-rt-content div[data-type="part"] h1{font-size:2em;text-align:center;margin-top:0 !important;margin-bottom:50px;padding:50px 0 10px 0;border-bottom:1px solid #000}#sbo-rt-content img.width-ninety{width:90%}#sbo-rt-content img{max-width:95%;margin:0 auto;padding:0}#sbo-rt-content div.figure{background-color:transparent;text-align:center !important;margin:15px 0 15px 0 !important;page-break-inside:avoid}#sbo-rt-content figure{margin:15px 0 15px 0 !important;page-break-inside:avoid}#sbo-rt-content div.figure h6,#sbo-rt-content figure h6,#sbo-rt-content figure figcaption{font-size:.9rem !important;text-align:center;font-weight:normal !important;font-style:italic;font-family:serif !important;text-transform:none !important;letter-spacing:normal !important;color:#000 !important;padding-top:10px !important;page-break-before:avoid}#sbo-rt-content div.informalfigure{text-align:center !important;padding:5px 0 !important}#sbo-rt-content div.sidebar{margin:15px 0 10px 0 !important;border:1px solid #DCDCDC;background-color:#F7F7F7;padding:15px !important;page-break-inside:avoid}#sbo-rt-content aside[data-type="sidebar"]{margin:15px 0 10px 0 !important;page-break-inside:avoid}#sbo-rt-content div.sidebar-title,#sbo-rt-content aside[data-type="sidebar"] h5{font-weight:bold;font-size:1em;font-family:sans-serif;text-transform:uppercase;letter-spacing:1px;text-align:center;margin:4px 0 6px 0 !important;page-break-inside:avoid}#sbo-rt-content div.sidebar ol,#sbo-rt-content div.sidebar ul,#sbo-rt-content aside[data-type="sidebar"] ol,#sbo-rt-content aside[data-type="sidebar"] ul{margin-left:1.25em !important}#sbo-rt-content div.sidebar div.figure p.title,#sbo-rt-content aside[data-type="sidebar"] figcaption,#sbo-rt-content div.sidebar div.informalfigure div.caption{font-size:90%;text-align:center;font-weight:normal;font-style:italic;font-family:serif !important;color:#000;padding:5px !important;page-break-before:avoid;page-break-after:avoid}#sbo-rt-content div.sidebar div.tip,#sbo-rt-content div.sidebar div[data-type="tip"],#sbo-rt-content div.sidebar div.note,#sbo-rt-content div.sidebar div[data-type="note"],#sbo-rt-content div.sidebar div.warning,#sbo-rt-content div.sidebar div[data-type="warning"],#sbo-rt-content div.sidebar div[data-type="caution"],#sbo-rt-content div.sidebar div[data-type="important"]{margin:20px auto 20px auto !important;font-size:90%;width:85%}#sbo-rt-content aside[data-type="sidebar"] p.byline{font-size:90%;font-weight:bold;font-style:italic;text-align:center;text-indent:0;margin:5px auto 6px;page-break-after:avoid}#sbo-rt-content pre{white-space:pre-wrap;font-family:"Ubuntu Mono",monospace;margin:25px 0 25px 20px;font-size:85%;display:block;-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;overflow-wrap:break-word}#sbo-rt-content div.note pre.programlisting,#sbo-rt-content div.tip pre.programlisting,#sbo-rt-content div.warning pre.programlisting,#sbo-rt-content div.caution pre.programlisting,#sbo-rt-content div.important pre.programlisting{margin-bottom:0}#sbo-rt-content code{font-family:"Ubuntu Mono",monospace;-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;overflow-wrap:break-word}#sbo-rt-content code strong em,#sbo-rt-content code em strong,#sbo-rt-content pre em strong,#sbo-rt-content pre strong em,#sbo-rt-content strong code em code,#sbo-rt-content em code strong code,#sbo-rt-content span.bolditalic code{font-weight:bold;font-style:italic;font-family:"Ubuntu Mono BoldItal",monospace}#sbo-rt-content code em,#sbo-rt-content em code,#sbo-rt-content pre em,#sbo-rt-content em.replaceable{font-family:"Ubuntu Mono Ital",monospace;font-style:italic}#sbo-rt-content code strong,#sbo-rt-content strong code,#sbo-rt-content pre strong,#sbo-rt-content strong.userinput{font-family:"Ubuntu Mono Bold",monospace;font-weight:bold}#sbo-rt-content div[data-type="example"]{margin:10px 0 15px 0 !important}#sbo-rt-content div[data-type="example"] h1,#sbo-rt-content div[data-type="example"] h2,#sbo-rt-content div[data-type="example"] h3,#sbo-rt-content div[data-type="example"] h4,#sbo-rt-content div[data-type="example"] h5,#sbo-rt-content div[data-type="example"] h6{font-style:italic;font-weight:normal;text-align:left !important;text-transform:none !important;font-family:serif !important;margin:10px 0 5px 0 !important;border-bottom:1px solid #000}#sbo-rt-content li pre.example{padding:10px 0 !important}#sbo-rt-content div[data-type="example"] pre[data-type="programlisting"],#sbo-rt-content div[data-type="example"] pre[data-type="screen"]{margin:0}#sbo-rt-content section[data-type="titlepage"]>div>h1{font-size:2em;margin:50px 0 10px 0 !important;line-height:1;text-align:center}#sbo-rt-content section[data-type="titlepage"] h2,#sbo-rt-content section[data-type="titlepage"] p.subtitle,#sbo-rt-content section[data-type="titlepage"] p[data-type="subtitle"]{font-size:1.3em;font-weight:normal;text-align:center;margin-top:.5em;color:#555}#sbo-rt-content section[data-type="titlepage"]>div>h2[data-type="author"],#sbo-rt-content section[data-type="titlepage"] p.author{font-size:1.3em;font-family:serif !important;font-weight:bold;margin:50px 0 !important;text-align:center}#sbo-rt-content section[data-type="titlepage"] p.edition{text-align:center;text-transform:uppercase;margin-top:2em}#sbo-rt-content section[data-type="titlepage"]{text-align:center}#sbo-rt-content section[data-type="titlepage"]:after{content:url(css_assets/titlepage_footer_ebook.png);margin:0 auto;max-width:80%}#sbo-rt-content div.book div.titlepage div.publishername{margin-top:60%;margin-bottom:20px;text-align:center;font-size:1.25em}#sbo-rt-content div.book div.titlepage div.locations p{margin:0;text-align:center}#sbo-rt-content div.book div.titlepage div.locations p.cities{font-size:80%;text-align:center;margin-top:5px}#sbo-rt-content section.preface[title="Dedication"]>div.titlepage h2.title{text-align:center;text-transform:uppercase;font-size:1.5em;margin-top:50px;margin-bottom:50px}#sbo-rt-content ul.stafflist{margin:15px 0 15px 20px !important}#sbo-rt-content ul.stafflist li{list-style-type:none;padding:5px 0}#sbo-rt-content ul.printings li{list-style-type:none}#sbo-rt-content section.preface[title="Dedication"] p{font-style:italic;text-align:center}#sbo-rt-content div.colophon h1.title{font-size:1.3em;margin:0 !important;font-family:serif !important;font-weight:normal}#sbo-rt-content div.colophon h2.subtitle{margin:0 !important;color:#000;font-family:serif !important;font-size:1em;font-weight:normal}#sbo-rt-content div.colophon div.author h3.author{font-size:1.1em;font-family:serif !important;margin:10px 0 0 !important;font-weight:normal}#sbo-rt-content div.colophon div.editor h4,#sbo-rt-content div.colophon div.editor h3.editor{color:#000;font-size:.8em;margin:15px 0 0 !important;font-family:serif !important;font-weight:normal}#sbo-rt-content div.colophon div.editor h3.editor{font-size:.8em;margin:0 !important;font-family:serif !important;font-weight:normal}#sbo-rt-content div.colophon div.publisher{margin-top:10px}#sbo-rt-content div.colophon div.publisher p,#sbo-rt-content div.colophon div.publisher span.publishername{margin:0;font-size:.8em}#sbo-rt-content div.legalnotice p,#sbo-rt-content div.timestamp p{font-size:.8em}#sbo-rt-content div.timestamp p{margin-top:10px}#sbo-rt-content div.colophon[title="About the Author"] h1.title,#sbo-rt-content div.colophon[title="Colophon"] h1.title{font-size:1.5em;margin:0 !important;font-family:sans-serif !important}#sbo-rt-content section.chapter div.titlepage div.author{margin:10px 0 10px 0}#sbo-rt-content section.chapter div.titlepage div.author div.affiliation{font-style:italic}#sbo-rt-content div.attribution{margin:5px 0 0 50px !important}#sbo-rt-content h3.author span.orgname{display:none}#sbo-rt-content div.epigraph{margin:10px 0 10px 20px !important;page-break-inside:avoid;font-size:90%}#sbo-rt-content div.epigraph p{font-style:italic}#sbo-rt-content blockquote,#sbo-rt-content div.blockquote{margin:10px !important;page-break-inside:avoid;font-size:95%}#sbo-rt-content blockquote p,#sbo-rt-content div.blockquote p{font-style:italic;margin:.75em 0 0 !important}#sbo-rt-content blockquote div.attribution,#sbo-rt-content blockquote p[data-type="attribution"]{margin:5px 0 10px 30px !important;text-align:right;width:80%}#sbo-rt-content blockquote div.attribution p,#sbo-rt-content blockquote p[data-type="attribution"]{font-style:normal;margin-top:5px}#sbo-rt-content blockquote div.attribution p:before,#sbo-rt-content blockquote p[data-type="attribution"]:before{font-style:normal;content:"—";-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none}#sbo-rt-content p.right{text-align:right;margin:0}#sbo-rt-content div[data-type="footnotes"]{border-top:1px solid black;margin-top:1.5em}#sbo-rt-content sub,#sbo-rt-content sup{font-size:75%;line-height:0;position:relative}#sbo-rt-content sup{top:-.5em}#sbo-rt-content sub{bottom:-.25em}#sbo-rt-content div.refentry p.refname{font-size:1em;font-family:sans-serif,"DejaVuSans";font-weight:bold;margin-bottom:5px;overflow:auto;width:100%}#sbo-rt-content div.refentry{width:100%;display:block;margin-top:2em}#sbo-rt-content div.refsynopsisdiv{display:block;clear:both}#sbo-rt-content div.refentry header{page-break-inside:avoid !important;display:block;break-inside:avoid !important;padding-top:0;border-bottom:1px solid #000}#sbo-rt-content div.refsect1 h6{font-size:.9em;font-family:sans-serif,"DejaVuSans";font-weight:bold}#sbo-rt-content div.refsect1{margin-top:3em}#sbo-rt-content dt{padding-top:10px !important;padding-bottom:0 !important}#sbo-rt-content dd{margin-left:1.5em !important;margin-bottom:.25em}#sbo-rt-content dd ol,#sbo-rt-content dd ul{padding-left:1em}#sbo-rt-content dd li{margin-top:0;margin-bottom:0}#sbo-rt-content dd,#sbo-rt-content li{text-align:left}#sbo-rt-content ul,#sbo-rt-content ul>li,#sbo-rt-content ol ul,#sbo-rt-content ol ul>li,#sbo-rt-content ul ol ul,#sbo-rt-content ul ol ul>li{list-style-type:disc}#sbo-rt-content ul ul,#sbo-rt-content ul ul>li{list-style-type:square}#sbo-rt-content ul ul ul,#sbo-rt-content ul ul ul>li{list-style-type:circle}#sbo-rt-content ol,#sbo-rt-content ol>li,#sbo-rt-content ol ul ol,#sbo-rt-content ol ul ol>li,#sbo-rt-content ul ol,#sbo-rt-content ul ol>li{list-style-type:decimal}#sbo-rt-content ol ol,#sbo-rt-content ol ol>li{list-style-type:lower-alpha}#sbo-rt-content ol ol ol,#sbo-rt-content ol ol ol>li{list-style-type:lower-roman}#sbo-rt-content ol,#sbo-rt-content ul{list-style-position:outside;margin:15px 0 15px 1.25em;padding-left:2.25em}#sbo-rt-content ol li,#sbo-rt-content ul li{margin:.5em 0 .65em;line-height:125%}#sbo-rt-content div.orderedlistalpha{list-style-type:upper-alpha}#sbo-rt-content table.simplelist,#sbo-rt-content ul.simplelist{margin:15px 0 15px 20px !important}#sbo-rt-content ul.simplelist li{list-style-type:none;padding:5px 0}#sbo-rt-content table.simplelist td{border:none}#sbo-rt-content table.simplelist tr{border-bottom:none}#sbo-rt-content table.simplelist tr:nth-of-type(even){background-color:transparent}#sbo-rt-content dl.calloutlist p:first-child{margin-top:-25px !important}#sbo-rt-content dl.calloutlist dd{padding-left:0;margin-top:-25px}#sbo-rt-content dl.calloutlist img,#sbo-rt-content a.co img{padding:0}#sbo-rt-content div.toc ol{margin-top:8px !important;margin-bottom:8px !important;margin-left:0 !important;padding-left:0 !important}#sbo-rt-content div.toc ol ol{margin-left:30px !important;padding-left:0 !important}#sbo-rt-content div.toc ol li{list-style-type:none}#sbo-rt-content div.toc a{color:#8e0012}#sbo-rt-content div.toc ol a{font-size:1em;font-weight:bold}#sbo-rt-content div.toc ol>li>ol a{font-weight:bold;font-size:1em}#sbo-rt-content div.toc ol>li>ol>li>ol a{text-decoration:none;font-weight:normal;font-size:1em}#sbo-rt-content div.tip,#sbo-rt-content div[data-type="tip"],#sbo-rt-content div.note,#sbo-rt-content div[data-type="note"],#sbo-rt-content div.warning,#sbo-rt-content div[data-type="warning"],#sbo-rt-content div[data-type="caution"],#sbo-rt-content div[data-type="important"]{margin:30px !important;font-size:90%;padding:10px 8px 20px 8px !important;page-break-inside:avoid}#sbo-rt-content div.tip ol,#sbo-rt-content div.tip ul,#sbo-rt-content div[data-type="tip"] ol,#sbo-rt-content div[data-type="tip"] ul,#sbo-rt-content div.note ol,#sbo-rt-content div.note ul,#sbo-rt-content div[data-type="note"] ol,#sbo-rt-content div[data-type="note"] ul,#sbo-rt-content div.warning ol,#sbo-rt-content div.warning ul,#sbo-rt-content div[data-type="warning"] ol,#sbo-rt-content div[data-type="warning"] ul,#sbo-rt-content div[data-type="caution"] ol,#sbo-rt-content div[data-type="caution"] ul,#sbo-rt-content div[data-type="important"] ol,#sbo-rt-content div[data-type="important"] ul{margin-left:1.5em !important}#sbo-rt-content div.tip,#sbo-rt-content div[data-type="tip"],#sbo-rt-content div.note,#sbo-rt-content div[data-type="note"]{border:1px solid #BEBEBE;background-color:transparent}#sbo-rt-content div.warning,#sbo-rt-content div[data-type="warning"],#sbo-rt-content div[data-type="caution"],#sbo-rt-content div[data-type="important"]{border:1px solid #BC8F8F}#sbo-rt-content div.tip h3,#sbo-rt-content div[data-type="tip"] h6,#sbo-rt-content div[data-type="tip"] h1,#sbo-rt-content div.note h3,#sbo-rt-content div[data-type="note"] h6,#sbo-rt-content div[data-type="note"] h1,#sbo-rt-content div.warning h3,#sbo-rt-content div[data-type="warning"] h6,#sbo-rt-content div[data-type="warning"] h1,#sbo-rt-content div[data-type="caution"] h6,#sbo-rt-content div[data-type="caution"] h1,#sbo-rt-content div[data-type="important"] h1,#sbo-rt-content div[data-type="important"] h6{font-weight:bold;font-size:110%;font-family:sans-serif !important;text-transform:uppercase;letter-spacing:1px;text-align:center;margin:4px 0 6px !important}#sbo-rt-content div[data-type="tip"] figure h6,#sbo-rt-content div[data-type="note"] figure h6,#sbo-rt-content div[data-type="warning"] figure h6,#sbo-rt-content div[data-type="caution"] figure h6,#sbo-rt-content div[data-type="important"] figure h6{font-family:serif !important}#sbo-rt-content div.tip h3,#sbo-rt-content div[data-type="tip"] h6,#sbo-rt-content div.note h3,#sbo-rt-content div[data-type="note"] h6,#sbo-rt-content div[data-type="tip"] h1,#sbo-rt-content div[data-type="note"] h1{color:#737373}#sbo-rt-content div.warning h3,#sbo-rt-content div[data-type="warning"] h6,#sbo-rt-content div[data-type="caution"] h6,#sbo-rt-content div[data-type="important"] h6,#sbo-rt-content div[data-type="warning"] h1,#sbo-rt-content div[data-type="caution"] h1,#sbo-rt-content div[data-type="important"] h1{color:#C67171}#sbo-rt-content div.sect1[title="Safari® Books Online"] div.note,#sbo-rt-content div.safarienabled{background-color:transparent;margin:8px 0 0 !important;border:0 solid #BEBEBE;font-size:100%;padding:0 !important;page-break-inside:avoid}#sbo-rt-content div.sect1[title="Safari® Books Online"] div.note h3,#sbo-rt-content div.safarienabled h6{display:none}#sbo-rt-content div.table,#sbo-rt-content table{margin:15px 0 30px 0 !important;max-width:95%;border:none !important;background:none;display:table !important}#sbo-rt-content div.table,#sbo-rt-content div.informaltable,#sbo-rt-content table{page-break-inside:avoid}#sbo-rt-content tr,#sbo-rt-content tr td{border-bottom:1px solid #c3c3c3}#sbo-rt-content thead td,#sbo-rt-content thead th{border-bottom:#9d9d9d 1px solid !important;border-top:#9d9d9d 1px solid !important}#sbo-rt-content tr:nth-of-type(even){background-color:#f1f6fc}#sbo-rt-content thead{font-family:sans-serif;font-weight:bold}#sbo-rt-content td,#sbo-rt-content th{display:table-cell;padding:.3em;text-align:left;vertical-align:middle;font-size:80%}#sbo-rt-content div.informaltable table{margin:10px auto !important}#sbo-rt-content div.informaltable table tr{border-bottom:none}#sbo-rt-content div.informaltable table tr:nth-of-type(even){background-color:transparent}#sbo-rt-content div.informaltable td,#sbo-rt-content div.informaltable th{border:#9d9d9d 1px solid}#sbo-rt-content div.table-title,#sbo-rt-content table caption{font-weight:normal;font-style:italic;font-family:serif;font-size:1em;margin:10px 0 10px 0 !important;padding:0;page-break-after:avoid;text-align:left !important}#sbo-rt-content table code{font-size:smaller}#sbo-rt-content div.equation,#sbo-rt-content div[data-type="equation"]{margin:10px 0 15px 0 !important}#sbo-rt-content div.equation-title,#sbo-rt-content div[data-type="equation"] h5{font-style:italic;font-weight:normal;font-family:serif !important;font-size:90%;margin:20px 0 10px 0 !important;page-break-after:avoid}#sbo-rt-content div.equation-contents{margin-left:20px}#sbo-rt-content div[data-type="equation"] math{font-size:calc(.35em + 1vw)}#sbo-rt-content span.inlinemediaobject{height:.85em;display:inline-block;margin-bottom:.2em}#sbo-rt-content span.inlinemediaobject img{margin:0;height:.85em}#sbo-rt-content div.informalequation{margin:20px 0 20px 20px;width:75%}#sbo-rt-content div.informalequation img{width:75%}#sbo-rt-content div.index{text-indent:0}#sbo-rt-content div.index h3{padding:.25em;margin-top:1em !important;background-color:#F0F0F0}#sbo-rt-content div.index li{line-height:130%;list-style-type:none}#sbo-rt-content div.index a.indexterm{color:#8e0012 !important}#sbo-rt-content div.index ul{margin-left:0 !important;padding-left:0 !important}#sbo-rt-content div.index ul ul{margin-left:1em !important;margin-top:0 !important}#sbo-rt-content code.boolean,#sbo-rt-content .navy{color:rgb(0,0,128);}#sbo-rt-content code.character,#sbo-rt-content .olive{color:rgb(128,128,0);}#sbo-rt-content code.comment,#sbo-rt-content .blue{color:rgb(0,0,255);}#sbo-rt-content code.conditional,#sbo-rt-content .limegreen{color:rgb(50,205,50);}#sbo-rt-content code.constant,#sbo-rt-content .darkorange{color:rgb(255,140,0);}#sbo-rt-content code.debug,#sbo-rt-content .darkred{color:rgb(139,0,0);}#sbo-rt-content code.define,#sbo-rt-content .darkgoldenrod,#sbo-rt-content .gold{color:rgb(184,134,11);}#sbo-rt-content code.delimiter,#sbo-rt-content .dimgray{color:rgb(105,105,105);}#sbo-rt-content code.error,#sbo-rt-content .red{color:rgb(255,0,0);}#sbo-rt-content code.exception,#sbo-rt-content .salmon{color:rgb(250,128,11);}#sbo-rt-content code.float,#sbo-rt-content .steelblue{color:rgb(70,130,180);}#sbo-rt-content pre code.function,#sbo-rt-content .green{color:rgb(0,128,0);}#sbo-rt-content code.identifier,#sbo-rt-content .royalblue{color:rgb(65,105,225);}#sbo-rt-content code.ignore,#sbo-rt-content .gray{color:rgb(128,128,128);}#sbo-rt-content code.include,#sbo-rt-content .purple{color:rgb(128,0,128);}#sbo-rt-content code.keyword,#sbo-rt-content .sienna{color:rgb(160,82,45);}#sbo-rt-content code.label,#sbo-rt-content .deeppink{color:rgb(255,20,147);}#sbo-rt-content code.macro,#sbo-rt-content .orangered{color:rgb(255,69,0);}#sbo-rt-content code.number,#sbo-rt-content .brown{color:rgb(165,42,42);}#sbo-rt-content code.operator,#sbo-rt-content .black{color:#000;}#sbo-rt-content code.preCondit,#sbo-rt-content .teal{color:rgb(0,128,128);}#sbo-rt-content code.preProc,#sbo-rt-content .fuschia{color:rgb(255,0,255);}#sbo-rt-content code.repeat,#sbo-rt-content .indigo{color:rgb(75,0,130);}#sbo-rt-content code.special,#sbo-rt-content .saddlebrown{color:rgb(139,69,19);}#sbo-rt-content code.specialchar,#sbo-rt-content .magenta{color:rgb(255,0,255);}#sbo-rt-content code.specialcomment,#sbo-rt-content .seagreen{color:rgb(46,139,87);}#sbo-rt-content code.statement,#sbo-rt-content .forestgreen{color:rgb(34,139,34);}#sbo-rt-content code.storageclass,#sbo-rt-content .plum{color:rgb(221,160,221);}#sbo-rt-content code.string,#sbo-rt-content .darkred{color:rgb(139,0,0);}#sbo-rt-content code.structure,#sbo-rt-content .chocolate{color:rgb(210,106,30);}#sbo-rt-content code.tag,#sbo-rt-content .darkcyan{color:rgb(0,139,139);}#sbo-rt-content code.todo,#sbo-rt-content .black{color:#000;}#sbo-rt-content code.type,#sbo-rt-content .mediumslateblue{color:rgb(123,104,238);}#sbo-rt-content code.typedef,#sbo-rt-content .darkgreen{color:rgb(0,100,0);}#sbo-rt-content code.underlined{text-decoration:underline;}#sbo-rt-content pre code.hll{background-color:#ffc}#sbo-rt-content pre code.c{color:#09F;font-style:italic}#sbo-rt-content pre code.err{color:#A00}#sbo-rt-content pre code.k{color:#069;font-weight:bold}#sbo-rt-content pre code.o{color:#555}#sbo-rt-content pre code.cm{color:#35586C;font-style:italic}#sbo-rt-content pre code.cp{color:#099}#sbo-rt-content pre code.c1{color:#35586C;font-style:italic}#sbo-rt-content pre code.cs{color:#35586C;font-weight:bold;font-style:italic}#sbo-rt-content pre code.gd{background-color:#FCC}#sbo-rt-content pre code.ge{font-style:italic}#sbo-rt-content pre code.gr{color:#F00}#sbo-rt-content pre code.gh{color:#030;font-weight:bold}#sbo-rt-content pre code.gi{background-color:#CFC}#sbo-rt-content pre code.go{color:#000}#sbo-rt-content pre code.gp{color:#009;font-weight:bold}#sbo-rt-content pre code.gs{font-weight:bold}#sbo-rt-content pre code.gu{color:#030;font-weight:bold}#sbo-rt-content pre code.gt{color:#9C6}#sbo-rt-content pre code.kc{color:#069;font-weight:bold}#sbo-rt-content pre code.kd{color:#069;font-weight:bold}#sbo-rt-content pre code.kn{color:#069;font-weight:bold}#sbo-rt-content pre code.kp{color:#069}#sbo-rt-content pre code.kr{color:#069;font-weight:bold}#sbo-rt-content pre code.kt{color:#078;font-weight:bold}#sbo-rt-content pre code.m{color:#F60}#sbo-rt-content pre code.s{color:#C30}#sbo-rt-content pre code.na{color:#309}#sbo-rt-content pre code.nb{color:#366}#sbo-rt-content pre code.nc{color:#0A8;font-weight:bold}#sbo-rt-content pre code.no{color:#360}#sbo-rt-content pre code.nd{color:#99F}#sbo-rt-content pre code.ni{color:#999;font-weight:bold}#sbo-rt-content pre code.ne{color:#C00;font-weight:bold}#sbo-rt-content pre code.nf{color:#C0F}#sbo-rt-content pre code.nl{color:#99F}#sbo-rt-content pre code.nn{color:#0CF;font-weight:bold}#sbo-rt-content pre code.nt{color:#309;font-weight:bold}#sbo-rt-content pre code.nv{color:#033}#sbo-rt-content pre code.ow{color:#000;font-weight:bold}#sbo-rt-content pre code.w{color:#bbb}#sbo-rt-content pre code.mf{color:#F60}#sbo-rt-content pre code.mh{color:#F60}#sbo-rt-content pre code.mi{color:#F60}#sbo-rt-content pre code.mo{color:#F60}#sbo-rt-content pre code.sb{color:#C30}#sbo-rt-content pre code.sc{color:#C30}#sbo-rt-content pre code.sd{color:#C30;font-style:italic}#sbo-rt-content pre code.s2{color:#C30}#sbo-rt-content pre code.se{color:#C30;font-weight:bold}#sbo-rt-content pre code.sh{color:#C30}#sbo-rt-content pre code.si{color:#A00}#sbo-rt-content pre code.sx{color:#C30}#sbo-rt-content pre code.sr{color:#3AA}#sbo-rt-content pre code.s1{color:#C30}#sbo-rt-content pre code.ss{color:#A60}#sbo-rt-content pre code.bp{color:#366}#sbo-rt-content pre code.vc{color:#033}#sbo-rt-content pre code.vg{color:#033}#sbo-rt-content pre code.vi{color:#033}#sbo-rt-content pre code.il{color:#F60}#sbo-rt-content pre code.g{color:#050}#sbo-rt-content pre code.l{color:#C60}#sbo-rt-content pre code.l{color:#F90}#sbo-rt-content pre code.n{color:#008}#sbo-rt-content pre code.nx{color:#008}#sbo-rt-content pre code.py{color:#96F}#sbo-rt-content pre code.p{color:#000}#sbo-rt-content pre code.x{color:#F06}#sbo-rt-content div.blockquote_sampler_toc{width:95%;margin:5px 5px 5px 10px !important}#sbo-rt-content div{font-family:serif;text-align:left}#sbo-rt-content .gray-background,#sbo-rt-content .reverse-video{background:#2E2E2E;color:#FFF}#sbo-rt-content .light-gray-background{background:#A0A0A0}#sbo-rt-content .preserve-whitespace{white-space:pre-wrap}#sbo-rt-content span.gray{color:#4C4C4C}#sbo-rt-content div.map-ebook{page-break-after:always}
    </style><link rel="canonical" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html"><meta name="description" content=" Chapter 4. Encoding and Evolution Everything changes and nothing stands still. Heraclitus of Ephesus, as quoted by Plato in Cratylus (360 BCE) Applications inevitably change over time. Features are added ... "><meta property="og:title" content="4. Encoding and Evolution"><meta itemprop="isPartOf" content="/library/view/designing-data-intensive-applications/9781491903063/"><meta itemprop="name" content="4. Encoding and Evolution"><meta property="og:url" itemprop="url" content="https://www.safaribooksonline.com/library/view/designing-data-intensive-applications/9781491903063/ch04.html"><meta property="og:site_name" content="Safari"><meta property="og:image" itemprop="thumbnailUrl" content="https://www.safaribooksonline.com/library/cover/9781491903063/"><meta property="og:description" itemprop="description" content=" Chapter 4. Encoding and Evolution Everything changes and nothing stands still. Heraclitus of Ephesus, as quoted by Plato in Cratylus (360 BCE) Applications inevitably change over time. Features are added ... "><meta itemprop="inLanguage" content="en"><meta itemprop="publisher" content="O'Reilly Media, Inc."><meta property="og:type" content="book"><meta property="og:book:isbn" itemprop="isbn" content="9781449373320"><meta property="og:book:author" itemprop="author" content="Martin Kleppmann"><meta property="og:book:tag" itemprop="about" content="Core Programming"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@safari"><style type="text/css" id="font-styles" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-size: <%= font_size %> !important; }"></style><style type="text/css" id="font-family" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-family: <%= font_family %> !important; }"></style><style type="text/css" id="column-width" data-template="#sbo-rt-content { max-width: <%= column_width %>% !important; margin: 0 auto !important; }"></style><style id="annotator-dynamic-style">.annotator-adder, .annotator-outer, .annotator-notice {
  z-index: 100019;
}
.annotator-filter {
  z-index: 100009;
}</style></head>


<body class="reading sidenav nav-collapsed  scalefonts subscribe-panel library" data-gr-c-s-loaded="true">

    
  
  
  



    
      <div class="hide working" role="status">
        <div class="working-image"></div>
      </div>
      <div class="sbo-site-nav">
        





<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#container" class="skip">Skip to content</a><header class="topbar t-topbar" style="display:None"><nav role="navigation" class="js-site-nav"><ul class="topnav"><li class="t-logo"><a href="https://www.safaribooksonline.com/home/" class="l0 None safari-home nav-icn js-keyboard-nav-home"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>Safari Home Icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M4 9.9L4 9.9 4 18 16 18 16 9.9 10 4 4 9.9ZM2.6 8.1L2.6 8.1 8.7 1.9 10 0.5 11.3 1.9 17.4 8.1 18 8.7 18 9.5 18 18.1 18 20 16.1 20 3.9 20 2 20 2 18.1 2 9.5 2 8.7 2.6 8.1Z"></path><rect x="10" y="12" width="3" height="7"></rect><rect transform="translate(18.121320, 10.121320) rotate(-315.000000) translate(-18.121320, -10.121320) " x="16.1" y="9.1" width="4" height="2"></rect><rect transform="translate(2.121320, 10.121320) scale(-1, 1) rotate(-315.000000) translate(-2.121320, -10.121320) " x="0.1" y="9.1" width="4" height="2"></rect></g></svg><span>Safari Home</span></a></li><li><a href="https://www.safaribooksonline.com/r/" class="t-recommendations-nav l0 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>recommendations icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M50 25C50 18.2 44.9 12.5 38.3 11.7 37.5 5.1 31.8 0 25 0 18.2 0 12.5 5.1 11.7 11.7 5.1 12.5 0 18.2 0 25 0 31.8 5.1 37.5 11.7 38.3 12.5 44.9 18.2 50 25 50 31.8 50 37.5 44.9 38.3 38.3 44.9 37.5 50 31.8 50 25ZM25 3.1C29.7 3.1 33.6 6.9 34.4 11.8 30.4 12.4 26.9 15.1 25 18.8 23.1 15.1 19.6 12.4 15.6 11.8 16.4 6.9 20.3 3.1 25 3.1ZM34.4 15.6C33.6 19.3 30.7 22.2 27.1 22.9 27.8 19.2 30.7 16.3 34.4 15.6ZM22.9 22.9C19.2 22.2 16.3 19.3 15.6 15.6 19.3 16.3 22.2 19.2 22.9 22.9ZM3.1 25C3.1 20.3 6.9 16.4 11.8 15.6 12.4 19.6 15.1 23.1 18.8 25 15.1 26.9 12.4 30.4 11.8 34.4 6.9 33.6 3.1 29.7 3.1 25ZM22.9 27.1C22.2 30.7 19.3 33.6 15.6 34.4 16.3 30.7 19.2 27.8 22.9 27.1ZM25 46.9C20.3 46.9 16.4 43.1 15.6 38.2 19.6 37.6 23.1 34.9 25 31.3 26.9 34.9 30.4 37.6 34.4 38.2 33.6 43.1 29.7 46.9 25 46.9ZM27.1 27.1C30.7 27.8 33.6 30.7 34.4 34.4 30.7 33.6 27.8 30.7 27.1 27.1ZM38.2 34.4C37.6 30.4 34.9 26.9 31.3 25 34.9 23.1 37.6 19.6 38.2 15.6 43.1 16.4 46.9 20.3 46.9 25 46.9 29.7 43.1 33.6 38.2 34.4Z"></path></g></svg><span>Recommended</span></a></li><li><a href="https://www.safaribooksonline.com/playlists/" class="t-queue-nav l0 nav-icn None"><!--?xml version="1.0" encoding="UTF-8"?--><svg width="21px" height="17px" viewBox="0 0 21 17" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><!-- Generator: Sketch 46.2 (44496) - http://www.bohemiancoding.com/sketch --><title>icon_Playlist_sml</title><desc>Created with Sketch.</desc><defs></defs><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="icon_Playlist_sml" fill-rule="nonzero" fill="#000000"><g id="playlist-icon"><g id="Group-6"><rect id="Rectangle-path" x="5" y="0" width="16" height="3" rx="0.5"></rect><circle id="Oval" cx="1.5" cy="1.5" r="1.5"></circle></g><g id="Group-5" transform="translate(0.000000, 7.000000)"><circle id="Oval" cx="1.5" cy="1.5" r="1.5"></circle><rect id="Rectangle-path" x="5" y="0" width="16" height="3" rx="0.5"></rect></g><g id="Group-5-Copy" transform="translate(0.000000, 14.000000)"><circle id="Oval" cx="1.5" cy="1.5" r="1.5"></circle><rect id="Rectangle-path" x="5" y="0" width="16" height="3" rx="0.5"></rect></g></g></g></g></svg><span>
               Playlists
            </span></a></li><li class="search"><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#" class="t-search-nav trigger nav-icn l0" data-dropdown-selector=".searchbox"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>search icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M31.3 0C20.9 0 12.5 8.4 12.5 18.8 12.5 22.5 13.6 25.9 15.4 28.8L1.2 42.9C-0.4 44.5-0.4 47.2 1.2 48.8 2 49.6 3.1 50 4.2 50 5.2 50 6.3 49.6 7.1 48.8L21.2 34.6C24.1 36.5 27.5 37.5 31.3 37.5 41.6 37.5 50 29.1 50 18.8 50 8.4 41.6 0 31.3 0ZM31.3 31.3C24.4 31.3 18.8 25.6 18.8 18.8 18.8 11.9 24.4 6.3 31.3 6.3 38.1 6.3 43.8 11.9 43.8 18.8 43.8 25.6 38.1 31.3 31.3 31.3Z"></path></g></svg><span>Search</span></a></li><li class="usermenu dropdown"><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#" class="trigger l0 nav-icn nav-dropdown"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>navigation arrow</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M0.1 12.5L9.7 3.1C9.8 3 9.9 3 10 3 10.1 3 10.2 3 10.3 3.1L19.9 12.5C20 12.5 20 12.6 20 12.8 20 12.9 20 13 19.9 13L17 15.9C16.9 16 16.8 16 16.7 16 16.5 16 16.4 16 16.4 15.9L10 9.7 3.6 15.9C3.6 16 3.5 16 3.3 16 3.2 16 3.1 16 3 15.9L0.1 13C0 12.9 0 12.8 0 12.7 0 12.7 0 12.6 0.1 12.5Z"></path></g></svg><span>Expand Nav</span></a><div class="drop-content"><ul><li><a href="https://www.safaribooksonline.com/history/" class="t-recent-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>recent items icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 0C11.2 0 0 11.2 0 25 0 38.8 11.2 50 25 50 38.8 50 50 38.8 50 25 50 11.2 38.8 0 25 0ZM6.3 25C6.3 14.6 14.6 6.3 25 6.3 35.4 6.3 43.8 14.6 43.8 25 43.8 35.4 35.4 43.8 25 43.8 14.6 43.8 6.3 35.4 6.3 25ZM31.8 31.5C32.5 30.5 32.4 29.2 31.6 28.3L27.1 23.8 27.1 12.8C27.1 11.5 26.2 10.4 25 10.4 23.9 10.4 22.9 11.5 22.9 12.8L22.9 25.7 28.8 31.7C29.2 32.1 29.7 32.3 30.2 32.3 30.8 32.3 31.3 32 31.8 31.5Z"></path></g></svg><span>History</span></a></li><li><a href="https://www.safaribooksonline.com/topics" class="t-topics-link l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 55" width="20" height="20" version="1.1" fill="#4A3C31"><desc>topics icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 55L50 41.262 50 13.762 25 0 0 13.762 0 41.262 25 55ZM8.333 37.032L8.333 17.968 25 8.462 41.667 17.968 41.667 37.032 25 46.538 8.333 37.032Z"></path></g></svg><span>Topics</span></a></li><li><a href="https://www.safaribooksonline.com/tutorials/" class="l1 nav-icn t-tutorials-nav js-toggle-menu-item None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>tutorials icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M15.8 18.2C15.8 18.2 15.9 18.2 16 18.2 16.1 18.2 16.2 18.2 16.4 18.2 16.5 18.2 16.7 18.1 16.9 18 17 17.9 17.1 17.8 17.2 17.7 17.3 17.6 17.4 17.5 17.4 17.4 17.5 17.2 17.6 16.9 17.6 16.7 17.6 16.6 17.6 16.5 17.6 16.4 17.5 16.2 17.5 16.1 17.4 15.9 17.3 15.8 17.2 15.6 17 15.5 16.8 15.3 16.6 15.3 16.4 15.2 16.2 15.2 16 15.2 15.8 15.2 15.7 15.2 15.5 15.3 15.3 15.4 15.2 15.4 15.1 15.5 15 15.7 14.9 15.8 14.8 15.9 14.7 16 14.7 16.1 14.6 16.3 14.6 16.4 14.6 16.5 14.6 16.6 14.6 16.6 14.6 16.7 14.6 16.9 14.6 17 14.6 17.1 14.7 17.3 14.7 17.4 14.8 17.6 15 17.7 15.1 17.9 15.2 18 15.3 18 15.5 18.1 15.5 18.1 15.6 18.2 15.7 18.2 15.7 18.2 15.7 18.2 15.8 18.2L15.8 18.2ZM9.4 11.5C9.5 11.5 9.5 11.5 9.6 11.5 9.7 11.5 9.9 11.5 10 11.5 10.2 11.5 10.3 11.4 10.5 11.3 10.6 11.2 10.8 11.1 10.9 11 10.9 10.9 11 10.8 11.1 10.7 11.2 10.5 11.2 10.2 11.2 10 11.2 9.9 11.2 9.8 11.2 9.7 11.2 9.5 11.1 9.4 11 9.2 10.9 9.1 10.8 8.9 10.6 8.8 10.5 8.7 10.3 8.6 10 8.5 9.9 8.5 9.7 8.5 9.5 8.5 9.3 8.5 9.1 8.6 9 8.7 8.8 8.7 8.7 8.8 8.6 9 8.5 9.1 8.4 9.2 8.4 9.3 8.2 9.5 8.2 9.8 8.2 10 8.2 10.1 8.2 10.2 8.2 10.3 8.2 10.5 8.3 10.6 8.4 10.7 8.5 10.9 8.6 11.1 8.7 11.2 8.9 11.3 9 11.4 9.1 11.4 9.2 11.4 9.3 11.5 9.3 11.5 9.3 11.5 9.4 11.5 9.4 11.5L9.4 11.5ZM3 4.8C3.1 4.8 3.1 4.8 3.2 4.8 3.4 4.8 3.5 4.8 3.7 4.8 3.8 4.8 4 4.7 4.1 4.6 4.3 4.5 4.4 4.4 4.5 4.3 4.6 4.2 4.6 4.1 4.7 4 4.8 3.8 4.8 3.5 4.8 3.3 4.8 3.1 4.8 3 4.8 2.9 4.7 2.8 4.7 2.6 4.6 2.5 4.5 2.3 4.4 2.2 4.2 2.1 4 1.9 3.8 1.9 3.6 1.8 3.5 1.8 3.3 1.8 3.1 1.8 2.9 1.8 2.7 1.9 2.6 2 2.4 2.1 2.3 2.2 2.2 2.3 2.1 2.4 2 2.5 2 2.6 1.8 2.8 1.8 3 1.8 3.3 1.8 3.4 1.8 3.5 1.8 3.6 1.8 3.8 1.9 3.9 2 4 2.1 4.2 2.2 4.4 2.4 4.5 2.5 4.6 2.6 4.7 2.7 4.7 2.8 4.7 2.9 4.8 2.9 4.8 3 4.8 3 4.8 3 4.8L3 4.8ZM13.1 15.2C13.2 15.1 13.2 15.1 13.2 15.1 13.3 14.9 13.4 14.7 13.6 14.5 13.8 14.2 14.1 14 14.4 13.8 14.7 13.6 15.1 13.5 15.5 13.4 15.9 13.4 16.3 13.4 16.7 13.5 17.2 13.5 17.6 13.7 17.9 13.9 18.2 14.1 18.5 14.4 18.7 14.7 18.9 15 19.1 15.3 19.2 15.6 19.3 15.9 19.4 16.1 19.4 16.4 19.4 17 19.3 17.5 19.1 18.1 19 18.3 18.9 18.5 18.7 18.7 18.5 19 18.3 19.2 18 19.4 17.7 19.6 17.3 19.8 16.9 19.9 16.6 20 16.3 20 16 20 15.8 20 15.6 20 15.4 19.9 15.4 19.9 15.4 19.9 15.4 19.9 15.2 19.9 15 19.8 14.9 19.8 14.8 19.7 14.7 19.7 14.6 19.7 14.4 19.6 14.3 19.5 14.1 19.3 13.7 19.1 13.4 18.7 13.2 18.4 13.1 18.1 12.9 17.8 12.9 17.5 12.8 17.3 12.8 17.1 12.8 16.9L3.5 14.9C3.3 14.9 3.1 14.8 3 14.8 2.7 14.7 2.4 14.5 2.1 14.3 1.7 14 1.4 13.7 1.2 13.3 1 13 0.9 12.6 0.8 12.3 0.7 12 0.7 11.7 0.7 11.4 0.7 11 0.8 10.5 1 10.1 1.1 9.8 1.3 9.5 1.6 9.2 1.8 8.9 2.1 8.7 2.4 8.5 2.8 8.3 3.2 8.1 3.6 8.1 3.9 8 4.2 8 4.5 8 4.6 8 4.8 8 4.9 8.1L6.8 8.5C6.8 8.4 6.8 8.4 6.8 8.4 6.9 8.2 7.1 8 7.2 7.8 7.5 7.5 7.7 7.3 8 7.1 8.4 6.9 8.7 6.8 9.1 6.7 9.5 6.7 10 6.7 10.4 6.8 10.8 6.8 11.2 7 11.5 7.2 11.8 7.5 12.1 7.7 12.4 8 12.6 8.3 12.7 8.6 12.8 8.9 12.9 9.2 13 9.4 13 9.7 13 9.7 13 9.8 13 9.8 13.6 9.9 14.2 10.1 14.9 10.2 15 10.2 15 10.2 15.1 10.2 15.3 10.2 15.4 10.2 15.6 10.2 15.8 10.1 16 10 16.2 9.9 16.4 9.8 16.5 9.6 16.6 9.5 16.8 9.2 16.9 8.8 16.9 8.5 16.9 8.3 16.9 8.2 16.8 8 16.8 7.8 16.7 7.7 16.6 7.5 16.5 7.3 16.3 7.2 16.2 7.1 16 7 15.9 6.9 15.8 6.9 15.7 6.9 15.6 6.8 15.5 6.8L6.2 4.8C6.2 5 6 5.2 5.9 5.3 5.7 5.6 5.5 5.8 5.3 6 4.9 6.2 4.5 6.4 4.1 6.5 3.8 6.6 3.5 6.6 3.2 6.6 3 6.6 2.8 6.6 2.7 6.6 2.6 6.6 2.6 6.5 2.6 6.5 2.5 6.5 2.3 6.5 2.1 6.4 1.8 6.3 1.6 6.1 1.3 6 1 5.7 0.7 5.4 0.5 5 0.3 4.7 0.2 4.4 0.1 4.1 0 3.8 0 3.6 0 3.3 0 2.8 0.1 2.2 0.4 1.7 0.5 1.5 0.7 1.3 0.8 1.1 1.1 0.8 1.3 0.6 1.6 0.5 2 0.3 2.3 0.1 2.7 0.1 3.1 0 3.6 0 4 0.1 4.4 0.2 4.8 0.3 5.1 0.5 5.5 0.8 5.7 1 6 1.3 6.2 1.6 6.3 1.9 6.4 2.3 6.5 2.5 6.6 2.7 6.6 3 6.6 3 6.6 3.1 6.6 3.1 9.7 3.8 12.8 4.4 15.9 5.1 16.1 5.1 16.2 5.2 16.4 5.2 16.7 5.3 16.9 5.5 17.2 5.6 17.5 5.9 17.8 6.2 18.1 6.5 18.3 6.8 18.4 7.2 18.6 7.5 18.6 7.9 18.7 8.2 18.7 8.6 18.7 9 18.6 9.4 18.4 9.8 18.3 10.1 18.2 10.3 18 10.6 17.8 10.9 17.5 11.1 17.3 11.3 16.9 11.6 16.5 11.8 16 11.9 15.7 12 15.3 12 15 12 14.8 12 14.7 12 14.5 11.9 13.9 11.8 13.3 11.7 12.6 11.5 12.5 11.7 12.4 11.9 12.3 12 12.1 12.3 11.9 12.5 11.7 12.7 11.3 12.9 10.9 13.1 10.5 13.2 10.2 13.3 9.9 13.3 9.6 13.3 9.4 13.3 9.2 13.3 9 13.2 9 13.2 9 13.2 9 13.2 8.8 13.2 8.7 13.2 8.5 13.1 8.2 13 8 12.8 7.7 12.6 7.4 12.4 7.1 12 6.8 11.7 6.7 11.4 6.6 11.1 6.5 10.8 6.4 10.6 6.4 10.4 6.4 10.2 5.8 10.1 5.2 9.9 4.5 9.8 4.4 9.8 4.4 9.8 4.3 9.8 4.1 9.8 4 9.8 3.8 9.8 3.6 9.9 3.4 10 3.2 10.1 3 10.2 2.9 10.4 2.8 10.5 2.6 10.8 2.5 11.1 2.5 11.5 2.5 11.6 2.5 11.8 2.6 12 2.6 12.1 2.7 12.3 2.8 12.5 2.9 12.6 3.1 12.8 3.2 12.9 3.3 13 3.5 13.1 3.6 13.1 3.7 13.1 3.8 13.2 3.9 13.2L13.1 15.2 13.1 15.2Z"></path></g></svg><span>Tutorials</span></a></li><li class="nav-offers flyout-parent"><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#" class="l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>offers icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M35.9 20.6L27 15.5C26.1 15 24.7 15 23.7 15.5L14.9 20.6C13.9 21.1 13.2 22.4 13.2 23.4L13.2 41.4C13.2 42.4 13.9 43.7 14.9 44.2L23.3 49C24.2 49.5 25.6 49.5 26.6 49L35.9 43.6C36.8 43.1 37.6 41.8 37.6 40.8L37.6 23.4C37.6 22.4 36.8 21.1 35.9 20.6L35.9 20.6ZM40 8.2C39.1 7.6 37.6 7.6 36.7 8.2L30.2 11.9C29.3 12.4 29.3 13.2 30.2 13.8L39.1 18.8C40 19.4 40.7 20.6 40.7 21.7L40.7 39C40.7 40.1 41.4 40.5 42.4 40L48.2 36.6C49.1 36.1 49.8 34.9 49.8 33.8L49.8 15.6C49.8 14.6 49.1 13.3 48.2 12.8L40 8.2 40 8.2ZM27 10.1L33.6 6.4C34.5 5.9 34.5 5 33.6 4.5L26.6 0.5C25.6 0 24.2 0 23.3 0.5L16.7 4.2C15.8 4.7 15.8 5.6 16.7 6.1L23.7 10.1C24.7 10.6 26.1 10.6 27 10.1ZM10.1 21.7C10.1 20.6 10.8 19.4 11.7 18.8L20.6 13.8C21.5 13.2 21.5 12.4 20.6 11.9L13.6 7.9C12.7 7.4 11.2 7.4 10.3 7.9L1.6 12.8C0.7 13.3 0 14.6 0 15.6L0 33.8C0 34.9 0.7 36.1 1.6 36.6L8.4 40.5C9.3 41 10.1 40.6 10.1 39.6L10.1 21.7 10.1 21.7Z"></path></g></svg><span>Offers &amp; Deals</span></a><ul class="flyout"><li><a href="https://get.oreilly.com/email-signup.html" target="_blank" class="l2 nav-icn"><span>Newsletters</span></a></li></ul></li><li class="nav-highlights"><a href="https://www.safaribooksonline.com/u/f04af719-1c84-4fc3-9be3-1f1b4622ab99/" class="t-highlights-nav l1 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 35" width="20" height="20" version="1.1" fill="#4A3C31"><desc>highlights icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M13.325 18.071L8.036 18.071C8.036 11.335 12.36 7.146 22.5 5.594L22.5 0C6.37 1.113 0 10.632 0 22.113 0 29.406 3.477 35 10.403 35 15.545 35 19.578 31.485 19.578 26.184 19.578 21.556 17.211 18.891 13.325 18.071L13.325 18.071ZM40.825 18.071L35.565 18.071C35.565 11.335 39.86 7.146 50 5.594L50 0C33.899 1.113 27.5 10.632 27.5 22.113 27.5 29.406 30.977 35 37.932 35 43.045 35 47.078 31.485 47.078 26.184 47.078 21.556 44.74 18.891 40.825 18.071L40.825 18.071Z"></path></g></svg><span>Highlights</span></a></li><li><a href="https://www.safaribooksonline.com/u/preferences/" class="t-settings-nav l1 js-settings nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"></path></g></svg><span>Settings</span></a></li><li><a href="https://www.oreilly.com/online-learning/support/" class="l1 no-icon">Support</a></li><li><a href="https://www.safaribooksonline.com/accounts/logout/" class="l1 no-icon">Sign Out</a></li></ul><ul class="profile"><li><a href="https://www.safaribooksonline.com/u/preferences/" class="l2 nav-icn None"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"></path></g></svg><span>Settings</span></a><span class="l2 t-nag-notification" id="nav-nag"><strong class="trial-green">10</strong> days left in your trial.
  
  

  
    
      

<a class="" href="https://www.safaribooksonline.com/subscribe/">Subscribe</a>.


    
  

  

</span></li><li><a href="https://www.oreilly.com/online-learning/support/" class="l2">Support</a></li><li><a href="https://www.safaribooksonline.com/accounts/logout/" class="l2">Sign Out</a></li></ul></div></li></ul></nav></header>


      </div>
      <div id="container" class="application" style="height: auto;">
        
          <div class="nav-container clearfix">
            


            
            
          </div>

          

  <div class="js-toc">
    
      <div class="sbo-reading-menu sbo-menu-top"><section class="sbo-toc-container toc-menu"><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#" class="sbo-toc-thumb"><span class="sbo-title ss-list"><h1><div class="visuallyhidden">Table of Contents for </div>
      
      Designing Data-Intensive Applications
      
    </h1></span></a><div class="toc-contents"></div></section></div>

    

    <div class="interface-controls interface-controls-top">
      <ul class="interface-control-btns js-bitlist js-reader">
        <li class="js-search-in-archive search-in-archive t-search-in-archive"><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#" title="Search in archive" class="js-search-controls search-controls"><span class="icon">Search in book...</span></a><form class="search-archive-bar js-search-form"><input type="search" name="query" placeholder="Search inside this book..." autocomplete="off"></form><div class="search-archive-results"><div class="js-sitb-results-region"></div></div></li><li class="queue-control"><div class="js-content-uri" data-content-uri="/api/v1/book/9781491903063/chapter/ch04.html"><div class="js-collections-dropdown collections-dropdown menu-bit-cards"></div></div></li><li class="js-font-control-panel font-control-activator"><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#" data-push-state="false" id="font-controls" title="Change font size" aria-label="Change font size"><span class="icon">Toggle Font Controls</span></a></li><li class="dropdown sharing-controls"><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#" class="trigger" data-push-state="false" title="Share" aria-label="Share"><i class="fa fa-share"></i></a><ul class="social-sharing dropdown-menu"><li><a class="twitter share-button t-twitter" target="_blank" aria-label="Share this section on Twitter" title="Share this section on Twitter" href="https://twitter.com/share?url=https://www.safaribooksonline.com/library/view/designing-data-intensive-applications/9781491903063/ch04.html&amp;text=Designing%20Data-Intensive%20Applications&amp;via=safari"><span>Twitter</span></a></li><li><a class="facebook share-button t-facebook" target="_blank" aria-label="Share this section on Facebook" title="Share this section on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://www.safaribooksonline.com/library/view/designing-data-intensive-applications/9781491903063/ch04.html"><span>Facebook</span></a></li><li><a class="googleplus share-button t-googleplus" target="_blank" aria-label="Share this secton on Google Plus" title="Share this secton on Google Plus" href="https://plus.google.com/share?url=https://www.safaribooksonline.com/library/view/designing-data-intensive-applications/9781491903063/ch04.html"><span>Google Plus</span></a></li><li><a class="email share-button t-email" aria-label="Share this section via email" title="Share this section via email" href="mailto:?subject=Safari:%204.%20Encoding%20and%20Evolution&amp;body=https://www.safaribooksonline.com/library/view/designing-data-intensive-applications/9781491903063/ch04.html%0D%0Afrom%20Designing%20Data-Intensive%20Applications%0D%0A"><span>Email</span></a></li></ul></li>
      </ul>
    </div>

    <section role="document">
        
        



 <!--[if lt IE 9]>
  
<![endif]-->



  


        
	  <div class="t-sbo-prev sbo-prev sbo-nav-top">
  
    
      
        <a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch03.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">3. Storage and Retrieval</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-top">
  
    
      
        <a href="/site/library/view/designing-data-intensive-applications/9781491903063/part02.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">II. Distributed Data</div>
        </a>
    
  
  </div>



<div id="sbo-rt-content" style="transform: none;"><div class="annotator-wrapper"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 4. Encoding and Evolution"><div class="chapter" id="ch_encoding">
<h1><span class="label">Chapter 4. </span>Encoding and Evolution</h1>

<blockquote data-type="epigraph" epub:type="epigraph">
  <p><em>Everything changes and nothing stands still.</em></p>
  <p data-type="attribution">Heraclitus of Ephesus, as quoted by Plato in <em>Cratylus</em> (360 BCE)</p>
</blockquote>

<div class="map-ebook">
 <img id="c270" src="https://www.safaribooksonline.com/library/view/designing-data-intensive-applications/9781491903063/assets/ch04-map-ebook.png" width="2756" height="2100" data-mfp-src="/library/view/designing-data-intensive-applications/9781491903063/assets/ch04-map-ebook.png">
</div>

<p><a data-type="indexterm" data-primary="encodings (data formats)" id="ix_encode"></a>
<a data-type="indexterm" data-primary="evolvability" id="idm140417570479728"></a>
Applications inevitably change over time. Features are added or modified as new products are
launched, user requirements become better understood, or business circumstances change. In
<a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch01.html#ch_introduction">Chapter&nbsp;1</a> we introduced the idea of <em>evolvability</em>: we should aim to build systems that
make it easy to adapt to change (see <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch01.html#sec_introduction_evolvability">“Evolvability: Making Change Easy”</a>).</p>

<p>In most cases, a change to an application’s features also requires a change to data that it stores:
perhaps a new field or record type needs to be captured, or perhaps existing data needs to be
presented in a new way.</p>

<p><a data-type="indexterm" data-primary="ALTER TABLE statement (SQL)" id="idm140417570475664"></a>
<a data-type="indexterm" data-primary="relational databases" data-secondary="schema changes" id="idm140417570474704"></a>
<a data-type="indexterm" data-primary="evolvability" data-secondary="schema-on-read" id="idm140417570473600"></a>
The data models we discussed in <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch02.html#ch_datamodels">Chapter&nbsp;2</a> have different ways of coping with such change.
Relational databases generally assume that all data in the database conforms to one schema: although
that schema can be changed (through schema migrations; i.e., <code>ALTER</code> statements), there is exactly
one schema in force at any one point in time. By contrast, schema-on-read (“schemaless”) databases
don’t enforce a schema, so the database can contain a mixture of older and newer data formats
written at different times (see <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch02.html#sec_datamodels_schema_flexibility">“Schema flexibility in the document model”</a>).</p>

<p><a data-type="indexterm" data-primary="schemas" data-secondary="evolution of" data-tertiary="affecting application code" id="idm140417570469760"></a>
When a data format or schema changes, a corresponding change to application code often needs to
happen (for example, you add a new field to a record, and the application code starts reading
and writing that field). However, in a large application, code changes often cannot happen
instantaneously:</p>

<ul class="pagebreak-before">
<li>
<p>With server-side applications you may want to perform a <a data-type="indexterm" data-primary="rolling upgrades" id="idm140417570466800"></a> <em>rolling upgrade</em>
(also known as a <em>staged rollout</em>), deploying the new version to a few nodes at a time, checking
whether the new version is running smoothly, and gradually working your way through all the nodes.
This allows new versions to be deployed without service downtime, and thus encourages more
frequent releases and better evolvability.</p>
</li>
<li>
<p>With client-side applications you’re at the mercy of the user, who may not install the update for
some time.</p>
</li>
</ul>

<p><a data-type="indexterm" data-primary="compatibility" id="idm140417570463248"></a>
<a data-type="indexterm" data-primary="encodings (data formats)" data-secondary="compatibility" id="idm140417570462416"></a>
This means that old and new versions of the code, and old and new data formats, may potentially all
coexist in the system at the same time. In order for the system to continue running smoothly, we
need to maintain compatibility in both directions:</p>
<dl>
<dt>Backward compatibility</dt>
<dd>
<p><a data-type="indexterm" data-primary="backward compatibility" id="idm140417570459680"></a>
Newer code can read data that was written by older code.</p>
</dd>
<dt>Forward compatibility</dt>
<dd>
<p><a data-type="indexterm" data-primary="forward compatibility" id="idm140417570457616"></a>
Older code can read data that was written by newer code.</p>
</dd>
</dl>

<p>Backward compatibility is normally not hard to achieve: as author of the newer code, you know the
format of data written by older code, and so you can explicitly handle it (if necessary by simply
keeping the old code to read the old data). Forward compatibility can be trickier, because it
requires older code to ignore additions made by a newer version of the code.</p>

<p>In this chapter we will look at several formats for encoding data, including JSON, XML, Protocol
Buffers, Thrift, and Avro. In particular, we will look at how they handle schema changes and how
they support systems where old and new data and code need to coexist. We will then discuss how those
formats are used for data storage and for communication: in web services, Representational State
Transfer (REST), and remote procedure calls (RPC), as well as message-passing systems such as actors
and message queues.</p>






<section data-type="sect1" data-pdf-bookmark="Formats for Encoding Data"><div class="sect1" id="sec_encoding_formats">
<h1>Formats for Encoding Data</h1>

<p><a data-type="indexterm" data-primary="encodings (data formats)" data-secondary="representations of data" id="idm140417570452768"></a>
<a data-type="indexterm" data-primary="memory" data-secondary="in-memory representation of data" id="idm140417570451600"></a>
<a data-type="indexterm" data-primary="byte sequence, encoding data in" id="idm140417570450480"></a>
Programs usually work with data in (at least) two different representations:</p>
<ol>
<li>
<p>In memory, data is kept in objects, structs, lists, arrays, hash tables, trees, and so on. These
data structures are optimized for efficient access and manipulation by the CPU (typically using
pointers).</p>
</li>
<li>
<p>When you want to write data to a file or send it over the network, you have to encode it as some
kind of self-contained sequence of bytes (for example, a JSON document). Since a pointer wouldn’t
make sense to any other process, this sequence-of-bytes representation looks quite different from
the data structures that are normally used in
memory.<sup xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook"><a data-type="noteref" id="idm140417570447152-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#idm140417570447152" class="totri-footnote">i</a></sup></p>
</li>

</ol>

<p><a data-type="indexterm" data-primary="encodings (data formats)" data-secondary="defined" id="idm140417570444800"></a>
<a data-type="indexterm" data-primary="marshalling" data-see="encoding" id="idm140417570443280"></a>
<a data-type="indexterm" data-primary="data formats" data-see="encoding" id="idm140417570442176"></a>
Thus, we need some kind of translation between the two representations. The translation from the
in-memory representation to a byte sequence is called <em>encoding</em> (also known as <em>serialization</em> or
<em>marshalling</em>), and the reverse is called <em>decoding</em> (<em>parsing</em>, <em>deserialization</em>,
<em>unmarshalling</em>).<sup xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook"><a data-type="noteref" id="idm140417570437856-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#idm140417570437856">ii</a></sup></p>
<div data-type="note" epub:type="note"><h1>Terminology clash</h1>
<p><a data-type="indexterm" data-primary="serialization" data-seealso="encoding" id="idm140417570435344"></a>
<em>Serialization</em> is unfortunately also used in the context of transactions (see <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch07.html#ch_transactions">Chapter&nbsp;7</a>),
with a completely different meaning. To avoid overloading the word we’ll stick with <em>encoding</em> in
this book, even though <em>serialization</em> is perhaps a more common term.</p>
</div>

<p>As this is such a common problem, there are a myriad different libraries and encoding formats to
choose from. Let’s do a brief overview.</p>








<section data-type="sect2" data-pdf-bookmark="Language-Specific Formats"><div class="sect2" id="idm140417570431072">
<h2>Language-Specific Formats</h2>

<p><a data-type="indexterm" data-primary="encodings (data formats)" data-secondary="language-specific formats" id="idm140417570429616"></a>
<a data-type="indexterm" data-primary="Serializable (Java)" id="idm140417570428032"></a>
<a data-type="indexterm" data-primary="pickle (Python)" id="idm140417570427200"></a>
<a data-type="indexterm" data-primary="Kryo (Java)" id="idm140417570426368"></a>
Many programming languages come with built-in support for encoding in-memory objects into byte
sequences. For example, Java has <code>java.io.Serializable</code>
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="JavaSerializable-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#JavaSerializable" class="totri-footnote">1</a>], Ruby has <code>Marshal</code>
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="RubyAPI-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#RubyAPI" class="totri-footnote">2</a>], Python has <code>pickle</code>
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="PythonPickle-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#PythonPickle" class="totri-footnote">3</a>],
and so on. Many third-party libraries also exist, such as Kryo for Java
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="JavaKryo-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#JavaKryo" class="totri-footnote">4</a>].</p>

<p>These encoding libraries are very convenient, because they allow in-memory objects to be saved and
restored with minimal additional code. However, they also have a number of deep problems:</p>

<ul>
<li>
<p>The encoding is often tied to a particular programming language, and reading the data in another
language is very difficult. If you store or transmit data in such an encoding, you are committing
yourself to your current programming language for potentially a very long time, and precluding
integrating your systems with those of other organizations (which may use different languages).</p>
</li>
<li>
<p>In order to restore data in the same object types, the decoding process needs to be able to
instantiate arbitrary classes. This is frequently a source of security problems
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="CWE502-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#CWE502" class="totri-footnote">5</a>]: if an attacker can get your application to decode an arbitrary
byte sequence, they can instantiate arbitrary classes, which in turn often allows them to do
terrible things such as remotely executing arbitrary code
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Breen2015up-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Breen2015up" class="totri-footnote">6</a>,
<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="McKenzie2013uv-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#McKenzie2013uv" class="totri-footnote">7</a>].</p>
</li>
<li>
<p>Versioning data is often an afterthought in these libraries: as they are intended for quick and
easy encoding of data, they often neglect the inconvenient problems of forward and backward
compatibility.</p>
</li>
<li>
<p>Efficiency (CPU time taken to encode or decode, and the size of the encoded structure) is also
often an afterthought. For example, Java’s built-in serialization is notorious for its bad
performance and bloated encoding [<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="JvmSerializers-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#JvmSerializers" class="totri-footnote">8</a>].</p>
</li>
</ul>

<p>For these reasons it’s generally a bad idea to use your language’s built-in encoding for anything
other than very transient purposes.</p>
</div></section>













<section data-type="sect2" data-pdf-bookmark="JSON, XML, and Binary Variants"><div class="sect2" id="sec_encoding_json">
<h2>JSON, XML, and Binary Variants</h2>

<p><a data-type="indexterm" data-primary="encodings (data formats)" data-secondary="JSON, XML, and CSV" id="idm140417570398608"></a>
<a data-type="indexterm" data-primary="XML" data-secondary="for application data, issues with" id="idm140417570397328"></a>
<a data-type="indexterm" data-primary="JSON" data-secondary="for application data, issues with" id="idm140417570396208"></a>
<a data-type="indexterm" data-primary="comma-separated values" data-see="CSV" id="idm140417570395088"></a>
<a data-type="indexterm" data-primary="CSV (comma-separated values)" id="idm140417570393984"></a>
Moving to standardized encodings that can be written and read by many programming languages, JSON
and XML are the obvious contenders. They are widely known, widely supported, and almost as widely
disliked. XML is often criticized for being too verbose and unnecessarily complicated
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="XMLSExp-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#XMLSExp" class="totri-footnote">9</a>]. JSON’s popularity is mainly due to its
built-in support in web browsers (by virtue of being a subset of JavaScript) and simplicity relative
to XML. CSV is another popular language-independent format, albeit less powerful.</p>

<p>JSON, XML, and CSV are textual formats, and thus somewhat human-readable (although the syntax is a
popular topic of debate). Besides the superficial syntactic issues, they also have some subtle
problems:</p>

<ul>
<li>
<p><a data-type="indexterm" data-primary="numbers, in XML and JSON encodings" id="idm140417570389056"></a>
<a data-type="indexterm" data-primary="datatypes" data-secondary="numbers in XML and JSON" id="idm140417570388208"></a>
There is a lot of ambiguity around the encoding of numbers. In XML and CSV, you cannot distinguish
between a number and a string that happens to consist of digits (except by referring to an external
schema). JSON distinguishes strings and numbers, but it doesn’t distinguish integers and
floating-point numbers, and it doesn’t specify a precision.</p>

<p>This is a problem when dealing with large numbers; for example, integers greater than 2<sup>53</sup> cannot
be exactly represented in an IEEE 754 double-precision floating-point number, so such numbers become
inaccurate when parsed in a language that uses floating-point numbers (such as JavaScript). An
example of numbers larger than 2<sup>53</sup> occurs on Twitter, which uses a 64-bit number to identify each
tweet. The JSON returned by Twitter’s API includes tweet IDs twice, once as a JSON number and once
as a decimal string, to work around the fact that the numbers are not correctly parsed by JavaScript
applications [<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Harris2010vu-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Harris2010vu">10</a>].</p>
</li>
<li>
<p><a data-type="indexterm" data-primary="binary strings, lack of support in JSON and XML" id="idm140417570382064"></a>
<a data-type="indexterm" data-primary="datatypes" data-secondary="binary strings in XML and JSON" id="idm140417570381200"></a>
JSON and XML have good support for Unicode character strings (i.e., human-readable text), but they
don’t support binary strings (sequences of bytes without a character encoding). Binary strings are a
useful feature, so people get around this limitation by encoding the binary data as text using
Base64. The schema is then used to indicate that the value should be interpreted as Base64-encoded.
This works, but it’s somewhat hacky and increases the data size by 33%.</p>
</li>
<li>
<p><a data-type="indexterm" data-primary="schemas" data-secondary="for JSON and XML" id="idm140417570378848"></a> There is optional schema support for both XML
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="W3CXMLSchema-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#W3CXMLSchema">11</a>] and JSON
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Galiegue2013wu-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Galiegue2013wu">12</a>].
These schema languages are quite powerful, and thus quite complicated to learn and implement. Use of
XML schemas is fairly widespread, but many JSON-based tools don’t bother using schemas. Since the
correct interpretation of data (such as numbers and binary strings) depends on information in the
schema, applications that don’t use XML/JSON schemas need to potentially hardcode the appropriate
encoding/decoding logic instead.</p>
</li>
<li>
<p>CSV does not have any schema, so it is up to the application to define the meaning of each row and
column. If an application change adds a new row or column, you have to handle that change manually.
CSV is also a quite vague format (what happens if a value contains a comma or a newline character?).
Although its escaping rules have been formally specified
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Shafranovich2005vq-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Shafranovich2005vq">13</a>],
not all parsers implement them correctly.</p>
</li>
</ul>

<p>Despite these flaws, JSON, XML, and CSV are good enough for many purposes. It’s likely that they will
remain popular, especially as data interchange formats (i.e., for sending data from one organization to
another). In these situations, as long as people agree on what the format is, it often doesn’t
matter how pretty or efficient the format is. The difficulty of getting different organizations to
agree on <em>anything</em> outweighs most other concerns.</p>










<section data-type="sect3" data-pdf-bookmark="Binary encoding"><div class="sect3" id="idm140417570369184">
<h3>Binary encoding</h3>

<p><a data-type="indexterm" data-primary="encodings (data formats)" data-secondary="binary variants of JSON and XML" id="idm140417570367584"></a>
<a data-type="indexterm" data-primary="binary data encodings" id="ix_bindata"></a>
For data that is used only internally within your organization, there is less pressure to use a
lowest-common-denominator encoding format. For example, you could choose a format that is more
compact or faster to parse. For a small dataset, the gains are negligible, but once you get into the
terabytes, the choice of data format can have a big impact.</p>

<p><a data-type="indexterm" data-primary="JSON" data-secondary="binary variants" id="idm140417570364672"></a>
<a data-type="indexterm" data-primary="XML" data-secondary="binary variants" id="idm140417570363568"></a>
JSON is less verbose than XML, but both still use a lot of space compared to binary formats. This
observation led to the development of a profusion of binary encodings for JSON (MessagePack, BSON,
BJSON, UBJSON, BISON, and Smile, to name a few) and for XML (WBXML and Fast Infoset, for example).
These formats have been adopted in various niches, but none of them are as widely adopted as the
textual versions of JSON and XML.</p>

<p>Some of these formats extend the set of datatypes (e.g., distinguishing integers and floating-point numbers,
or adding support for binary strings), but otherwise they keep the JSON/XML data model unchanged. In
particular, since they don’t prescribe a schema, they need to include all the object field names within
the encoded data. That is, in a binary encoding of the JSON document in <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#fig_encoding_json">Example&nbsp;4-1</a>, they
will need to include the strings <code>userName</code>, <code>favoriteNumber</code>, and <code>interests</code> somewhere.</p>
<div id="fig_encoding_json" data-type="example">
<h5><span class="label">Example 4-1. </span>Example record which we will encode in several binary formats in this chapter</h5>

<pre data-type="programlisting" data-code-language="javascript"><code class="p">{</code>
    <code class="s2">"userName"</code><code class="o">:</code> <code class="s2">"Martin"</code><code class="p">,</code>
    <code class="s2">"favoriteNumber"</code><code class="o">:</code> <code class="mi">1337</code><code class="p">,</code>
    <code class="s2">"interests"</code><code class="o">:</code> <code class="p">[</code><code class="s2">"daydreaming"</code><code class="p">,</code> <code class="s2">"hacking"</code><code class="p">]</code>
<code class="p">}</code></pre></div>

<p><a data-type="indexterm" data-primary="binary data encodings" data-secondary="MessagePack" id="ix_bindatamsgpack"></a>
<a data-type="indexterm" data-primary="MessagePack (encoding format)" id="idm140417570337920"></a>
Let’s look at an example of MessagePack, a binary encoding for JSON. <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#fig_encoding_messagepack">Figure&nbsp;4-1</a>
shows the byte sequence that you get if you encode the JSON document in <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#fig_encoding_json">Example&nbsp;4-1</a> with
MessagePack [<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="MsgPack-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#MsgPack">14</a>]. The first few bytes are as follows:</p>
<ol>
<li>
<p>The first byte, <code>0x83</code>, indicates that what follows is an object (top four bits = <code>0x80</code>) with three
fields (bottom four bits = <code>0x03</code>). (In case you’re wondering what happens if an object has more
than 15 fields, so that the number of fields doesn’t fit in four bits, it then gets a different type
indicator, and the number of fields is encoded in two or four bytes.)</p>
</li>
<li>
<p>The second byte, <code>0xa8</code>, indicates that what follows is a string (top four bits = <code>0xa0</code>) that is eight
bytes long (bottom four bits = <code>0x08</code>).</p>
</li>
<li>
<p>The next eight bytes are the field name <code>userName</code> in ASCII. Since the length was indicated
previously, there’s no need for any marker to tell us where the string ends (or any escaping).</p>
</li>
<li>
<p>The next seven bytes encode the six-letter string value <code>Martin</code> with a prefix <code>0xa6</code>, and so on.</p>
</li>

</ol>

<p>The binary encoding is 66 bytes long, which is only a little less than the 81 bytes taken by the
textual JSON encoding (with whitespace removed). All the binary encodings of JSON are similar in
this regard. It’s not clear whether such a small space reduction (and perhaps a speedup in parsing)
is worth the loss of human-readability.</p>

<p>In the following sections we will see how we can do much better, and encode the same record in just
32 bytes.</p>

<figure><div id="fig_encoding_messagepack" class="figure">
<img src="https://www.safaribooksonline.com/library/view/designing-data-intensive-applications/9781491903063/assets/ddia_0401.png" alt="ddia 0401" width="2880" height="2432" data-mfp-src="/library/view/designing-data-intensive-applications/9781491903063/assets/ddia_0401.png">
<h6><span class="label">Figure 4-1. </span>Example record (<a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#fig_encoding_json">Example&nbsp;4-1</a>) encoded using MessagePack.</h6>
</div></figure>

<p><a data-type="indexterm" data-primary="binary data encodings" data-secondary="MessagePack" data-startref="ix_bindatamsgpack" id="idm140417570320656"></a></p>
</div></section>



</div></section>













<section data-type="sect2" data-pdf-bookmark="Thrift and Protocol Buffers"><div class="sect2" id="sec_encoding_thrift_protobuf">
<h2>Thrift and Protocol Buffers</h2>

<p><a data-type="indexterm" data-primary="encodings (data formats)" data-secondary="Thrift and Protocol Buffers" id="ix_encodeThriftPB"></a>
<a data-type="indexterm" data-primary="Protocol Buffers (data format)" id="ix_ProtoBuff"></a>
<a data-type="indexterm" data-primary="Thrift (data format)" id="ix_Thrift"></a><a data-type="indexterm" data-primary="Apache Thrift" data-see="Thrift" id="idm140417570313920"></a>
<a data-type="indexterm" data-primary="binary data encodings" data-secondary="Thrift and Protocol Buffers" id="ix_bindatathrift"></a>
Apache Thrift [<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Slee2007vh-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Slee2007vh">15</a>]
and Protocol Buffers (protobuf)
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="GoogleProtobuf-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#GoogleProtobuf">16</a>]
are binary encoding libraries that are based on the same principle. Protocol Buffers was originally
developed at Google, Thrift was originally developed at Facebook, and both were made open source in
2007–08 [<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Anishchenko2012tx-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Anishchenko2012tx">17</a>].</p>

<p><a data-type="indexterm" data-primary="schemas" data-secondary="Thrift and Protocol Buffers" id="ix_schemathriftpb"></a>
<a data-type="indexterm" data-primary="Interface Definition Language (IDL)" id="idm140417570303504"></a>
Both Thrift and Protocol Buffers require a schema for any data that is encoded. To encode the data
in <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#fig_encoding_json">Example&nbsp;4-1</a> in Thrift, you would describe the schema in the Thrift interface
definition language (IDL) like this:</p>

<pre data-type="programlisting" data-code-language="cpp"><code class="k">struct</code> <code class="n">Person</code> <code class="p">{</code>
  <code class="mi">1</code><code class="o">:</code> <code class="n">required</code> <code class="n">string</code>       <code class="n">userName</code><code class="p">,</code>
  <code class="mi">2</code><code class="o">:</code> <code class="n">optional</code> <code class="n">i64</code>          <code class="n">favoriteNumber</code><code class="p">,</code>
  <code class="mi">3</code><code class="o">:</code> <code class="n">optional</code> <code class="n">list</code><code class="o">&lt;</code><code class="n">string</code><code class="o">&gt;</code> <code class="n">interests</code>
<code class="p">}</code></pre>

<p class="pagebreak-before">The equivalent schema definition for Protocol Buffers looks very similar:</p>

<pre data-type="programlisting" data-code-language="cpp"><code class="n">message</code> <code class="n">Person</code> <code class="p">{</code>
    <code class="n">required</code> <code class="n">string</code> <code class="n">user_name</code>       <code class="o">=</code> <code class="mi">1</code><code class="p">;</code>
    <code class="n">optional</code> <code class="n">int64</code>  <code class="n">favorite_number</code> <code class="o">=</code> <code class="mi">2</code><code class="p">;</code>
    <code class="n">repeated</code> <code class="n">string</code> <code class="n">interests</code>       <code class="o">=</code> <code class="mi">3</code><code class="p">;</code>
<code class="p">}</code></pre>

<p><a data-type="indexterm" data-primary="code generation" data-secondary="with Thrift and Protocol Buffers" id="idm140417570220544"></a>
Thrift and Protocol Buffers each come with a code generation tool that takes a schema definition
like the ones shown here, and produces classes that implement the schema in various programming languages
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="ThriftLangs-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#ThriftLangs">18</a>]. Your application code can call this generated code to encode
or decode records of the schema.</p>

<p><a data-type="indexterm" data-primary="BinaryProtocol encoding (Thrift)" id="idm140417570112000"></a>
<a data-type="indexterm" data-primary="Thrift (data format)" data-secondary="BinaryProtocol" id="idm140417570111040"></a>
What does data encoded with this schema look like? Confusingly, Thrift has two different binary
encoding formats,<sup xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook"><a data-type="noteref" id="idm140417570109808-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#idm140417570109808">iii</a></sup>
called <em>BinaryProtocol</em> and <em>CompactProtocol</em>, respectively. Let’s look at BinaryProtocol first.
Encoding <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#fig_encoding_json">Example&nbsp;4-1</a> in that format takes 59 bytes, as shown in
<a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#fig_encoding_thrift_binary">Figure&nbsp;4-2</a> [<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Kleppmann2012tu-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Kleppmann2012tu">19</a>].</p>

<figure><div id="fig_encoding_thrift_binary" class="figure">
<img src="https://www.safaribooksonline.com/library/view/designing-data-intensive-applications/9781491903063/assets/ddia_0402.png" alt="ddia 0402" width="2880" height="2154" data-mfp-src="/library/view/designing-data-intensive-applications/9781491903063/assets/ddia_0402.png">
<h6><span class="label">Figure 4-2. </span>Example record encoded using Thrift’s BinaryProtocol.</h6>
</div></figure>

<p><a data-type="indexterm" data-primary="ASCII text" id="idm140417570100144"></a>
Similarly to <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#fig_encoding_messagepack">Figure&nbsp;4-1</a>, each field has a type annotation (to indicate whether it
is a string, integer, list, etc.) and, where required, a length indication (length of a string,
number of items in a list). The strings that appear in the data (“Martin”, “daydreaming”, “hacking”)
are also encoded as ASCII (or rather, UTF-8), similar to before.</p>

<p><a data-type="indexterm" data-primary="field tags (Thrift and Protocol Buffers)" id="ix_fieldtags"></a>
The big difference compared to <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#fig_encoding_messagepack">Figure&nbsp;4-1</a> is that there are no field names
(<code>userName</code>, <code>favoriteNumber</code>, <code>interests</code>). Instead, the encoded data contains <em>field tags</em>, which
are numbers (<code>1</code>, <code>2</code>, and <code>3</code>). Those are the numbers that appear in the schema definition. Field tags
are like aliases for fields—they are a compact way of saying what field we’re talking about,
without having to spell out the field name.</p>

<p><a data-type="indexterm" data-primary="CompactProtocol encoding (Thrift)" id="idm140417570092240"></a>
<a data-type="indexterm" data-primary="Thrift (data format)" data-secondary="CompactProtocol" id="idm140417570091392"></a>
The Thrift CompactProtocol encoding is semantically equivalent to BinaryProtocol, but as you can see
in <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#fig_encoding_thrift_compact">Figure&nbsp;4-3</a>, it packs the same information into only 34 bytes. It does this
by packing the field type and tag number into a single byte, and by using variable-length integers.
Rather than using a full eight bytes for the number 1337, it is encoded in two bytes, with the top bit
of each byte used to indicate whether there are still more bytes to come. This means numbers between –64
and 63 are encoded in one byte, numbers between –8192 and 8191 are encoded in two bytes, etc. Bigger
numbers use more bytes.</p>

<figure><div id="fig_encoding_thrift_compact" class="figure">
<img src="https://www.safaribooksonline.com/library/view/designing-data-intensive-applications/9781491903063/assets/ddia_0403.png" alt="ddia 0403" width="2880" height="1968" data-mfp-src="/library/view/designing-data-intensive-applications/9781491903063/assets/ddia_0403.png">
<h6><span class="label">Figure 4-3. </span>Example record encoded using Thrift’s CompactProtocol.</h6>
</div></figure>

<p>Finally, Protocol Buffers (which has only one binary encoding format) encodes the same data as shown
in <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#fig_encoding_protobuf">Figure&nbsp;4-4</a>. It does the bit packing slightly differently, but is otherwise very
similar to Thrift’s CompactProtocol. Protocol Buffers fits the same record in 33 bytes.</p>

<figure><div id="fig_encoding_protobuf" class="figure">
<img src="https://www.safaribooksonline.com/library/view/designing-data-intensive-applications/9781491903063/assets/ddia_0404.png" alt="ddia 0404" width="2880" height="1775" data-mfp-src="/library/view/designing-data-intensive-applications/9781491903063/assets/ddia_0404.png">
<h6><span class="label">Figure 4-4. </span>Example record encoded using Protocol Buffers.</h6>
</div></figure>

<p>One detail to note: in the schemas shown earlier, each field was marked either <code>required</code> or <code>optional</code>, but
this makes no difference to how the field is encoded (nothing in the binary data indicates whether a
field was required). The difference is simply that <code>required</code> enables a runtime check that fails if
the field is not set, which can be useful for catching bugs.</p>










<section data-type="sect3" data-pdf-bookmark="Field tags and schema evolution"><div class="sect3" id="idm140417570081280">
<h3>Field tags and schema evolution</h3>

<p><a data-type="indexterm" data-primary="evolvability" data-secondary="schema evolution in Thrift and Protocol Buffers" id="idm140417570200608"></a>
<a data-type="indexterm" data-primary="Protocol Buffers (data format)" data-secondary="field tags and schema evolution" id="idm140417570199472"></a>
<a data-type="indexterm" data-primary="Thrift (data format)" data-secondary="field tags and schema evolution" id="idm140417570198288"></a>
<a data-type="indexterm" data-primary="schemas" data-secondary="Thrift and Protocol Buffers" data-tertiary="schema evolution" id="idm140417570197168"></a>
We said previously that schemas inevitably need to change over time. We call this <em>schema
evolution</em>. How do Thrift and Protocol Buffers handle schema changes while keeping backward and
forward compatibility?</p>

<p>As you can see from the examples, an encoded record is just the concatenation of its encoded fields.
Each field is identified by its tag number (the numbers <code>1</code>, <code>2</code>, <code>3</code> in the sample schemas) and
annotated with a datatype (e.g., string or integer). If a field value is not set, it is simply
omitted from the encoded record. From this you can see that field tags are critical to the meaning
of the encoded data. You can change the name of a field in the schema, since the encoded data never
refers to field names, but you cannot change a field’s tag, since that would make all existing
encoded data <span class="keep-together">invalid.</span></p>

<p>You can add new fields to the schema, provided that you give each field a new tag number. If old
code (which doesn’t know about the new tag numbers you added) tries to read data written by new
code, including a new field with a tag number it doesn’t recognize, it can simply ignore that field.
The datatype annotation allows the parser to determine how many bytes it needs to skip. This
maintains forward compatibility: old code can read records that were written by new code.</p>

<p>What about backward compatibility? As long as each field has a unique tag number, new code can
always read old data, because the tag numbers still have the same meaning. The only detail is that
if you add a new field, you cannot make it required. If you were to add a field and make it
required, that check would fail if new code read data written by old code, because the old code will
not have written the new field that you added. Therefore, to maintain backward compatibility, every
field you add after the initial deployment of the schema must be optional or have a default value.</p>

<p>Removing a field is just like adding a field, with backward and forward compatibility concerns
reversed. That means you can only remove a field that is optional (a required field can never be
removed), and you can never use the same tag number again (because you may still have data written
somewhere that includes the old tag number, and that field must be ignored by new code).
<a data-type="indexterm" data-primary="field tags (Thrift and Protocol Buffers)" data-startref="ix_fieldtags" id="idm140417570189600"></a></p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Datatypes and schema evolution"><div class="sect3" id="idm140417570188464">
<h3>Datatypes and schema evolution</h3>

<p><a data-type="indexterm" data-primary="datatypes" data-secondary="in Thrift and Protocol Buffers" id="idm140417570187328"></a>
What about changing the datatype of a field? That may be possible—check the documentation for
details—but there is a risk that values will lose precision or get truncated. For example, say you
change a 32-bit integer into a 64-bit integer. New code can easily read data written by old code,
because the parser can fill in any missing bits with zeros. However, if old code reads data written
by new code, the old code is still using a 32-bit variable to hold the value. If the decoded 64-bit
value won’t fit in 32 bits, it will be truncated.</p>

<p>A curious detail of Protocol Buffers is that it does not have a list or array datatype, but instead
has a <code>repeated</code> marker for fields (which is a third option alongside <code>required</code> and <code>optional</code>). As
you can see in <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#fig_encoding_protobuf">Figure&nbsp;4-4</a>, the encoding of a <code>repeated</code> field is just what it says on
the tin: the same field tag simply appears multiple times in the record. This has the nice effect
that it’s okay to change an <code>optional</code> (single-valued) field into a <code>repeated</code> (multi-valued) field.
New code reading old data sees a list with zero or one elements (depending on whether the field was
present); old code reading new data sees only the last element of the list.</p>

<p>Thrift has a dedicated list datatype, which is parameterized with the datatype of the list
elements. This does not allow the same evolution from single-valued to multi-valued as Protocol
Buffers does, but it has the advantage of supporting nested lists.
<a data-type="indexterm" data-primary="Protocol Buffers (data format)" data-startref="ix_ProtoBuff" id="idm140417570180576"></a>
<a data-type="indexterm" data-primary="Thrift (data format)" data-startref="ix_Thrift" id="idm140417570179408"></a>
<a data-type="indexterm" data-primary="binary data encodings" data-secondary="Thrift and Protocol Buffers" data-startref="ix_bindatathrift" id="idm140417570178304"></a>
<a data-type="indexterm" data-primary="encodings (data formats)" data-secondary="Thift and Protocol Buffers" data-startref="ix_encodeThriftPB" id="idm140417570176912"></a>
<a data-type="indexterm" data-primary="schemas" data-secondary="Thrift and Protocol Buffers" data-startref="ix_schemathriftpb" id="idm140417570175504"></a></p>
</div></section>



</div></section>













<section data-type="sect2" data-pdf-bookmark="Avro"><div class="sect2" id="sec_encoding_avro">
<h2>Avro</h2>

<p><a data-type="indexterm" data-primary="binary data encodings" data-secondary="Avro" id="ix_bindataavro"></a>
<a data-type="indexterm" data-primary="encodings (data formats)" data-secondary="Avro" id="ix_encodeAvro"></a>
<a data-type="indexterm" data-primary="Avro (data format)" id="ix_Avro"></a><a data-type="indexterm" data-primary="Apache Avro" data-see="Avro" id="idm140417570168416"></a>
Apache Avro
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="ApacheAvro-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#ApacheAvro">20</a>] is another binary
encoding format that is interestingly different from Protocol Buffers and Thrift. It was started in
2009 as a subproject of Hadoop, as a result of Thrift not being a good fit for Hadoop’s use cases
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Cutting2009tu-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Cutting2009tu">21</a>].</p>

<p><a data-type="indexterm" data-primary="schemas" data-secondary="Avro" id="ix_schemasavro"></a>
<a data-type="indexterm" data-primary="Interface Definition Language (IDL)" id="idm140417570160704"></a>
Avro also uses a schema to specify the structure of the data being encoded. It has two schema
languages: one (Avro IDL) intended for human editing, and one (based on JSON) that is more easily
machine-readable.</p>

<p>Our example schema, written in Avro IDL, might look like this:</p>

<pre data-type="programlisting" data-code-language="cpp"><code class="n">record</code> <code class="n">Person</code> <code class="p">{</code>
    <code class="n">string</code>               <code class="n">userName</code><code class="p">;</code>
    <code class="k">union</code> <code class="p">{</code> <code class="n">null</code><code class="p">,</code> <code class="kt">long</code> <code class="p">}</code> <code class="n">favoriteNumber</code> <code class="o">=</code> <code class="n">null</code><code class="p">;</code>
    <code class="n">array</code><code class="o">&lt;</code><code class="n">string</code><code class="o">&gt;</code>        <code class="n">interests</code><code class="p">;</code>
<code class="p">}</code></pre>

<p><a data-type="indexterm" data-primary="JSON" data-secondary="Avro schema representation" id="idm140417570157552"></a>
The equivalent JSON representation of that schema is as follows:</p>

<pre data-type="programlisting" data-code-language="javascript"><code class="p">{</code>
    <code class="s2">"type"</code><code class="o">:</code> <code class="s2">"record"</code><code class="p">,</code>
    <code class="s2">"name"</code><code class="o">:</code> <code class="s2">"Person"</code><code class="p">,</code>
    <code class="s2">"fields"</code><code class="o">:</code> <code class="p">[</code>
        <code class="p">{</code><code class="s2">"name"</code><code class="o">:</code> <code class="s2">"userName"</code><code class="p">,</code>       <code class="s2">"type"</code><code class="o">:</code> <code class="s2">"string"</code><code class="p">},</code>
        <code class="p">{</code><code class="s2">"name"</code><code class="o">:</code> <code class="s2">"favoriteNumber"</code><code class="p">,</code> <code class="s2">"type"</code><code class="o">:</code> <code class="p">[</code><code class="s2">"null"</code><code class="p">,</code> <code class="s2">"long"</code><code class="p">],</code> <code class="s2">"default"</code><code class="o">:</code> <code class="kc">null</code><code class="p">},</code>
        <code class="p">{</code><code class="s2">"name"</code><code class="o">:</code> <code class="s2">"interests"</code><code class="p">,</code>      <code class="s2">"type"</code><code class="o">:</code> <code class="p">{</code><code class="s2">"type"</code><code class="o">:</code> <code class="s2">"array"</code><code class="p">,</code> <code class="s2">"items"</code><code class="o">:</code> <code class="s2">"string"</code><code class="p">}}</code>
    <code class="p">]</code>
<code class="p">}</code></pre>

<p>First of all, notice that there are no tag numbers in the schema. If we encode our example record
(<a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#fig_encoding_json">Example&nbsp;4-1</a>) using this schema, the Avro binary encoding is just 32 bytes long—the
most compact of all the encodings we have seen. The breakdown of the encoded byte sequence is shown
in <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#fig_encoding_avro">Figure&nbsp;4-5</a>.</p>

<p><a data-type="indexterm" data-primary="datatypes" data-secondary="in Avro encodings" id="idm140417569991776"></a>
If you examine the byte sequence, you can see that there is nothing to identify fields or their
datatypes. The encoding simply consists of values concatenated together. A string is just a length
prefix followed by UTF-8 bytes, but there’s nothing in the encoded data that tells you that it is a
string. It could just as well be an integer, or something else entirely. An integer is encoded using
a variable-length encoding (the same as Thrift’s CompactProtocol).</p>

<figure><div id="fig_encoding_avro" class="figure">
<img src="https://www.safaribooksonline.com/library/view/designing-data-intensive-applications/9781491903063/assets/ddia_0405.png" alt="ddia 0405" width="2880" height="1900" data-mfp-src="/library/view/designing-data-intensive-applications/9781491903063/assets/ddia_0405.png">
<h6><span class="label">Figure 4-5. </span>Example record encoded using Avro.</h6>
</div></figure>

<p>To parse the binary data, you go through the fields in the order that they appear in the schema and
use the schema to tell you the datatype of each field. This means that the binary data can only be
decoded correctly if the code reading the data is using the <em>exact same schema</em> as the code that
wrote the data. Any mismatch in the schema between the reader and the writer would mean incorrectly
decoded data.</p>

<p>So, how does Avro support schema evolution?</p>










<section data-type="sect3" data-pdf-bookmark="The writer’s schema and the reader’s schema"><div class="sect3" id="idm140417569986400">
<h3>The writer’s schema and the reader’s schema</h3>

<p><a data-type="indexterm" data-primary="Avro (data format)" data-secondary="schema evolution" id="idm140417569984992"></a>
<a data-type="indexterm" data-primary="evolvability" data-secondary="schema evolution in Avro" id="idm140417569983888"></a>
<a data-type="indexterm" data-primary="schemas" data-secondary="Avro" data-tertiary="schema evolution" id="idm140417569982816"></a>
With Avro, when an application wants to encode some data (to write it to a file or database, to send
it over the network, etc.), it encodes the data using whatever version of the schema it knows
about—for example, that schema may be compiled into the application. This is known as the
<em>writer’s schema</em>.</p>

<p>When an application wants to decode some data (read it from a file or database, receive it from the
network, etc.), it is expecting the data to be in some schema, which is known as the <em>reader’s
schema</em>. That is the schema the application code is relying on—code may have been generated from
that schema during the application’s build process.</p>

<p>The key idea with Avro is that the writer’s schema and the reader’s schema <em>don’t have to be the
same</em>—they only need to be compatible. When data is decoded (read), the Avro library resolves the
differences by looking at the writer’s schema and the reader’s schema side by side and translating
the data from the writer’s schema into the reader’s schema. The Avro specification
[<a data-type="noteref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#ApacheAvro">20</a>] defines exactly how this resolution works,
and it is illustrated in <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#fig_encoding_avro_resolution">Figure&nbsp;4-6</a>.</p>

<p>For example, it’s no problem if the writer’s schema and the reader’s schema have their fields in a
different order, because the schema resolution matches up the fields by field name. If the code
reading the data encounters a field that appears in the writer’s schema but not in the reader’s
schema, it is ignored. If the code reading the data expects some field, but the writer’s schema does
not contain a field of that name, it is filled in with a default value declared in the reader’s
schema.</p>

<figure><div id="fig_encoding_avro_resolution" class="figure">
<img src="https://www.safaribooksonline.com/library/view/designing-data-intensive-applications/9781491903063/assets/ddia_0406.png" alt="ddia 0406" width="2880" height="1033" data-mfp-src="/library/view/designing-data-intensive-applications/9781491903063/assets/ddia_0406.png">
<h6><span class="label">Figure 4-6. </span>An Avro reader resolves differences between the writer’s schema and the reader’s schema.</h6>
</div></figure>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Schema evolution rules"><div class="sect3" id="idm140417569973696">
<h3>Schema evolution rules</h3>

<p>With Avro, forward compatibility means that you can have a new version of the schema as writer and
an old version of the schema as reader. Conversely, backward compatibility means that you can have a
new version of the schema as reader and an old version as writer.</p>

<p>To maintain compatibility, you may only add or remove a field that has a default value. (The field
<code>favoriteNumber</code> in our Avro schema has a default value of <code>null</code>.) For example, say you add a
field with a default value, so this new field exists in the new schema but not the old one. When a
reader using the new schema reads a record written with the old schema, the default value is filled
in for the missing field.</p>

<p>If you were to add a field that has no default value, new readers wouldn’t be able to read data
written by old writers, so you would break backward compatibility. If you were to remove a field
that has no default value, old readers wouldn’t be able to read data written by new writers, so you
would break forward compatibility.</p>

<p><a data-type="indexterm" data-primary="union type (in Avro)" id="idm140417569937056"></a>
In some programming languages, <code>null</code> is an acceptable default for any variable, but this is not the
case in Avro: if you want to allow a field to be null, you have to use a <em>union type</em>. For example,
<code>union { null, long, string } field;</code> indicates that <code>field</code> can be a number, or a string, or null.
You can only use <code>null</code> as a default value if it is one of the branches of the
union.<sup xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook"><a data-type="noteref" id="idm140417569933760-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#idm140417569933760">iv</a></sup> This is a little more verbose than having
everything nullable by default, but it helps prevent bugs by being explicit about what can and
cannot be null [<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Hoare2009vv-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Hoare2009vv">22</a>].</p>

<p>Consequently, Avro doesn’t have <code>optional</code> and <code>required</code> markers in the same way as Protocol
Buffers and Thrift do (it has union types and default values instead).</p>

<p>Changing the datatype of a field is possible, provided that Avro can convert the type. Changing the
name of a field is possible but a little tricky: the reader’s schema can contain aliases for field
names, so it can match an old writer’s schema field names against the aliases. This means that
changing a field name is backward compatible but not forward compatible. Similarly, adding a branch
to a union type is backward compatible but not forward compatible.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="But what is the writer’s schema?"><div class="sect3" id="idm140417569927424">
<h3>But what is the writer’s schema?</h3>

<p><a data-type="indexterm" data-primary="Avro (data format)" data-secondary="reader determining writer’s schema" id="idm140417569926176"></a>
<a data-type="indexterm" data-primary="schemas" data-secondary="Avro" data-tertiary="reader determining writer’s schema" id="idm140417569925008"></a>
There is an important question that we’ve glossed over so far: how does the reader know the writer’s
schema with which a particular piece of data was encoded? We can’t just include the entire schema
with every record, because the schema would likely be much bigger than the encoded data, making all
the space savings from the binary encoding futile.</p>

<p>The answer depends on the context in which Avro is being used. To give a few examples:</p>
<dl>
<dt>Large file with lots of records</dt>
<dd>
<p><a data-type="indexterm" data-primary="Avro (data format)" data-secondary="object container files" id="idm140417569921296"></a>
A common use for Avro—especially in the context of Hadoop—is for storing a large file
containing millions of records, all encoded with the same schema. (We will discuss this kind of
situation in <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch10.html#ch_batch">Chapter&nbsp;10</a>.) In this case, the writer of that file can just include the writer’s
schema once at the beginning of the file. Avro specifies a file format (object container files) to
do this.</p>
</dd>
<dt>Database with individually written records</dt>
<dd>
<p>In a database, different records may be written at different points in time using different
writer’s schemas—you cannot assume that all the records will have the same schema. The simplest
solution is to include a version number at the beginning of every encoded record, and to keep a
list of schema versions in your database. A reader can fetch a record, extract the version number,
and then fetch the writer’s schema for that version number from the database. Using that writer’s
schema, it can decode the rest of the record.
<a data-type="indexterm" data-primary="LinkedIn" data-secondary="Espresso (database)" id="idm140417569917120"></a> (Espresso
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Auradkar2015wz-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Auradkar2015wz">23</a>]
works this way, for example.)</p>
</dd>
<dt>Sending records over a network connection</dt>
<dd>
<p><a data-type="indexterm" data-primary="remote procedure calls (RPCs)" data-secondary="using Avro" id="idm140417569912576"></a>
When two processes are communicating over a bidirectional network connection, they can negotiate
the schema version on connection setup and then use that schema for the lifetime of the
connection. The Avro RPC protocol (see <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#sec_encoding_dataflow_rpc">“Dataflow Through Services: REST and RPC”</a>) works like this.</p>
</dd>
</dl>

<p><a data-type="indexterm" data-primary="schemas" data-secondary="evolution of" data-tertiary="compatibility checking" id="idm140417569909936"></a>
A database of schema versions is a useful thing to have in any case, since it acts as documentation
and gives you a chance to check schema compatibility
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Kreps2015ux-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Kreps2015ux">24</a>].
As the version number, you could use a simple incrementing integer, or you could use a hash of the
schema.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Dynamically generated schemas"><div class="sect3" id="idm140417569905904">
<h3>Dynamically generated schemas</h3>

<p><a data-type="indexterm" data-primary="schemas" data-secondary="dynamically generated" id="idm140417569904496"></a>
<a data-type="indexterm" data-primary="Avro (data format)" data-secondary="dynamically generated schemas" id="idm140417569903392"></a>
One advantage of Avro’s approach, compared to Protocol Buffers and Thrift, is that the schema
doesn’t contain any tag numbers. But why is this important? What’s the problem with keeping a couple
of numbers in the schema?</p>

<p>The difference is that Avro is friendlier to <em>dynamically generated</em> schemas. For example, say
you have a relational database whose contents you want to dump to a file, and you want to use a
binary format to avoid the aforementioned problems with textual formats (JSON, CSV, XML). If you use
Avro, you can fairly easily generate an Avro schema (in the JSON representation we saw earlier) from the
relational schema and encode the database contents using that schema, dumping it all to an Avro
object container file [<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Shapira2014wf-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Shapira2014wf">25</a>]. You generate a record schema
for each database table, and each column becomes a field in that record. The column name in the
database maps to the field name in Avro.</p>

<p>Now, if the database schema changes (for example, a table has one column added and one column
removed), you can just generate a new Avro schema from the updated database schema and export data in
the new Avro schema. The data export process does not need to pay any attention to the schema
change—it can simply do the schema conversion every time it runs. Anyone who reads the new data
files will see that the fields of the record have changed, but since the fields are identified by
name, the updated writer’s schema can still be matched up with the old reader’s schema.</p>

<p>By contrast, if you were using Thrift or Protocol Buffers for this purpose, the field tags would
likely have to be assigned by hand: every time the database schema changes, an administrator would
have to manually update the mapping from database column names to field tags. (It might be possible
to automate this, but the schema generator would have to be very careful to not assign previously
used field tags.) This kind of dynamically generated schema simply wasn’t a design goal of Thrift or
Protocol Buffers, whereas it was for Avro.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Code generation and dynamically typed languages"><div class="sect3" id="sec_encoding_code_generation">
<h3>Code generation and dynamically typed languages</h3>

<p><a data-type="indexterm" data-primary="code generation" data-secondary="with Avro" id="idm140417569894672"></a>
<a data-type="indexterm" data-primary="Avro (data format)" data-secondary="code generation" id="idm140417569893568"></a>
<a data-type="indexterm" data-primary="statically typed languages" data-secondary="code generation and" id="idm140417569892464"></a>
Thrift and Protocol Buffers rely on code generation: after a schema has been defined, you can
generate code that implements this schema in a programming language of your choice. This is useful
in statically typed languages such as Java, C++, or C#, because it allows efficient in-memory
structures to be used for decoded data, and it allows type checking and autocompletion in IDEs when
writing programs that access the data structures.</p>

<p><a data-type="indexterm" data-primary="dynamically typed languages" data-secondary="code generation and" id="idm140417569890640"></a>
In dynamically typed programming languages such as JavaScript, Ruby, or Python, there is not much
point in generating code, since there is no compile-time type checker to satisfy. Code generation is
often frowned upon in these languages, since they otherwise avoid an explicit compilation step.
Moreover, in the case of a dynamically generated schema (such as an Avro schema generated from a
database table), code generation is an unnecessary obstacle to getting to the data.</p>

<p><a data-type="indexterm" data-primary="self-describing files" id="idm140417569888768"></a>
Avro provides optional code generation for statically typed programming languages, but it can be
used just as well without any code generation. If you have an object container file (which embeds
the writer’s schema), you can simply open it using the Avro library and look at the data in the
same way as you could look at a JSON file. The file is <em>self-describing</em> since it includes all the
necessary metadata.</p>

<p>This property is especially useful in conjunction with dynamically typed data processing languages like
Apache Pig [<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="ApachePig-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#ApachePig">26</a>]. In Pig, you can just open
some Avro files, start analyzing them, and write derived datasets to output files in Avro format
without even thinking about schemas.
<a data-type="indexterm" data-primary="Avro (data format)" data-startref="ix_Avro" id="idm140417569884288"></a>
<a data-type="indexterm" data-primary="binary data encodings" data-secondary="Avro" data-startref="ix_bindataavro" id="idm140417569883184"></a>
<a data-type="indexterm" data-primary="encodings (data formats)" data-secondary="Avro" data-startref="ix_encodeAvro" id="idm140417569881808"></a>
<a data-type="indexterm" data-primary="schemas" data-secondary="Avro" data-startref="ix_schemasavro" id="idm140417569880368"></a></p>
</div></section>



</div></section>













<section data-type="sect2" data-pdf-bookmark="The Merits of Schemas"><div class="sect2" id="sec_encoding_schemas">
<h2>The Merits of Schemas</h2>

<p><a data-type="indexterm" data-primary="encodings (data formats)" data-secondary="merits of schemas" id="idm140417569877440"></a>
<a data-type="indexterm" data-primary="schemas" data-secondary="merits of" id="idm140417569876368"></a>
<a data-type="indexterm" data-primary="binary encoding" data-secondary="based on schemas" id="idm140417569875264"></a>
As we saw, Protocol Buffers, Thrift, and Avro all use a schema to describe a binary encoding format.
Their schema languages are much simpler than XML Schema or JSON Schema, which support much more
detailed validation rules (e.g., “the string value of this field must match this regular expression”
or “the integer value of this field must be between 0 and 100”). As Protocol Buffers, Thrift, and
Avro are simpler to implement and simpler to use, they have grown to support a fairly wide range of
programming languages.</p>

<p><a data-type="indexterm" data-primary="ASN.1 (schema language)" id="idm140417569873360"></a>
The ideas on which these encodings are based are by no means new. For example, they have a lot in
common with ASN.1, a schema definition language that was first standardized in 1984
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Larmouth1999-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Larmouth1999">27</a>].
It was used to define various network protocols, and its binary encoding (DER) is still used to encode
SSL certificates (X.509), for example
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Housley1999tv-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Housley1999tv">28</a>].
ASN.1 supports schema evolution using tag numbers, similar to Protocol Buffers and Thrift
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Walkin2010ur-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Walkin2010ur">29</a>].
However, it’s also very complex and badly documented, so <span class="keep-together">ASN.1</span>
is probably not a good choice for new applications.</p>

<p><a data-type="indexterm" data-primary="binary encoding" data-secondary="by network drivers" id="idm140417569865312"></a>
<a data-type="indexterm" data-primary="Java Database Connectivity (JDBC)" data-secondary="network drivers" id="idm140417569864208"></a>
Many data systems also implement some kind of proprietary binary encoding for their data. For
example, most relational databases have a network protocol over which you can send queries to the
database and get back responses. Those protocols are generally specific to a particular database,
and the database vendor provides a driver (e.g., using the ODBC or JDBC APIs) that decodes responses
from the database’s network protocol into in-memory data structures.</p>

<p>So, we can see that although textual data formats such as JSON, XML, and CSV are widespread, binary
encodings based on schemas are also a viable option. They have a number of nice properties:</p>

<ul>
<li>
<p>They can be much more compact than the various “binary JSON” variants, since they can omit field
names from the encoded data.</p>
</li>
<li>
<p>The schema is a valuable form of documentation, and because the schema is required for decoding,
you can be sure that it is up to date (whereas manually maintained documentation may easily
diverge from reality).</p>
</li>
<li>
<p>Keeping a database of schemas allows you to check forward and backward compatibility of schema
changes, before anything is deployed.</p>
</li>
<li>
<p>For users of statically typed programming languages, the ability to generate code from the schema
is useful, since it enables type checking at compile time.</p>
</li>
</ul>

<p><a data-type="indexterm" data-primary="schema-on-read" data-secondary="comparison to evolvable schema" id="idm140417569857136"></a>
<a data-type="indexterm" data-primary="evolvability" data-secondary="schema-on-read" id="idm140417569856016"></a>
In summary, schema evolution allows the same kind of flexibility as schemaless/schema-on-read JSON
databases provide (see <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch02.html#sec_datamodels_schema_flexibility">“Schema flexibility in the document model”</a>), while also providing better
guarantees about your data and better tooling.
<a data-type="indexterm" data-primary="binary data encodings" data-startref="ix_bindata" id="idm140417569853952"></a>
<a data-type="indexterm" data-primary="encodings (data formats)" data-startref="ix_encode" id="idm140417569852880"></a></p>
</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Modes of Dataflow"><div class="sect1" id="sec_encoding_dataflow">
<h1>Modes of Dataflow</h1>

<p><a data-type="indexterm" data-primary="dataflow" id="ix_dataflow"></a>
At the beginning of this chapter we said that whenever you want to send some data to another process
with which you don’t share memory—for example, whenever you want to send data over the network or
write it to a file—you need to encode it as a sequence of bytes. We then discussed a variety of
different encodings for doing this.</p>

<p><a data-type="indexterm" data-primary="compatibility" id="idm140417569848496"></a>
We talked about forward and backward compatibility, which are important for evolvability (making
change easy by allowing you to upgrade different parts of your system independently, and not having
to change everything at once). Compatibility is a relationship between one process that encodes the
data, and another process that decodes it.</p>

<p>That’s a fairly abstract idea—there are many ways data can flow from one process to another.
Who encodes the data, and who decodes it? In the rest of this chapter we will explore some of the
most common ways how data flows between processes:</p>

<ul>
<li>
<p>Via databases (see <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#sec_encoding_dataflow_db">“Dataflow Through Databases”</a>)</p>
</li>
<li>
<p>Via service calls (see <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#sec_encoding_dataflow_rpc">“Dataflow Through Services: REST and RPC”</a>)</p>
</li>
<li>
<p>Via asynchronous message passing (see <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#sec_encoding_dataflow_msg">“Message-Passing Dataflow”</a>)</p>
</li>
</ul>








<section data-type="sect2" data-pdf-bookmark="Dataflow Through Databases"><div class="sect2" id="sec_encoding_dataflow_db">
<h2>Dataflow Through Databases</h2>

<p><a data-type="indexterm" data-primary="compatibility" data-secondary="using databases" id="ix_compatdbs"></a>
<a data-type="indexterm" data-primary="evolvability" data-secondary="of databases" id="ix_evolvdbs"></a>
<a data-type="indexterm" data-primary="encodings (data formats)" data-secondary="compatibility" data-tertiary="using databases" id="ix_enccompdbs"></a>
<a data-type="indexterm" data-primary="schemas" data-secondary="evolution of" data-tertiary="in databases" id="ix_schemevoldbs"></a>
<a data-type="indexterm" data-primary="dataflow" data-secondary="through databases" id="idm140417569811312"></a>
<a data-type="indexterm" data-primary="databases" data-secondary="dataflow through" id="idm140417569810208"></a>
In a database, the process that writes to the database encodes the data, and the process that reads
from the database decodes it. There may just be a single process accessing the database, in which
case the reader is simply a later version of the same process—in that case you can think of
storing something in the database as <em>sending a message to your future self</em>.</p>

<p>Backward compatibility is clearly necessary here; otherwise your future self won’t be able to decode
what you previously wrote.</p>

<p>In general, it’s common for several different processes to be accessing a database at the same time.
Those processes might be several different applications or services, or they may simply be several
instances of the same service (running in parallel for scalability or fault tolerance). Either way,
in an environment where the application is changing, it is likely that some processes accessing the
database will be running newer code and some will be running older code—for example because a new
version is currently being deployed in a rolling upgrade, so some instances have been updated while
others haven’t yet.</p>

<p>This means that a value in the database may be written by a <em>newer</em> version of the code, and
subsequently read by an <em>older</em> version of the code that is still running. Thus, forward
compatibility is also often required for databases.</p>

<p>However, there is an additional snag. Say you add a field to a record schema, and the newer code
writes a value for that new field to the database. Subsequently, an older version of the code (which
doesn’t yet know about the new field) reads the record, updates it, and writes it back. In this
situation, the desirable behavior is usually for the old code to keep the new field intact, even
though it couldn’t be interpreted.</p>

<p>The encoding formats discussed previously support such preservation of unknown fields, but sometimes you
need to take care at an application level, as illustrated in <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#fig_encoding_preserve_field">Figure&nbsp;4-7</a>. For
example, if you decode a database value into model objects in the application, and later reencode
those model objects, the unknown field might be lost in that translation process. Solving this is
not a hard problem; you just need to be aware of it.</p>

<figure><div id="fig_encoding_preserve_field" class="figure">
<img src="https://www.safaribooksonline.com/library/view/designing-data-intensive-applications/9781491903063/assets/ddia_0407.png" alt="ddia 0407" width="2880" height="1565" data-mfp-src="/library/view/designing-data-intensive-applications/9781491903063/assets/ddia_0407.png">
<h6><span class="label">Figure 4-7. </span>When an older version of the application updates data previously written by a newer version of the application, data may be lost if you’re not careful.</h6>
</div></figure>










<section data-type="sect3" data-pdf-bookmark="Different values written at different times"><div class="sect3" id="idm140417569800608">
<h3>Different values written at different times</h3>

<p>A database generally allows any value to be updated at any time. This means that within a single
database you may have some values that were written five milliseconds ago, and some values that were
written five years ago.</p>

<p>When you deploy a new version of your application (of a server-side application, at least), you may
entirely replace the old version with the new version within a few minutes. The same is not true of
database contents: the five-year-old data will still be there, in the original encoding, unless you
have explicitly rewritten it since then. This observation is sometimes summed up as <em>data outlives
code</em>.</p>

<p><a data-type="indexterm" data-primary="migrating (rewriting) data" id="idm140417569797280"></a>
<a data-type="indexterm" data-primary="relational databases" data-secondary="schema changes" id="idm140417569796288"></a>
Rewriting (<em>migrating</em>) data into a new schema is certainly possible, but it’s an expensive thing to
do on a large dataset, so most databases avoid it if possible. Most relational databases allow
simple schema changes, such as adding a new column with a <code>null</code> default value, without rewriting
existing data.<sup xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook"><a data-type="noteref" id="idm140417569794096-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#idm140417569794096" class="totri-footnote">v</a></sup> When an old row is
read, the database fills in <code>null</code>s for any columns that are missing from the encoded data on disk.
<a data-type="indexterm" data-primary="LinkedIn" data-secondary="Espresso (database)" id="idm140417569791712"></a>
LinkedIn’s document database Espresso uses Avro for storage, allowing it to use Avro’s schema
evolution rules [<a data-type="noteref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Auradkar2015wz">23</a>].</p>

<p>Schema evolution thus allows the entire database to appear as if it was encoded with a single
schema, even though the underlying storage may contain records encoded with various historical
versions of the schema.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Archival storage"><div class="sect3" id="idm140417569788960">
<h3>Archival storage</h3>

<p><a data-type="indexterm" data-primary="databases" data-secondary="archival storage" id="idm140417569787760"></a>
<a data-type="indexterm" data-primary="archival storage, data from databases" id="idm140417569786656"></a>
Perhaps you take a snapshot of your database from time to time, say for backup purposes or for
loading into a data warehouse (see <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch03.html#sec_storage_dwh">“Data Warehousing”</a>). In this case, the data dump will typically
be encoded using the latest schema, even if the original encoding in the source database contained a
mixture of schema versions from different eras. Since you’re copying the data anyway, you might as
well encode the copy of the data consistently.</p>

<p><a data-type="indexterm" data-primary="Avro (data format)" data-secondary="object container files" id="idm140417569784352"></a>
<a data-type="indexterm" data-primary="Parquet (data format)" id="idm140417569783248"></a>
<a data-type="indexterm" data-primary="column-oriented storage" data-secondary="Parquet" id="idm140417569782416"></a>
<a data-type="indexterm" data-primary="storage engines" data-secondary="column-oriented" data-tertiary="Parquet" id="idm140417569781312"></a>
As the data dump is written in one go and is thereafter immutable, formats like Avro object
container files are a good fit. This is also a good opportunity to encode the data in an
analytics-friendly column-oriented format such as Parquet (see <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch03.html#sec_storage_column_compression">“Column Compression”</a>).</p>

<p>In <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch10.html#ch_batch">Chapter&nbsp;10</a> we will talk more about using data in archival storage.
<a data-type="indexterm" data-primary="compatibility" data-secondary="using databases" data-startref="ix_compatdbs" id="idm140417569777632"></a>
<a data-type="indexterm" data-primary="evolvability" data-secondary="of databases" data-startref="ix_evolvdbs" id="idm140417569776208"></a>
<a data-type="indexterm" data-primary="encodings (data formats)" data-secondary="compatibility" data-tertiary="using databases" data-startref="ix_enccompdbs" id="idm140417569774832"></a>
<a data-type="indexterm" data-primary="schemas" data-secondary="evolution of" data-tertiary="in databases" data-startref="ix_schemevoldbs" id="idm140417569773168"></a></p>
</div></section>



</div></section>













<section data-type="sect2" data-pdf-bookmark="Dataflow Through Services: REST and RPC"><div class="sect2" id="sec_encoding_dataflow_rpc">
<h2>Dataflow Through Services: REST and RPC</h2>

<p><a data-type="indexterm" data-primary="services" id="ix_servicedataflow"></a>
<a data-type="indexterm" data-primary="dataflow" data-secondary="through services" id="ix_dataflowser"></a>
<a data-type="indexterm" data-primary="clients" data-secondary="calling services" id="idm140417569767056"></a>
<a data-type="indexterm" data-primary="Application Programming Interfaces (APIs)" data-secondary="for services" data-seealso="services" id="ix_apiservices"></a>
When you have processes that need to communicate over a network, there are a few different ways of
arranging that communication. The most common arrangement is to have two roles: <em>clients</em> and
<em>servers</em>. The servers expose an API over the network, and the clients can connect to the servers
to make requests to that API. The API exposed by the server is known as a <em>service</em>.</p>

<p>The web works this way: clients (web browsers) make requests to web servers, making <code>GET</code> requests
to download HTML, CSS, JavaScript, images, etc., and making <code>POST</code> requests to submit data to the
server. The API consists of a standardized set of protocols and data formats (HTTP, URLs, SSL/TLS,
HTML, etc.). Because web browsers, web servers, and website authors mostly agree on these standards,
you can use any web browser to access any website (at least in theory!).</p>

<p><a data-type="indexterm" data-primary="Ajax" id="idm140417569760736"></a>
Web browsers are not the only type of client. For example, a native app running on a mobile device
or a desktop computer can also make network requests to a server, and a client-side JavaScript
application running inside a web browser can use XMLHttpRequest to become an HTTP client (this
technique is known as <em>Ajax</em> [<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Garrett2005wi-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Garrett2005wi">30</a>]).
In this case, the server’s response is typically not HTML for displaying to a human, but rather data
in an encoding that is convenient for further processing by the client-side application code (such
as JSON). Although HTTP may be used as the transport protocol, the API implemented on top is
application-specific, and the client and server need to agree on the details of that API.</p>

<p><a data-type="indexterm" data-primary="service-oriented architecture (SOA)" data-seealso="services" id="idm140417569756256"></a>
<a data-type="indexterm" data-primary="microservices" data-seealso="services" id="idm140417569754960"></a>
<a data-type="indexterm" data-primary="services" data-secondary="microservices" id="idm140417569753856"></a>
Moreover, a server can itself be a client to another service (for example, a typical web app server
acts as client to a database). This approach is often used to decompose a large application into
smaller services by area of functionality, such that one service makes a request to another when it
requires some functionality or data from that other service. This way of building applications has
traditionally been called a <em>service-oriented architecture</em> (SOA), more recently refined and
rebranded as <em>microservices architecture</em>
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Newman2015wq-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Newman2015wq">31</a>,
<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Richardson2014wv-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Richardson2014wv">32</a>].</p>

<p><a data-type="indexterm" data-primary="services" data-secondary="similarity to databases" id="idm140417569747568"></a>
In some ways, services are similar to databases: they typically allow clients to submit and query
data. However, while databases allow arbitrary queries using the query languages we discussed in
<a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch02.html#ch_datamodels">Chapter&nbsp;2</a>, services expose an application-specific API that only allows inputs and outputs
that are predetermined by the business logic (application code) of the service
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Helland2005tc_ch4-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Helland2005tc_ch4">33</a>]. This restriction provides a degree of encapsulation: services can impose
fine-grained restrictions on what clients can and cannot do.</p>

<p>A key design goal of a service-oriented/microservices architecture is to make the application easier
to change and maintain by making services independently deployable and evolvable. For example, each
service should be owned by one team, and that team should be able to release new versions of the
service frequently, without having to coordinate with other teams. In other words, we should expect
old and new versions of servers and clients to be running at the same time, and so the data encoding
used by servers and clients must be compatible across versions of the service API—precisely what
we’ve been talking about in this chapter.</p>










<section data-type="sect3" data-pdf-bookmark="Web services"><div class="sect3" id="idm140417569741680">
<h3>Web services</h3>

<p><a data-type="indexterm" data-primary="services" data-secondary="web services" id="idm140417569740080"></a>
<a data-type="indexterm" data-primary="web services" data-see="services" id="idm140417569738976"></a>
<a data-type="indexterm" data-primary="HTTP, use in APIs" data-see="services" id="idm140417569737872"></a>
When HTTP is used as the underlying protocol for talking to the service, it is called a <em>web
service</em>. This is perhaps a slight misnomer, because web services are not only used on the web, but
in several different contexts. For example:</p>
<ol>
<li>
<p>A client application running on a user’s device (e.g., a native app on a mobile device, or JavaScript
web app using Ajax) making requests to a service over HTTP. These requests typically go over the
public internet.</p>
</li>
<li>
<p>One service making requests to another service owned by the same organization, often located
within the same datacenter, as part of a service-oriented/microservices architecture. (Software that supports
this kind of use case is sometimes called <em>middleware</em>.)</p>
</li>
<li>
<p>One service making requests to a service owned by a different organization, usually via the
internet. This is used for data exchange between different organizations’ backend systems. This
category includes public APIs provided by online services, such as credit card processing
systems, or OAuth for shared access to user data.</p>
</li>

</ol>

<p><a data-type="indexterm" data-primary="REST (Representational State Transfer)" data-seealso="services" id="idm140417569731408"></a>
There are two popular approaches to web services: <em>REST</em> and <em>SOAP</em>. They are almost diametrically
opposed in terms of philosophy, and often the subject of heated debate among their respective
proponents.<sup xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook"><a data-type="noteref" id="idm140417569729296-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#idm140417569729296">vi</a></sup></p>

<p><a data-type="indexterm" data-primary="Application Programming Interfaces (APIs)" data-secondary="for services" data-tertiary="RESTful" id="idm140417569726928"></a>
REST is not a protocol, but rather a design philosophy that builds upon the principles of HTTP
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Fielding2000vh-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Fielding2000vh">34</a>, <a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Fielding2008wj-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Fielding2008wj">35</a>].
It emphasizes simple data formats, using URLs for identifying resources and using HTTP features for
cache control, authentication, and content type negotiation. REST has been gaining popularity
compared to SOAP, at least in the context of cross-organizational service integration
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Pingdom2010-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Pingdom2010">36</a>],
and is often associated with microservices
[<a data-type="noteref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Newman2015wq">31</a>]. An API designed according to the
principles of REST is called <em>RESTful</em>.</p>

<p><a data-type="indexterm" data-primary="SOAP" data-seealso="services" id="idm140417569717232"></a>
<a data-type="indexterm" data-primary="WS-* framework" data-seealso="services" id="idm140417569715904"></a>
<a data-type="indexterm" data-primary="Application Programming Interfaces (APIs)" data-secondary="for services" data-tertiary="SOAP" id="idm140417569714800"></a>
By contrast, SOAP is an XML-based protocol for making network API
requests.<sup xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook"><a data-type="noteref" id="idm140417569713328-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#idm140417569713328">vii</a></sup>
Although it is most commonly used over HTTP, it aims to be independent from HTTP and avoids using
most HTTP features. Instead, it comes with a sprawling and complex multitude of related standards
(the <em>web service framework</em>, known as <em>WS-*</em>) that add various features
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Innoq2007-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Innoq2007">37</a>].</p>

<p><a data-type="indexterm" data-primary="Web Services Description Language (WSDL)" id="idm140417569708752"></a>
<a data-type="indexterm" data-primary="code generation" data-secondary="with WSDL" id="idm140417569707888"></a>
The API of a SOAP web service is described using an XML-based language called the Web Services
Description Language, or WSDL. WSDL enables code generation so that a client can access a remote
service using local classes and method calls (which are encoded to XML messages and decoded again by
the framework). This is useful in statically typed programming languages, but less so in dynamically
typed ones (see <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#sec_encoding_code_generation">“Code generation and dynamically typed languages”</a>).</p>

<p>As WSDL is not designed to be human-readable, and as SOAP messages are often too complex to
construct manually, users of SOAP rely heavily on tool support, code generation, and IDEs
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Lacey2006ul-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Lacey2006ul">38</a>].
For users of programming languages that are not supported by SOAP vendors, integration with SOAP
services is difficult.</p>

<p>Even though SOAP and its various extensions are ostensibly standardized, interoperability between
different vendors’ implementations often causes problems
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Tilkov2006tb-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Tilkov2006tb">39</a>]. For all of these reasons,
although SOAP is still used in many large enterprises, it has fallen out of favor in most smaller
companies.</p>

<p><a data-type="indexterm" data-primary="OpenAPI (service definition format)" id="idm140417569699360"></a>
<a data-type="indexterm" data-primary="Swagger (service definition format)" id="idm140417569698512"></a>
RESTful APIs tend to favor simpler approaches, typically involving less code generation and
automated tooling. A definition format such as OpenAPI, also known as Swagger
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Swagger2014-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Swagger2014">40</a>], can be used to describe RESTful APIs and produce
documentation.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="The problems with remote procedure calls (RPCs)"><div class="sect3" id="idm140417569741056">
<h3>The problems with remote procedure calls (RPCs)</h3>

<p><a data-type="indexterm" data-primary="services" data-secondary="remote procedure calls (RPCs)" id="ix_servrpc"></a>
<a data-type="indexterm" data-primary="remote procedure calls (RPCs)" data-seealso="services" id="ix_rpcs"></a>
<a data-type="indexterm" data-primary="RPCs" data-see="remote procedure calls" id="idm140417569690928"></a>
<a data-type="indexterm" data-primary="Remote Method Invocation (Java RMI)" id="idm140417569689824"></a>
<a data-type="indexterm" data-primary="Enterprise JavaBeans (EJB)" id="idm140417569688976"></a>
<a data-type="indexterm" data-primary="Java Enterprise Edition (EE)" id="idm140417569688128"></a>
<a data-type="indexterm" data-primary="Microsoft" data-secondary="DCOM (Distributed Component Object Model)" id="idm140417569687280"></a>
<a data-type="indexterm" data-primary="CORBA (Common Object Request Broker Architecture)" id="idm140417569686080"></a>
Web services are merely the latest incarnation of a long line of technologies for making API
requests over a network, many of which received a lot of hype but have serious problems. Enterprise
JavaBeans (EJB) and Java’s Remote Method Invocation (RMI) are limited to Java. The Distributed
Component Object Model (DCOM) is limited to Microsoft platforms. The Common Object Request Broker
Architecture (CORBA) is excessively complex, and does not provide backward or forward
compatibility [<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Henning2006jb-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Henning2006jb">41</a>].</p>

<p><a data-type="indexterm" data-primary="location transparency" id="idm140417569681776"></a>
All of these are based on the idea of a <em>remote procedure call</em> (RPC), which has been around since
the 1970s [<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Birrell1984hv-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Birrell1984hv">42</a>].
The RPC model tries to make a request to a remote network service look the same as calling a function or
method in your programming language, within the same process (this abstraction is called <em>location
transparency</em>). Although RPC seems convenient at first, the approach is fundamentally flawed
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Waldo1994wx_ch4-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Waldo1994wx_ch4">43</a>,
<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Vinoski2008gv-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Vinoski2008gv">44</a>].
A network request is very different from a local function call:
<a data-type="indexterm" data-primary="services" data-secondary="remote procedure calls (RPCs)" data-tertiary="issues with" id="idm140417569672112"></a>
<a data-type="indexterm" data-primary="remote procedure calls (RPCs)" data-secondary="issues with" id="idm140417569670672"></a></p>

<ul>
<li>
<p>A local function call is predictable and either succeeds or fails, depending only on parameters
that are under your control. A network request is unpredictable: the request or response may be
lost due to a network problem, or the remote machine may be slow or unavailable, and such problems
are entirely outside of your control. Network problems are common, so you have to anticipate them,
for example by retrying a failed request.</p>
</li>
<li>
<p>A local function call either returns a result, or throws an exception, or never returns (because
it goes into an infinite loop or the process crashes). A network request has another possible
outcome: it may return without a result, due to a <em>timeout</em>. In that case, you simply don’t know
what happened: if you don’t get a response from the remote service, you have no way of knowing
whether the request got through or not. (We discuss this issue in more detail in <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch08.html#ch_distributed">Chapter&nbsp;8</a>.)</p>
</li>
<li>
<p>If you retry a failed network request, it could happen that the requests are actually getting
through, and only the responses are getting lost.<a data-type="indexterm" data-primary="idempotence" id="idm140417569664384"></a>
In that case, <span class="keep-together">retrying</span> will cause the action to
be performed multiple times, unless you build a mechanism for deduplication (<em>idempotence</em>) into
the protocol. Local function calls don’t have this problem. (We discuss idempotence in more detail
in <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch11.html#ch_stream">Chapter&nbsp;11</a>.)</p>
</li>
<li>
<p>Every time you call a local function, it normally takes about the same time to execute. A network
request is much slower than a function call, and its latency is also wildly variable: at good
times it may complete in less than a millisecond, but when the network is congested or the remote
service is overloaded it may take many seconds to do exactly the same thing.</p>
</li>
<li>
<p>When you call a local function, you can efficiently pass it references (pointers) to objects in
local memory. When you make a network request, all those parameters need to be encoded into a
sequence of bytes that can be sent over the network. That’s okay if the parameters are primitives
like numbers or strings, but quickly becomes problematic with larger objects.</p>
</li>
<li>
<p>The client and the service may be implemented in different programming languages, so the RPC
framework must translate datatypes from one language into another. This can end up ugly, since not
all languages have the same types—recall JavaScript’s problems with numbers greater than 2<sup>53</sup>,
for example (see <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#sec_encoding_json">“JSON, XML, and Binary Variants”</a>). This problem doesn’t exist in a single process written in
a single language.</p>
</li>
</ul>

<p>All of these factors mean that there’s no point trying to make a remote service look too much like a
local object in your programming language, because it’s a fundamentally different thing. Part of the
appeal of REST is that it doesn’t try to hide the fact that it’s a network protocol (although this
doesn’t seem to stop people from building RPC libraries on top of REST).</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Current directions for RPC"><div class="sect3" id="idm140417569655392">
<h3>Current directions for RPC</h3>

<p><a data-type="indexterm" data-primary="services" data-secondary="web services" id="idm140417569653984"></a>
<a data-type="indexterm" data-primary="Google" data-secondary="gRPC (RPC framework)" id="idm140417569652656"></a>
<a data-type="indexterm" data-primary="Twitter" data-secondary="Finagle (RPC framework)" id="idm140417569651552"></a>
<a data-type="indexterm" data-primary="LinkedIn" data-secondary="Rest.li (RPC framework)" id="idm140417569650448"></a>
<a data-type="indexterm" data-primary="remote procedure calls (RPCs)" data-secondary="using Avro" id="idm140417569649344"></a>
<a data-type="indexterm" data-primary="remote procedure calls (RPCs)" data-secondary="using Thrift" id="idm140417569648272"></a>
Despite all these problems, RPC isn’t going away. Various RPC frameworks have been built on top of
all the encodings mentioned in this chapter: for example, Thrift and Avro come with RPC support
included, gRPC is an RPC implementation using Protocol Buffers, Finagle also uses Thrift, and Rest.li
uses JSON over HTTP.</p>

<p><a data-type="indexterm" data-primary="remote procedure calls (RPCs)" data-secondary="based on futures" id="idm140417569646736"></a>
<a data-type="indexterm" data-primary="futures (asynchronous operations)" id="idm140417569645440"></a>
<a data-type="indexterm" data-primary="promises (asynchronous operations)" id="idm140417569644640"></a>
This new generation of RPC frameworks is more explicit about the fact that a remote request is
different from a local function call. For example, Finagle and Rest.li use <em>futures</em> (<em>promises</em>) to
encapsulate asynchronous actions that may fail. Futures also simplify situations where you need to
make requests to multiple services in parallel, and combine their results
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Eriksen2013gz-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Eriksen2013gz">45</a>].
gRPC supports <em>streams</em>, where a call consists of not just one request and one response, but a
series of requests and responses over time
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="gRPC2015-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#gRPC2015">46</a>].</p>

<p><a data-type="indexterm" data-primary="service discovery" id="idm140417569636864"></a>
Some of these frameworks also provide <em>service discovery</em>—that is, allowing a client to find out
at which IP address and port number it can find a particular service. We will return to this topic
in <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch06.html#sec_partitioning_routing">“Request Routing”</a>.</p>

<p><a data-type="indexterm" data-primary="curl (Unix tool)" id="idm140417569634304"></a>
Custom RPC protocols with a binary encoding format can achieve better performance than something
generic like JSON over REST. However, a RESTful API has other significant advantages: it is good for
experimentation and debugging (you can simply make requests to it using a web browser or the
command-line tool <code>curl</code>, without any code generation or software installation), it is supported by
all mainstream programming languages and platforms, and there is a vast ecosystem of tools available (servers,
caches, load balancers, proxies, firewalls, monitoring, debugging tools, testing tools, etc.).</p>

<p>For these reasons, REST seems to be the predominant style for public APIs. The main focus of RPC
frameworks is on requests between services owned by the same organization, typically within the same
datacenter.</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Data encoding and evolution for RPC"><div class="sect3" id="idm140417569631696">
<h3>Data encoding and evolution for RPC</h3>

<p><a data-type="indexterm" data-primary="compatibility" data-secondary="calling services" id="idm140417569630288"></a>
<a data-type="indexterm" data-primary="evolvability" data-secondary="calling services" id="idm140417569628960"></a>
<a data-type="indexterm" data-primary="encodings (data formats)" data-secondary="compatibility" data-tertiary="calling services" id="idm140417569627856"></a>
<a data-type="indexterm" data-primary="schemas" data-secondary="evolution of" data-tertiary="in service calls" id="idm140417569626512"></a>
<a data-type="indexterm" data-primary="remote procedure calls (RPCs)" data-secondary="data encoding and evolution" id="idm140417569625136"></a>
<a data-type="indexterm" data-primary="Application Programming Interfaces (APIs)" data-secondary="for services" data-tertiary="evolvability" id="idm140417569624000"></a>
For evolvability, it is important that RPC clients and servers can be changed and deployed
independently. Compared to data flowing through databases (as described in the last section), we can make a
simplifying assumption in the case of dataflow through services: it is reasonable to assume that
all the servers will be updated first, and all the clients second. Thus, you only need backward
compatibility on requests, and forward compatibility on responses.</p>

<p>The backward and forward compatibility properties of an RPC scheme are inherited from whatever
encoding it uses:</p>

<ul>
<li>
<p>Thrift, gRPC (Protocol Buffers), and Avro RPC can be evolved according to the compatibility rules
of the respective encoding format.</p>
</li>
<li>
<p><a data-type="indexterm" data-primary="SOAP" data-secondary="evolvability" id="idm140417569619856"></a>
In SOAP, requests and responses are specified with XML schemas. These can be evolved, but there
are some subtle pitfalls
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Narayan2007vg-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Narayan2007vg">47</a>].</p>
</li>
<li>
<p>RESTful APIs most commonly use JSON (without a formally specified schema) for responses, and
JSON or URI-encoded/form-encoded request parameters for requests. Adding optional request
parameters and adding new fields to response objects are usually considered changes that maintain
compatibility.</p>
</li>
</ul>

<p>Service compatibility is made harder by the fact that RPC is often used for communication across
organizational boundaries, so the provider of a service often has no control over its clients and
cannot force them to upgrade. Thus, compatibility needs to be maintained for a long time, perhaps
indefinitely. If a compatibility-breaking change is required, the service provider often ends up
maintaining multiple versions of the service API side by side.</p>

<p>There is no agreement on how API versioning should work (i.e., how a client can indicate which
version of the API it wants to use [<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Hunt2014wn-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Hunt2014wn">48</a>]). For RESTful APIs, common approaches are to use a version
number in the URL or in the HTTP <code>Accept</code> header. For services that use API keys to identify a
particular client, another option is to store a client’s requested API version on the server and to
allow this version selection to be updated through a separate administrative interface
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="StripeAPI-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#StripeAPI">49</a>].
<a data-type="indexterm" data-primary="remote procedure calls (RPCs)" data-startref="ix_rpcs" id="idm140417569608688"></a>
<a data-type="indexterm" data-primary="services" data-secondary="remote procedure calls (RPCs)" data-startref="ix_servrpc" id="idm140417569607520"></a>
<a data-type="indexterm" data-primary="services" data-startref="ix_servicedataflow" id="idm140417569606128"></a>
<a data-type="indexterm" data-primary="dataflow" data-secondary="through services" data-startref="ix_dataflowser" id="idm140417569605024"></a>
<a data-type="indexterm" data-primary="Application Programming Interfaces (APIs)" data-secondary="for services" data-startref="ix_apiservices" id="idm140417569603648"></a></p>
</div></section>



</div></section>













<section data-type="sect2" data-pdf-bookmark="Message-Passing Dataflow"><div class="sect2" id="sec_encoding_dataflow_msg">
<h2>Message-Passing Dataflow</h2>

<p><a data-type="indexterm" data-primary="message-passing" id="ix_messagedata"></a>
<a data-type="indexterm" data-primary="dataflow" data-secondary="message-passing" id="ix_dataflowmessage"></a>
We have been looking at the different ways encoded data flows from one process to another. So
far, we’ve discussed REST and RPC (where one process sends a request over the network to another
process and expects a response as quickly as possible), and databases (where one process writes
encoded data, and another process reads it again sometime in the future).</p>

<p>In this final section, we will briefly look at <em>asynchronous message-passing</em> systems, which are
somewhere between RPC and databases. They are similar to RPC in that a client’s request (usually
called a <em>message</em>) is delivered to another process with low latency. They are similar to databases
in that the message is not sent via a direct network connection, but goes via an intermediary called
a <em>message broker</em> (also called a <em>message queue</em> or <em>message-oriented middleware</em>), which stores
the message temporarily.</p>

<p><a data-type="indexterm" data-primary="remote procedure calls (RPCs)" data-secondary="versus message brokers" id="idm140417569594752"></a>
<a data-type="indexterm" data-primary="message-passing" data-secondary="advantages over direct RPC" id="idm140417569593632"></a>
Using a message broker has several advantages compared to direct RPC:</p>

<ul>
<li>
<p>It can act as a buffer if the recipient is unavailable or overloaded, and thus improve system
reliability.</p>
</li>
<li>
<p>It can automatically redeliver messages to a process that has crashed, and thus prevent messages from
being lost.</p>
</li>
<li>
<p>It avoids the sender needing to know the IP address and port number of the recipient (which is
particularly useful in a cloud deployment where virtual machines often come and go).</p>
</li>
<li>
<p>It allows one message to be sent to several recipients.</p>
</li>
<li>
<p>It logically decouples the sender from the recipient (the sender just publishes messages and
doesn’t care who consumes them).</p>
</li>
</ul>

<p>However, a difference compared to RPC is that message-passing communication is usually one-way: a
sender normally doesn’t expect to receive a reply to its messages. It is possible for a process to
send a response, but this would usually be done on a separate channel. This communication pattern is
<em>asynchronous</em>: the sender doesn’t wait for the message to be delivered, but simply sends it and
then forgets about it.</p>










<section data-type="sect3" data-pdf-bookmark="Message brokers"><div class="sect3" id="idm140417569585616">
<h3>Message brokers</h3>

<p><a data-type="indexterm" data-primary="TIBCO" id="idm140417569584176"></a>
<a data-type="indexterm" data-primary="IBM" data-secondary="WebSphere (messaging)" id="idm140417569583184"></a>
<a data-type="indexterm" data-primary="webMethods (messaging)" id="idm140417569582080"></a>
<a data-type="indexterm" data-primary="RabbitMQ (messaging)" id="idm140417569581248"></a>
<a data-type="indexterm" data-primary="ActiveMQ (messaging)" id="idm140417569580416"></a><a data-type="indexterm" data-primary="Apache ActiveMQ" data-see="ActiveMQ" id="idm140417569579712"></a>
<a data-type="indexterm" data-primary="HornetQ (messaging)" id="idm140417569578640"></a>
<a data-type="indexterm" data-primary="NATS (messaging)" id="idm140417569577808"></a>
<a data-type="indexterm" data-primary="Kafka (messaging)" id="idm140417569576976"></a><a data-type="indexterm" data-primary="Apache Kafka" data-see="Kafka" id="idm140417569576272"></a>
In the past, the landscape of message brokers was dominated by commercial enterprise software from
companies such as TIBCO, IBM WebSphere, and webMethods. More recently, open source implementations
such as RabbitMQ, ActiveMQ, HornetQ, NATS, and Apache Kafka have become popular. We will compare them
in more detail in <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch11.html#ch_stream">Chapter&nbsp;11</a>.</p>

<p><a data-type="indexterm" data-primary="consumers (message streams)" id="idm140417569573904"></a>
<a data-type="indexterm" data-primary="topics (messaging)" id="idm140417569572912"></a><a data-type="indexterm" data-primary="queues (messaging)" id="idm140417569572176"></a>
The detailed delivery semantics vary by implementation and configuration, but in general, message
brokers are used as follows: one process sends a message to a named <em>queue</em> or <em>topic</em>, and the
broker ensures that the message is delivered to one or more <em>consumers</em> of or <em>subscribers</em> to that
queue or topic. There can be many producers and many consumers on the same topic.</p>

<p>A topic provides only one-way dataflow. However, a consumer may itself publish messages to another
topic (so you can chain them together, as we shall see in <a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch11.html#ch_stream">Chapter&nbsp;11</a>), or to a reply queue that
is consumed by the sender of the original message (allowing a request/response dataflow, similar to
RPC).</p>

<p>Message brokers typically don’t enforce any particular data model—a message is just a sequence of
bytes with some metadata, so you can use any encoding format. If the encoding is backward and
forward compatible, you have the greatest flexibility to change publishers and consumers
independently and deploy them in any order.</p>

<p>If a consumer republishes messages to another topic, you may need to be careful to preserve unknown
fields, to prevent the issue described previously in the context of databases
(<a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#fig_encoding_preserve_field">Figure&nbsp;4-7</a>).</p>
</div></section>













<section data-type="sect3" data-pdf-bookmark="Distributed actor frameworks"><div class="sect3" id="sec_encoding_actors">
<h3>Distributed actor frameworks</h3>

<p><a data-type="indexterm" data-primary="actor model" data-seealso="message-passing" id="idm140417569563920"></a>
<a data-type="indexterm" data-primary="message-passing" data-secondary="distributed actor frameworks" id="idm140417569562592"></a>
<a data-type="indexterm" data-primary="concurrency" data-secondary="actor programming model" data-seealso="message-passing" id="idm140417569561520"></a>
<a data-type="indexterm" data-primary="threads (concurrency)" data-secondary="actor model" data-seealso="message-passing" id="idm140417569560144"></a>
The <em>actor model</em> is a programming model for concurrency in a single process. Rather than dealing
directly with threads (and the associated problems of race conditions, locking, and deadlock), logic
is encapsulated in <em>actors</em>. Each actor typically represents one client or entity, it may have some
local state (which is not shared with any other actor), and it communicates with other actors by
sending and receiving asynchronous messages. Message delivery is not guaranteed: in certain error
scenarios, messages will be lost. Since each actor processes only one message at a time, it doesn’t
need to worry about threads, and each actor can be scheduled independently by the framework.</p>

<p><a data-type="indexterm" data-primary="distributed actor frameworks" id="idm140417569557072"></a>
In <em>distributed actor frameworks</em>, this programming model is used to scale an application across
multiple nodes. The same message-passing mechanism is used, no matter whether the sender and recipient
are on the same node or different nodes. If they are on different nodes, the message is
transparently encoded into a byte sequence, sent over the network, and decoded on the other side.</p>

<p><a data-type="indexterm" data-primary="location transparency" data-secondary="in the actor model" id="idm140417569555232"></a>
Location transparency works better in the actor model than in RPC, because the actor model already
assumes that messages may be lost, even within a single process. Although latency over the network
is likely higher than within the same process, there is less of a fundamental mismatch between local
and remote communication when using the actor model.</p>

<p>A distributed actor framework essentially integrates a message broker and the actor programming
model into a single framework. However, if you want to perform rolling upgrades of your actor-based
application, you still have to worry about forward and backward compatibility, as messages may be
sent from a node running the new version to a node running the old version, and vice versa.</p>

<p><a data-type="indexterm" data-primary="compatibility" data-secondary="using message-passing" id="idm140417569552688"></a>
<a data-type="indexterm" data-primary="evolvability" data-secondary="of message-passing" id="idm140417569551584"></a>
<a data-type="indexterm" data-primary="encodings (data formats)" data-secondary="compatibility" data-tertiary="using message-passing" id="idm140417569550480"></a>
<a data-type="indexterm" data-primary="schemas" data-secondary="evolution of" data-tertiary="in message-passing" id="idm140417569549040"></a>
<a data-type="indexterm" data-primary="message-passing" data-secondary="evolvability" id="idm140417569547664"></a>
Three popular distributed actor frameworks handle message encoding as follows:</p>

<ul>
<li>
<p><a data-type="indexterm" data-primary="Akka (actor framework)" id="idm140417569545664"></a>
<em>Akka</em> uses Java’s built-in serialization by default, which does not provide forward or backward
compatibility. However, you can replace it with something like Protocol Buffers, and thus gain the
ability to do rolling upgrades [<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Boner2013tx-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Boner2013tx">50</a>].</p>
</li>
<li>
<p><a data-type="indexterm" data-primary="Orleans (actor framework)" id="idm140417569540704"></a>
<a data-type="indexterm" data-primary="Microsoft" data-secondary="Orleans" data-see="Orleans" id="idm140417569539808"></a>
<em>Orleans</em> by default uses a custom data encoding format that does not support rolling upgrade
deployments; to deploy a new version of your application, you need to set up a new cluster, move
traffic from the old cluster to the new one, and shut down the old one
[<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Bernstein2014tr-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Bernstein2014tr">51</a>,
<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Orleans2015-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Orleans2015">52</a>].
Like with Akka, custom serialization plug-ins can be used.</p>
</li>
<li>
<p><a data-type="indexterm" data-primary="Erlang OTP (actor framework)" id="idm140417569532896"></a>
  In <em>Erlang OTP</em> it is surprisingly hard to make changes to record schemas (despite the system
  having many features designed for high availability); rolling upgrades are possible but need to be
  planned carefully
  [<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Mercer2007va-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Mercer2007va">53</a>].
  An experimental new <code>maps</code> datatype (a JSON-like structure, introduced in Erlang R17 in 2014) may
  make this easier in the future [<a xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="noteref" id="Hebert2014uu-marker" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Hebert2014uu">54</a>].
<a data-type="indexterm" data-primary="message-passing" data-startref="ix_messagedata" id="idm140417569525824"></a>
<a data-type="indexterm" data-primary="dataflow" data-secondary="message-passing" data-startref="ix_dataflowmessage" id="idm140417569524688"></a>
<a data-type="indexterm" data-primary="dataflow" data-startref="ix_dataflow" id="idm140417569523312"></a></p>
</li>
</ul>
</div></section>



</div></section>





</div></section>













<section data-type="sect1" data-pdf-bookmark="Summary"><div class="sect1" id="idm140417569522080">
<h1>Summary</h1>

<p>In this chapter we looked at several ways of turning data structures into bytes on the network or
bytes on disk. We saw how the details of these encodings affect not only their efficiency, but more
importantly also the architecture of applications and your options for deploying them.</p>

<p>In particular, many services need to support rolling upgrades, where a new version of a service is
gradually deployed to a few nodes at a time, rather than deploying to all nodes simultaneously.
Rolling upgrades allow new versions of a service to be released without downtime (thus encouraging
frequent small releases over rare big releases) and make deployments less risky (allowing faulty
releases to be detected and rolled back before they affect a large number of users). These
properties are hugely beneficial for <em>evolvability</em>, the ease of making changes to an application.</p>

<p>During rolling upgrades, or for various other reasons, we must assume that different nodes are
running the different versions of our application’s code. Thus, it is important that all data
flowing around the system is encoded in a way that provides backward compatibility (new code can
read old data) and forward compatibility (old code can read new data).</p>

<p><a data-type="indexterm" data-primary="compatibility" data-secondary="properties of encoding formats" id="idm140417569517808"></a>
We discussed several data encoding formats and their compatibility properties:</p>

<ul>
<li>
<p>Programming language–specific encodings are restricted to a single programming language and often
fail to provide forward and backward compatibility.</p>
</li>
<li>
<p>Textual formats like JSON, XML, and CSV are widespread, and their compatibility depends on how you
use them. They have optional schema languages, which are sometimes helpful and sometimes a
hindrance. These formats are somewhat vague about datatypes, so you have to be careful with things
like numbers and binary strings.</p>
</li>
<li>
<p>Binary schema–driven formats like Thrift, Protocol Buffers, and Avro allow compact, efficient
encoding with clearly defined forward and backward compatibility semantics. The schemas can be
useful for documentation and code generation in statically typed languages. However, they have the
downside that data needs to be decoded before it is human-readable.</p>
</li>
</ul>

<p>We also discussed several modes of dataflow, illustrating different scenarios in which data
encodings are important:</p>

<ul>
<li>
<p>Databases, where the process writing to the database encodes the data and the process reading
from the database decodes it</p>
</li>
<li>
<p>RPC and REST APIs, where the client encodes a request, the server decodes the request and encodes
a response, and the client finally decodes the response</p>
</li>
<li>
<p>Asynchronous message passing (using message brokers or actors), where nodes communicate by sending
each other messages that are encoded by the sender and decoded by the recipient</p>
</li>
</ul>

<p>We can conclude that with a bit of care, backward/forward compatibility and rolling upgrades are
quite achievable. May your application’s evolution be rapid and your deployments be frequent.</p>
</div></section>







<div data-type="footnotes"><h5>Footnotes</h5><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="idm140417570447152"><sup><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#idm140417570447152-marker" class="totri-footnote">i</a></sup> With the exception of some special
cases, such as certain memory-mapped files or when operating directly on compressed data (as described in
<a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch03.html#sec_storage_column_compression">“Column Compression”</a>).</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="idm140417570437856"><sup><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#idm140417570437856-marker">ii</a></sup> Note that <em>encoding</em>
has nothing to do with <em>encryption</em>. We don’t discuss encryption in this book.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="idm140417570109808"><sup><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#idm140417570109808-marker">iii</a></sup> Actually, it has three—BinaryProtocol,
CompactProtocol, and DenseProtocol—although DenseProtocol is only supported by the C++
implementation, so it doesn’t count as cross-language [<a data-type="noteref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#ThriftLangs">18</a>].
Besides those, it also has two different JSON-based encoding formats
[<a data-type="noteref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Kleppmann2012tu">19</a>]. What fun!</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="idm140417569933760"><sup><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#idm140417569933760-marker">iv</a></sup> To be precise, the default value must be
of the type of the <em>first</em> branch of the union, although this is a specific limitation of
Avro, not a general feature of union types.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="idm140417569794096"><sup><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#idm140417569794096-marker" class="totri-footnote">v</a></sup> Except for MySQL, which often
rewrites an entire table even though it is not strictly necessary, as mentioned in
<a data-type="xref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch02.html#sec_datamodels_schema_flexibility">“Schema flexibility in the document model”</a>.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="idm140417569729296"><sup><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#idm140417569729296-marker">vi</a></sup> Even within each camp there are plenty of
arguments. For example, HATEOAS (<em>hypermedia as the engine of application
state</em>), often provokes discussions
[<a data-type="noteref" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Fielding2008wj">35</a>].</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="idm140417569713328"><sup><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#idm140417569713328-marker">vii</a></sup> Despite the similarity of acronyms,
SOAP is not a requirement for SOA. SOAP is a particular technology, whereas SOA is a general
approach to building systems.</p></div><div data-type="footnotes"><h5>References</h5><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="JavaSerializable">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#JavaSerializable-marker" class="totri-footnote">1</a>] “<a href="http://docs.oracle.com/javase/7/docs/platform/serialization/spec/serialTOC.html">Java
Object Serialization Specification</a>,” <em>docs.oracle.com</em>, 2010.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="RubyAPI">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#RubyAPI-marker" class="totri-footnote">2</a>] “<a href="http://ruby-doc.org/core-2.2.0/">Ruby 2.2.0 API
Documentation</a>,” <em>ruby-doc.org</em>, Dec 2014.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="PythonPickle">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#PythonPickle-marker" class="totri-footnote">3</a>] “<a href="https://docs.python.org/3/library/pickle.html">The
Python 3.4.3 Standard Library Reference Manual</a>,” <em>docs.python.org</em>, February 2015.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="JavaKryo">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#JavaKryo-marker" class="totri-footnote">4</a>] “<a href="https://github.com/EsotericSoftware/kryo">EsotericSoftware/kryo</a>,”
<em>github.com</em>, October 2014.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="CWE502">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#CWE502-marker" class="totri-footnote">5</a>] “<a href="http://cwe.mitre.org/data/definitions/502.html">CWE-502:
Deserialization of Untrusted Data</a>,” Common Weakness Enumeration, <em>cwe.mitre.org</em>,
July 30, 2014.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Breen2015up">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Breen2015up-marker" class="totri-footnote">6</a>] Steve Breen:
“<a href="http://foxglovesecurity.com/2015/11/06/what-do-weblogic-websphere-jboss-jenkins-opennms-and-your-application-have-in-common-this-vulnerability/">What
Do WebLogic, WebSphere, JBoss, Jenkins, OpenNMS, and Your Application Have in Common? This
Vulnerability</a>,” <em>foxglovesecurity.com</em>, November 6, 2015.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="McKenzie2013uv">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#McKenzie2013uv-marker" class="totri-footnote">7</a>] Patrick McKenzie:
“<a href="http://www.kalzumeus.com/2013/01/31/what-the-rails-security-issue-means-for-your-startup/">What
the Rails Security Issue Means for Your Startup</a>,” <em>kalzumeus.com</em>, January 31, 2013.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="JvmSerializers">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#JvmSerializers-marker" class="totri-footnote">8</a>] Eishay Smith:
“<a href="https://github.com/eishay/jvm-serializers/wiki">jvm-serializers wiki</a>,”
<em>github.com</em>, November 2014.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="XMLSExp">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#XMLSExp-marker" class="totri-footnote">9</a>] “<a href="http://c2.com/cgi/wiki?XmlIsaPoorCopyOfEssExpressions">XML
Is a Poor Copy of S-Expressions</a>,” <em>c2.com</em> wiki.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Harris2010vu">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Harris2010vu-marker">10</a>] Matt Harris:
“<a href="https://groups.google.com/forum/#!topic/twitter-development-talk/ahbvo3VTIYI">Snowflake:
An Update and Some Very Important Information</a>,” email to <em>Twitter Development
Talk</em> mailing list, October 19, 2010.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="W3CXMLSchema">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#W3CXMLSchema-marker">11</a>] Shudi (Sandy) Gao, C. M. Sperberg-McQueen, and
Henry S. Thompson: “<a href="http://www.w3.org/XML/Schema">XML Schema 1.1</a>,” W3C Recommendation,
May 2001.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Galiegue2013wu">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Galiegue2013wu-marker">12</a>] Francis Galiegue, Kris Zyp, and Gary Court:
“<a href="http://json-schema.org/">JSON Schema</a>,” IETF Internet-Draft, February 2013.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Shafranovich2005vq">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Shafranovich2005vq-marker">13</a>] Yakov Shafranovich:
“<a href="https://tools.ietf.org/html/rfc4180">RFC 4180: Common Format and MIME Type for
Comma-Separated Values (CSV) Files</a>,” October 2005.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="MsgPack">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#MsgPack-marker">14</a>] “<a href="http://msgpack.org/">MessagePack
Specification</a>,” <em>msgpack.org</em>.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Slee2007vh">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Slee2007vh-marker">15</a>] Mark Slee, Aditya Agarwal, and Marc Kwiatkowski:
“<a href="http://thrift.apache.org/static/files/thrift-20070401.pdf">Thrift: Scalable
Cross-Language Services Implementation</a>,” Facebook technical report, April 2007.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="GoogleProtobuf">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#GoogleProtobuf-marker">16</a>] “<a href="https://developers.google.com/protocol-buffers/docs/overview">Protocol
Buffers Developer Guide</a>,” Google, Inc., <em>developers.google.com</em>.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Anishchenko2012tx">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Anishchenko2012tx-marker">17</a>] Igor Anishchenko:
“<a href="http://www.slideshare.net/IgorAnishchenko/pb-vs-thrift-vs-avro">Thrift vs Protocol
Buffers vs Avro - Biased Comparison</a>,” <em>slideshare.net</em>, September 17, 2012.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="ThriftLangs">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#ThriftLangs-marker">18</a>] “<a href="http://wiki.apache.org/thrift/LibraryFeatures">A
Matrix of the Features Each Individual Language Library Supports</a>,”
<em>wiki.apache.org</em>.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Kleppmann2012tu">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Kleppmann2012tu-marker">19</a>] Martin Kleppmann:
“<a href="http://martin.kleppmann.com/2012/12/05/schema-evolution-in-avro-protocol-buffers-thrift.html">Schema
Evolution in Avro, Protocol Buffers and Thrift</a>,” <em>martin.kleppmann.com</em>, December 5, 2012.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="ApacheAvro">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#ApacheAvro-marker">20</a>] “<a href="http://avro.apache.org/docs/1.7.7/">Apache
Avro 1.7.7 Documentation</a>,” <em>avro.apache.org</em>, July 2014.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Cutting2009tu">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Cutting2009tu-marker">21</a>] Doug Cutting, Chad Walters, Jim Kellerman, et al.:
“<a href="http://mail-archives.apache.org/mod_mbox/hadoop-general/200904.mbox/%3C49D53694.1050906@apache.org%3E">[PROPOSAL]
New Subproject: Avro</a>,” email thread on <em>hadoop-general</em> mailing list,
<em>mail-archives.apache.org</em>, April 2009.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Hoare2009vv">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Hoare2009vv-marker">22</a>] Tony Hoare:
“<a href="http://www.infoq.com/presentations/Null-References-The-Billion-Dollar-Mistake-Tony-Hoare">Null
References: The Billion Dollar Mistake</a>,” at <em>QCon London</em>,
March 2009.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Auradkar2015wz">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Auradkar2015wz-marker">23</a>] Aditya Auradkar and Tom Quiggle:
“<a href="https://engineering.linkedin.com/espresso/introducing-espresso-linkedins-hot-new-distributed-document-store">Introducing
Espresso—LinkedIn’s Hot New Distributed Document Store</a>,” <em>engineering.linkedin.com</em>, January 21, 2015.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Kreps2015ux">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Kreps2015ux-marker">24</a>] Jay Kreps:
“<a href="http://blog.confluent.io/2015/02/25/stream-data-platform-2/">Putting Apache Kafka to
Use: A Practical Guide to Building a Stream Data Platform (Part 2)</a>,” <em>blog.confluent.io</em>,
February 25, 2015.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Shapira2014wf">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Shapira2014wf-marker">25</a>] Gwen Shapira:
“<a href="http://radar.oreilly.com/2014/11/the-problem-of-managing-schemas.html">The Problem of
Managing Schemas</a>,” <em>radar.oreilly.com</em>, November 4, 2014.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="ApachePig">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#ApachePig-marker">26</a>] “<a href="http://pig.apache.org/docs/r0.14.0/">Apache
Pig 0.14.0 Documentation</a>,” <em>pig.apache.org</em>, November 2014.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Larmouth1999">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Larmouth1999-marker">27</a>] John Larmouth:
<a href="http://www.oss.com/asn1/resources/books-whitepapers-pubs/larmouth-asn1-book.pdf"><em>ASN.1
Complete</em></a>. Morgan Kaufmann, 1999. ISBN: 978-0-122-33435-1</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Housley1999tv">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Housley1999tv-marker">28</a>] Russell Housley, Warwick Ford, Tim Polk, and David Solo:
“<a href="https://www.ietf.org/rfc/rfc2459.txt">RFC 2459: Internet X.509 Public Key
Infrastructure: Certificate and CRL Profile</a>,” IETF Network Working Group, Standards Track,
January 1999.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Walkin2010ur">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Walkin2010ur-marker">29</a>] Lev Walkin:
“<a href="http://lionet.info/asn1c/blog/2010/09/21/question-extensibility-removing-fields/">Question:
Extensibility and Dropping Fields</a>,” <em>lionet.info</em>, September 21, 2010.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Garrett2005wi">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Garrett2005wi-marker">30</a>] Jesse James Garrett:
“<a href="http://www.adaptivepath.com/ideas/ajax-new-approach-web-applications/">Ajax: A New
Approach to Web Applications</a>,” <em>adaptivepath.com</em>, February 18, 2005.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Newman2015wq">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Newman2015wq-marker">31</a>] Sam Newman: <em>Building Microservices</em>.
O’Reilly Media, 2015. ISBN: 978-1-491-95035-7</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Richardson2014wv">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Richardson2014wv-marker">32</a>] Chris Richardson:
“<a href="http://www.infoq.com/articles/microservices-intro">Microservices: Decomposing
Applications for Deployability and Scalability</a>,” <em>infoq.com</em>, May 25, 2014.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Helland2005tc_ch4">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Helland2005tc_ch4-marker">33</a>] Pat Helland:
“<a href="http://cidrdb.org/cidr2005/papers/P12.pdf">Data on the Outside Versus Data on the
Inside</a>,” at <em>2nd Biennial Conference on Innovative Data Systems Research</em> (CIDR),
January 2005.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Fielding2000vh">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Fielding2000vh-marker">34</a>] Roy Thomas Fielding:
“<a href="https://www.ics.uci.edu/~fielding/pubs/dissertation/fielding_dissertation.pdf">Architectural
Styles and the Design of Network-Based Software Architectures</a>,” PhD Thesis, University of
California, Irvine, 2000.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Fielding2008wj">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Fielding2008wj-marker">35</a>] Roy Thomas Fielding:
“<a href="http://roy.gbiv.com/untangled/2008/rest-apis-must-be-hypertext-driven">REST APIs Must
Be Hypertext-Driven</a>,” <em>roy.gbiv.com</em>, October 20 2008.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Pingdom2010">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Pingdom2010-marker">36</a>] “<a href="http://royal.pingdom.com/2010/10/15/rest-in-peace-soap/">REST
in Peace, SOAP</a>,” <em>royal.pingdom.com</em>, October 15, 2010.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Innoq2007">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Innoq2007-marker">37</a>] “<a href="https://www.innoq.com/resources/ws-standards-poster/">Web
Services Standards as of Q1 2007</a>,” <em>innoq.com</em>, February 2007.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Lacey2006ul">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Lacey2006ul-marker">38</a>] Pete Lacey:
“<a href="http://harmful.cat-v.org/software/xml/soap/simple">The S
Stands for Simple</a>,” <em>harmful.cat-v.org</em>, November 15, 2006.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Tilkov2006tb">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Tilkov2006tb-marker">39</a>] Stefan Tilkov:
“<a href="http://www.infoq.com/articles/pete-lacey-ws-criticism">Interview: Pete Lacey Criticizes
Web Services</a>,” <em>infoq.com</em>, December 12, 2006.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Swagger2014">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Swagger2014-marker">40</a>] “<a href="http://swagger.io/specification/">OpenAPI
Specification (fka Swagger RESTful API Documentation Specification) Version 2.0</a>,”
<em>swagger.io</em>, September 8, 2014.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Henning2006jb">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Henning2006jb-marker">41</a>] Michi Henning:
“<a href="http://queue.acm.org/detail.cfm?id=1142044">The Rise and Fall of CORBA</a>,”
<em>ACM Queue</em>, volume 4, number 5, pages 28–34, June 2006.
<a href="http://dx.doi.org/10.1145/1142031.1142044">doi:10.1145/1142031.1142044</a></p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Birrell1984hv">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Birrell1984hv-marker">42</a>] Andrew D. Birrell and Bruce Jay Nelson:
“<a href="http://www.cs.princeton.edu/courses/archive/fall03/cs518/papers/rpc.pdf">Implementing
Remote Procedure Calls</a>,” <em>ACM Transactions on Computer Systems</em> (TOCS),
volume 2, number 1, pages 39–59, February 1984.
<a href="http://dx.doi.org/10.1145/2080.357392">doi:10.1145/2080.357392</a></p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Waldo1994wx_ch4">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Waldo1994wx_ch4-marker">43</a>] Jim Waldo, Geoff Wyant, Ann Wollrath, and Sam Kendall:
“<a href="http://m.mirror.facebook.net/kde/devel/smli_tr-94-29.pdf">A Note on Distributed Computing</a>,”
Sun Microsystems Laboratories, Inc., Technical Report TR-94-29, November 1994.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Vinoski2008gv">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Vinoski2008gv-marker">44</a>] Steve Vinoski:
“<a href="http://steve.vinoski.net/pdf/IEEE-Convenience_Over_Correctness.pdf">Convenience over
Correctness</a>,” <em>IEEE Internet Computing</em>, volume 12, number 4, pages 89–92, July 2008.
<a href="http://dx.doi.org/10.1109/MIC.2008.75">doi:10.1109/MIC.2008.75</a></p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Eriksen2013gz">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Eriksen2013gz-marker">45</a>] Marius Eriksen:
“<a href="http://monkey.org/~marius/funsrv.pdf">Your Server as a Function</a>,” at
<em>7th Workshop on Programming Languages and Operating Systems</em> (PLOS), November 2013.
<a href="http://dx.doi.org/10.1145/2525528.2525538">doi:10.1145/2525528.2525538</a></p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="gRPC2015">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#gRPC2015-marker">46</a>] “<a href="https://github.com/grpc/grpc-common">grpc-common
Documentation</a>,” Google, Inc., <em>github.com</em>, February 2015.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Narayan2007vg">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Narayan2007vg-marker">47</a>] Aditya Narayan and Irina Singh:
“<a href="http://www.ibm.com/developerworks/websphere/library/techarticles/0705_narayan/0705_narayan.html">Designing
and Versioning Compatible Web Services</a>,” <em>ibm.com</em>, March 28, 2007.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Hunt2014wn">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Hunt2014wn-marker">48</a>] Troy Hunt:
“<a href="http://www.troyhunt.com/2014/02/your-api-versioning-is-wrong-which-is.html">Your API
Versioning Is Wrong, Which Is Why I Decided to Do It 3 Different Wrong Ways</a>,” <em>troyhunt.com</em>,
February 10, 2014.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="StripeAPI">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#StripeAPI-marker">49</a>] “<a href="https://stripe.com/docs/upgrades">API
Upgrades</a>,” Stripe, Inc., April 2015.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Boner2013tx">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Boner2013tx-marker">50</a>] Jonas Bonér:
“<a href="http://grokbase.com/t/gg/akka-user/138wd8j9e3/upgrade-in-an-akka-cluster">Upgrade in an
Akka Cluster</a>,” email to <em>akka-user</em> mailing list, <em>grokbase.com</em>, August 28, 2013.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Bernstein2014tr">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Bernstein2014tr-marker">51</a>] Philip A. Bernstein, Sergey Bykov, Alan Geller, et al.:
“<a href="http://research.microsoft.com/pubs/210931/Orleans-MSR-TR-2014-41.pdf">Orleans:
Distributed Virtual Actors for Programmability and Scalability</a>,” Microsoft Research
Technical Report MSR-TR-2014-41, March 2014.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Orleans2015">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Orleans2015-marker">52</a>] “<a href="http://dotnet.github.io/orleans/">Microsoft Project
Orleans Documentation</a>,” Microsoft Research, <em>dotnet.github.io</em>, 2015.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Mercer2007va">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Mercer2007va-marker">53</a>] David Mercer, Sean Hinde, Yinso Chen, and Richard A O’Keefe:
  “<a href="http://erlang.org/pipermail/erlang-questions/2007-October/030318.html">beginner:
  Updating Data Structures</a>,” email thread on <em>erlang-questions</em> mailing list, <em>erlang.com</em>,
  October 29, 2007.</p><p xmlns:htmlbook="https://github.com/oreillymedia/HTMLBook" data-type="footnote" id="Hebert2014uu">[<a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#Hebert2014uu-marker">54</a>] Fred Hebert:
  “<a href="http://learnyousomeerlang.com/maps">Postscript: Maps</a>,” <em>learnyousomeerlang.com</em>,
  April 9, 2014.</p></div></div></section><div class="annotator-outer annotator-viewer viewer annotator-hide">
  <ul class="annotator-widget annotator-listing"></ul>
</div><div class="annotator-modal-wrapper annotator-editor-modal annotator-editor annotator-hide">
	<div class="annotator-outer editor">
		<h2 class="title">Highlight</h2>
		<form class="annotator-widget">
			<ul class="annotator-listing">
			<li class="annotator-item"><textarea id="annotator-field-0" placeholder="Add a note using markdown (optional)" class="js-editor" maxlength="750"></textarea></li></ul>
			<div class="annotator-controls">
				<a class="link-to-markdown" href="https://daringfireball.net/projects/markdown/basics" target="_blank">?</a>
				<ul>
					<li class="delete annotator-hide"><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#delete" class="annotator-delete-note button positive">Delete Note</a></li>
					<li class="save"><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#save" class="annotator-save annotator-focus button positive">Save Note</a></li>
					<li class="cancel"><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#cancel" class="annotator-cancel button">Cancel</a></li>
				</ul>
			</div>
		</form>
	</div>
</div><div class="annotator-modal-wrapper annotator-delete-confirm-modal" style="display: none;">
  <div class="annotator-outer">
    <h2 class="title">Highlight</h2>
      <a class="js-close-delete-confirm annotator-cancel close" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#close">Close</a>
      <div class="annotator-widget">
         <div class="delete-confirm">
            Are you sure you want to permanently delete this note?
         </div>
         <div class="annotator-controls">
            <a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#cancel" class="annotator-cancel button js-cancel-delete-confirm">No, I changed my mind</a>
            <a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#delete" class="annotator-delete button positive js-delete-confirm">Yes, delete it</a>
         </div>
       </div>
   </div>
</div><div class="annotator-adder" style="display: none;">
	<ul class="adders ">
		
		<li class="copy"><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#">Copy</a></li>
		
		<li class="add-highlight"><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#">Add Highlight</a></li>
		<li class="add-note"><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#">
			
				Add Note
			
		</a></li>
		
	</ul>
</div></div></div>



  <div class="t-sbo-prev sbo-prev sbo-nav-bottom">
  
    
      
        <a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch03.html" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">3. Storage and Retrieval</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-bottom">
  
    
      
        <a href="/site/library/view/designing-data-intensive-applications/9781491903063/part02.html" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">II. Distributed Data</div>
        </a>
    
  
  </div>


        
    </section>
  </div>
<section class="sbo-saved-archives"></section>



          
          
  




    
    
      <div id="js-subscribe-nag" class="subscribe-nag clearfix trial-panel t-subscribe-nag collapsed slideUp">
        
        
          
          
            <p class="usage-data">Find answers on the fly, or master something new. Subscribe today. <a href="https://www.safaribooksonline.com/subscribe/" class="ga-active-trial-subscribe-nag">See pricing options.</a></p>
          

          
        
        

      </div>

    
    



        
      </div>
<div style="width:0px; height:0px; display:none; visibility:hidden;" id="batBeacon0.6353805672598438"><img style="width:0px; height:0px; display:none; visibility:hidden;" id="batBeacon0.19590757557539829" width="0" height="0" alt="" src="https://bat.bing.com/action/0?ti=5794699&amp;Ver=2&amp;mid=f995923a-b4b3-d612-6e33-08bf33cf54e5&amp;pi=1200101525&amp;lg=en-US&amp;sw=1440&amp;sh=900&amp;sc=24&amp;tl=4.%20Encoding%20and%20Evolution%20-%20Designing%20Data-Intensive%20Applications&amp;p=https%3A%2F%2Fwww.safaribooksonline.com%2Flibrary%2Fview%2Fdesigning-data-intensive-applications%2F9781491903063%2Fch04.html&amp;r=&amp;evt=pageLoad&amp;msclkid=N&amp;rn=755062"></div>
      




  <footer class="pagefoot t-pagefoot" style="padding-bottom: 69px;">
    <a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#" class="icon-up"><div class="visuallyhidden">Back to top</div></a>
    <ul class="js-footer-nav">
      
        <li><a class="t-recommendations-footer" href="https://www.safaribooksonline.com/r/">Recommended</a></li>
      
      <li>
      <a class="t-queue-footer" href="https://www.safaribooksonline.com/playlists/">Playlists</a>
      </li>
      
        <li><a class="t-recent-footer" href="https://www.safaribooksonline.com/history/">History</a></li>
        <li><a class="t-topics-footer" href="https://www.safaribooksonline.com/topics?q=*&amp;limit=21">Topics</a></li>
      
      
        <li><a class="t-tutorials-footer" href="https://www.safaribooksonline.com/tutorials/">Tutorials</a></li>
      
      <li><a class="t-settings-footer js-settings" href="https://www.safaribooksonline.com/u/preferences/">Settings</a></li>
      <li class="full-support"><a href="https://www.oreilly.com/online-learning/support/">Support</a></li>
      <li><a href="https://www.safaribooksonline.com/apps/">Get the App</a></li>
      <li><a href="https://www.safaribooksonline.com/accounts/logout/">Sign Out</a></li>
    </ul>
    <span class="copyright">© 2018 <a href="https://www.safaribooksonline.com/" target="_blank">Safari</a>.</span>
    <a href="https://www.safaribooksonline.com/terms/">Terms of Service</a> /
    <a href="https://www.safaribooksonline.com/privacy/">Privacy Policy</a>
  </footer>




    
    
      <img src="https://www.oreilly.com/library/view/oreilly_set_cookie/" alt="" style="display:none;">
    
    
    
  

<div class="annotator-notice"></div><div class="font-flyout"><div class="font-controls-panel">
	<div class="nightmodes">
		<ul>
			<li class="day"><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#" id="day-mode" title="Day Mode">
				<i class="fa fa-sun-o"></i>
				<span>Day Mode</span></a></li>
			<li class="cloudy"><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#" id="cloudy-mode" title="Cloudy Mode">
				<i class="fa fa-cloud"></i>
				<span>Cloud Mode</span>
			</a></li>
			<li class="night"><a href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#" id="night-mode" title="Night Mode">
				<i class="fa fa-moon-o"></i>
				<span>Night Mode</span>
			</a></li>
		</ul>
	</div>

	<div class="font-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-font left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-font-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-font right"></i>
		</div>
	</div>

	<div class="column-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-compress left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-column-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-expand right"></i>
		</div>
	</div>

	<a id="reset" class="button" href="/site/library/view/designing-data-intensive-applications/9781491903063/ch04.html#">Reset</a>
</div>
</div></body></html>